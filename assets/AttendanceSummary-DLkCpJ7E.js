import{u as W,j as e}from"./query-vendor-B--u1oZD.js";import{r as m}from"./react-vendor-XXJdR_Id.js";import{a as J,e as Y}from"./index-ysxJ7eO1.js";import{y as Z,a0 as ee,j as se,X as te,h as ae,f as R,b as A,z as re,t as u,c as T,u as $,w as M,v as q,a2 as le,q as ne}from"./ui-vendor-DMb5NT47.js";const me=()=>{const{t:z}=J(),[x,P]=m.useState("by-class"),[w,B]=m.useState(""),[S,H]=m.useState(""),[g,k]=m.useState("class_name"),[p,F]=m.useState("asc"),[n,N]=m.useState({page:1,limit:20,total:0}),[h,L]=m.useState(""),{data:y,isLoading:I,error:E,refetch:Q}=W({queryKey:["admin-attendance-summary",w,S],queryFn:async()=>await Y.getAttendanceSummary({semester:w||void 0,program:S||void 0}),enabled:!0}),j=y?.overall_stats,V=m.useMemo(()=>{const c=[...y?.by_class||[]].sort((t,l)=>{let r=0;switch(g){case"class_name":r=(t.class_name||"").localeCompare(l.class_name||"");break;case"course_name":r=(t.course_name||"").localeCompare(l.course_name||"");break;case"attendance":r=l.percentage-0-(t.percentage-0);break;case"students":r=(t.total_students||0)-(l.total_students||0);break;case"meetings":r=(t.total_meetings||0)-(l.total_meetings||0);break;case"percentage":r=(l.percentage||0)-(t.percentage||0);break;default:r=0}return p==="asc"?r:-r});return N(t=>({...t,total:c.length})),c},[y?.by_class,g,p]),G=m.useMemo(()=>{const s=y?.by_student||[];let c=s;if(h){const l=h.toLowerCase();c=s.filter(r=>r.name.toLowerCase().includes(l)||r.nim.toLowerCase().includes(l))}const t=[...c].sort((l,r)=>{let a=0;switch(g){case"name":a=l.name.localeCompare(r.name);break;case"nim":a=l.nim.localeCompare(r.nim);break;case"program":a=(l.program||"").localeCompare(r.program||"");break;case"percentage":a=r.overall_percentage-l.overall_percentage;break;case"classes_count":a=l.classes.length-r.classes.length;break;default:a=0}return p==="asc"?a:-a});return N(l=>({...l,total:t.length})),t},[y?.by_student,g,p,h]),i=x==="by-class"?V:G,C=m.useMemo(()=>i.length===0?1:Math.ceil(i.length/n.limit),[i.length,n.limit]),D=m.useMemo(()=>{const s=(n.page-1)*n.limit,c=s+n.limit;return i.slice(s,c)},[i,n.page,n.limit]),o=(s,c)=>{const t=g===s;return e.jsx("button",{onClick:()=>X(s),className:`flex items-center gap-1 ${t?"text-blue-600":"text-gray-400"} hover:text-blue-800`,title:`Sort by ${s} (${p==="asc"?"ascending":"descending"})`,children:p==="asc"?e.jsx(le,{className:"h-4 w-4"}):e.jsx(ne,{className:"h-4 w-4"})})},b=s=>s>=80?"text-green-600 bg-green-50":s>=70?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50",X=s=>{g===s?F(p==="asc"?"desc":"asc"):(k(s),F("asc"))},O=s=>{N(c=>({...c,page:s}))},K=()=>{if(i.length===0)return;let s=[];if(x==="by-class")s=[["Class ID","Class Name","Course Code","Course Name","Students","Meetings","Hadir","Izin","Sakit","Terlambat","Alfa","Attendance %"],...i.map(a=>[String(a.class_id),a.class_name,a.course_code,a.course_name,String(a.total_students),String(a.total_meetings),String(a.attended),String(a.excused),String(a.sick),String(a.late),String(a.absent),`${a.percentage.toFixed(1)}%`])];else{const a=new Set;i.forEach(d=>{d.classes.forEach(_=>{a.add(_.course_code)})});const U=Array.from(a).sort();s=[["NIM","Name","Program","Overall %","Total Classes",...U.flatMap(d=>[`${d} Attended`,`${d} Total`,`${d} %`])],...i.map(d=>{const _=new Map(d.classes.map(f=>[f.course_code,f]));return[d.nim,d.name,d.program,`${d.overall_percentage.toFixed(1)}%`,String(d.classes.length),...U.flatMap(f=>{const v=_.get(f);return v?[String(v.attended),String(v.total_meetings),`${v.percentage.toFixed(1)}%`]:["","",""]})]})]}const c=s.map(a=>a.join(",")).join(`
`),t=new Blob([c],{type:"text/csv"}),l=URL.createObjectURL(t),r=document.createElement("a");r.href=l,r.download=`attendance-summary-${x}-${new Date().toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(l)};return I?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Z,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading attendance summary..."})]}):E?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-800",children:["Error loading attendance summary: ",E.message]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:z("sidebar.attendanceSummary")}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Overview of student attendance by class and student"})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Semester"}),e.jsx("input",{type:"text",placeholder:"e.g., 2024-2025 Ganjil",value:w,onChange:s=>B(s.target.value),className:"input-field"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Program"}),e.jsx("input",{type:"text",placeholder:"e.g., IF",value:S,onChange:s=>H(s.target.value),className:"input-field"})]}),x==="by-student"&&e.jsxs("div",{className:"flex-1 min-w-[300px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Students"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or NIM...",value:h,onChange:s=>L(s.target.value),className:"input-field pl-10"}),h&&e.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 p-1 text-gray-400 hover:text-gray-600",title:"Clear search",children:e.jsx(te,{className:"h-4 w-4"})})]})]})]})}),j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:`card p-4 border-l-4 ${b(j.average_attendance)}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(ae,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Attendance"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[j.average_attendance.toFixed(1),"%"]})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(R,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Students"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.total_students})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(A,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Classes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.total_classes})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(A,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Meetings"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.total_meetings})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:x==="by-class"?"Class Attendance":"Student Attendance"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",i.length," ",x==="by-class"?"classes":"students"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:K,className:"btn-secondary flex items-center gap-2",disabled:i.length===0,title:`Export ${x==="by-class"?"Classes":"Students"} to CSV`,children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:"Export CSV"})]}),e.jsxs("button",{onClick:()=>Q(),className:"btn-secondary flex items-center gap-2",title:"Refresh data",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>{P("by-class"),N(s=>({...s,page:1})),k("class_name")},className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${x==="by-class"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"By Class"}),e.jsx("button",{onClick:()=>{P("by-student"),N(s=>({...s,page:1})),k("name")},className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${x==="by-student"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"By Student"})]})}),x==="by-class"&&e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Class ",o("class_name")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Course Name ",o("course_name")]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Students ",o("students")]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Meetings ",o("meetings")]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Attendance ",o("percentage")]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Breakdown"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map((s,c)=>e.jsxs("tr",{className:c===0?"border-t border-gray-300":"",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.class_name})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.course_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.course_code})]}),e.jsx("td",{className:"px-4 py-4 text-center text-sm text-gray-900",children:s.total_students}),e.jsx("td",{className:"px-4 py-4 text-center text-sm text-gray-900",children:s.total_meetings}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-bold ${b(s.percentage)}`,children:[s.percentage.toFixed(1),"%"]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs flex-wrap",children:[s.attended>0&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600",title:"Hadir (Present)",children:[e.jsx(u,{className:"h-3 w-3"})," ",s.attended]}),s.excused>0&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",title:"Izin (Excused)",children:[e.jsx(T,{className:"h-3 w-3"})," ",s.excused]}),s.sick>0&&e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",title:"Sakit (Sick)",children:[e.jsx($,{className:"h-3 w-3"})," ",s.sick]}),s.late>0&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-600",title:"Terlambat (Late)",children:[e.jsx(M,{className:"h-3 w-3"})," ",s.late]}),s.absent>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-600",title:"Alfa (Absent)",children:[e.jsx(q,{className:"h-3 w-3"})," ",s.absent]})]})})]},s.class_id))})]})})}),x==="by-student"&&e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center gap-1",children:["NIM ",o("nim")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Name ",o("name")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Program ",o("program")]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Classes ",o("classes_count")]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Overall ",o("percentage")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[400px]",children:"Class Details"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map((s,c)=>e.jsxs("tr",{className:c===0?"border-t border-gray-300":"",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.nim})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.name})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded bg-gray-100 text-gray-700",children:s.program})}),e.jsx("td",{className:"px-4 py-4 text-center text-sm text-gray-900",children:s.classes.length}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-bold ${b(s.overall_percentage)}`,children:[s.overall_percentage.toFixed(1),"%"]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"space-y-1",children:s.classes.map(t=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.course_code}),e.jsx("span",{className:"text-gray-500 ml-1",children:"-"}),e.jsx("span",{className:"text-gray-600",children:t.course_name})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold ${b(t.percentage)}`,children:[t.percentage.toFixed(1),"%"]})})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs pl-2",children:t.excused!==void 0||t.sick!==void 0||t.late!==void 0||t.absent!==void 0||t.substitute!==void 0?e.jsxs(e.Fragment,{children:[t.attended>0&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600",title:"Hadir (Present)",children:[e.jsx(u,{className:"h-3 w-3"})," ",t.attended]}),t.excused!==void 0&&t.excused>0&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",title:"Izin (Excused)",children:[e.jsx(T,{className:"h-3 w-3"})," ",t.excused]}),t.sick!==void 0&&t.sick>0&&e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",title:"Sakit (Sick)",children:[e.jsx($,{className:"h-3 w-3"})," ",t.sick]}),t.late!==void 0&&t.late>0&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-600",title:"Terlambat (Late)",children:[e.jsx(M,{className:"h-3 w-3"})," ",t.late]}),t.substitute!==void 0&&t.substitute>0&&e.jsxs("span",{className:"flex items-center gap-1 text-purple-600",title:"Pengganti (Substitute)",children:[e.jsx(u,{className:"h-3 w-3"})," ",t.substitute]}),t.absent!==void 0&&t.absent>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-600",title:"Alfa (Absent)",children:[e.jsx(q,{className:"h-3 w-3"})," ",t.absent]}),(t.absent!==void 0||t.substitute!==void 0)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-600",children:t.total_meetings})]})]}):e.jsxs("span",{className:"text-gray-600",title:"Hadir",children:["✓",t.attended," / ",t.total_meetings]})})]},t.class_id))})})]},s.nim))})]})})}),C>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(n.page-1)*n.limit+1," to"," ",Math.min(n.page*n.limit,i.length)," of ",i.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(n.page-1),disabled:n.page===1,className:"px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",n.page," of ",C]}),e.jsx("button",{onClick:()=>O(n.page+1),disabled:n.page===C,className:"px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Next"})]})]})})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"Present (Hadir)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Excused (Izin)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{children:"Sick (Sakit)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"Late (Terlambat)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{children:"Absent (Alfa)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"Substitute (Pengganti)"})]}),e.jsx("div",{className:"w-px h-4 bg-gray-300 mx-2"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-100"}),e.jsx("span",{className:"text-green-600",children:"Good (≥80%)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-100"}),e.jsx("span",{className:"text-yellow-600",children:"Warning (≥70%)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-100"}),e.jsx("span",{className:"text-red-600",children:"Poor (<70%)"})]})]})}),!I&&i.length===0&&e.jsxs("div",{className:"text-center py-12 card",children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No attendance data found"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:h?"Try adjusting your search query":"Try adjusting filters or check if classes have been created"})]})]})};export{me as default};
//# sourceMappingURL=AttendanceSummary-DLkCpJ7E.js.map
