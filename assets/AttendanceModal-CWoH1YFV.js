import{b as ue,j as e}from"./query-vendor-B--u1oZD.js";import{g as c}from"./react-vendor-XXJdR_Id.js";import{g as k}from"./index-BYG0ekbM.js";import{d as ge,e as pe,c as he,u as be,a as fe,b as ye}from"./useAttendances-sywbn539.js";import{u as je}from"./useLecturerAssignments-BSprSVq5.js";import{c as ve,i as ke,Z as we}from"./ui-vendor-CkH0jJa3.js";const y=(a,w="")=>a?typeof a=="string"?a:"String"in a&&typeof a.String=="string"?a.String:"Time"in a&&typeof a.Time=="string"?a.Time:k(a,w):w,Ee=({selectedMeeting:a,onClose:w})=>{const U=ue(),{data:z,isLoading:ee}=ge(a?.classId),{data:F,isLoading:te}=pe(a?.meetingId),{data:N,refetch:R}=he(a?.classId),S=c.useMemo(()=>z??[],[z]),M=c.useMemo(()=>F??[],[F]),{data:A=[]}=je({id_kelas:a?.classId?String(a.classId):void 0}),I=c.useMemo(()=>{const t={};return A.forEach(s=>{const i=k(s.id_dosen),d=k(s.nama_dosen);i&&d&&(t[i]=d)}),t},[A]),se=c.useMemo(()=>{const t=new Set;return A.forEach(s=>{const i=k(s.id_dosen);i&&t.add(i)}),Array.from(t)},[A]),l=c.useMemo(()=>{if(!a||!N||N.length===0)return null;const t=N.find(H=>H.id===a.meetingId);if(!t)return null;let s="",i="",d="",n="",r="",f="";s=y(t.tgl_pertemuan,""),i=y(t.jam_pertemuan,""),d=y(t.topik,""),n=y(t.id_dosen,""),r=y(t.realisasi_topik,""),f=y(t.catatan_pertemuan,"");let v=!1;t.absensi_aktif!==null&&t.absensi_aktif!==void 0&&(typeof t.absensi_aktif=="boolean"?v=t.absensi_aktif:typeof t.absensi_aktif=="object"&&"Bool"in t.absensi_aktif&&(v=t.absensi_aktif.Valid?t.absensi_aktif.Bool:!1));let P;if(s&&i){const H=s.includes("T")?s.split("T")[0]:s.split(" ")[0]||s,me=i.length===5?`${i}:00`:i.split(".")[0]||i,xe=`${H}T${me}`;P=new Date(xe)}return{meetingDateTime:P,topic:d,lecturerId:n,absensiAktif:v,realisasiTopik:r,catatanPertemuan:f}},[a,N]),u=be(),g=fe(),h=ye(),[x,o]=c.useState({}),[ae,C]=c.useState(!1),[D,q]=c.useState(!1),[ne,T]=c.useState(!1),[b,O]=c.useState(""),[m,Q]=c.useState(""),[$,W]=c.useState(""),[K,V]=c.useState(""),[p,L]=c.useState(!1),[_,X]=c.useState(""),[E,Z]=c.useState(""),j=c.useMemo(()=>{if(!S||S.length===0)return[];const t=new Map(M.map(s=>[s.nim,{status:k(s.status_kehadiran,""),id:s.id}]));return S.map(s=>{const i=t.get(s.nim);return{...s,status:i?.status||"Belum Absen",attendanceId:i?.id}})},[S,M]),G=async(t,s,i)=>{if(!a)return;const d=new Date().toISOString();try{i?await g.mutateAsync({id:i,data:{status_kehadiran:s,waktu_masuk:d}}):await u.mutateAsync({id_pertemuan:a.meetingId,nim:t,status_kehadiran:s,waktu_masuk:d})}catch(n){alert(`Failed to update attendance: ${n instanceof Error?n.message:"Unknown error"}`)}},ie=async()=>{if(!a||Object.keys(x).length===0)return;q(!0);const t=[],s=new Date().toISOString();for(const i of Object.keys(x)){const d=x[i],n=j.find(r=>r.nim===i);if(n)try{n.attendanceId?await g.mutateAsync({id:n.attendanceId,data:{status_kehadiran:d,waktu_masuk:s}}):await u.mutateAsync({id_pertemuan:a.meetingId,nim:i,status_kehadiran:d,waktu_masuk:s})}catch{t.push(`${n.nama} (${i})`)}}q(!1),t.length>0?alert(`Failed to update attendance for: ${t.join(", ")}`):(o({}),C(!1))},re=()=>{const t={};j.forEach(s=>{t[s.nim]=s.status==="Belum Absen"?"Hadir":s.status||"Hadir"}),o(t),C(!0)},le=()=>{o({}),C(!1)},de=async()=>{if(!(!a||!b||!m))try{const t=m.length===5?`${m}:00`:m;await h.mutateAsync({id:a.meetingId,data:{tgl_pertemuan:b,jam_pertemuan:t,topik:$||void 0,id_dosen:K||void 0,absensi_aktif:p,realisasi_topik:_||void 0,catatan_pertemuan:E||void 0}}),await R(),await U.invalidateQueries({queryKey:["lecturer-meeting-recap"]}),T(!1),alert("Meeting schedule updated successfully!")}catch(t){alert(`Failed to update meeting: ${t instanceof Error?t.message:"Unknown error"}`)}};c.useEffect(()=>{const t=l?.meetingDateTime||a?.meetingDateTime,s=l?.topic||a?.topic||"",i=l?.lecturerId||"",d=l?.absensiAktif||!1,n=l?.realisasiTopik||"",r=l?.catatanPertemuan||"";if(t){const f=new Date(t),v=f.toISOString().split("T")[0],P=`${String(f.getHours()).padStart(2,"0")}:${String(f.getMinutes()).padStart(2,"0")}`;O(v),Q(P),W(s),V(i),L(d),X(n),Z(r)}},[l?.meetingDateTime,l?.topic,l?.lecturerId,l?.absensiAktif,l?.realisasiTopik,l?.catatanPertemuan,a?.meetingDateTime,a?.topic]);const ce=()=>{T(!0)},oe=()=>{o({}),C(!1),T(!1),w()},B=l?.meetingDateTime||a?.meetingDateTime,J=c.useMemo(()=>B?new Date(B).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):a?.dateLabel,[B,a?.dateLabel]),Y=l?.topic||a?.topic;return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4 bg-black/30",children:e.jsxs("div",{className:"w-full h-full max-h-screen sm:max-h-[90vh] max-w-6xl bg-white rounded-lg shadow-lg flex flex-col overflow-hidden",children:[e.jsx("div",{className:"px-3 sm:px-4 py-2 border-b border-gray-200 flex items-center justify-end flex-shrink-0",children:e.jsx("button",{onClick:oe,className:"px-3 py-1.5 text-sm rounded hover:bg-gray-100 cursor-pointer","aria-label":"Close",children:"Close"})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[e.jsxs("div",{className:"w-full sm:w-1/3 border-r border-gray-200 overflow-y-auto p-3 sm:p-4",children:[e.jsxs("div",{className:"mb-4 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 truncate",children:a.subtitle}),e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 line-clamp-2",children:a.title}),J&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:J})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Course Week"}),e.jsx("div",{className:"text-sm text-gray-900 font-mono",children:a.subtitle})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Course Code - Name"}),e.jsx("div",{className:"text-sm text-gray-900",children:a.title})]}),ne?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:b,onChange:t=>O(t.target.value),className:"input-field w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Time"}),e.jsx("input",{type:"time",value:m,onChange:t=>Q(t.target.value),className:"input-field w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Topic"}),e.jsx("textarea",{value:$,onChange:t=>W(t.target.value),className:"input-field w-full text-sm",rows:3,placeholder:"Enter meeting topic or description...",maxLength:500}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Realized Topic"}),e.jsx("textarea",{value:_,onChange:t=>X(t.target.value),className:"input-field w-full text-sm",rows:3,placeholder:"Enter actual/realized topic delivered...",maxLength:500}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[_.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Meeting Notes"}),e.jsx("textarea",{value:E,onChange:t=>Z(t.target.value),className:"input-field w-full text-sm",rows:3,placeholder:"Enter any notes or observations from this meeting...",maxLength:500}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[E.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Lecturer"}),e.jsxs("select",{value:K,onChange:t=>V(t.target.value),className:"input-field w-full text-sm",children:[e.jsx("option",{value:"",children:"- No Lecturer -"}),se.map(t=>e.jsx("option",{value:t,children:I[t]||t},t))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:t=>L(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable Attendance"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:"When enabled, students can check-in for attendance"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:de,disabled:h.isPending||!b||!m,className:"px-3 py-1.5 text-sm font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex-1",children:h.isPending?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>T(!1),disabled:h.isPending,className:"px-3 py-1.5 text-sm font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Date"}),e.jsx("div",{className:"text-sm text-gray-900",children:b?new Date(`${b}T00:00`).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Time"}),e.jsxs("div",{className:"text-sm text-gray-900 font-mono flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 mr-2"}),m||"-"]})]}),Y&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Topic"}),e.jsx("div",{className:"text-sm text-gray-900 break-words",children:Y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Realized Topic"}),e.jsx("div",{className:"text-sm text-gray-900 break-words",children:_||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Meeting Notes"}),e.jsx("div",{className:"text-sm text-gray-900 break-words",children:E||"-"})]}),l?.lecturerId&&I[l.lecturerId]&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Lecturer"}),e.jsxs("div",{className:"text-sm text-gray-900 flex items-center",children:[e.jsx(ke,{className:"h-3 w-3 mr-2 flex-shrink-0"}),I[l.lecturerId]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Attendance Status"}),e.jsxs("div",{className:`text-sm flex items-center gap-2 ${l?.absensiAktif?"text-green-600":"text-gray-600"}`,children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${l?.absensiAktif?"bg-green-600":"bg-gray-400"}`}),l?.absensiAktif?"Enabled":"Disabled"]})]}),e.jsxs("button",{onClick:ce,className:"w-full px-3 py-2 text-sm font-medium rounded bg-blue-600 text-white hover:bg-blue-700 cursor-pointer flex items-center justify-center gap-2 mt-2",title:"Edit meeting schedule",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Meeting"})]})]})]})]}),e.jsxs("div",{className:"w-full sm:w-2/3 overflow-hidden flex flex-col min-h-0",children:[e.jsx("div",{className:"px-3 sm:px-4 py-3 border-b border-gray-200 flex-shrink-0",children:e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Attendance"})}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:ee||te?e.jsx("div",{className:"text-center text-gray-500 py-6",children:"Loading students and attendances..."}):j.length===0?e.jsx("div",{className:"text-center text-gray-500 py-6",children:"No students found for this class."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 sm:mb-4 flex gap-1 sm:gap-2 justify-between flex-wrap",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:async()=>{if(a)try{await h.mutateAsync({id:a.meetingId,data:{tgl_pertemuan:b,jam_pertemuan:m.length===5?`${m}:00`:m,absensi_aktif:!p}}),L(!p),await R(),await U.invalidateQueries({queryKey:["lecturer-meeting-recap"]})}catch(t){alert(`Failed to toggle attendance: ${t instanceof Error?t.message:"Unknown error"}`)}},disabled:h.isPending,className:`px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded flex items-center gap-1 whitespace-nowrap cursor-pointer transition-colors ${p?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"} disabled:opacity-50 disabled:cursor-not-allowed`,title:p?"Disable attendance":"Enable attendance",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${p?"bg-white":"bg-gray-500"}`}),h.isPending?"Toggling...":p?"Attendance On":"Attendance Off"]})}),e.jsx("div",{className:"flex gap-1 sm:gap-2",children:ae?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ie,disabled:D||Object.keys(x).length===0,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer whitespace-nowrap",children:D?"Saving...":`Save (${Object.keys(x).length})`}),e.jsx("button",{onClick:le,disabled:D,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer whitespace-nowrap",children:"Cancel"})]}):e.jsx("button",{onClick:re,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded bg-primary-600 text-white hover:bg-primary-700 cursor-pointer whitespace-nowrap",children:"Edit All"})})]}),e.jsxs("div",{className:"space-y-2 sm:overflow-x-auto sm:border sm:border-gray-200 sm:rounded-lg",children:[e.jsx("div",{className:"sm:hidden space-y-2",children:j.map(t=>{const s=t.status,i=x[t.nim]!==void 0,d=i?x[t.nim]:s;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-2 bg-white",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900 break-words",children:t.nama}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:t.nim})]}),!i&&e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-medium inline-block ${s==="Hadir"?"bg-green-100 text-green-700":s==="Izin"||s==="Sakit"?"bg-yellow-100 text-yellow-700":s==="Terlambat"?"bg-blue-100 text-blue-700":s==="Pengganti"?"bg-purple-100 text-purple-700":s==="Belum Absen"?"bg-gray-100 text-gray-700":"bg-red-100 text-red-700"}`,children:s||"Belum Absen"})]}),i?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:["Hadir","Izin","Sakit","Alfa","Terlambat","Pengganti"].map(n=>e.jsx("button",{onClick:()=>o(r=>({...r,[t.nim]:n})),className:`px-1.5 py-1 text-xs font-medium rounded transition-colors cursor-pointer ${d===n?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:n},n))}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:async()=>{await G(t.nim,d,t.attendanceId),o(n=>{const r={...n};return delete r[t.nim],r})},disabled:u.isPending||g.isPending,className:"flex-1 px-2 py-1 text-xs font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 cursor-pointer",children:u.isPending||g.isPending?"Saving...":"Save"}),e.jsx("button",{onClick:()=>o(n=>{const r={...n};return delete r[t.nim],r}),disabled:u.isPending||g.isPending,className:"px-2 py-1 text-xs font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer",children:"X"})]})]}):e.jsx("button",{onClick:()=>o(n=>({...n,[t.nim]:s==="Belum Absen"?"Hadir":s||"Hadir"})),className:"w-full px-2 py-1 text-xs font-medium rounded bg-primary-600 text-white hover:bg-primary-700 cursor-pointer",children:"Edit"})]},t.nim)})}),e.jsx("table",{className:"hidden sm:table w-full text-xs sm:text-sm",children:e.jsx("tbody",{children:j.map(t=>{const s=t.status,i=x[t.nim]!==void 0,d=i?x[t.nim]:s;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 sm:px-3 py-2 font-mono text-gray-900 whitespace-nowrap text-xs",children:t.nim}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-gray-900",children:t.nama}),e.jsx("td",{className:"px-2 sm:px-3 py-2",children:i?e.jsx("div",{className:"flex gap-1 flex-wrap",children:["Hadir","Izin","Sakit","Alfa","Terlambat","Pengganti"].map(n=>e.jsx("button",{onClick:()=>o(r=>({...r,[t.nim]:n})),className:`px-2 py-0.5 text-xs font-medium rounded transition-colors cursor-pointer ${d===n?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:n},n))}):e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium inline-block ${s==="Hadir"?"bg-green-100 text-green-700":s==="Izin"||s==="Sakit"?"bg-yellow-100 text-yellow-700":s==="Terlambat"?"bg-blue-100 text-blue-700":s==="Pengganti"?"bg-purple-100 text-purple-700":s==="Belum Absen"?"bg-gray-100 text-gray-700":"bg-red-100 text-red-700"}`,children:s||"Belum Absen"})}),e.jsx("td",{className:"px-2 sm:px-3 py-2 whitespace-nowrap",children:i?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:async()=>{await G(t.nim,d,t.attendanceId),o(n=>{const r={...n};return delete r[t.nim],r})},disabled:u.isPending||g.isPending,className:"px-2 py-1 text-xs font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 cursor-pointer",children:u.isPending||g.isPending?"Saving...":"Save"}),e.jsx("button",{onClick:()=>o(n=>{const r={...n};return delete r[t.nim],r}),disabled:u.isPending||g.isPending,className:"px-2 py-1 text-xs font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer",children:"Cancel"})]}):e.jsx("button",{onClick:()=>o(n=>({...n,[t.nim]:s==="Belum Absen"?"Hadir":s||"Hadir"})),className:"px-2 py-1 text-xs font-medium rounded bg-primary-600 text-white hover:bg-primary-700 cursor-pointer",children:"Edit"})})]},t.nim)})})})]})]})})]})]})]})}):null};export{Ee as A};
//# sourceMappingURL=AttendanceModal-CWoH1YFV.js.map
