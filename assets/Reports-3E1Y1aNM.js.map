{"version":3,"mappings":"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","names":["Reports","t","useTranslation","importedReports","setImportedReports","useState","isProcessing","setIsProcessing","uploadMessage","setUploadMessage","generatingId","setGeneratingId","selectedReport","setSelectedReport","reportRef","useRef","isDragActive","setIsDragActive","isBulkGenerating","setIsBulkGenerating","bulkProgress","setBulkProgress","getStatusIcon","status","jsx","CheckCircle","Clock","AlertCircle","ClockAlert","XCircle","Minus","getStatusColor","processFile","file","XLSX","data","workbook","classDescSheet","classDescData","courseCode","className","courseName","descMap","row","key","value","normalizedValue","lecturers","totalSKS","attendanceSheet","attendanceSheetData","isRowEmpty","c","r","classDescSheetData","meetingSheet","meetingSheetData","formatExcelDate","val","n","epoch","ms","idx","newRow","gradesSheetData","gradesSheet","handleFiles","files","fileArray","f","results","successes","failures","prev","filesText","failureText","handleFileUpload","event","handleDragOver","e","handleDragLeave","handleDrop","handleViewReport","report","handleCloseReport","generatePDFForReport","element","html2canvas","jsPDF","__vitePreload","canvas","imgWidth","pageHeight","imgHeight","heightLeft","pdf","position","imgData","filename","handleGeneratePDF","handleBulkGeneratePDF","successCount","failCount","i","resolve","message","handleDeleteReport","id","meetingHeaders","h","meetingDateMap","meeting","date","jsxs","X","Fragment","Loader2","Download","index","header","rowIndex","colIndex","statusValue","cell","cellIndex","isNIM","isName","isLetterGrade","isFinalGrade","FileText","Upload"],"ignoreList":[],"sources":["../../src/pages/admin/Reports.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport { Download, FileText, Upload, AlertCircle, CheckCircle, Loader2, XCircle, Clock, ClockAlert, Minus, X } from 'lucide-react';\r\nimport { useTranslation } from '../../contexts/LanguageContext';\r\n\r\ntype SheetPrimitive = string | number | boolean | Date | null | undefined;\r\ntype SheetRow = SheetPrimitive[];\r\ntype SheetData = SheetRow[];\r\n\r\ninterface ImportedReport {\r\n  id: string;\r\n  fileName: string;\r\n  courseCode: string;\r\n  className: string;\r\n  courseName: string;\r\n  lecturers?: string;\r\n  totalSKS?: string | number;\r\n  classDescData?: SheetData;\r\n  attendanceData?: SheetData;\r\n  meetingSummaryData?: SheetData;\r\n  gradesData?: SheetData;\r\n  gradeWeights?: SheetData;\r\n}\r\n\r\nconst Reports: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const [importedReports, setImportedReports] = useState<ImportedReport[]>([]);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [uploadMessage, setUploadMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [generatingId, setGeneratingId] = useState<string | null>(null);\r\n  const [selectedReport, setSelectedReport] = useState<ImportedReport | null>(null);\r\n  const reportRef = useRef<HTMLDivElement>(null);\r\n  const [isDragActive, setIsDragActive] = useState(false);\r\n  const [isBulkGenerating, setIsBulkGenerating] = useState(false);\r\n  const [bulkProgress, setBulkProgress] = useState({ current: 0, total: 0 });\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'izin':\r\n      case 'excused':\r\n        return <Clock className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'sakit':\r\n      case 'sick':\r\n        return <AlertCircle className=\"h-4 w-4 text-yellow-600\" />;\r\n      case 'terlambat':\r\n      case 'late':\r\n        return <ClockAlert className=\"h-4 w-4 text-orange-600\" />;\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return <CheckCircle className=\"h-4 w-4 text-purple-600\" />;\r\n      case 'alpa':\r\n      case 'absent':\r\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\r\n      default:\r\n        return <Minus className=\"h-4 w-4 text-gray-300\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return 'bg-green-50 text-green-700';\r\n      case 'izin':\r\n      case 'excused':\r\n        return 'bg-blue-50 text-blue-700';\r\n      case 'sakit':\r\n      case 'sick':\r\n        return 'bg-yellow-50 text-yellow-700';\r\n      case 'terlambat':\r\n      case 'late':\r\n        return 'bg-orange-50 text-orange-700';\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return 'bg-purple-50 text-purple-700';\r\n      case 'alpa':\r\n      case 'absent':\r\n        return 'bg-red-50 text-red-700';\r\n      default:\r\n        return 'bg-gray-50 text-gray-400';\r\n    }\r\n  };\r\n\r\n  // Parse a single XLSX file into an ImportedReport\r\n  const processFile = async (file: File): Promise<ImportedReport> => {\r\n    const XLSX = await import('xlsx');\r\n    const data = await file.arrayBuffer();\r\n    const workbook = XLSX.read(data, { type: 'array' });\r\n\r\n    // Read Class Description sheet\r\n    const classDescSheet = workbook.Sheets['Class Description'];\r\n    if (!classDescSheet) {\r\n      throw new Error('Class Description sheet not found');\r\n    }\r\n\r\n    const classDescData = XLSX.utils.sheet_to_json<SheetRow>(classDescSheet, { header: 1 }) as SheetData;\r\n\r\n    // Extract data from Class Description\r\n    let courseCode = '';\r\n    let className = '';\r\n    let courseName = '';\r\n\r\n    const descMap: Record<string, string | number> = {};\r\n    classDescData.forEach((row) => {\r\n      const [key, value] = row;\r\n      if (key === undefined || value === undefined) return;\r\n      const normalizedValue = typeof value === 'number' ? value : String(value);\r\n      descMap[String(key)] = normalizedValue;\r\n    });\r\n\r\n    courseCode = (descMap['Course Code'] as string) || 'N/A';\r\n    className = (descMap['Class'] as string) || 'N/A';\r\n    courseName = (descMap['Course Name'] as string) || 'N/A';\r\n    const lecturers = (descMap['Lecturers'] as string) || '';\r\n    const totalSKS = descMap['Total SKS'] || descMap['SKS'] || '';\r\n\r\n    // Read Attendance Overview sheet\r\n    const attendanceSheet = workbook.Sheets['Attendance Overview'];\r\n    if (!attendanceSheet) {\r\n      throw new Error('Attendance Overview sheet not found');\r\n    }\r\n    let attendanceSheetData = XLSX.utils.sheet_to_json<SheetRow>(attendanceSheet, { header: 1 }) as SheetData;\r\n    // Filter out empty data rows (keep header)\r\n    const isRowEmpty = (row: SheetRow) => !row || row.every((c) => c === null || c === undefined || String(c).trim() === '');\r\n    if (attendanceSheetData.length > 0) {\r\n      attendanceSheetData = [attendanceSheetData[0], ...attendanceSheetData.slice(1).filter((r) => !isRowEmpty(r))];\r\n    }\r\n    const classDescSheetData: SheetData = classDescData;\r\n\r\n    // Read Meeting Summary sheet\r\n    const meetingSheet = workbook.Sheets['Meeting Summary'];\r\n    if (!meetingSheet) {\r\n      throw new Error('Meeting Summary sheet not found');\r\n    }\r\n    let meetingSheetData = XLSX.utils.sheet_to_json<SheetRow>(meetingSheet, { header: 1 }) as SheetData;\r\n    if (meetingSheetData.length > 0) {\r\n      // Keep header, filter empty rows\r\n      meetingSheetData = [meetingSheetData[0], ...meetingSheetData.slice(1).filter((r) => !isRowEmpty(r))];\r\n      // Convert Excel serial date in Date column (index 1) to 'MMM dd, yyyy'\r\n      const formatExcelDate = (val: SheetPrimitive): string => {\r\n        // Already a Date instance\r\n        if (val instanceof Date && !isNaN(val.getTime())) {\r\n          return val.toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });\r\n        }\r\n        // Numeric serial or numeric-looking string\r\n        const n = typeof val === 'number' ? val : (typeof val === 'string' && /^\\d+(\\.\\d+)?$/.test(val.trim()) ? parseFloat(val) : NaN);\r\n        if (!isNaN(n)) {\r\n          // Excel 1900 date system: days since 1899-12-31, with 1900 leap-year bug; approximate conversion\r\n          const epoch = new Date(Date.UTC(1899, 11, 30)); // 1899-12-30 to account for Excel offset\r\n          const ms = n * 24 * 60 * 60 * 1000;\r\n          const d = new Date(epoch.getTime() + ms);\r\n          return d.toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });\r\n        }\r\n        // Fallback: return as-is (string or other)\r\n        return typeof val === 'string' ? val : '';\r\n      };\r\n      meetingSheetData = meetingSheetData.map((row, idx) => {\r\n        if (idx === 0) return row; // header\r\n        const newRow = [...row];\r\n        if (newRow[1] !== undefined && newRow[1] !== null && String(newRow[1]).trim() !== '') {\r\n          newRow[1] = formatExcelDate(newRow[1]);\r\n        }\r\n        return newRow;\r\n      });\r\n    }\r\n\r\n    // Read Grades Overview sheet (optional - may not exist in older files)\r\n    let gradesSheetData: SheetData | undefined;\r\n    const gradesSheet = workbook.Sheets['Grades Overview'];\r\n    if (gradesSheet) {\r\n      gradesSheetData = XLSX.utils.sheet_to_json<SheetRow>(gradesSheet, { header: 1 }) as SheetData;\r\n      if (gradesSheetData.length > 0) {\r\n        gradesSheetData = [gradesSheetData[0], ...gradesSheetData.slice(1).filter((r) => !isRowEmpty(r))];\r\n      }\r\n    }\r\n\r\n    const newReport: ImportedReport = {\r\n      id: `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\r\n      fileName: file.name,\r\n      courseCode,\r\n      className,\r\n      courseName,\r\n      lecturers,\r\n      totalSKS,\r\n      classDescData: classDescSheetData,\r\n      attendanceData: attendanceSheetData,\r\n      meetingSummaryData: meetingSheetData,\r\n      gradesData: gradesSheetData,\r\n    };\r\n\r\n    return newReport;\r\n  };\r\n\r\n  const handleFiles = async (files: FileList | File[]) => {\r\n    const fileArray = Array.from(files || []).filter((f) => /\\.xlsx?$/i.test(f.name));\r\n    if (fileArray.length === 0) return;\r\n\r\n    setIsProcessing(true);\r\n    setUploadMessage(null);\r\n\r\n    const results = await Promise.allSettled(fileArray.map((f) => processFile(f)));\r\n    const successes: ImportedReport[] = [];\r\n    let failures = 0;\r\n    results.forEach((r) => {\r\n      if (r.status === 'fulfilled') successes.push(r.value);\r\n      else failures += 1;\r\n    });\r\n\r\n    if (successes.length > 0) {\r\n      setImportedReports((prev) => [...prev, ...successes]);\r\n      const filesText = successes.length === 1 ? '1 file' : `${successes.length} files`;\r\n      const failureText = failures > 0 ? ` (⚠️ ${failures} failed)` : '';\r\n      setUploadMessage({ type: 'success', text: `${filesText} berhasil diimpor${failureText}.` });\r\n    } else {\r\n      setUploadMessage({\r\n        type: 'error',\r\n        text: 'Gagal membaca semua file. Pastikan setiap file memiliki sheet: Class Description, Attendance Overview, Meeting Summary.',\r\n      });\r\n    }\r\n\r\n    setIsProcessing(false);\r\n  };\r\n\r\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = event.target.files;\r\n    if (files && files.length > 0) {\r\n      await handleFiles(files);\r\n    }\r\n    // Reset input\r\n    event.target.value = '';\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!isDragActive) setIsDragActive(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragActive(false);\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragActive(false);\r\n    if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {\r\n      await handleFiles(e.dataTransfer.files);\r\n      e.dataTransfer.clearData();\r\n    }\r\n  };\r\n\r\n  const handleViewReport = (report: ImportedReport) => {\r\n    setSelectedReport(report);\r\n  };\r\n\r\n  const handleCloseReport = () => {\r\n    setSelectedReport(null);\r\n  };\r\n\r\n  const generatePDFForReport = async (report: ImportedReport, element: HTMLElement): Promise<boolean> => {\r\n    try {\r\n      const [{ default: html2canvas }, { default: jsPDF }] = await Promise.all([\r\n        import('html2canvas-pro'),\r\n        import('jspdf')\r\n      ]);\r\n\r\n      const canvas = await html2canvas(element, {\r\n        scale: 1.5, // Reduced from 2 to 1.5 for smaller file size while maintaining quality\r\n        useCORS: true,\r\n        logging: false,\r\n        backgroundColor: '#ffffff',\r\n      });\r\n\r\n      const imgWidth = 210;\r\n      const pageHeight = 297;\r\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n      let heightLeft = imgHeight;\r\n\r\n      const pdf = new jsPDF('p', 'mm', 'a4');\r\n      let position = 0;\r\n\r\n      // Convert canvas to JPEG with compression for smaller file size\r\n      const imgData = canvas.toDataURL('image/jpeg', 0.85); // JPEG with 85% quality\r\n\r\n      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\r\n      heightLeft -= pageHeight;\r\n\r\n      while (heightLeft > 0) {\r\n        position = heightLeft - imgHeight;\r\n        pdf.addPage();\r\n        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\r\n        heightLeft -= pageHeight;\r\n      }\r\n\r\n      const filename = `Class_Summary_${report.className}_${report.courseName.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;\r\n      pdf.save(filename);\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleGeneratePDF = async () => {\r\n    if (!reportRef.current) return;\r\n\r\n    setGeneratingId('pdf-generation');\r\n\r\n    try {\r\n      await generatePDFForReport(selectedReport!, reportRef.current);\r\n    } catch (error) {\r\n      alert('Failed to generate PDF. Please try again.');\r\n    } finally {\r\n      setGeneratingId(null);\r\n    }\r\n  };\r\n\r\n  const handleBulkGeneratePDF = async () => {\r\n    if (importedReports.length === 0) return;\r\n\r\n    setIsBulkGenerating(true);\r\n    setBulkProgress({ current: 0, total: importedReports.length });\r\n\r\n    let successCount = 0;\r\n    let failCount = 0;\r\n\r\n    for (let i = 0; i < importedReports.length; i++) {\r\n      const report = importedReports[i];\r\n      setBulkProgress({ current: i + 1, total: importedReports.length });\r\n\r\n      // Temporarily set the report as selected to render it\r\n      setSelectedReport(report);\r\n      \r\n      // Wait for DOM to update\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n\r\n      if (reportRef.current) {\r\n        const success = await generatePDFForReport(report, reportRef.current);\r\n        if (success) {\r\n          successCount++;\r\n        } else {\r\n          failCount++;\r\n        }\r\n        \r\n        // Small delay between generations to prevent browser freezing\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n      }\r\n    }\r\n\r\n    // Clear selected report and show completion message\r\n    setSelectedReport(null);\r\n    setIsBulkGenerating(false);\r\n    setBulkProgress({ current: 0, total: 0 });\r\n\r\n    const message = failCount > 0 \r\n      ? `Bulk generation complete: ${successCount} succeeded, ${failCount} failed`\r\n      : `Successfully generated ${successCount} PDF reports!`;\r\n    \r\n    setUploadMessage({ \r\n      type: failCount > 0 ? 'error' : 'success', \r\n      text: message \r\n    });\r\n  };\r\n\r\n  const handleDeleteReport = (id: string) => {\r\n    setImportedReports((prev) => prev.filter((r) => r.id !== id));\r\n  };\r\n\r\n  // If a report is selected, show the report view\r\n  if (selectedReport) {\r\n    // Get meeting headers (P1, P2, etc.) from attendance data\r\n    const meetingHeaders: string[] = selectedReport.attendanceData && selectedReport.attendanceData.length > 0\r\n      ? selectedReport.attendanceData[0].slice(2).map((h) => String(h))\r\n      : [];\r\n\r\n    // Build a map of meeting -> date from meeting summary data\r\n    const meetingDateMap: Record<string, string> = {};\r\n    if (selectedReport.meetingSummaryData && selectedReport.meetingSummaryData.length > 1) {\r\n      selectedReport.meetingSummaryData.slice(1).forEach((row) => {\r\n        const meeting = row[0];\r\n        const date = row[1];\r\n        if (meeting !== undefined && meeting !== null && date !== undefined && date !== null) {\r\n          meetingDateMap[String(meeting)] = String(date);\r\n        }\r\n      });\r\n    }\r\n\r\n    return (\r\n      <div className=\"p-6 space-y-6\">\r\n        {/* Action Bar */}\r\n        <div className=\"flex justify-between items-center\">\r\n          <button\r\n            onClick={handleCloseReport}\r\n            className=\"btn-secondary flex items-center gap-2\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n            <span>Close Report</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleGeneratePDF}\r\n            disabled={generatingId === 'pdf-generation'}\r\n            className=\"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n          >\r\n            {generatingId === 'pdf-generation' ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                <span>Generating PDF...</span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Download className=\"h-4 w-4\" />\r\n                <span>Generate PDF Report</span>\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Report Content */}\r\n        <div ref={reportRef} className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          {/* Header */}\r\n          <div className=\"px-6 pt-6 pb-3\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">Class Summary</h1>\r\n              <p className=\"text-base text-gray-600 mt-1\">\r\n                {selectedReport.courseCode && <span className=\"font-medium\">{selectedReport.courseCode}</span>}\r\n                {selectedReport.courseCode && ' - '}\r\n                {selectedReport.courseName} - Class {selectedReport.className}\r\n                {selectedReport.totalSKS && ` (${selectedReport.totalSKS} SKS)`}\r\n              </p>\r\n              {selectedReport.lecturers && (\r\n                <p className=\"text-sm text-gray-500 mt-2\">\r\n                  {selectedReport.lecturers}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div>\r\n            {/* Attendance Table Section */}\r\n            <div className=\"px-6 py-3\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Attendance Overview</h3>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                  <div className=\"flex gap-0\">\r\n                    {/* Fixed NIM/Name Table */}\r\n                    <div className=\"flex-shrink-0 sticky left-0 z-10\">\r\n                      <table className=\"border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50\">\r\n                            <th className=\"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 h-14\">\r\n                              NIM\r\n                            </th>\r\n                            <th className=\"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 h-14\">\r\n                              Name\r\n                            </th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {selectedReport.attendanceData?.slice(1).map((row, index) => (\r\n                            <tr key={index} className=\"hover:bg-gray-50 h-9\">\r\n                              <td className=\"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900\">\r\n                                {row[0] ? String(row[0]) : '-'}\r\n                              </td>\r\n                              <td className=\"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate\">\r\n                                {row[1] ? String(row[1]) : '-'}\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n\r\n                    {/* Scrollable Meetings Table */}\r\n                    <div className=\"flex-1\">\r\n                      <table className=\"border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50\">\r\n                            {meetingHeaders.map((header, index) => (\r\n                              <th\r\n                                key={index}\r\n                                className=\"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-16 h-14\"\r\n                              >\r\n                                <div className=\"flex flex-col items-center gap-0.5\">\r\n                                  <span className=\"font-bold text-[10px]\">{String(header)}</span>\r\n                                  {meetingDateMap[header] && (\r\n                                    <span className=\"text-gray-500 font-normal text-[9px]\">\r\n                                      {meetingDateMap[header]}\r\n                                    </span>\r\n                                  )}\r\n                                </div>\r\n                              </th>\r\n                            ))}\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {selectedReport.attendanceData?.slice(1).map((row, rowIndex) => (\r\n                            <tr key={rowIndex} className=\"hover:bg-gray-50 h-9\">\r\n                              {row.slice(2).map((status, colIndex) => {\r\n                                const statusValue = status === null || status === undefined ? '' : String(status);\r\n                                return (\r\n                                <td\r\n                                    key={colIndex}\r\n                                    className={`border-r border-b border-gray-300 px-1 py-1.5 text-center ${getStatusColor(statusValue)}`}\r\n                                  >\r\n                                    <span className=\"inline-flex items-center gap-1 justify-center\">\r\n                                      {getStatusIcon(statusValue)}\r\n                                      <span className=\"text-[10px] text-gray-700\">{statusValue}</span>\r\n                                    </span>\r\n                                  </td>\r\n                                );\r\n                              })}\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div className=\"px-6 py-3\">\r\n              <div className=\"flex items-center gap-4 text-xs flex-wrap\">\r\n                <span className=\"font-medium text-gray-700\">Legend:</span>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                  <span className=\"text-gray-600\">Present</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <ClockAlert className=\"h-4 w-4 text-orange-600\" />\r\n                  <span className=\"text-gray-600\">Late</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Clock className=\"h-4 w-4 text-blue-600\" />\r\n                  <span className=\"text-gray-600\">Excused</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\r\n                  <span className=\"text-gray-600\">Sick</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                  <span className=\"text-gray-600\">Absent</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <CheckCircle className=\"h-4 w-4 text-purple-600\" />\r\n                  <span className=\"text-gray-600\">Substitute</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Minus className=\"h-4 w-4 text-gray-300\" />\r\n                  <span className=\"text-gray-600\">No data</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Meeting Descriptions Table */}\r\n            <div className=\"px-6 py-3\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Meeting Descriptions</h3>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <table className=\"w-full border-collapse text-xs\">\r\n                  <thead>\r\n                    <tr className=\"bg-gray-50\">\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16\">\r\n                        Meeting\r\n                      </th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28\">\r\n                        Date\r\n                      </th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700\">\r\n                        Topic\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {selectedReport.meetingSummaryData?.slice(1).map((row, index) => (\r\n                      <tr key={index} className=\"hover:bg-gray-50\">\r\n                        <td className=\"border-b border-gray-300 px-3 py-2 font-medium text-gray-900\">\r\n                          {row[0] ? String(row[0]) : '-'}\r\n                        </td>\r\n                        <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                          {row[1] ? String(row[1]) : '-'}\r\n                        </td>\r\n                        <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                          {row[2] ? String(row[2]) : '-'}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Grades Overview Table */}\r\n            {selectedReport.gradesData && selectedReport.gradesData.length > 0 && (\r\n              <div className=\"px-6 py-3 pb-6\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Grades Overview</h3>\r\n                <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                  <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full border-collapse text-xs\">\r\n                      <thead>\r\n                        <tr className=\"bg-gray-50\">\r\n                              {selectedReport.gradesData[0].map((header, index) => (\r\n                            <th\r\n                              key={index}\r\n                              className={`border-${index < selectedReport.gradesData![0].length - 1 ? 'r' : ''} border-b border-gray-300 px-3 py-2 ${\r\n                                index <= 1 ? 'text-left' : 'text-center'\r\n                              } font-semibold text-gray-700`}\r\n                            >\r\n                              {String(header)}\r\n                            </th>\r\n                          ))}\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {selectedReport.gradesData.slice(1).map((row, rowIndex) => {\r\n                          // Check if this is the weights row (last row or contains \"Component Weights\")\r\n                          const isWeightsRow = rowIndex === selectedReport.gradesData!.length - 2 || \r\n                                              (row[0] && String(row[0]).toLowerCase().includes('weight'));\r\n                          \r\n                          if (isWeightsRow) {\r\n                            // Special rendering for weights row\r\n                            return (\r\n                              <tr key={rowIndex} className=\"bg-blue-50 font-bold\">\r\n                                {/* Component Weights label - spans first 2 columns */}\r\n                                <td \r\n                                  colSpan={2} \r\n                                  className=\"border-r border-b border-gray-300 px-3 py-2 text-left text-gray-900\"\r\n                                >\r\n                                  {row[0] === null || row[0] === undefined ? '-' : String(row[0])}\r\n                                </td>\r\n                                {/* Individual weight percentages - columns 2-7 */}\r\n                                {row.slice(2, 8).map((cell, idx) => (\r\n                                  <td \r\n                                    key={idx + 2}\r\n                                    className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600\"\r\n                                  >\r\n                                    {cell === null || cell === undefined ? '-' : String(cell)}\r\n                                  </td>\r\n                                ))}\r\n                                {/* Total: 100% - spans last 3 columns */}\r\n                                <td \r\n                                  colSpan={3}\r\n                                  className=\"border-b border-gray-300 px-3 py-2 text-center text-blue-600\"\r\n                                >\r\n                                  {row[8] === null || row[8] === undefined ? '-' : String(row[8])}\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          }\r\n                          \r\n                          // Regular student row\r\n                          return (\r\n                            <tr key={rowIndex} className=\"hover:bg-gray-50\">\r\n                              {row.map((cell, cellIndex) => {\r\n                                // Determine styling based on column\r\n                                const isNIM = cellIndex === 0;\r\n                                const isName = cellIndex === 1;\r\n                                const isLetterGrade = cellIndex === selectedReport.gradesData![0].length - 2;\r\n                                const isFinalGrade = cellIndex >= selectedReport.gradesData![0].length - 3;\r\n                                \r\n                                return (\r\n                                  <td\r\n                                    key={cellIndex}\r\n                                    className={`border-${cellIndex < row.length - 1 ? 'r' : ''} border-b border-gray-300 px-3 py-2 ${\r\n                                      cellIndex <= 1 ? 'text-left' : 'text-center'\r\n                                    } ${\r\n                                      isNIM\r\n                                        ? 'font-medium text-gray-900'\r\n                                        : isName\r\n                                        ? 'text-gray-900'\r\n                                        : isLetterGrade\r\n                                        ? 'font-bold text-blue-600'\r\n                                        : isFinalGrade\r\n                                        ? 'font-semibold text-gray-900'\r\n                                        : 'text-gray-600'\r\n                                    }`}\r\n                                  >\r\n                                    {cell === null || cell === undefined ? '-' : String(cell)}\r\n                                  </td>\r\n                                );\r\n                              })}\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <FileText className=\"h-8 w-8 text-blue-600\" />\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900\">{t('adminReports.title')}</h1>\r\n            <p className=\"text-gray-600\">{t('adminReports.subtitle')}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Upload Section */}\r\n      <div className=\"card p-6\">\r\n        <div className=\"space-y-4\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900\">{t('adminReports.uploadTitle')}</h2>\r\n          \r\n          <div\r\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\r\n              isDragActive ? 'border-blue-500 bg-blue-50' : 'border-blue-300 hover:border-blue-400'\r\n            }`}\r\n            onDragOver={handleDragOver}\r\n            onDragEnter={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n          >\r\n            <input\r\n              type=\"file\"\r\n              accept=\".xlsx,.xls\"\r\n              multiple\r\n              onChange={handleFileUpload}\r\n              disabled={isProcessing}\r\n              className=\"hidden\"\r\n              id=\"file-upload\"\r\n            />\r\n            <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\r\n              <div className=\"flex flex-col items-center justify-center\">\r\n                <Upload className=\"h-12 w-12 text-blue-400 mb-3\" />\r\n                <p className=\"text-lg font-medium text-gray-900\">{t('adminReports.dragDrop')}</p>\r\n                <p className=\"text-sm text-gray-500 mt-2\">{t('adminReports.orClick')}</p>\r\n                <p className=\"text-xs text-gray-400 mt-3\">\r\n                  {t('adminReports.fileRequirements')}\r\n                </p>\r\n                {isProcessing && (\r\n                  <div className=\"flex items-center gap-2 mt-4 text-blue-600\">\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                    <span className=\"text-sm\">{t('adminReports.processing')}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </label>\r\n          </div>\r\n\r\n          {uploadMessage && (\r\n            <div\r\n              className={`flex items-center gap-3 p-4 rounded-lg ${\r\n                uploadMessage.type === 'success'\r\n                  ? 'bg-green-50 text-green-700 border border-green-200'\r\n                  : 'bg-red-50 text-red-700 border border-red-200'\r\n              }`}\r\n            >\r\n              {uploadMessage.type === 'success' ? (\r\n                <CheckCircle className=\"h-5 w-5 flex-shrink-0\" />\r\n              ) : (\r\n                <AlertCircle className=\"h-5 w-5 flex-shrink-0\" />\r\n              )}\r\n              <span className=\"text-sm\">{uploadMessage.text}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Imported Reports List */}\r\n      {importedReports.length > 0 ? (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">{t('adminReports.importedReports')} ({importedReports.length})</h2>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={handleBulkGeneratePDF}\r\n                disabled={isBulkGenerating || isProcessing}\r\n                className=\"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n              >\r\n                {isBulkGenerating ? (\r\n                  <>\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                    <span>{t('adminReports.generating')} {bulkProgress.current}/{bulkProgress.total}...</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Download className=\"h-4 w-4\" />\r\n                    <span>{t('adminReports.bulkGenerate')}</span>\r\n                  </>\r\n                )}\r\n              </button>\r\n              <button\r\n                onClick={() => setImportedReports([])}\r\n                disabled={isBulkGenerating || isProcessing || importedReports.length === 0}\r\n                className=\"btn-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n                <span>{t('adminReports.removeAll')}</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {importedReports.map((report) => (\r\n              <div key={report.id} className=\"card p-6\">\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">\r\n                      {report.courseCode && <span className=\"text-blue-600\">{report.courseCode}</span>}\r\n                      {report.courseCode && ' - '}\r\n                      {report.courseName} - Class {report.className}\r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-500\">{t('adminReports.file')}: {report.fileName}</p>\r\n                  </div>\r\n\r\n                  <div className=\"flex space-x-2\">\r\n                    <button\r\n                      onClick={() => handleViewReport(report)}\r\n                      className=\"flex-1 btn-primary flex items-center justify-center space-x-2\"\r\n                    >\r\n                      <FileText className=\"h-4 w-4\" />\r\n                      <span>{t('adminReports.viewReport')}</span>\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDeleteReport(report.id)}\r\n                      className=\"flex-1 btn-secondary flex items-center justify-center space-x-2\"\r\n                    >\r\n                      <span>{t('adminReports.remove')}</span>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12 card p-6\">\r\n          <FileText className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">{t('adminReports.noReports')}</h3>\r\n          <p className=\"text-gray-500 mb-6\">{t('adminReports.uploadPrompt')}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Reports;"],"file":"assets/Reports-3E1Y1aNM.js"}