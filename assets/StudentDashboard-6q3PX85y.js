import{j as e}from"./query-vendor-B--u1oZD.js";import{r as x,g as R}from"./react-vendor-XXJdR_Id.js";import{u as z,e as N,c as h}from"./index-BFadXLuC.js";import{u as U,a as K}from"./useClasses-h-HHWjgv.js";import{C as P}from"./CheckInModal-FN5TpRlJ.js";import{r as Z,g as q}from"./ui-vendor-Bvty7Z9l.js";const G=c=>{const o=N(c);if(!o)return null;const l=o.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[l]||null},J=c=>{const o=h(c);if(!o)return"00:00";const l=o.split("T")[1]?.split(".")[0]||o.split("T")[1]?.split("Z")[0];return l?l.substring(0,5):new Date(o).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})},Q=()=>{const c=new Date,o=c.getDay(),l=o===0?0:o,d=new Date(c);d.setDate(c.getDate()-l),d.setHours(0,0,0,0);const u=new Date(d);return u.setDate(d.getDate()+6),u.setHours(23,59,59,999),{start:d,end:u}},ae=()=>{const{user:c}=z(),[o,l]=x.useState([]),[d,u]=x.useState(!1),[I,p]=x.useState(null),[D,f]=x.useState(""),{start:S,end:T}=R.useMemo(()=>Q(),[]),v=S.toISOString().split("T")[0],C=T.toISOString().split("T")[0],{data:y=[]}=U(c?.studentId||"",{start_day:v,end_day:C}),{data:g=[]}=K(),_=(t,r)=>{p(t),f(r),u(!0)},M=()=>{u(!1),p(null),f("")},k=t=>Array.isArray(g)&&g.some(r=>r.id_pertemuan===t),$=t=>Array.isArray(g)?g.find(r=>r.id_pertemuan===t):void 0,A=t=>{if(!t.actualDate)return{allowed:!1,reason:"Invalid meeting date"};if(k(t.meetingId))return{allowed:!1,reason:"Already checked in"};const[r,s]=t.startTime.split(":").map(Number),a=new Date(t.actualDate);a.setHours(r,s,0,0);const n=new Date,i=new Date(a.getTime()-300*1e3);return n<i?{allowed:!1}:{allowed:!0}},W=t=>{const r=t.toLowerCase();return r==="hadir"?{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}:r==="izin"||r==="sakit"?{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-700",icon:"text-yellow-600"}:r==="alfa"?{border:"border-red-300",bg:"bg-red-50",text:"text-red-700",icon:"text-red-600"}:r==="terlambat"?{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"}:{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}},b=t=>{if(!t)return null;try{const r=new Date(t);return isNaN(r.getTime())?null:{date:r.toLocaleDateString("id-ID",{day:"numeric",month:"short"}),time:r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}}catch{return null}};return x.useEffect(()=>{const t=[];y.forEach(s=>{s.meeting_schedules.forEach(a=>{const n=G(a.tgl_pertemuan);if(!n)return;const i=J(a.jam_pertemuan),m=N(a.tgl_pertemuan);if(!m)return;const j=s.sks_tatap_muka+s.sks_praktek+s.sks_prak_lapangan+s.sks_simulasi,E=j*60,[F,H]=i.split(":").map(Number),w=F*60+H+E,L=Math.floor(w/60)%24,O=w%60,B=`${String(L).padStart(2,"0")}:${String(O).padStart(2,"0")}`;t.push({id:`${s.kelas_id}-${a.id}`,day:n,startTime:i,endTime:B,courseCode:s.kode_mk,courseName:s.nama_mk,className:s.nama_kelas,credits:j,room:h(a.media_pembelajaran,"TBA"),topic:h(a.topik,""),weekNumber:a.pertemuan_ke,classId:s.kelas_id,actualDate:m,meetingId:a.id})})});const r=t.filter(s=>s.actualDate).map(s=>{const a=s.actualDate.getDay();return{...s,weekDay:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[a]||"Monday"}}).sort((s,a)=>!s.actualDate||!a.actualDate?0:s.actualDate.getTime()-a.actualDate.getTime());l(r)},[y]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Dashboard"})}),o.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"This Week's Schedule"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(t=>{const r=k(t.meetingId),s=A(t),a=$(t.meetingId),n=a?W(a.status_kehadiran):null;return e.jsxs("div",{onClick:()=>s.allowed&&_(t.meetingId,t.courseName),className:`p-3 border rounded-lg transition-colors flex flex-col ${r&&n?`${n.border} ${n.bg} cursor-default`:s.allowed?"border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer":"border-gray-300 bg-gray-100 cursor-not-allowed"}`,title:s.allowed?void 0:s.reason,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2.5 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:t.weekDay}),t.actualDate&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-0.5 bg-gray-100 rounded",children:t.actualDate.toLocaleDateString("id-ID",{day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[r&&a&&n&&e.jsxs("div",{className:`flex items-center gap-1 text-xs ${n.text} font-medium`,children:[e.jsx(Z,{className:`h-3 w-3 ${n.icon}`}),e.jsx("span",{children:"Checked In"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Week ",t.weekNumber]})]})]}),e.jsx("div",{className:"text-xs font-semibold text-primary-600 mb-1",children:t.courseCode}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:t.courseName}),t.topic&&e.jsx("div",{className:"text-xs text-gray-600 mb-2 italic line-clamp-2",children:t.topic})]}),e.jsx("div",{className:"flex flex-col gap-1 text-xs text-gray-600 border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:[t.startTime," - ",t.endTime]})]})}),r&&a&&n&&e.jsx("div",{className:`mt-2 pt-2 border-t ${n.border}`,children:e.jsx("div",{className:"text-xs text-gray-600 space-y-0.5",children:(()=>{const i=b(a.waktu_masuk),m=a.waktu_keluar?b(a.waktu_keluar):null;return e.jsxs(e.Fragment,{children:[i&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Check-in:"}),e.jsxs("span",{className:"font-medium",children:[i.date," ",i.time]})]}),m&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Check-out:"}),e.jsx("span",{className:"font-medium",children:m.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`font-medium ${n.text}`,children:a.status_kehadiran})]})]})})()})}),!r&&!s.allowed&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center italic",children:s.reason})]},t.id)})})]}),e.jsx(P,{isOpen:d,meetingId:I,courseName:D,onClose:M})]})};export{ae as default};
//# sourceMappingURL=StudentDashboard-6q3PX85y.js.map
