import{j as e}from"./query-vendor-B--u1oZD.js";import{r as d,g as Y}from"./react-vendor-XXJdR_Id.js";import{u as ce,e as _,c as M}from"./index-C1kkCffi.js";import{u as de,a as oe}from"./useClasses-K0xObK0J.js";import{C as Z}from"./CheckInModal-BF5kcR8_.js";import{w as xe,s as me,K as $,c as q,N as he,r as G}from"./ui-vendor-DIF6S0il.js";const pe=f=>{const i=_(f);if(!i)return null;const g=i.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[g]||null},ue=f=>{const i=M(f);if(!i)return"00:00";const g=i.split("T")[1]?.split(".")[0]||i.split("T")[1]?.split("Z")[0];return g?g.substring(0,5):new Date(i).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})},ke=()=>{const{user:f}=ce(),[i,g]=d.useState([]),[p,E]=d.useState([]),[y,T]=d.useState(""),[j,A]=d.useState(""),[J,D]=d.useState(!1),[Q,F]=d.useState(null),[X,L]=d.useState(""),[ee,P]=d.useState(""),[se,O]=d.useState(""),[te,K]=d.useState(!1),[B,R]=d.useState(null),ae=Y.useMemo(()=>{const s={};return y&&(s.start_day=y),j&&(s.end_day=j),s},[y,j]),{data:v,isLoading:re,error:C}=de(f?.studentId||"",ae),b=Y.useMemo(()=>v??[],[v]),{data:w=[]}=oe(),W=C?C instanceof Error?C.message:"Failed to load class schedule":null,z=(s,a)=>{F(s),L(a),D(!0)},ne=()=>{D(!1),F(null),L("")},le=s=>{R(s),P(s.link_bukti||""),O(s.deskripsi||""),K(!0)},ie=()=>{R(null),P(""),O(""),K(!1)},S=s=>Array.isArray(w)&&w.some(a=>a.id_pertemuan===s),H=s=>Array.isArray(w)?w.find(a=>a.id_pertemuan===s):void 0,U=(s,a)=>s.actualDate?S(s.meetingId)?{allowed:!1,reason:"Already checked in"}:a?{allowed:!0}:{allowed:!1,reason:"Attendance not yet active"}:{allowed:!1,reason:"Invalid meeting date"},V=s=>{const a=s.toLowerCase();return a==="hadir"?{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}:a==="izin"||a==="sakit"?{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-700",icon:"text-yellow-600"}:a==="alfa"?{border:"border-red-300",bg:"bg-red-50",text:"text-red-700",icon:"text-red-600"}:a==="terlambat"?{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"}:a==="pengganti"?{border:"border-purple-300",bg:"bg-purple-50",text:"text-purple-700",icon:"text-purple-600"}:{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}};return d.useEffect(()=>{const s=[];(v??[]).forEach(a=>{a.meeting_schedules.forEach(t=>{const l=pe(t.tgl_pertemuan);if(!l)return;const o=ue(t.jam_pertemuan),r=_(t.tgl_pertemuan);if(!r)return;const h=a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,N=h*60,[k,u]=o.split(":").map(Number),m=k*60+u+N,x=Math.floor(m/60)%24,n=m%60,c=`${String(x).padStart(2,"0")}:${String(n).padStart(2,"0")}`;s.push({id:`${a.kelas_id}-${t.id}`,day:l,startTime:o,endTime:c,courseCode:a.kode_mk,courseName:a.nama_mk,className:a.nama_kelas,credits:h,room:M(t.media_pembelajaran,"TBA"),topic:M(t.topik,""),weekNumber:t.pertemuan_ke,classId:a.kelas_id,actualDate:r,meetingId:t.id})})}),g(s)},[v]),re?e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xe,{className:"h-8 w-8 animate-spin text-primary-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading class schedule..."})]})})}):W?e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class & Schedule"}),e.jsx("div",{className:"card bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-3 text-red-800",children:[e.jsx(me,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading schedule"}),e.jsx("p",{className:"text-sm mt-1",children:W})]})]})})]}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 lg:space-y-6",children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold text-gray-900",children:"Class & Schedule"}),e.jsxs("div",{className:"card grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($,{className:"h-5 w-5 text-primary-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Classes Enrolled"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[b.length," classes"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Total Meetings"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[i.length," sessions"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:col-span-2 lg:col-span-1",children:[e.jsx(he,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Total Credits"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[b.reduce((s,a)=>s+a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,0)," SKS"]})]})]})]}),b.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Classes Found"}),e.jsx("p",{className:"text-gray-600",children:"You are not enrolled in any classes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4",children:"Enrolled Classes"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:b.map(s=>{const a=s.sks_tatap_muka+s.sks_praktek+s.sks_prak_lapangan+s.sks_simulasi,t=s.meeting_schedules.length;return e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:e.jsx("span",{className:"text-xs font-semibold text-primary-600",children:s.kode_mk})}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:s.nama_mk}),s.bahasan&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:s.bahasan})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-x-2 gap-y-0.5 text-xs text-gray-500 border-t border-gray-100 pt-2",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[a," SKS"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t," meetings"]}),s.mode_kuliah&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"text-gray-600 hidden sm:inline",children:s.mode_kuliah})]})]})]},s.kelas_id)})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 lg:mb-4 flex-wrap gap-3",children:e.jsx("h2",{className:"text-base lg:text-lg font-semibold text-gray-900",children:"List of Schedules"})}),e.jsx("div",{className:"mb-4 lg:mb-6 pb-3 lg:pb-4 border-b border-gray-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3",children:"Filter by Course"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from(new Set(i.map(s=>s.courseCode))).map(s=>{const a=i.find(l=>l.courseCode===s)?.courseName,t=p.includes(s);return e.jsxs("button",{onClick:()=>{E(t?p.filter(l=>l!==s):[...p,s])},className:`px-2.5 lg:px-3 py-1.5 text-xs font-medium rounded-lg transition-all cursor-pointer ${t?"bg-primary-600 text-white border border-primary-600 hover:bg-primary-700":"bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200 hover:border-gray-300"}`,title:`${s} - ${a}`,type:"button",children:[e.jsxs("span",{className:"hidden sm:inline",children:[s," - ",a]}),e.jsx("span",{className:"sm:hidden",children:a})]},s)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3",children:"Filter by Date"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:y,onChange:s=>T(s.target.value),className:"input-field w-full text-xs",placeholder:"Start date"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:j,onChange:s=>A(s.target.value),className:"input-field w-full text-xs",placeholder:"End date"})}),(y||j)&&e.jsx("button",{onClick:()=>{T(""),A("")},className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-lg hover:bg-gray-200 hover:border-gray-300 transition-all cursor-pointer whitespace-nowrap",type:"button",children:"Clear Dates"})]})]})]})}),(()=>{let s=i;p.length>0&&(s=s.filter(t=>p.includes(t.courseCode)));const a=[...s].sort((t,l)=>{if(!t.actualDate||!l.actualDate)return 0;const o=t.actualDate.getTime()-l.actualDate.getTime();return o!==0?o:t.startTime.localeCompare(l.startTime)});return a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No meetings match the selected filters."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"lg:hidden space-y-2",children:a.map((t,l)=>{const o=b.find(c=>c.kelas_id===t.classId),r=o?.meeting_schedules.find(c=>`${o.kelas_id}-${c.id}`===t.id),h=r?_(r.tgl_pertemuan):null,N=h?h.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"",k=r?.absensi_aktif===!0||typeof r?.absensi_aktif=="object"&&r.absensi_aktif?.Valid&&r.absensi_aktif?.Bool,u=S(t.meetingId),m=U(t,k),x=H(t.meetingId),n=x?V(x.status_kehadiran):null;return e.jsxs("div",{className:`p-3 border rounded-lg ${u&&n?`${n.border} ${n.bg}`:"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:t.day}),e.jsx("span",{className:"text-xs text-gray-600",children:N})]}),u&&n&&e.jsx(G,{className:`h-4 w-4 ${n.icon} flex-shrink-0`})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-primary-600 flex-shrink-0",children:t.courseCode}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:t.courseName})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:e.jsxs("span",{children:["Week ",t.weekNumber]})}),e.jsx("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.startTime," - ",t.endTime]})]})}),u&&x&&n?e.jsxs("div",{className:`text-xs ${n.text} font-medium pt-2 border-t ${n.border}`,children:["✓ ",x.status_kehadiran]}):m.allowed?e.jsx("button",{onClick:()=>z(t.meetingId,t.courseName),className:"w-full text-xs px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all cursor-pointer font-medium mt-2",type:"button",children:"Check In"}):e.jsx("div",{className:"text-xs text-gray-500 italic text-center py-1 mt-2",children:m.reason})]})]},`${t.id}-${l}-mobile`)})}),e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Day"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Course Code"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Course Name"}),e.jsx("th",{className:"px-3 py-2 text-center font-semibold text-gray-700",children:"Week"}),e.jsx("th",{className:"px-3 py-2 text-center font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:a.map((t,l)=>{const o=b.find(I=>I.kelas_id===t.classId),r=o?.meeting_schedules.find(I=>`${o.kelas_id}-${I.id}`===t.id),h=r?_(r.tgl_pertemuan):null,N=h?h.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"",k=r?.absensi_aktif===!0||typeof r?.absensi_aktif=="object"&&r.absensi_aktif?.Valid&&r.absensi_aktif?.Bool,u=l%2===0,m=S(t.meetingId),x=U(t,k),n=H(t.meetingId),c=n?V(n.status_kehadiran):null;return e.jsxs("tr",{className:`border-b border-gray-200 transition-colors ${m&&c?c.bg:u?"bg-white hover:bg-blue-50":"bg-gray-50 hover:bg-blue-50"}`,children:[e.jsx("td",{className:"px-3 py-2 text-center",children:m&&c&&e.jsx(G,{className:`h-4 w-4 ${c.icon} inline`})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 font-semibold rounded",children:t.day})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-gray-600",children:N}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap text-gray-600",children:[t.startTime," - ",t.endTime]}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap font-semibold text-primary-600",children:t.courseCode}),e.jsx("td",{className:"px-3 py-2 max-w-xs",children:e.jsx("div",{className:"truncate text-gray-900 font-medium",children:t.courseName})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-600 whitespace-nowrap",children:t.weekNumber}),e.jsx("td",{className:"px-3 py-2 text-center whitespace-nowrap",children:m&&n&&c?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:`text-xs ${c.text} font-medium whitespace-nowrap`,children:["✓ ",n.status_kehadiran]}),e.jsx("button",{onClick:()=>le(n),className:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",type:"button",children:"Update Proof/Description"})]}):x.allowed?e.jsx("button",{onClick:()=>z(t.meetingId,t.courseName),className:"text-xs px-2 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-all cursor-pointer font-medium",type:"button",children:"Check In"}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{disabled:!0,className:"text-xs px-2 py-1 bg-gray-300 text-gray-500 rounded cursor-not-allowed",title:x.reason,children:"Check In"}),e.jsx("span",{className:"text-xs text-gray-500 italic max-w-[120px] text-center",children:x.reason})]})})]},`${t.id}-${l}`)})})]})})]})})()]})]}),e.jsx(Z,{isOpen:J,meetingId:Q,courseName:X,onClose:ne}),e.jsx(Z,{isOpen:te,meetingId:B?.id_pertemuan||null,courseName:B?.nama_mk||"",onClose:ie,editMode:!0,existingProof:ee,existingDescription:se})]})};export{ke as default};
//# sourceMappingURL=ClassSchedule-Bnup-0oP.js.map
