const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-2pqXIzBy.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js"])))=>i.map(i=>d[i]);
import{j as e,_ as A}from"./query-vendor-B--u1oZD.js";import{r as b}from"./react-vendor-XXJdR_Id.js";import{X as Y,w as T,x as q,r as S,u as Q,c as Z,s as G,t as ee,v as se,F as M,a6 as pe}from"./ui-vendor-DIF6S0il.js";const Ne=()=>{const[h,_]=b.useState([]),[w,O]=b.useState(!1),[D,C]=b.useState(null),[X,I]=b.useState(null),[r,k]=b.useState(null),v=b.useRef(null),[U,F]=b.useState(!1),[$,B]=b.useState(!1),[V,E]=b.useState({current:0,total:0}),te=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return e.jsx(S,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(Z,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(G,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(Q,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(S,{className:"h-4 w-4 text-purple-600"});case"alpa":case"absent":return e.jsx(ee,{className:"h-4 w-4 text-red-600"});default:return e.jsx(se,{className:"h-4 w-4 text-gray-300"})}},ae=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return"bg-green-50 text-green-700";case"izin":case"excused":return"bg-blue-50 text-blue-700";case"sakit":case"sick":return"bg-yellow-50 text-yellow-700";case"terlambat":case"late":return"bg-orange-50 text-orange-700";case"pengganti":case"substitute":return"bg-purple-50 text-purple-700";case"alpa":case"absent":return"bg-red-50 text-red-700";default:return"bg-gray-50 text-gray-400"}},re=async s=>{const n=await A(()=>import("./xlsx-DGuHH-KN.js"),[]),t=await s.arrayBuffer(),a=n.read(t,{type:"array"}),i=a.Sheets["Class Description"];if(!i)throw new Error("Class Description sheet not found");const l=n.utils.sheet_to_json(i,{header:1});let c="",x="",p="";const o={};l.forEach(m=>{const[d,u]=m;if(d===void 0||u===void 0)return;const g=typeof u=="number"?u:String(u);o[String(d)]=g}),c=o["Course Code"]||"N/A",x=o.Class||"N/A",p=o["Course Name"]||"N/A";const f=o.Lecturers||"",P=o["Total SKS"]||o.SKS||"",R=a.Sheets["Attendance Overview"];if(!R)throw new Error("Attendance Overview sheet not found");let j=n.utils.sheet_to_json(R,{header:1});const L=m=>!m||m.every(d=>d==null||String(d).trim()==="");j.length>0&&(j=[j[0],...j.slice(1).filter(m=>!L(m))]);const ge=l,W=a.Sheets["Meeting Summary"];if(!W)throw new Error("Meeting Summary sheet not found");let y=n.utils.sheet_to_json(W,{header:1});if(y.length>0){y=[y[0],...y.slice(1).filter(d=>!L(d))];const m=d=>{if(d instanceof Date&&!isNaN(d.getTime()))return d.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"});const u=typeof d=="number"?d:typeof d=="string"&&/^\d+(\.\d+)?$/.test(d.trim())?parseFloat(d):NaN;if(!isNaN(u)){const g=new Date(Date.UTC(1899,11,30)),he=u*24*60*60*1e3;return new Date(g.getTime()+he).toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"})}return typeof d=="string"?d:""};y=y.map((d,u)=>{if(u===0)return d;const g=[...d];return g[1]!==void 0&&g[1]!==null&&String(g[1]).trim()!==""&&(g[1]=m(g[1])),g})}let N;const J=a.Sheets["Grades Overview"];return J&&(N=n.utils.sheet_to_json(J,{header:1}),N.length>0&&(N=[N[0],...N.slice(1).filter(m=>!L(m))])),{id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fileName:s.name,courseCode:c,className:x,courseName:p,lecturers:f,totalSKS:P,classDescData:ge,attendanceData:j,meetingSummaryData:y,gradesData:N}},K=async s=>{const n=Array.from(s||[]).filter(l=>/\.xlsx?$/i.test(l.name));if(n.length===0)return;O(!0),C(null);const t=await Promise.allSettled(n.map(l=>re(l))),a=[];let i=0;if(t.forEach(l=>{l.status==="fulfilled"?a.push(l.value):i+=1}),a.length>0){_(x=>[...x,...a]);const l=a.length===1?"1 file":`${a.length} files`,c=i>0?` (⚠️ ${i} failed)`:"";C({type:"success",text:`${l} berhasil diimpor${c}.`})}else C({type:"error",text:"Gagal membaca semua file. Pastikan setiap file memiliki sheet: Class Description, Attendance Overview, Meeting Summary."});O(!1)},le=async s=>{const n=s.target.files;n&&n.length>0&&await K(n),s.target.value=""},z=s=>{s.preventDefault(),s.stopPropagation(),U||F(!0)},ne=s=>{s.preventDefault(),s.stopPropagation(),F(!1)},ce=async s=>{s.preventDefault(),s.stopPropagation(),F(!1),s.dataTransfer?.files&&s.dataTransfer.files.length>0&&(await K(s.dataTransfer.files),s.dataTransfer.clearData())},ie=s=>{k(s)},de=()=>{k(null)},H=async(s,n)=>{try{const[{default:t},{default:a}]=await Promise.all([A(()=>import("./html2canvas-pro.esm-BvaDPKdU.js"),[]),A(()=>import("./jspdf.es.min-2pqXIzBy.js").then(j=>j.j),__vite__mapDeps([0,1,2]))]),i=await t(n,{scale:1.5,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),l=210,c=297,x=i.height*l/i.width;let p=x;const o=new a("p","mm","a4");let f=0;const P=i.toDataURL("image/jpeg",.85);for(o.addImage(P,"JPEG",0,f,l,x),p-=c;p>0;)f=p-x,o.addPage(),o.addImage(P,"JPEG",0,f,l,x),p-=c;const R=`Class_Summary_${s.className}_${s.courseName.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;return o.save(R),!0}catch(t){return console.error("Error generating PDF:",t),!1}},oe=async()=>{if(v.current){I("pdf-generation");try{await H(r,v.current)}catch(s){console.error("Error generating PDF:",s),alert("Failed to generate PDF. Please try again.")}finally{I(null)}}},xe=async()=>{if(h.length===0)return;B(!0),E({current:0,total:h.length});let s=0,n=0;for(let a=0;a<h.length;a++){const i=h[a];E({current:a+1,total:h.length}),k(i),await new Promise(l=>setTimeout(l,100)),v.current&&(await H(i,v.current)?s++:n++,await new Promise(c=>setTimeout(c,300)))}k(null),B(!1),E({current:0,total:0});const t=n>0?`Bulk generation complete: ${s} succeeded, ${n} failed`:`Successfully generated ${s} PDF reports!`;C({type:n>0?"error":"success",text:t})},me=s=>{_(n=>n.filter(t=>t.id!==s))};if(r){const s=r.attendanceData&&r.attendanceData.length>0?r.attendanceData[0].slice(2).map(t=>String(t)):[],n={};return r.meetingSummaryData&&r.meetingSummaryData.length>1&&r.meetingSummaryData.slice(1).forEach(t=>{const a=t[0],i=t[1];a!=null&&i!==void 0&&i!==null&&(n[String(a)]=String(i))}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:de,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Close Report"})]}),e.jsx("button",{onClick:oe,disabled:X==="pdf-generation",className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:X==="pdf-generation"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate PDF Report"})]})})]}),e.jsxs("div",{ref:v,className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 pt-6 pb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Summary"}),e.jsxs("p",{className:"text-base text-gray-600 mt-1",children:[r.courseCode&&e.jsx("span",{className:"font-medium",children:r.courseCode}),r.courseCode&&" - ",r.courseName," - Class ",r.className,r.totalSKS&&` (${r.totalSKS} SKS)`]}),r.lecturers&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:r.lecturers})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attendance Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex gap-0",children:[e.jsx("div",{className:"flex-shrink-0 sticky left-0 z-10",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 h-14",children:"NIM"}),e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 h-14",children:"Name"})]})}),e.jsx("tbody",{children:r.attendanceData?.slice(1).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9",children:[e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900",children:t[0]?String(t[0]):"-"}),e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate",children:t[1]?String(t[1]):"-"})]},a))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:s.map((t,a)=>e.jsx("th",{className:"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-16 h-14",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("span",{className:"font-bold text-[10px]",children:String(t)}),n[t]&&e.jsx("span",{className:"text-gray-500 font-normal text-[9px]",children:n[t]})]})},a))})}),e.jsx("tbody",{children:r.attendanceData?.slice(1).map((t,a)=>e.jsx("tr",{className:"hover:bg-gray-50 h-9",children:t.slice(2).map((i,l)=>{const c=i==null?"":String(i);return e.jsx("td",{className:`border-r border-b border-gray-300 px-1 py-1.5 text-center ${ae(c)}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1 justify-center",children:[te(c),e.jsx("span",{className:"text-[10px] text-gray-700",children:c})]})},l)})},a))})]})})]})})})]}),e.jsx("div",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-gray-600",children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Substitute"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4 text-gray-300"}),e.jsx("span",{className:"text-gray-600",children:"No data"})]})]})}),e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Descriptions"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16",children:"Meeting"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28",children:"Date"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Topic"})]})}),e.jsx("tbody",{children:r.meetingSummaryData?.slice(1).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 font-medium text-gray-900",children:t[0]?String(t[0]):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:t[1]?String(t[1]):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:t[2]?String(t[2]):"-"})]},a))})]})})]}),r.gradesData&&r.gradesData.length>0&&e.jsxs("div",{className:"px-6 py-3 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grades Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:r.gradesData[0].map((t,a)=>e.jsx("th",{className:`border-${a<r.gradesData[0].length-1?"r":""} border-b border-gray-300 px-3 py-2 ${a<=1?"text-left":"text-center"} font-semibold text-gray-700`,children:String(t)},a))})}),e.jsx("tbody",{children:r.gradesData.slice(1).map((t,a)=>a===r.gradesData.length-2||t[0]&&String(t[0]).toLowerCase().includes("weight")?e.jsxs("tr",{className:"bg-blue-50 font-bold",children:[e.jsx("td",{colSpan:2,className:"border-r border-b border-gray-300 px-3 py-2 text-left text-gray-900",children:t[0]===null||t[0]===void 0?"-":String(t[0])}),t.slice(2,8).map((l,c)=>e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600",children:l==null?"-":String(l)},c+2)),e.jsx("td",{colSpan:3,className:"border-b border-gray-300 px-3 py-2 text-center text-blue-600",children:t[8]===null||t[8]===void 0?"-":String(t[8])})]},a):e.jsx("tr",{className:"hover:bg-gray-50",children:t.map((l,c)=>{const x=c===0,p=c===1,o=c===r.gradesData[0].length-2,f=c>=r.gradesData[0].length-3;return e.jsx("td",{className:`border-${c<t.length-1?"r":""} border-b border-gray-300 px-3 py-2 ${c<=1?"text-left":"text-center"} ${x?"font-medium text-gray-900":p?"text-gray-900":o?"font-bold text-blue-600":f?"font-semibold text-gray-900":"text-gray-600"}`,children:l==null?"-":String(l)},c)})},a))})]})})})]})]})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Report Generator"}),e.jsx("p",{className:"text-gray-600",children:"Import XLSX files dan generate laporan kelas"})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Upload XLSX Report"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${U?"border-blue-500 bg-blue-50":"border-blue-300 hover:border-blue-400"}`,onDragOver:z,onDragEnter:z,onDragLeave:ne,onDrop:ce,children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",multiple:!0,onChange:le,disabled:w,className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(pe,{className:"h-12 w-12 text-blue-400 mb-3"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Drag and drop your XLSX files"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"atau klik untuk memilih file"}),e.jsx("p",{className:"text-xs text-gray-400 mt-3",children:"File harus memiliki sheet: Class Description, Attendance Overview, Meeting Summary"}),w&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-blue-600",children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Processing file(s)..."})]})]})})]}),D&&e.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-lg ${D.type==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[D.type==="success"?e.jsx(S,{className:"h-5 w-5 flex-shrink-0"}):e.jsx(G,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:D.text})]})]})}),h.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Imported Reports (",h.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:xe,disabled:$||w,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:$?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsxs("span",{children:["Generating ",V.current,"/",V.total,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Bulk Generate All PDFs"})]})}),e.jsxs("button",{onClick:()=>_([]),disabled:$||w||h.length===0,className:"btn-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Remove All"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:h.map(s=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:[s.courseCode&&e.jsx("span",{className:"text-blue-600",children:s.courseCode}),s.courseCode&&" - ",s.courseName," - Class ",s.className]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["File: ",s.fileName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>ie(s),className:"flex-1 btn-primary flex items-center justify-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"View Report"})]}),e.jsx("button",{onClick:()=>me(s.id),className:"flex-1 btn-secondary flex items-center justify-center space-x-2",children:e.jsx("span",{children:"Remove"})})]})]})},s.id))})]}):e.jsxs("div",{className:"text-center py-12 card p-6",children:[e.jsx(M,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Reports Imported Yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Upload XLSX files to generate class reports"})]})]})};export{Ne as default};
//# sourceMappingURL=Reports-CnY6uSOi.js.map
