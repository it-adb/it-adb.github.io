{"version":3,"mappings":"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","names":["useGrades","params","useQuery","apiService","useCreateGrade","options","qc","useQueryClient","useMutation","data","useUpdateGrade","id","_response","variables","updatedGrade","old","grade","error","ATTENDANCE_STATUSES","KEYBOARD_STATUS_MAP","extractString","val","extractDateISO","raw","d","extractTimeHHMM","parts","extractNumeric","extractPrimitive","extractBobotValue","sqlNull","getStudentKrsId","student","normalizeStatus","validStatuses","s","formatDate","dateValue","dateString","date","dayOfWeek","formattedDate","formatDateCompact","day","month","formatTime","timeValue","DEFAULT_GRADE_WEIGHTS","BOBOT_FIELDS","GRADE_COMPARE_FIELDS","getGradeComponents","classData","partisipatif","proyek","kuis","tugas","uts","uas","calculateLetterGrade","nilaiAngka","calculateNumericGrade","components","gradeComponents","totalWeight","totalValue","hasAnyValue","key","weight","rawValue","value","generateGradeKey","studentKrsId","studentNim","useAttendanceManager","classId","meetingIds","attendanceMap","isEditing","queryClient","justSavedAttendanceRef","useRef","savingCells","setSavingCells","useState","initialAttendanceSnapshot","setInitialAttendanceSnapshot","modifiedCells","setModifiedCells","pendingStatusChanges","setPendingStatusChanges","originalAttendanceCache","setOriginalAttendanceCache","activeCell","setActiveCell","currentShortcutStatus","setCurrentShortcutStatus","createAttendanceMutation","useCreateAttendance","updateAttendanceMutation","useUpdateAttendance","buildInitialSnapshot","useCallback","snap","records","r","status","recalcModified","next","original","updateSingleCell","newStatus","nim","meetingIdStr","meetingId","queryKey","clone","arr","existingIdx","prev","commitAttendanceChanges","skipExit","changes","existing","map","enterEditMode","exitEditMode","hasUnsavedChanges","useMemo","useMeetingManager","classIdNum","meetings","editedTopics","setEditedTopics","editedDates","setEditedDates","editedTimes","setEditedTimes","editedLecturers","setEditedLecturers","updateMeetingMutation","useUpdateMeeting","startEditTopic","currentTopik","currentDate","currentTime","currentLecturer","cancelEditTopic","saveTopic","newTopic","newDateRaw","newTimeRaw","newLecturer","newDateISO","newTimeWithSeconds","m","topics","dates","times","lecturers","meeting","editedTopik","editedDate","currentDateISO","editedTime","editedLecturer","useGradeManager","students","gradeRecords","editedGrades","setEditedGrades","savingGradeIds","setSavingGradeIds","completedGradeKeys","setCompletedGradeKeys","editedBobots","setEditedBobots","isSavingBobots","setIsSavingBobots","bobotError","setBobotError","isBobotCompleted","setIsBobotCompleted","updateGradeMutation","createGradeMutation","gradeWeights","effectiveClassData","originalBobotWeights","hasEditedBobots","field","edited","findGradeForStudent","extendedRecords","found","g","k","v","saveGrade","gradeKey","idNum","editedGrade","originalValue","editedValue","calculatedNumeric","nilaiHuruf","nilaiIndeks","huruf","indeks","updateData","krsId","e","updateGradeField","comp","handleBobotChange","numValue","cancelBobots","enableBobotEditing","saveBobots","bobotData","total","gradeMap","safeNim","eVal","oVal","generatePDFReport","contentRef","html2canvas","jsPDF","__vitePreload","n","canvas","imgWidth","pageHeight","imgHeight","heightLeft","pdf","position","imgData","generateXLSXReport","XLSX","workbook","classDescData","classDescSheet","attendanceData","studentAttendance","row","attendanceSheet","meetingSummaryData","hasValidDate","topik","lecturerId","lecturerName","meetingSheet","gradesData","getValue","gradesSheet","downloadPDFReport","className","courseName","filename","downloadXLSXReport","ClassSummary","useParams","searchParams","useSearchParams","navigate","useNavigate","isGeneratingPDF","setIsGeneratingPDF","isGeneratingXLSX","setIsGeneratingXLSX","isAttendanceEditing","setIsAttendanceEditing","isMeetingEditing","setIsMeetingEditing","isGradesEditing","setIsGradesEditing","isSavingAll","setIsSavingAll","courseCode","fromPage","sksTatapMuka","sksPraktek","sksPrakLapangan","sksSimulasi","loadingMeetings","meetingsError","useClassMeetings","loadingStudents","studentsError","useClassStudents","loadingGrades","lecturerAssignments","loadingLecturers","useLecturerAssignments","loadingClassData","lecturerIds","idSet","assignment","lecturerQueryResults","useQueries","lecturerLookup","lookup","q","lecturer","totalSks","lecturerNames","loadingAttendances","attendanceManager","meetingManager","gradeManager","enterAttendanceEditModeFromHook","exitAttendanceEditModeFromHook","exitGradesEditModeFromHook","loadingLecturersDetails","loading","anyEditing","sortedMeetings","getTimeValue","t","a","b","diff","attendanceLookup","record","getStatusIcon","jsx","CheckCircle","Clock","AlertCircle","ClockAlert","XCircle","Minus","getStatusColor","useEffect","handler","enterAttendanceEditMode","exitAttendanceEditMode","enterMeetingEditMode","exitMeetingEditMode","enterGradesEditMode","exitGradesEditMode","exitAllEditModes","saveAllAndFinish","meetingSavePromises","idStr","bobotSaved","gradeSavePromises","targetStudent","gradeId","originalGrade","attendancePromise","err","handleBack","handleGeneratePDF","fn","handleGenerateXLSX","jsxs","Home","ChevronRight","Fragment","Loader2","Download","FileSpreadsheet","cellKey","isModified","isSaving","timeInputValue","rawDate","p","dateForInput","timeForInput","rawTime","lecturerForInput","gradeKrsId","sqlKrs","isCompleted","nilaiAngkaValue","displayNumeric","normalizedNumeric","calcHuruf","calcIndeks","nilaiHurufValue","displayHuruf","nilaiIndeksValue","displayIndeks","currentGrade"],"ignoreList":[],"sources":["../../src/hooks/useGrades.ts","../../src/utils/classSummary/constants.ts","../../src/utils/classSummary/sqlHelpers.ts","../../src/utils/classSummary/formatters.ts","../../src/utils/classSummary/gradeCalculations.ts","../../src/hooks/classSummary/useAttendanceManager.ts","../../src/hooks/classSummary/useMeetingManager.ts","../../src/hooks/classSummary/useGradeManager.ts","../../src/services/classSummary/reportGenerator.ts","../../src/pages/shared/ClassSummary.tsx"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { apiService } from '../services/api';\r\nimport type { GetGradesParams, GradeRecord, CreateGradeRequest, UpdateGradeRequest } from '../types';\r\n\r\nexport function useGrades(params?: GetGradesParams) {\r\n  return useQuery<GradeRecord[], Error>({\r\n    queryKey: ['grades', params?.krs_id ?? null, params?.kelas_id ?? null],\r\n    queryFn: () => apiService.getGrades(params),\r\n    enabled: Boolean(params && (params.krs_id !== undefined || params.kelas_id !== undefined)),\r\n  });\r\n}\r\n\r\nexport function useCreateGrade(options?: { skipInvalidation?: boolean }) {\r\n  const qc = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: (data: CreateGradeRequest) => apiService.createGrade(data),\r\n    onSuccess: async () => {\r\n      if (!options?.skipInvalidation) {\r\n        // For create, we need to invalidate since we don't have the new ID yet\r\n        qc.invalidateQueries({ queryKey: ['grades'] });\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateGrade(options?: { skipInvalidation?: boolean }) {\r\n  const qc = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: ({ id, data }: { id: number; data: UpdateGradeRequest }) => apiService.updateGrade(id, data),\r\n    onSuccess: async (_response, variables) => {\r\n      if (!options?.skipInvalidation) {\r\n        // Fetch the updated grade and update cache instead of invalidating all\r\n        try {\r\n          const updatedGrade = await apiService.getGrade(variables.id);\r\n\r\n          // Update all matching grade queries\r\n          qc.setQueriesData<GradeRecord[]>(\r\n            { queryKey: ['grades'], exact: false },\r\n            (old) => {\r\n              if (!old) return old;\r\n              return old.map(grade =>\r\n                grade.id === variables.id ? updatedGrade : grade\r\n              );\r\n            }\r\n          );\r\n        } catch (error) {\r\n          // Fallback to invalidation if fetch fails\r\n          console.error('Failed to fetch updated grade, invalidating:', error);\r\n          qc.invalidateQueries({ queryKey: ['grades'] });\r\n        }\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDeleteGrade() {\r\n  const qc = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: (id: number) => apiService.deleteGrade(id),\r\n    onSuccess: () => {\r\n      qc.invalidateQueries({ queryKey: ['grades'] });\r\n    },\r\n  });\r\n}\r\n","// ============================================================================\r\n// ClassSummary Constants\r\n// ============================================================================\r\n\r\n/** Canonical attendance status values */\r\nexport const ATTENDANCE_STATUSES = ['', 'Hadir', 'Izin', 'Sakit', 'Alfa', 'Terlambat', 'Pengganti'] as const;\r\n\r\n/** Keyboard shortcuts mapping for attendance status brush */\r\nexport const KEYBOARD_STATUS_MAP: Record<string, string> = {\r\n  '1': 'Hadir',\r\n  '2': 'Izin',\r\n  '3': 'Sakit',\r\n  '4': 'Alfa',\r\n  '5': 'Terlambat',\r\n  '6': 'Pengganti',\r\n};\r\n","// ============================================================================\r\n// SQL Null Type Definitions\r\n// ============================================================================\r\n\r\nexport type SqlNullString = { String: string; Valid: boolean };\r\nexport type SqlNullTime = { Time: string; Valid: boolean };\r\nexport type SqlNullFloat64 = { Float64: number; Valid: boolean };\r\nexport type SqlNullInt32 = { Int32: number; Valid: boolean };\r\n\r\n// ============================================================================\r\n// SQL Value Extraction Helpers\r\n// ============================================================================\r\n\r\n/** Extract string from SqlNullString or plain string */\r\nexport const extractString = (val: string | SqlNullString | undefined | null): string => {\r\n  if (!val) return '';\r\n  if (typeof val === 'string') return val;\r\n  return val.Valid ? val.String : '';\r\n};\r\n\r\n/** Extract date string from SqlNullTime or plain string, returns ISO date YYYY-MM-DD */\r\nexport const extractDateISO = (val: string | SqlNullTime | undefined | null): string => {\r\n  if (!val) return '';\r\n  let raw = '';\r\n  if (typeof val === 'string') {\r\n    raw = val;\r\n  } else if (val.Valid) {\r\n    raw = val.Time;\r\n  }\r\n  if (!raw) return '';\r\n  const d = new Date(raw);\r\n  return isNaN(d.getTime()) ? '' : d.toISOString().slice(0, 10);\r\n};\r\n\r\n/** Extract time string, returns HH:MM format */\r\nexport const extractTimeHHMM = (val: string | SqlNullString | SqlNullTime | undefined | null): string => {\r\n  if (!val) return '';\r\n  let raw = '';\r\n  if (typeof val === 'string') {\r\n    raw = val;\r\n  } else if ('String' in val && val.Valid) {\r\n    raw = val.String;\r\n  } else if ('Time' in val && val.Valid) {\r\n    raw = val.Time;\r\n  }\r\n  if (!raw) return '';\r\n  const parts = raw.split(':');\r\n  return parts.length >= 2 ? `${parts[0].padStart(2, '0')}:${parts[1].padStart(2, '0')}` : raw;\r\n};\r\n\r\n/** Extract numeric value from various SQL null types (properly checks Valid property) */\r\nexport const extractNumeric = (val: unknown): number | null => {\r\n  if (val === null || val === undefined) return null;\r\n  if (typeof val === 'number') return val;\r\n  if (typeof val === 'object' && val !== null) {\r\n    if ('Float64' in val && (val as SqlNullFloat64).Valid) return (val as SqlNullFloat64).Float64;\r\n    if ('Int32' in val && (val as SqlNullInt32).Valid) return (val as SqlNullInt32).Int32;\r\n  }\r\n  return null;\r\n};\r\n\r\n/** Extract primitive value from SQL null types */\r\nexport const extractPrimitive = (val: unknown): string | number | boolean | null => {\r\n  if (val === null || val === undefined) return null;\r\n  if (typeof val === 'number' || typeof val === 'string' || typeof val === 'boolean') return val;\r\n  if (typeof val === 'object' && val !== null) {\r\n    if ('Float64' in val && (val as SqlNullFloat64).Valid) return (val as SqlNullFloat64).Float64;\r\n    if ('Int32' in val) return (val as SqlNullInt32).Int32;\r\n    if ('String' in val && (val as SqlNullString).Valid) return (val as SqlNullString).String;\r\n  }\r\n  return null;\r\n};\r\n\r\n/** Helper to extract numeric value from SqlNullFloat64 or number */\r\nexport const extractBobotValue = (val: unknown): number | null => {\r\n  if (val === null || val === undefined) return null;\r\n  if (typeof val === 'number') return val;\r\n  if (typeof val === 'object' && val !== null && 'Float64' in val && 'Valid' in val) {\r\n    const sqlNull = val as { Float64: number; Valid: boolean };\r\n    return sqlNull.Valid ? sqlNull.Float64 : null;\r\n  }\r\n  return null;\r\n};\r\n\r\n/** Get KRS ID from student object (handles multiple field name variants) */\r\ntype StudentKrsLike = {\r\n  id_krs?: string | number | null;\r\n  krs_id?: string | number | null;\r\n  krsId?: string | number | null;\r\n  krs?: {\r\n    id?: string | number | null;\r\n    KRS?: {\r\n      id?: string | number | null;\r\n    } | null;\r\n  } | null;\r\n} | null | undefined;\r\n\r\nexport const getStudentKrsId = (student: StudentKrsLike): number | null => {\r\n  const val =\r\n    student?.id_krs ??\r\n    student?.krs_id ??\r\n    student?.krsId ??\r\n    student?.krs?.id ??\r\n    student?.krs?.KRS?.id;\r\n  return val !== undefined && val !== null ? Number(val) : null;\r\n};\r\n\r\n/** Normalize attendance status to canonical form */\r\nexport const normalizeStatus = (val: string, validStatuses: readonly string[]): string => {\r\n  const found = validStatuses.find((s) => s.toLowerCase() === val.toLowerCase());\r\n  return found ?? val;\r\n};\r\n","import { extractTimeHHMM } from './sqlHelpers';\r\nimport type { SqlNullString, SqlNullTime } from './sqlHelpers';\r\n\r\n// ============================================================================\r\n// Date & Time Formatters\r\n// ============================================================================\r\n\r\n/** Format date for display with day of week */\r\nexport const formatDate = (dateValue: string | SqlNullTime): string => {\r\n  let dateString = '';\r\n  if (typeof dateValue === 'object' && dateValue !== null) {\r\n    if (!dateValue.Valid) return '-';\r\n    dateString = dateValue.Time;\r\n  } else {\r\n    dateString = dateValue;\r\n  }\r\n  if (!dateString) return '-';\r\n  const date = new Date(dateString);\r\n  const dayOfWeek = date.toLocaleDateString('en-US', { weekday: 'short' });\r\n  const formattedDate = date.toLocaleDateString('en-US', { day: '2-digit', month: 'short', year: 'numeric' });\r\n  return `${dayOfWeek}, ${formattedDate}`;\r\n};\r\n\r\n/** Format date for compact display (for table headers) */\r\nexport const formatDateCompact = (dateValue: string | SqlNullTime): string => {\r\n  let dateString = '';\r\n  if (typeof dateValue === 'object' && dateValue !== null) {\r\n    if (!dateValue.Valid) return '-';\r\n    dateString = dateValue.Time;\r\n  } else {\r\n    dateString = dateValue;\r\n  }\r\n  if (!dateString) return '-';\r\n  const date = new Date(dateString);\r\n  const dayOfWeek = date.toLocaleDateString('en-US', { weekday: 'short' });\r\n  const day = date.toLocaleDateString('en-US', { day: '2-digit' });\r\n  const month = date.toLocaleDateString('en-US', { month: 'short' });\r\n  return `${dayOfWeek}\\n${day} ${month}`;\r\n};\r\n\r\n/** Format time for display */\r\nexport const formatTime = (timeValue: string | SqlNullString | SqlNullTime | null | undefined): string => {\r\n  const raw = extractTimeHHMM(timeValue);\r\n  return raw || '-';\r\n};\r\n","import type { GradeRecord } from '@/types';\r\nimport { extractNumeric, extractBobotValue } from './sqlHelpers';\r\nimport type { SqlNullInt32 } from './sqlHelpers';\r\n\r\n// ============================================================================\r\n// Constants\r\n// ============================================================================\r\n\r\n/** Default grade component weights (percentage) - used as fallback */\r\nexport const DEFAULT_GRADE_WEIGHTS = {\r\n  aktivitas_partisipatif: 15,\r\n  hasil_proyek: 35,\r\n  quiz: 5,\r\n  tugas: 5,\r\n  uts: 15,\r\n  uas: 25,\r\n} as const;\r\n\r\nexport const BOBOT_FIELDS = [\r\n  'bobot_partisipatif',\r\n  'bobot_proyek',\r\n  'bobot_kuis',\r\n  'bobot_tugas',\r\n  'bobot_uts',\r\n  'bobot_uas',\r\n] as const;\r\n\r\n/** Fields to compare when checking for grade changes */\r\nexport const GRADE_COMPARE_FIELDS: (keyof GradeRecord)[] = [\r\n  'aktivitas_partisipatif',\r\n  'hasil_proyek',\r\n  'quiz',\r\n  'tugas',\r\n  'uts',\r\n  'uas',\r\n  'nilai_angka',\r\n  'nilai_huruf',\r\n  'nilai_indeks',\r\n];\r\n\r\n// ============================================================================\r\n// Grade Component Configuration\r\n// ============================================================================\r\n\r\n/** Get grade components with dynamic weights from class data */\r\ntype GradeWeightSource = Partial<{\r\n  bobot_partisipatif: unknown;\r\n  bobot_proyek: unknown;\r\n  bobot_kuis: unknown;\r\n  bobot_tugas: unknown;\r\n  bobot_uts: unknown;\r\n  bobot_uas: unknown;\r\n}> | null;\r\n\r\nexport const getGradeComponents = (classData?: GradeWeightSource) => {\r\n  const partisipatif = extractBobotValue(classData?.bobot_partisipatif);\r\n  const proyek = extractBobotValue(classData?.bobot_proyek);\r\n  const kuis = extractBobotValue(classData?.bobot_kuis);\r\n  const tugas = extractBobotValue(classData?.bobot_tugas);\r\n  const uts = extractBobotValue(classData?.bobot_uts);\r\n  const uas = extractBobotValue(classData?.bobot_uas);\r\n\r\n  return [\r\n    { key: 'aktivitas_partisipatif', weight: partisipatif ?? DEFAULT_GRADE_WEIGHTS.aktivitas_partisipatif },\r\n    { key: 'hasil_proyek', weight: proyek ?? DEFAULT_GRADE_WEIGHTS.hasil_proyek },\r\n    { key: 'quiz', weight: kuis ?? DEFAULT_GRADE_WEIGHTS.quiz },\r\n    { key: 'tugas', weight: tugas ?? DEFAULT_GRADE_WEIGHTS.tugas },\r\n    { key: 'uts', weight: uts ?? DEFAULT_GRADE_WEIGHTS.uts },\r\n    { key: 'uas', weight: uas ?? DEFAULT_GRADE_WEIGHTS.uas },\r\n  ] as const;\r\n};\r\n\r\n// ============================================================================\r\n// Grade Calculations\r\n// ============================================================================\r\n\r\n/** Calculate letter grade and index from numeric value */\r\nexport const calculateLetterGrade = (nilaiAngka: number | null): { huruf: string; indeks: number } => {\r\n  if (nilaiAngka === null || nilaiAngka === undefined) return { huruf: '', indeks: 0 };\r\n  if (nilaiAngka >= 80) return { huruf: 'A', indeks: 4.0 };\r\n  if (nilaiAngka >= 75) return { huruf: 'AB', indeks: 3.5 };\r\n  if (nilaiAngka >= 70) return { huruf: 'B', indeks: 3.0 };\r\n  if (nilaiAngka >= 65) return { huruf: 'BC', indeks: 2.5 };\r\n  if (nilaiAngka >= 60) return { huruf: 'C', indeks: 2.0 };\r\n  if (nilaiAngka >= 55) return { huruf: 'CD', indeks: 1.5 };\r\n  if (nilaiAngka >= 40) return { huruf: 'D', indeks: 1.0 };\r\n  return { huruf: 'E', indeks: 0.0 };\r\n};\r\n\r\n/** Calculate numeric grade from components based on weights (handles SqlNullFloat64) */\r\nexport const calculateNumericGrade = (\r\n  components: Partial<GradeRecord>,\r\n  gradeComponents?: ReturnType<typeof getGradeComponents>\r\n): number | null => {\r\n  let totalWeight = 0;\r\n  let totalValue = 0;\r\n  let hasAnyValue = false;\r\n\r\n  const componentsToUse = gradeComponents ?? getGradeComponents();\r\n  componentsToUse.forEach(({ key, weight }) => {\r\n    const rawValue = components[key as keyof GradeRecord];\r\n    const value = extractNumeric(rawValue);\r\n    if (value !== null) {\r\n      totalValue += value * weight;\r\n      totalWeight += weight;\r\n      hasAnyValue = true;\r\n    }\r\n  });\r\n\r\n  if (!hasAnyValue || totalWeight === 0) return null;\r\n  return parseFloat((totalValue / totalWeight).toFixed(2));\r\n};\r\n\r\n/** Generate a unique grade key for a student */\r\nexport const generateGradeKey = (grade: GradeRecord, studentKrsId: number | null, studentNim: string): string => {\r\n  if (grade.id && grade.id > 0) {\r\n    return `id:${grade.id}`;\r\n  }\r\n  if (grade.krs_id) {\r\n    const krsId = typeof grade.krs_id === 'object' ? (grade.krs_id as SqlNullInt32).Int32 : grade.krs_id;\r\n    return `krs:${krsId}`;\r\n  }\r\n  if (studentKrsId) {\r\n    return `krs:${studentKrsId}`;\r\n  }\r\n  return `nim:${studentNim}`;\r\n};\r\n","import { useState, useRef, useCallback, useMemo } from 'react';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { useCreateAttendance, useUpdateAttendance } from '../useAttendances';\r\nimport { extractString, normalizeStatus, ATTENDANCE_STATUSES } from '../../utils/classSummary';\r\nimport type { SqlNullString } from '../../utils/classSummary';\r\nimport type { AttendanceRecord } from '../../types';\r\nimport { apiService } from '../../services/api';\r\n\r\ninterface UseAttendanceManagerProps {\r\n  classId: string | undefined;\r\n  meetingIds: number[];\r\n  attendanceMap: Record<number, AttendanceRecord[]>;\r\n  isEditing: boolean;\r\n}\r\n\r\nexport const useAttendanceManager = ({\r\n  classId,\r\n  meetingIds,\r\n  attendanceMap,\r\n  isEditing,\r\n}: UseAttendanceManagerProps) => {\r\n  const queryClient = useQueryClient();\r\n  const justSavedAttendanceRef = useRef(false);\r\n\r\n  // State\r\n  const [savingCells, setSavingCells] = useState<Record<string, boolean>>({});\r\n  const [initialAttendanceSnapshot, setInitialAttendanceSnapshot] = useState<Record<string, string>>({});\r\n  const [modifiedCells, setModifiedCells] = useState<Set<string>>(new Set());\r\n  const [pendingStatusChanges, setPendingStatusChanges] = useState<Record<string, string>>({});\r\n  const [originalAttendanceCache, setOriginalAttendanceCache] = useState<Record<number, AttendanceRecord[]>>({});\r\n  const [activeCell, setActiveCell] = useState<string | null>(null);\r\n  const [currentShortcutStatus, setCurrentShortcutStatus] = useState<string | null>(null);\r\n\r\n  // Mutations\r\n  const createAttendanceMutation = useCreateAttendance();\r\n  const updateAttendanceMutation = useUpdateAttendance();\r\n\r\n  // Build initial snapshot\r\n  const buildInitialSnapshot = useCallback(() => {\r\n    if (justSavedAttendanceRef.current) {\r\n      console.log('[EFFECT] Skipping attendance snapshot update - just saved');\r\n      return;\r\n    }\r\n\r\n    console.log('[EFFECT] Building attendance snapshot, isEditing:', isEditing);\r\n\r\n    const snap: Record<string, string> = {};\r\n    Object.values(attendanceMap).forEach((records) => {\r\n      records.forEach((r) => {\r\n        const status = extractString(r.status_kehadiran as string | SqlNullString | undefined | null);\r\n        snap[`${r.nim}-${r.id_pertemuan}`] = normalizeStatus(status, ATTENDANCE_STATUSES);\r\n      });\r\n    });\r\n    setInitialAttendanceSnapshot(snap);\r\n    if (!isEditing) {\r\n      console.log('[EFFECT] Setting original cache (not editing)');\r\n      setOriginalAttendanceCache(attendanceMap);\r\n    }\r\n  }, [attendanceMap, isEditing]);\r\n\r\n  // Recalculate modified cells\r\n  const recalcModified = useCallback(() => {\r\n    const next = new Set<string>();\r\n    Object.entries(pendingStatusChanges).forEach(([key, val]) => {\r\n      const original = initialAttendanceSnapshot[key] ?? '';\r\n      if (normalizeStatus(original, ATTENDANCE_STATUSES) !== normalizeStatus(val, ATTENDANCE_STATUSES)) {\r\n        next.add(key);\r\n      }\r\n    });\r\n    setModifiedCells(next);\r\n  }, [pendingStatusChanges, initialAttendanceSnapshot]);\r\n\r\n  // Update single cell\r\n  const updateSingleCell = useCallback(\r\n    (key: string, newStatus: string) => {\r\n      const [nim, meetingIdStr] = key.split('-');\r\n      const meetingId = Number(meetingIdStr);\r\n      const queryKey = ['class-attendances', classId, meetingIds];\r\n\r\n      queryClient.setQueryData(queryKey, (old: typeof attendanceMap) => {\r\n        const clone = { ...(old || {}) };\r\n        const arr = [...(clone[meetingId] || [])];\r\n        const existingIdx = arr.findIndex((r) => r.nim === nim);\r\n\r\n        if (existingIdx >= 0) {\r\n          arr[existingIdx] = { ...arr[existingIdx], status_kehadiran: newStatus };\r\n        } else {\r\n          arr.push({\r\n            id: -Date.now(),\r\n            id_pertemuan: meetingId,\r\n            nim,\r\n            status_kehadiran: newStatus,\r\n          } as AttendanceRecord);\r\n        }\r\n\r\n        clone[meetingId] = arr;\r\n        return clone;\r\n      });\r\n\r\n      setPendingStatusChanges((prev) => ({ ...prev, [key]: newStatus }));\r\n      recalcModified();\r\n    },\r\n    [classId, meetingIds, queryClient, recalcModified]\r\n  );\r\n\r\n  // Commit attendance changes\r\n  const commitAttendanceChanges = useCallback(\r\n    async (skipExit = false) => {\r\n      if (!isEditing) return;\r\n\r\n      const changes = Object.entries(pendingStatusChanges);\r\n      if (!changes.length) {\r\n        return;\r\n      }\r\n\r\n      setSavingCells((prev) => {\r\n        const next = { ...prev };\r\n        changes.forEach(([key]) => (next[key] = true));\r\n        return next;\r\n      });\r\n\r\n      try {\r\n        await Promise.all(\r\n          changes.map(async ([key, status]) => {\r\n            const [nim, meetingIdStr] = key.split('-');\r\n            const meetingId = Number(meetingIdStr);\r\n            const existing = attendanceMap[meetingId]?.find((r) => r.nim === nim);\r\n\r\n            if (existing && existing.id > 0) {\r\n              await updateAttendanceMutation.mutateAsync({\r\n                id: existing.id,\r\n                data: { status_kehadiran: status || undefined },\r\n              });\r\n            } else {\r\n              await createAttendanceMutation.mutateAsync({\r\n                id_pertemuan: meetingId,\r\n                nim,\r\n                status_kehadiran: status || undefined,\r\n              });\r\n            }\r\n          })\r\n        );\r\n\r\n        // Manually refetch fresh data from the server\r\n        const map: Record<number, AttendanceRecord[]> = {};\r\n        await Promise.all(\r\n          meetingIds.map(async (meetingId) => {\r\n            const records = await apiService.getMeetingAttendances(meetingId);\r\n            map[meetingId] = records;\r\n          })\r\n        );\r\n\r\n        // Update the query cache with fresh data\r\n        queryClient.setQueryData(['class-attendances', classId, meetingIds], map);\r\n\r\n        // Update the original cache\r\n        setOriginalAttendanceCache(map);\r\n\r\n        // Mark that we just saved successfully\r\n        justSavedAttendanceRef.current = true;\r\n\r\n        if (!skipExit) {\r\n          setPendingStatusChanges({});\r\n          setModifiedCells(new Set());\r\n          setActiveCell(null);\r\n        }\r\n      } finally {\r\n        setSavingCells({});\r\n      }\r\n    },\r\n    [\r\n      isEditing,\r\n      pendingStatusChanges,\r\n      attendanceMap,\r\n      meetingIds,\r\n      updateAttendanceMutation,\r\n      createAttendanceMutation,\r\n      queryClient,\r\n      classId,\r\n    ]\r\n  );\r\n\r\n  // Enter edit mode\r\n  const enterEditMode = useCallback(() => {\r\n    setOriginalAttendanceCache(attendanceMap);\r\n    setPendingStatusChanges({});\r\n    setModifiedCells(new Set());\r\n    setActiveCell(null);\r\n    setCurrentShortcutStatus(null);\r\n  }, [attendanceMap]);\r\n\r\n  // Exit edit mode\r\n  const exitEditMode = useCallback(() => {\r\n    const queryKey = ['class-attendances', classId, meetingIds];\r\n\r\n    // Don't restore old data if we just saved successfully\r\n    if (justSavedAttendanceRef.current) {\r\n      justSavedAttendanceRef.current = false;\r\n    } else {\r\n      queryClient.setQueryData(queryKey, originalAttendanceCache);\r\n    }\r\n\r\n    setPendingStatusChanges({});\r\n    setModifiedCells(new Set());\r\n    setActiveCell(null);\r\n    setCurrentShortcutStatus(null);\r\n  }, [classId, meetingIds, queryClient, originalAttendanceCache]);\r\n\r\n  // Check if there are unsaved changes\r\n  const hasUnsavedChanges = useMemo(() => {\r\n    return modifiedCells.size > 0;\r\n  }, [modifiedCells]);\r\n\r\n  return {\r\n    // State\r\n    savingCells,\r\n    initialAttendanceSnapshot,\r\n    modifiedCells,\r\n    pendingStatusChanges,\r\n    activeCell,\r\n    currentShortcutStatus,\r\n    hasUnsavedChanges,\r\n\r\n    // State setters\r\n    setActiveCell,\r\n    setCurrentShortcutStatus,\r\n    setPendingStatusChanges,\r\n\r\n    // Methods\r\n    buildInitialSnapshot,\r\n    updateSingleCell,\r\n    commitAttendanceChanges,\r\n    enterEditMode,\r\n    exitEditMode,\r\n    recalcModified,\r\n  };\r\n};\r\n","import { useState, useCallback, useMemo } from 'react';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { useUpdateMeeting } from '../useAttendances';\r\nimport { extractString, extractDateISO, extractTimeHHMM } from '../../utils/classSummary';\r\nimport type { SqlNullString } from '../../utils/classSummary';\r\nimport type { MeetingSchedule } from '../../types';\r\n\r\ninterface UseMeetingManagerProps {\r\n  classIdNum: number;\r\n  meetings: MeetingSchedule[];\r\n}\r\n\r\nexport const useMeetingManager = ({ classIdNum, meetings }: UseMeetingManagerProps) => {\r\n  const queryClient = useQueryClient();\r\n\r\n  // State\r\n  const [editedTopics, setEditedTopics] = useState<Record<number, string>>({});\r\n  const [editedDates, setEditedDates] = useState<Record<number, string>>({});\r\n  const [editedTimes, setEditedTimes] = useState<Record<number, string>>({});\r\n  const [editedLecturers, setEditedLecturers] = useState<Record<number, string>>({});\r\n\r\n  // Mutations\r\n  const updateMeetingMutation = useUpdateMeeting();\r\n\r\n  // Start editing a topic\r\n  const startEditTopic = useCallback(\r\n    (meetingId: number, currentTopik: string, currentDate: string, currentTime: string, currentLecturer: string) => {\r\n      setEditedTopics((prev) => ({ ...prev, [meetingId]: currentTopik || '' }));\r\n      setEditedDates((prev) => ({ ...prev, [meetingId]: currentDate || '' }));\r\n      setEditedTimes((prev) => ({ ...prev, [meetingId]: currentTime || '' }));\r\n      setEditedLecturers((prev) => ({ ...prev, [meetingId]: currentLecturer || '' }));\r\n    },\r\n    []\r\n  );\r\n\r\n  // Cancel editing a topic\r\n  const cancelEditTopic = useCallback((meetingId: number) => {\r\n    setEditedTopics((prev) => {\r\n      const next = { ...prev };\r\n      delete next[meetingId];\r\n      return next;\r\n    });\r\n    setEditedDates((prev) => {\r\n      const next = { ...prev };\r\n      delete next[meetingId];\r\n      return next;\r\n    });\r\n    setEditedTimes((prev) => {\r\n      const next = { ...prev };\r\n      delete next[meetingId];\r\n      return next;\r\n    });\r\n    setEditedLecturers((prev) => {\r\n      const next = { ...prev };\r\n      delete next[meetingId];\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Save a topic\r\n  const saveTopic = useCallback(\r\n    async (meetingId: number) => {\r\n      const newTopic = editedTopics[meetingId] ?? '';\r\n      const newDateRaw = editedDates[meetingId] ?? '';\r\n      const newTimeRaw = editedTimes[meetingId] ?? '';\r\n      const newLecturer = editedLecturers[meetingId] ?? '';\r\n\r\n      // Convert to expected formats\r\n      const newDateISO = newDateRaw ? `${newDateRaw}T00:00:00.000Z` : undefined;\r\n      const newTimeWithSeconds = newTimeRaw ? `${newTimeRaw}:00` : undefined;\r\n\r\n      console.log('[MEETING]  Saving meeting', meetingId, 'with topic:', newTopic);\r\n      console.log('[MEETING] Date input:', newDateRaw, ' ISO:', newDateISO);\r\n      console.log('[MEETING] Lecturer:', newLecturer);\r\n\r\n        await updateMeetingMutation.mutateAsync({\r\n          id: meetingId,\r\n          data: {\r\n            topik: newTopic || undefined,\r\n            tgl_pertemuan: newDateISO,\r\n            jam_pertemuan: newTimeWithSeconds,\r\n            id_dosen: newLecturer || undefined,\r\n          },\r\n        });\r\n\r\n        console.log('[MEETING]  Meeting saved successfully');\r\n\r\n        // Optimistically update cache\r\n        queryClient.setQueryData<MeetingSchedule[]>(['class-meetings', classIdNum], (prev) => {\r\n          if (!prev) return prev;\r\n          return prev.map((m) =>\r\n            m.id === meetingId\r\n              ? {\r\n                  ...m,\r\n                  topik: newTopic,\r\n                  tgl_pertemuan: newDateISO || m.tgl_pertemuan,\r\n                  jam_pertemuan: newTimeWithSeconds || m.jam_pertemuan,\r\n                  id_dosen: newLecturer || m.id_dosen,\r\n                }\r\n              : m\r\n          );\r\n        });\r\n\r\n        cancelEditTopic(meetingId);\r\n    },\r\n    [editedTopics, editedDates, editedTimes, editedLecturers, updateMeetingMutation, queryClient, classIdNum, cancelEditTopic]\r\n  );\r\n\r\n  // Enter edit mode\r\n  const enterEditMode = useCallback(() => {\r\n    console.log('[MEETING]  Entering meeting edit mode');\r\n    const topics: Record<number, string> = {};\r\n    const dates: Record<number, string> = {};\r\n    const times: Record<number, string> = {};\r\n    const lecturers: Record<number, string> = {};\r\n    meetings.forEach((meeting) => {\r\n      topics[meeting.id] = extractString(meeting.topik as string | SqlNullString);\r\n      dates[meeting.id] = extractDateISO(meeting.tgl_pertemuan);\r\n      times[meeting.id] = extractTimeHHMM(meeting.jam_pertemuan as string | SqlNullString);\r\n      lecturers[meeting.id] = extractString(meeting.id_dosen as string | SqlNullString);\r\n    });\r\n    setEditedTopics(topics);\r\n    setEditedDates(dates);\r\n    setEditedTimes(times);\r\n    setEditedLecturers(lecturers);\r\n  }, [meetings]);\r\n\r\n  // Exit edit mode\r\n  const exitEditMode = useCallback(() => {\r\n    console.log('[MEETING]  Exiting meeting edit mode - clearing edits');\r\n    setEditedTopics({});\r\n    setEditedDates({});\r\n    setEditedTimes({});\r\n    setEditedLecturers({});\r\n  }, []);\r\n\r\n  // Check if there are unsaved changes\r\n  const hasUnsavedChanges = useMemo(() => {\r\n    for (const meeting of meetings) {\r\n      const id = meeting.id;\r\n\r\n      // Topic\r\n      const editedTopik = editedTopics[id] ?? '';\r\n      const currentTopik = extractString(meeting.topik as string | SqlNullString);\r\n      if (editedTopik !== currentTopik) return true;\r\n\r\n      // Date\r\n      const editedDate = editedDates[id] ?? '';\r\n      const currentDateISO = extractDateISO(meeting.tgl_pertemuan);\r\n      if (editedDate !== currentDateISO) return true;\r\n\r\n      // Time\r\n      const editedTime = editedTimes[id] ?? '';\r\n      const currentTime = extractTimeHHMM(meeting.jam_pertemuan as string | SqlNullString);\r\n      if (editedTime !== currentTime) return true;\r\n\r\n      // Lecturer\r\n      const editedLecturer = editedLecturers[id] ?? '';\r\n      const currentLecturer = extractString(meeting.id_dosen as string | SqlNullString);\r\n      if (editedLecturer !== currentLecturer) return true;\r\n    }\r\n    return false;\r\n  }, [meetings, editedTopics, editedDates, editedTimes, editedLecturers]);\r\n\r\n  return {\r\n    // State\r\n    editedTopics,\r\n    editedDates,\r\n    editedTimes,\r\n    editedLecturers,\r\n    hasUnsavedChanges,\r\n\r\n    // State setters\r\n    setEditedTopics,\r\n    setEditedDates,\r\n    setEditedTimes,\r\n    setEditedLecturers,\r\n\r\n    // Methods\r\n    startEditTopic,\r\n    cancelEditTopic,\r\n    saveTopic,\r\n    enterEditMode,\r\n    exitEditMode,\r\n  };\r\n};\r\n","import { useState, useCallback, useMemo } from 'react';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { useUpdateGrade, useCreateGrade } from '../useGrades';\r\nimport {\r\n  extractNumeric,\r\n  extractBobotValue,\r\n  getStudentKrsId,\r\n  calculateNumericGrade,\r\n  calculateLetterGrade,\r\n  generateGradeKey,\r\n  getGradeComponents,\r\n  extractPrimitive,\r\n  GRADE_COMPARE_FIELDS,\r\n  DEFAULT_GRADE_WEIGHTS,\r\n  BOBOT_FIELDS,\r\n} from '../../utils/classSummary';\r\nimport type { GradeRecord } from '../../types';\r\nimport { apiService } from '../../services/api';\r\n\r\ntype StudentLite = {\r\n  nim?: string;\r\n  krs_id?: string | number | null | undefined;\r\n  id_krs?: string | number | null | undefined;\r\n  krsId?: string | number | null | undefined;\r\n  krs?: { id?: string | number | null | undefined; nim?: string; student?: { nim?: string } | null } | null;\r\n  student?: { nim?: string } | null;\r\n};\r\n\r\ntype ExtendedGradeRecord = GradeRecord & {\r\n  student?: { nim?: string | null } | null;\r\n  krs?: { student?: { nim?: string | null } | null; nim?: string | null } | null;\r\n};\r\n\r\ntype ClassGradeData = Partial<{\r\n  bobot_partisipatif: unknown;\r\n  bobot_proyek: unknown;\r\n  bobot_kuis: unknown;\r\n  bobot_tugas: unknown;\r\n  bobot_uts: unknown;\r\n  bobot_uas: unknown;\r\n}>;\r\n\r\ninterface UseGradeManagerProps {\r\n  classIdNum: number;\r\n  classId: string | undefined;\r\n  students: StudentLite[];\r\n  gradeRecords: GradeRecord[];\r\n  classData: ClassGradeData | null | undefined;\r\n}\r\n\r\nexport const useGradeManager = ({\r\n  classIdNum,\r\n  classId,\r\n  students,\r\n  gradeRecords,\r\n  classData,\r\n}: UseGradeManagerProps) => {\r\n  const queryClient = useQueryClient();\r\n\r\n  // State\r\n  const [editedGrades, setEditedGrades] = useState<Record<string, Partial<GradeRecord>>>({});\r\n  const [savingGradeIds, setSavingGradeIds] = useState<Set<number>>(new Set());\r\n  const [completedGradeKeys, setCompletedGradeKeys] = useState<Set<string>>(new Set());\r\n\r\n  // Bobot (grade weights) edit state\r\n  const [editedBobots, setEditedBobots] = useState<{\r\n    bobot_partisipatif?: number;\r\n    bobot_proyek?: number;\r\n    bobot_kuis?: number;\r\n    bobot_tugas?: number;\r\n    bobot_uts?: number;\r\n    bobot_uas?: number;\r\n  }>({});\r\n  const [isSavingBobots, setIsSavingBobots] = useState(false);\r\n  const [bobotError, setBobotError] = useState<string | null>(null);\r\n  const [isBobotCompleted, setIsBobotCompleted] = useState(false);\r\n\r\n  // Mutations\r\n  const updateGradeMutation = useUpdateGrade();\r\n  const createGradeMutation = useCreateGrade();\r\n\r\n  // Grade weights calculation\r\n  const gradeWeights = useMemo(() => {\r\n    const partisipatif = editedBobots.bobot_partisipatif ?? extractBobotValue(classData?.bobot_partisipatif);\r\n    const proyek = editedBobots.bobot_proyek ?? extractBobotValue(classData?.bobot_proyek);\r\n    const kuis = editedBobots.bobot_kuis ?? extractBobotValue(classData?.bobot_kuis);\r\n    const tugas = editedBobots.bobot_tugas ?? extractBobotValue(classData?.bobot_tugas);\r\n    const uts = editedBobots.bobot_uts ?? extractBobotValue(classData?.bobot_uts);\r\n    const uas = editedBobots.bobot_uas ?? extractBobotValue(classData?.bobot_uas);\r\n\r\n    return {\r\n      aktivitas_partisipatif: partisipatif ?? DEFAULT_GRADE_WEIGHTS.aktivitas_partisipatif,\r\n      hasil_proyek: proyek ?? DEFAULT_GRADE_WEIGHTS.hasil_proyek,\r\n      quiz: kuis ?? DEFAULT_GRADE_WEIGHTS.quiz,\r\n      tugas: tugas ?? DEFAULT_GRADE_WEIGHTS.tugas,\r\n      uts: uts ?? DEFAULT_GRADE_WEIGHTS.uts,\r\n      uas: uas ?? DEFAULT_GRADE_WEIGHTS.uas,\r\n    };\r\n  }, [classData, editedBobots]);\r\n\r\n  const gradeComponents = useMemo(() => {\r\n    const effectiveClassData = {\r\n      bobot_partisipatif: editedBobots.bobot_partisipatif ?? extractBobotValue(classData?.bobot_partisipatif),\r\n      bobot_proyek: editedBobots.bobot_proyek ?? extractBobotValue(classData?.bobot_proyek),\r\n      bobot_kuis: editedBobots.bobot_kuis ?? extractBobotValue(classData?.bobot_kuis),\r\n      bobot_tugas: editedBobots.bobot_tugas ?? extractBobotValue(classData?.bobot_tugas),\r\n      bobot_uts: editedBobots.bobot_uts ?? extractBobotValue(classData?.bobot_uts),\r\n      bobot_uas: editedBobots.bobot_uas ?? extractBobotValue(classData?.bobot_uas),\r\n    };\r\n    return getGradeComponents(effectiveClassData);\r\n  }, [classData, editedBobots]);\r\n\r\n  const originalBobotWeights = useMemo(\r\n    () => ({\r\n      bobot_partisipatif: extractBobotValue(classData?.bobot_partisipatif) ?? DEFAULT_GRADE_WEIGHTS.aktivitas_partisipatif,\r\n      bobot_proyek: extractBobotValue(classData?.bobot_proyek) ?? DEFAULT_GRADE_WEIGHTS.hasil_proyek,\r\n      bobot_kuis: extractBobotValue(classData?.bobot_kuis) ?? DEFAULT_GRADE_WEIGHTS.quiz,\r\n      bobot_tugas: extractBobotValue(classData?.bobot_tugas) ?? DEFAULT_GRADE_WEIGHTS.tugas,\r\n      bobot_uts: extractBobotValue(classData?.bobot_uts) ?? DEFAULT_GRADE_WEIGHTS.uts,\r\n      bobot_uas: extractBobotValue(classData?.bobot_uas) ?? DEFAULT_GRADE_WEIGHTS.uas,\r\n    }),\r\n    [classData]\r\n  );\r\n\r\n  const hasEditedBobots = useMemo(\r\n    () =>\r\n      BOBOT_FIELDS.some((field) => {\r\n        const edited = editedBobots[field];\r\n        if (edited === undefined) return false;\r\n        return edited !== originalBobotWeights[field];\r\n      }),\r\n    [editedBobots, originalBobotWeights]\r\n  );\r\n\r\n  // Find the grade record for a student\r\n  const findGradeForStudent = useCallback(\r\n    (student: StudentLite): GradeRecord => {\r\n      const extendedRecords = gradeRecords as ExtendedGradeRecord[];\r\n      const studentNim = student?.nim ?? student?.krs?.nim ?? student?.student?.nim ?? '';\r\n      let found: GradeRecord | ExtendedGradeRecord | undefined;\r\n      found = extendedRecords.find(\r\n        (g) => g.student?.nim === studentNim || g.krs?.student?.nim === studentNim || g.krs?.nim === studentNim\r\n      );\r\n      if (found) return found;\r\n\r\n      const studentKrsId = getStudentKrsId(student);\r\n      if (studentKrsId !== null) {\r\n        found = gradeRecords.find((g) => {\r\n          const k = extractNumeric(g.krs_id);\r\n          return k !== null && k === studentKrsId;\r\n        });\r\n        if (found) return found;\r\n      }\r\n\r\n      found = extendedRecords.find((g) => Object.values((g as unknown) as Record<string, unknown>).some((v) => typeof v === 'string' && v === studentNim));\r\n      if (found) return found;\r\n\r\n      return {\r\n        id: 0,\r\n        krs_id: null,\r\n        aktivitas_partisipatif: null,\r\n        hasil_proyek: null,\r\n        quiz: null,\r\n        tugas: null,\r\n        uts: null,\r\n        uas: null,\r\n        nilai_angka: null,\r\n        nilai_huruf: null,\r\n        nilai_indeks: null,\r\n      } as GradeRecord;\r\n    },\r\n    [gradeRecords]\r\n  );\r\n\r\n  // Save a grade\r\n  const saveGrade = useCallback(\r\n    async (gradeKey: string, grade: GradeRecord, student?: StudentLite) => {\r\n      console.log('[GRADES]  Saving grade for key:', gradeKey, 'Grade ID:', grade?.id);\r\n      const idNum = grade?.id && grade.id > 0 ? grade.id : null;\r\n      if (idNum) setSavingGradeIds((prev) => new Set([...prev, idNum]));\r\n\r\n      try {\r\n        const editedGrade = editedGrades[gradeKey];\r\n        if (!editedGrade) {\r\n          console.log('[GRADES]  No edited grade found for key:', gradeKey);\r\n          return;\r\n        }\r\n\r\n        const gradeComponentFields: (keyof GradeRecord)[] = [\r\n          'aktivitas_partisipatif',\r\n          'hasil_proyek',\r\n          'quiz',\r\n          'tugas',\r\n          'uts',\r\n          'uas',\r\n        ];\r\n\r\n        const hasChanges = gradeComponentFields.some((field) => {\r\n          const originalValue = extractNumeric(grade[field]);\r\n          const editedValue = extractNumeric(editedGrade[field]);\r\n          return originalValue !== editedValue;\r\n        });\r\n\r\n        if (!hasChanges) {\r\n          console.log('[GRADES]  No changes detected, skipping save');\r\n          setCompletedGradeKeys((prev) => new Set([...prev, gradeKey]));\r\n          if (idNum) setSavingGradeIds((prev) => new Set([...prev].filter((id) => id !== idNum)));\r\n          return;\r\n        }\r\n\r\n        const calculatedNumeric = calculateNumericGrade(editedGrade, gradeComponents);\r\n        const nilaiAngka = calculatedNumeric !== null ? calculatedNumeric : extractNumeric(editedGrade.nilai_angka);\r\n\r\n        let nilaiHuruf: string | undefined = undefined;\r\n        let nilaiIndeks: number | undefined = undefined;\r\n\r\n        if (nilaiAngka !== null) {\r\n          const { huruf, indeks } = calculateLetterGrade(nilaiAngka);\r\n          nilaiHuruf = huruf;\r\n          nilaiIndeks = indeks;\r\n          console.log('[GRADES]  Auto-calculated: Numeric=', nilaiAngka, 'Letter=', nilaiHuruf, 'Index=', nilaiIndeks);\r\n        }\r\n\r\n        const updateData = {\r\n          aktivitas_partisipatif: extractNumeric(editedGrade.aktivitas_partisipatif) ?? undefined,\r\n          hasil_proyek: extractNumeric(editedGrade.hasil_proyek) ?? undefined,\r\n          quiz: extractNumeric(editedGrade.quiz) ?? undefined,\r\n          tugas: extractNumeric(editedGrade.tugas) ?? undefined,\r\n          uts: extractNumeric(editedGrade.uts) ?? undefined,\r\n          uas: extractNumeric(editedGrade.uas) ?? undefined,\r\n          nilai_angka: nilaiAngka ?? undefined,\r\n          nilai_huruf: nilaiHuruf,\r\n          nilai_indeks: nilaiIndeks,\r\n        };\r\n\r\n        if (grade.id && grade.id > 0) {\r\n          console.log('[GRADES]  Updating existing grade with ID:', grade.id);\r\n          await updateGradeMutation.mutateAsync({ id: grade.id, data: updateData });\r\n        } else if (grade.krs_id) {\r\n          const krsId = extractNumeric(grade.krs_id);\r\n          console.log('[GRADES]  Creating new grade with KRS ID:', krsId);\r\n          await createGradeMutation.mutateAsync({ krs_id: Number(krsId), ...updateData });\r\n        } else {\r\n          const kFromStudent = getStudentKrsId(student);\r\n          const krsId = kFromStudent ?? extractNumeric(editedGrade?.krs_id);\r\n          if (krsId) {\r\n            console.log('[GRADES]  Creating new grade with KRS ID from student:', krsId);\r\n            await createGradeMutation.mutateAsync({ krs_id: Number(krsId), ...updateData });\r\n          } else {\r\n            console.log('[GRADES]  Missing KRS ID for grade creation');\r\n            throw new Error('Missing KRS id for grade creation');\r\n          }\r\n        }\r\n\r\n        console.log('[GRADES]  Grade saved successfully');\r\n\r\n        setEditedGrades((prev) => {\r\n          const next = { ...prev };\r\n          delete next[gradeKey];\r\n          return next;\r\n        });\r\n        setCompletedGradeKeys((prev) => new Set([...prev, gradeKey]));\r\n      } catch (e) {\r\n        console.log('[GRADES]  Error saving grade:', e);\r\n        throw e;\r\n      } finally {\r\n        if (idNum) {\r\n          setSavingGradeIds((prev) => new Set([...prev].filter((id) => id !== idNum)));\r\n        }\r\n      }\r\n    },\r\n    [editedGrades, gradeComponents, updateGradeMutation, createGradeMutation]\r\n  );\r\n\r\n  // Update a grade field\r\n  const updateGradeField = useCallback(\r\n    (gradeKey: string, field: keyof GradeRecord, value: unknown) => {\r\n      setEditedGrades((prev) => {\r\n        const updatedGrade = {\r\n          ...prev[gradeKey],\r\n          [field]: value === '' ? null : value,\r\n        };\r\n\r\n        const isGradeComponent = gradeComponents.some((comp) => comp.key === field);\r\n\r\n        if (isGradeComponent) {\r\n          const calculatedNumeric = calculateNumericGrade(updatedGrade, gradeComponents);\r\n\r\n          if (calculatedNumeric !== null) {\r\n            const { huruf, indeks } = calculateLetterGrade(calculatedNumeric);\r\n\r\n            updatedGrade.nilai_angka = calculatedNumeric;\r\n            updatedGrade.nilai_huruf = huruf;\r\n            updatedGrade.nilai_indeks = indeks;\r\n          } else {\r\n            updatedGrade.nilai_angka = null;\r\n            updatedGrade.nilai_huruf = null;\r\n            updatedGrade.nilai_indeks = null;\r\n          }\r\n        }\r\n\r\n        return {\r\n          ...prev,\r\n          [gradeKey]: updatedGrade,\r\n        };\r\n      });\r\n    },\r\n    [gradeComponents]\r\n  );\r\n\r\n  // Bobot change handler\r\n  const handleBobotChange = useCallback((field: string, value: string) => {\r\n    const numValue = value === '' ? undefined : parseFloat(value);\r\n    setEditedBobots((prev) => ({\r\n      ...prev,\r\n      [field]: numValue,\r\n    }));\r\n    setBobotError(null);\r\n  }, []);\r\n\r\n  // Cancel bobot changes\r\n  const cancelBobots = useCallback(() => {\r\n    setEditedBobots({});\r\n    setBobotError(null);\r\n    setIsBobotCompleted(true);\r\n  }, []);\r\n\r\n  // Enable bobot editing (reset completion state)\r\n  const enableBobotEditing = useCallback(() => {\r\n    setIsBobotCompleted(false);\r\n  }, []);\r\n\r\n  // Save bobot values\r\n  const saveBobots = useCallback(async () => {\r\n    try {\r\n      setIsSavingBobots(true);\r\n      setBobotError(null);\r\n\r\n      const bobotData = {\r\n        bobot_partisipatif: editedBobots.bobot_partisipatif ?? gradeWeights.aktivitas_partisipatif,\r\n        bobot_proyek: editedBobots.bobot_proyek ?? gradeWeights.hasil_proyek,\r\n        bobot_kuis: editedBobots.bobot_kuis ?? gradeWeights.quiz,\r\n        bobot_tugas: editedBobots.bobot_tugas ?? gradeWeights.tugas,\r\n        bobot_uts: editedBobots.bobot_uts ?? gradeWeights.uts,\r\n        bobot_uas: editedBobots.bobot_uas ?? gradeWeights.uas,\r\n      };\r\n\r\n      const total =\r\n        bobotData.bobot_partisipatif +\r\n        bobotData.bobot_proyek +\r\n        bobotData.bobot_kuis +\r\n        bobotData.bobot_tugas +\r\n        bobotData.bobot_uts +\r\n        bobotData.bobot_uas;\r\n\r\n      if (Math.abs(total - 100) > 0.01) {\r\n        setBobotError(`Total must be 100%. Current total: ${total.toFixed(1)}%`);\r\n        return false;\r\n      }\r\n\r\n      await apiService.updateClass(classIdNum, bobotData);\r\n\r\n      await queryClient.invalidateQueries({ queryKey: ['class', classId] });\r\n\r\n      setEditedBobots({});\r\n      setIsBobotCompleted(true);\r\n      console.log('[BOBOTS]  Bobot values saved successfully');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('[BOBOTS]  Failed to save bobot values:', error);\r\n      setBobotError(error instanceof Error ? error.message : 'Failed to save grade weights');\r\n      return false;\r\n    } finally {\r\n      setIsSavingBobots(false);\r\n    }\r\n  }, [editedBobots, gradeWeights, classIdNum, queryClient, classId]);\r\n\r\n  // Enter edit mode\r\n  const enterEditMode = useCallback(() => {\r\n    console.log('[GRADES]  Entering grades edit mode');\r\n    const gradeMap: Record<string, Partial<GradeRecord>> = {};\r\n    students.forEach((student) => {\r\n      const grade = findGradeForStudent(student) || ({} as GradeRecord);\r\n      const studentKrsId = getStudentKrsId(student);\r\n      const safeNim = student?.nim ?? student?.krs?.nim ?? student?.student?.nim ?? '';\r\n      const gradeKey = generateGradeKey(grade, studentKrsId, safeNim);\r\n      gradeMap[gradeKey] = grade;\r\n    });\r\n    console.log('[GRADES] Initial grade map:', gradeMap);\r\n    setEditedGrades(gradeMap);\r\n  }, [students, findGradeForStudent]);\r\n\r\n  // Exit edit mode\r\n  const exitEditMode = useCallback(() => {\r\n    console.log('[GRADES]  Exiting grades edit mode - clearing edits');\r\n    setEditedGrades({});\r\n    setCompletedGradeKeys(new Set());\r\n    setEditedBobots({});\r\n    setBobotError(null);\r\n    setIsBobotCompleted(false);\r\n  }, []);\r\n\r\n  // Check if there are unsaved changes\r\n  const hasUnsavedChanges = useMemo(() => {\r\n    for (const [gradeKey, edited] of Object.entries(editedGrades)) {\r\n      let original: GradeRecord | null = null;\r\n\r\n      if (gradeKey.startsWith('id:')) {\r\n        const id = Number(gradeKey.split(':')[1]);\r\n        original = gradeRecords.find((g) => g.id === id) ?? null;\r\n      } else if (gradeKey.startsWith('krs:')) {\r\n        const krsId = Number(gradeKey.split(':')[1]);\r\n        original =\r\n          gradeRecords.find((g) => {\r\n            const k = extractNumeric(g.krs_id);\r\n            return k !== null && k === krsId;\r\n          }) ?? null;\r\n      } else if (gradeKey.startsWith('nim:')) {\r\n        const nim = gradeKey.split(':')[1];\r\n        const extendedRecords = gradeRecords as ExtendedGradeRecord[];\r\n        original = extendedRecords.find((g) => g.student?.nim === nim || g.krs?.student?.nim === nim || g.krs?.nim === nim) ?? null;\r\n      }\r\n\r\n      if (!original) {\r\n        if (Object.values(edited).some((v) => v !== null && v !== undefined && v !== '')) {\r\n          return true;\r\n        }\r\n        continue;\r\n      }\r\n\r\n      for (const field of GRADE_COMPARE_FIELDS) {\r\n        const eVal = extractPrimitive(edited[field as keyof GradeRecord]);\r\n        const oVal = extractPrimitive((original as ExtendedGradeRecord)[field]);\r\n        if (eVal !== oVal) return true;\r\n      }\r\n    }\r\n\r\n    if (hasEditedBobots) return true;\r\n\r\n    return false;\r\n  }, [editedGrades, gradeRecords, hasEditedBobots]);\r\n\r\n  return {\r\n    // State\r\n    editedGrades,\r\n    savingGradeIds,\r\n    completedGradeKeys,\r\n    editedBobots,\r\n    isSavingBobots,\r\n    bobotError,\r\n    isBobotCompleted,\r\n    gradeWeights,\r\n    gradeComponents,\r\n    hasEditedBobots,\r\n    hasUnsavedChanges,\r\n\r\n    // State setters\r\n    setEditedGrades,\r\n    setCompletedGradeKeys,\r\n\r\n    // Methods\r\n    findGradeForStudent,\r\n    saveGrade,\r\n    updateGradeField,\r\n    handleBobotChange,\r\n    cancelBobots,\r\n    enableBobotEditing,\r\n    saveBobots,\r\n    enterEditMode,\r\n    exitEditMode,\r\n  };\r\n};\r\n","import type { MeetingSchedule, GradeRecord } from '../../types';\r\nimport { extractString, formatDate, formatTime } from '../../utils/classSummary';\r\nimport type { SqlNullString } from '../../utils/classSummary';\r\n\r\n// ============================================================================\r\n// Report Generator Service\r\n// ============================================================================\r\n\r\ntype StudentSummary = {\r\n  nim: string;\r\n  nama: string;\r\n  [key: string]: unknown;\r\n};\r\n\r\ninterface ReportData {\r\n  className: string;\r\n  courseName: string;\r\n  courseCode: string;\r\n  totalSks: number;\r\n  lecturerNames: string[];\r\n  students: StudentSummary[];\r\n  sortedMeetings: MeetingSchedule[];\r\n  attendanceLookup: Record<string, Record<number, string>>;\r\n  gradeRecords: GradeRecord[];\r\n  gradeWeights: {\r\n    aktivitas_partisipatif: number;\r\n    hasil_proyek: number;\r\n    quiz: number;\r\n    tugas: number;\r\n    uts: number;\r\n    uas: number;\r\n  };\r\n  lecturerLookup: Record<string, string>;\r\n  findGradeForStudent: (student: { nim: string }) => GradeRecord;\r\n}\r\n\r\n/**\r\n * Generate a PDF report of the class summary\r\n */\r\nexport const generatePDFReport = async (contentRef: HTMLDivElement) => {\r\n  try {\r\n    const [{ default: html2canvas }, { default: jsPDF }] = await Promise.all([\r\n      import('html2canvas-pro'),\r\n      import('jspdf'),\r\n    ]);\r\n\r\n    const canvas = await html2canvas(contentRef, {\r\n      scale: 1.5,\r\n      useCORS: true,\r\n      logging: false,\r\n      backgroundColor: '#ffffff',\r\n    });\r\n\r\n    const imgWidth = 210;\r\n    const pageHeight = 297;\r\n    const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n    let heightLeft = imgHeight;\r\n    const pdf = new jsPDF('p', 'mm', 'a4');\r\n    let position = 0;\r\n    const imgData = canvas.toDataURL('image/jpeg', 0.85);\r\n\r\n    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\r\n    heightLeft -= pageHeight;\r\n\r\n    while (heightLeft > 0) {\r\n      position = heightLeft - imgHeight;\r\n      pdf.addPage();\r\n      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\r\n      heightLeft -= pageHeight;\r\n    }\r\n\r\n    return pdf;\r\n  } catch (error) {\r\n    console.error('Error generating PDF:', error);\r\n    throw new Error('Failed to generate PDF. Please try again.');\r\n  }\r\n};\r\n\r\n/**\r\n * Generate an XLSX report of the class summary\r\n */\r\nexport const generateXLSXReport = async (data: ReportData) => {\r\n  try {\r\n    const XLSX = await import('xlsx');\r\n    const workbook = XLSX.utils.book_new();\r\n\r\n    // Sheet 1: Class Description\r\n    const classDescData = [\r\n      ['Class Summary Report'],\r\n      [],\r\n      ['Course Code', data.courseCode],\r\n      ['Course Name', data.courseName],\r\n      ['Class', data.className],\r\n      ['Total SKS', data.totalSks],\r\n      ['Lecturers', data.lecturerNames.join(', ')],\r\n      ['Total Students', data.students.length],\r\n      ['Total Meetings', data.sortedMeetings.length],\r\n      ['Generated Date', new Date().toLocaleDateString('id-ID')],\r\n    ];\r\n    const classDescSheet = XLSX.utils.aoa_to_sheet(classDescData);\r\n    classDescSheet['!cols'] = [{ wch: 20 }, { wch: 40 }];\r\n    XLSX.utils.book_append_sheet(workbook, classDescSheet, 'Class Description');\r\n\r\n    // Sheet 2: Attendance Overview\r\n    const attendanceHeaders = ['NIM', 'Name', ...data.sortedMeetings.map((m) => `P${m.pertemuan_ke}`)];\r\n    const attendanceData = [attendanceHeaders];\r\n\r\n    data.students.forEach((student) => {\r\n      const studentAttendance = data.attendanceLookup[student.nim] || {};\r\n      const row = [student.nim, student.nama];\r\n\r\n      data.sortedMeetings.forEach((meeting) => {\r\n        const status = studentAttendance[meeting.id] || '';\r\n        row.push(status || '-');\r\n      });\r\n\r\n      attendanceData.push(row);\r\n    });\r\n\r\n    const attendanceSheet = XLSX.utils.aoa_to_sheet(attendanceData);\r\n    attendanceSheet['!cols'] = [{ wch: 15 }, { wch: 25 }, ...data.sortedMeetings.map(() => ({ wch: 12 }))];\r\n    XLSX.utils.book_append_sheet(workbook, attendanceSheet, 'Attendance Overview');\r\n\r\n    // Sheet 3: Meeting Summary\r\n    const meetingSummaryData = [\r\n      ['Meeting', 'Date', 'Time', 'Lecturers', 'Topic'],\r\n      ...data.sortedMeetings.map((meeting) => {\r\n        const hasValidDate =\r\n          meeting.tgl_pertemuan &&\r\n          (typeof meeting.tgl_pertemuan === 'string' ||\r\n            (typeof meeting.tgl_pertemuan === 'object' &&\r\n              'Valid' in meeting.tgl_pertemuan &&\r\n              meeting.tgl_pertemuan.Valid));\r\n\r\n        let topik = '';\r\n        if (meeting.topik) {\r\n          if (typeof meeting.topik === 'string') {\r\n            topik = meeting.topik;\r\n          } else if ('String' in meeting.topik && meeting.topik.Valid) {\r\n            topik = meeting.topik.String;\r\n          }\r\n        }\r\n\r\n        const lecturerId = extractString(meeting.id_dosen as string | SqlNullString);\r\n        const lecturerName = lecturerId && data.lecturerLookup[lecturerId] ? data.lecturerLookup[lecturerId] : '-';\r\n\r\n        return [\r\n          `P${meeting.pertemuan_ke}`,\r\n          hasValidDate ? formatDate(meeting.tgl_pertemuan) : '-',\r\n          formatTime(meeting.jam_pertemuan),\r\n          lecturerName,\r\n          topik || '-',\r\n        ];\r\n      }),\r\n    ];\r\n\r\n    const meetingSheet = XLSX.utils.aoa_to_sheet(meetingSummaryData);\r\n    meetingSheet['!cols'] = [{ wch: 15 }, { wch: 20 }, { wch: 12 }, { wch: 25 }, { wch: 40 }];\r\n    XLSX.utils.book_append_sheet(workbook, meetingSheet, 'Meeting Summary');\r\n\r\n    // Sheet 4: Grades Overview\r\n    const gradesHeaders = [\r\n      'NIM',\r\n      'Name',\r\n      'Participation',\r\n      'Project',\r\n      'Quiz',\r\n      'Assignment',\r\n      'Midterm',\r\n      'Final',\r\n      'Numeric Grade',\r\n      'Letter Grade',\r\n      'Grade Index',\r\n    ];\r\n    const gradesData: (string | number)[][] = [gradesHeaders];\r\n\r\n    data.students.forEach((student) => {\r\n      const grade =\r\n        data.findGradeForStudent(student) || ({\r\n          aktivitas_partisipatif: null,\r\n          hasil_proyek: null,\r\n          quiz: null,\r\n          tugas: null,\r\n          uts: null,\r\n          uas: null,\r\n          nilai_angka: null,\r\n          nilai_huruf: null,\r\n          nilai_indeks: null,\r\n        } as GradeRecord);\r\n\r\n      const getValue = (key: keyof GradeRecord): string | number | '' => {\r\n        const val = grade[key];\r\n        if (val === null || val === undefined) return '';\r\n        if (typeof val === 'object' && 'Float64' in val) return val.Valid ? val.Float64 : '';\r\n        if (typeof val === 'object' && 'String' in val) return val.Valid ? val.String : '';\r\n        if (typeof val === 'object' && 'Int32' in val) return val.Valid ? val.Int32 : '';\r\n        return typeof val === 'number' || typeof val === 'string' ? val : '';\r\n      };\r\n\r\n      gradesData.push([\r\n        student.nim,\r\n        student.nama,\r\n        (() => {\r\n          const v = getValue('aktivitas_partisipatif');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('hasil_proyek');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('quiz');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('tugas');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('uts');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('uas');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('nilai_angka');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('nilai_huruf');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n        (() => {\r\n          const v = getValue('nilai_indeks');\r\n          return v !== '' ? v : '-';\r\n        })(),\r\n      ]);\r\n    });\r\n\r\n    // Add grade weights row at the bottom\r\n    gradesData.push([\r\n      'Component Weights',\r\n      '',\r\n      `${data.gradeWeights.aktivitas_partisipatif}%`,\r\n      `${data.gradeWeights.hasil_proyek}%`,\r\n      `${data.gradeWeights.quiz}%`,\r\n      `${data.gradeWeights.tugas}%`,\r\n      `${data.gradeWeights.uts}%`,\r\n      `${data.gradeWeights.uas}%`,\r\n      'Total: 100%',\r\n      '',\r\n      '',\r\n    ]);\r\n\r\n    const gradesSheet = XLSX.utils.aoa_to_sheet(gradesData);\r\n    gradesSheet['!cols'] = [\r\n      { wch: 15 }, // NIM\r\n      { wch: 25 }, // Name\r\n      { wch: 13 }, // Participation\r\n      { wch: 10 }, // Project\r\n      { wch: 8 }, // Quiz\r\n      { wch: 12 }, // Assignment\r\n      { wch: 10 }, // Midterm\r\n      { wch: 8 }, // Final\r\n      { wch: 13 }, // Numeric\r\n      { wch: 12 }, // Letter\r\n      { wch: 11 }, // Index\r\n    ];\r\n    XLSX.utils.book_append_sheet(workbook, gradesSheet, 'Grades Overview');\r\n\r\n    return { workbook, XLSX };\r\n  } catch (error) {\r\n    console.error('Error generating XLSX:', error);\r\n    throw new Error('Failed to generate XLSX. Please try again.');\r\n  }\r\n};\r\n\r\n/**\r\n * Generate and download a PDF report\r\n */\r\nexport const downloadPDFReport = async (contentRef: HTMLDivElement, className: string, courseName: string) => {\r\n  const pdf = await generatePDFReport(contentRef);\r\n  const filename = `Class_Summary_${className}_${courseName.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;\r\n  pdf.save(filename);\r\n};\r\n\r\n/**\r\n * Generate and download an XLSX report\r\n */\r\nexport const downloadXLSXReport = async (data: ReportData) => {\r\n  const { workbook, XLSX } = await generateXLSXReport(data);\r\n  const filename = `Class_Summary_${data.className}_${data.courseName.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;\r\n  XLSX.writeFile(workbook, filename);\r\n};\r\n","import React, { useMemo, useRef, useState, useEffect } from 'react';\r\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useQuery, useQueries } from '@tanstack/react-query';\r\nimport {\r\n  Loader2,\r\n  AlertCircle,\r\n  CheckCircle,\r\n  XCircle,\r\n  Clock,\r\n  Minus,\r\n  ClockAlert,\r\n  ChevronRight,\r\n  Home,\r\n  Download,\r\n  FileSpreadsheet,\r\n} from 'lucide-react';\r\n\r\nimport {\r\n  useClassMeetings,\r\n  useClassStudents,\r\n} from '../../hooks/useAttendances';\r\nimport { useLecturerAssignments } from '../../hooks/useLecturerAssignments';\r\nimport { useGrades } from '../../hooks/useGrades';\r\nimport { useAttendanceManager, useMeetingManager, useGradeManager } from '../../hooks/classSummary';\r\nimport { apiService } from '../../services/api';\r\nimport { downloadPDFReport, downloadXLSXReport } from '../../services/classSummary';\r\nimport type { AttendanceRecord, GradeRecord } from '../../types';\r\nimport type { SqlNullString, SqlNullTime } from '../../utils/classSummary';\r\nimport {\r\n  extractString,\r\n  extractDateISO,\r\n  extractTimeHHMM,\r\n  formatDate,\r\n  formatDateCompact,\r\n  formatTime,\r\n  getStudentKrsId,\r\n  calculateLetterGrade,\r\n  calculateNumericGrade,\r\n  generateGradeKey,\r\n  ATTENDANCE_STATUSES,\r\n  KEYBOARD_STATUS_MAP,\r\n} from '../../utils/classSummary';\r\n\r\n\r\n// ============================================================================\r\n// Component\r\n// ============================================================================\r\n\r\nconst ClassSummary: React.FC = () => {\r\n  // ---------------------------------------------------------------------------\r\n  // Router & Refs\r\n  // ---------------------------------------------------------------------------\r\n  const { classId } = useParams<{ classId: string }>();\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // UI State\r\n  // ---------------------------------------------------------------------------\r\n  const [isGeneratingPDF, setIsGeneratingPDF] = useState(false);\r\n  const [isGeneratingXLSX, setIsGeneratingXLSX] = useState(false);\r\n  // Edit modes: separate for attendance, meetings, and grades\r\n  const [isAttendanceEditing, setIsAttendanceEditing] = useState(false);\r\n  const [isMeetingEditing, setIsMeetingEditing] = useState(false);\r\n  const [isGradesEditing, setIsGradesEditing] = useState(false);\r\n  const [isSavingAll, setIsSavingAll] = useState(false);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // URL Parameters\r\n  // ---------------------------------------------------------------------------\r\n  const className = searchParams.get('className') || '';\r\n  const courseName = searchParams.get('courseName') || '';\r\n  const courseCode = searchParams.get('courseCode') || '';\r\n  const fromPage = searchParams.get('from') || 'dashboard';\r\n  \r\n  // Get SKS values from URL params\r\n  const sksTatapMuka = parseInt(searchParams.get('sksTatapMuka') || '0', 10);\r\n  const sksPraktek = parseInt(searchParams.get('sksPraktek') || '0', 10);\r\n  const sksPrakLapangan = parseInt(searchParams.get('sksPrakLapangan') || '0', 10);\r\n  const sksSimulasi = parseInt(searchParams.get('sksSimulasi') || '0', 10);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Data Fetching\r\n  // ---------------------------------------------------------------------------\r\n  const classIdNum = Number(classId);\r\n\r\n  const {\r\n    data: meetings = [],\r\n    isLoading: loadingMeetings,\r\n    error: meetingsError,\r\n  } = useClassMeetings(classIdNum);\r\n\r\n  const {\r\n    data: students = [],\r\n    isLoading: loadingStudents,\r\n    error: studentsError,\r\n  } = useClassStudents(classIdNum);\r\n\r\n  const { data: gradeRecords = [], isLoading: loadingGrades } = useGrades({\r\n    kelas_id: classIdNum,\r\n  });\r\n\r\n  const { data: lecturerAssignments = [], isLoading: loadingLecturers } = useLecturerAssignments({\r\n    id_kelas: String(classId),\r\n  });\r\n\r\n  const { data: classData, isLoading: loadingClassData } = useQuery({\r\n    queryKey: ['class', classId],\r\n    queryFn: () => apiService.getClassById(classIdNum),\r\n    enabled: !!classId,\r\n  });\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Lecturer Lookup\r\n  // ---------------------------------------------------------------------------\r\n  const lecturerIds = useMemo(() => {\r\n    const idSet = new Set<string>();\r\n    lecturerAssignments.forEach((assignment) => {\r\n      const id = extractString(assignment.id_dosen as string | SqlNullString);\r\n      if (id) idSet.add(id);\r\n    });\r\n    return Array.from(idSet);\r\n  }, [lecturerAssignments]);\r\n\r\n  const lecturerQueryResults = useQueries({\r\n    queries: lecturerIds.map((id) => ({\r\n      queryKey: ['lecturer', id],\r\n      queryFn: () => apiService.getLecturerByID(id),\r\n      enabled: !!id,\r\n    })),\r\n  });\r\n\r\n  const lecturerLookup = useMemo(() => {\r\n    const lookup: Record<string, string> = {};\r\n    lecturerQueryResults.forEach((q) => {\r\n      const lecturer = q.data as { id: string; nama_dosen: string } | undefined;\r\n      if (lecturer?.id && lecturer?.nama_dosen) {\r\n        lookup[lecturer.id] = lecturer.nama_dosen;\r\n      }\r\n    });\r\n    return lookup;\r\n  }, [lecturerQueryResults]);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Derived Data\r\n  // ---------------------------------------------------------------------------\r\n  const totalSks = sksTatapMuka + sksPraktek + sksPrakLapangan + sksSimulasi;\r\n\r\n  const lecturerNames = useMemo(() => {\r\n    return lecturerAssignments\r\n      .map((assignment) => {\r\n        const lecturerId = extractString(assignment.id_dosen as string | SqlNullString);\r\n        return lecturerId ? lecturerLookup[lecturerId] || lecturerId : null;\r\n      })\r\n      .filter(Boolean) as string[];\r\n  }, [lecturerAssignments, lecturerLookup]);\r\n\r\n  const meetingIds = useMemo(() => meetings.map((m) => m.id), [meetings]);\r\n  \r\n  const { data: attendanceMap = {}, isLoading: loadingAttendances } = useQuery({\r\n    queryKey: ['class-attendances', classId, meetingIds],\r\n    queryFn: async () => {\r\n      const map: Record<number, AttendanceRecord[]> = {};\r\n      await Promise.all(\r\n        meetingIds.map(async (meetingId) => {\r\n          const records = await apiService.getMeetingAttendances(meetingId);\r\n          map[meetingId] = records;\r\n        })\r\n      );\r\n      return map;\r\n    },\r\n    enabled: meetingIds.length > 0,\r\n  });\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Custom Hooks for State Management\r\n  // ---------------------------------------------------------------------------\r\n  const attendanceManager = useAttendanceManager({\r\n    classId,\r\n    meetingIds,\r\n    attendanceMap,\r\n    isEditing: isAttendanceEditing,\r\n  });\r\n\r\n  const meetingManager = useMeetingManager({\r\n    classIdNum,\r\n    meetings,\r\n  });\r\n\r\n  const gradeManager = useGradeManager({\r\n    classIdNum,\r\n    classId,\r\n    students,\r\n    gradeRecords,\r\n    classData,\r\n  });\r\n\r\n  // Destructure hook properties\r\n  const {\r\n    savingCells,\r\n    modifiedCells,\r\n    pendingStatusChanges,\r\n    activeCell,\r\n    currentShortcutStatus,\r\n    setActiveCell,\r\n    setCurrentShortcutStatus,\r\n    updateSingleCell,\r\n    commitAttendanceChanges,\r\n    enterEditMode: enterAttendanceEditModeFromHook,\r\n    exitEditMode: exitAttendanceEditModeFromHook,\r\n  } = attendanceManager;\r\n\r\n  const {\r\n    editedTopics,\r\n    editedDates,\r\n    editedTimes,\r\n    editedLecturers,\r\n    setEditedTopics,\r\n    setEditedDates,\r\n    setEditedTimes,\r\n    setEditedLecturers,\r\n    startEditTopic,\r\n    cancelEditTopic,\r\n    saveTopic,\r\n  } = meetingManager;\r\n\r\n  const {\r\n    editedGrades,\r\n    savingGradeIds,\r\n    completedGradeKeys,\r\n    isSavingBobots,\r\n    bobotError,\r\n    isBobotCompleted,\r\n    gradeWeights,\r\n    gradeComponents,\r\n    hasEditedBobots,\r\n    setEditedGrades,\r\n    setCompletedGradeKeys,\r\n    findGradeForStudent,\r\n    saveGrade,\r\n    updateGradeField,\r\n    handleBobotChange,\r\n    cancelBobots,\r\n    enableBobotEditing,\r\n    saveBobots,\r\n    exitEditMode: exitGradesEditModeFromHook,\r\n  } = gradeManager;\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Loading & Error States\r\n  // ---------------------------------------------------------------------------\r\n  const loadingLecturersDetails = lecturerQueryResults.some((q) => q.isLoading);\r\n  const loading =\r\n    loadingMeetings ||\r\n    loadingStudents ||\r\n    loadingAttendances ||\r\n    loadingLecturers ||\r\n    loadingGrades ||\r\n    loadingClassData ||\r\n    loadingLecturersDetails;\r\n  const error = meetingsError || studentsError;\r\n\r\n  // Whether any section is currently being edited\r\n  const anyEditing = isAttendanceEditing || isMeetingEditing || isGradesEditing;\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Memoized Data\r\n  // ---------------------------------------------------------------------------\r\n\r\n  /** Meetings sorted by date (invalid/empty dates last) */\r\n  const sortedMeetings = useMemo(() => {\r\n    const getTimeValue = (val: string | SqlNullTime | undefined | null): number => {\r\n      if (!val) return Number.POSITIVE_INFINITY;\r\n      if (typeof val === 'string') {\r\n        const t = Date.parse(val);\r\n        return isNaN(t) ? Number.POSITIVE_INFINITY : t;\r\n      }\r\n      if ('Valid' in val) {\r\n        if (!val.Valid) return Number.POSITIVE_INFINITY;\r\n        const t = Date.parse(val.Time);\r\n        return isNaN(t) ? Number.POSITIVE_INFINITY : t;\r\n      }\r\n      return Number.POSITIVE_INFINITY;\r\n    };\r\n\r\n    return [...meetings].sort((a, b) => {\r\n      const diff = getTimeValue(a.tgl_pertemuan) - getTimeValue(b.tgl_pertemuan);\r\n      return diff !== 0 ? diff : a.pertemuan_ke - b.pertemuan_ke;\r\n    });\r\n  }, [meetings]);\r\n\r\n\r\n  /** Attendance lookup: { nim: { meetingId: status } } */\r\n  const attendanceLookup = useMemo(() => {\r\n    const lookup: Record<string, Record<number, string>> = {};\r\n\r\n    Object.values(attendanceMap).forEach((records) => {\r\n      records.forEach((record) => {\r\n        if (!lookup[record.nim]) {\r\n          lookup[record.nim] = {};\r\n        }\r\n        const status = extractString(record.status_kehadiran as string | SqlNullString);\r\n        lookup[record.nim][record.id_pertemuan] = status;\r\n      });\r\n    });\r\n\r\n    return lookup;\r\n  }, [attendanceMap]);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Status Display Helpers\r\n  // ---------------------------------------------------------------------------\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'izin':\r\n      case 'excused':\r\n        return <Clock className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'sakit':\r\n      case 'sick':\r\n        return <AlertCircle className=\"h-4 w-4 text-yellow-600\" />;\r\n      case 'terlambat':\r\n      case 'late':\r\n        return <ClockAlert className=\"h-4 w-4 text-orange-600\" />;\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return <CheckCircle className=\"h-4 w-4 text-purple-600\" />;\r\n      case 'alpa':\r\n      case 'alfa':\r\n      case 'absent':\r\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\r\n      default:\r\n        return <Minus className=\"h-4 w-4 text-gray-300\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return 'bg-green-50 text-green-700';\r\n      case 'izin':\r\n      case 'excused':\r\n        return 'bg-blue-50 text-blue-700';\r\n      case 'sakit':\r\n      case 'sick':\r\n        return 'bg-yellow-50 text-yellow-700';\r\n      case 'terlambat':\r\n      case 'late':\r\n        return 'bg-orange-50 text-orange-700';\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return 'bg-purple-50 text-purple-700';\r\n      case 'alpa':\r\n      case 'alfa':\r\n      case 'absent':\r\n        return 'bg-red-50 text-red-700';\r\n      default:\r\n        return 'bg-gray-50 text-gray-400';\r\n    }\r\n  };\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Effects\r\n  // ---------------------------------------------------------------------------\r\n\r\n  /** Keyboard shortcuts for attendance status brush */\r\n  useEffect(() => {\r\n    if (!isAttendanceEditing) return;\r\n\r\n    const handler = (e: KeyboardEvent) => {\r\n      if (KEYBOARD_STATUS_MAP[e.key]) {\r\n        e.preventDefault();\r\n        setCurrentShortcutStatus(KEYBOARD_STATUS_MAP[e.key]);\r\n      } else if (e.key === 'Escape') {\r\n        setCurrentShortcutStatus(null);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handler);\r\n    return () => window.removeEventListener('keydown', handler);\r\n  }, [isAttendanceEditing, setCurrentShortcutStatus]);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Change Detection\r\n  // ---------------------------------------------------------------------------\r\n\r\n  /** Detect whether there are unsaved changes (aggregated from all managers) */\r\n  const hasUnsavedChanges =\r\n    attendanceManager.hasUnsavedChanges ||\r\n    meetingManager.hasUnsavedChanges ||\r\n    gradeManager.hasUnsavedChanges;\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Attendance Actions (now provided by attendanceManager hook)\r\n  // ---------------------------------------------------------------------------\r\n  // updateSingleCell and commitAttendanceChanges are now provided by attendanceManager\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Enter / Exit per-section edit modes\r\n  // ---------------------------------------------------------------------------\r\n\r\n  const enterAttendanceEditMode = () => {\r\n    enterAttendanceEditModeFromHook();\r\n    setIsAttendanceEditing(true);\r\n  };\r\n\r\n  const exitAttendanceEditMode = () => {\r\n    exitAttendanceEditModeFromHook();\r\n    setIsAttendanceEditing(false);\r\n  };\r\n\r\n  const enterMeetingEditMode = () => {\r\n    console.log('[MEETING]  Entering meeting edit mode');\r\n    // Initialize meeting description edit fields for all meetings\r\n    const topics: Record<number, string> = {};\r\n    const dates: Record<number, string> = {};\r\n    const times: Record<number, string> = {};\r\n    const lecturers: Record<number, string> = {};\r\n    meetings.forEach((meeting) => {\r\n      topics[meeting.id] = extractString(meeting.topik as string | SqlNullString);\r\n      dates[meeting.id] = extractDateISO(meeting.tgl_pertemuan);\r\n      times[meeting.id] = extractTimeHHMM(meeting.jam_pertemuan as string | SqlNullString);\r\n      lecturers[meeting.id] = extractString(meeting.id_dosen as string | SqlNullString);\r\n    });\r\n    setEditedTopics(topics);\r\n    setEditedDates(dates);\r\n    setEditedTimes(times);\r\n    setEditedLecturers(lecturers);\r\n    setIsMeetingEditing(true);\r\n  };\r\n\r\n  const exitMeetingEditMode = () => {\r\n    console.log('[MEETING]  Exiting meeting edit mode - clearing edits');\r\n    setEditedTopics({});\r\n    setEditedDates({});\r\n    setEditedTimes({});\r\n    setEditedLecturers({});\r\n    setIsMeetingEditing(false);\r\n  };\r\n\r\n  const enterGradesEditMode = () => {\r\n    console.log('[GRADES]  Entering grades edit mode');\r\n    const gradeMap: Record<string, Partial<GradeRecord>> = {};\r\n    students.forEach((student) => {\r\n      const grade = findGradeForStudent(student) || ({} as GradeRecord);\r\n      const studentKrsId = getStudentKrsId(student);\r\n      const gradeKey = generateGradeKey(grade, studentKrsId, student.nim);\r\n      gradeMap[gradeKey] = grade;\r\n    });\r\n    console.log('[GRADES] Initial grade map:', gradeMap);\r\n    setEditedGrades(gradeMap);\r\n    setIsGradesEditing(true);\r\n  };\r\n\r\n  const exitGradesEditMode = () => {\r\n    console.log('[GRADES]  Exiting grades edit mode - clearing edits');\r\n    exitGradesEditModeFromHook();\r\n    setIsGradesEditing(false);\r\n  };\r\n\r\n  const exitAllEditModes = () => {\r\n    exitAttendanceEditMode();\r\n    exitMeetingEditMode();\r\n    exitGradesEditMode();\r\n  };\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Grade Actions (now provided by gradeManager hook)\r\n  // ---------------------------------------------------------------------------\r\n  // saveGrade, handleBobotChange, cancelBobots, and saveBobots are now provided by gradeManager\r\n\r\n  const saveAllAndFinish = async () => {\r\n    console.log('[SAVE ALL]  Starting save all and finish');\r\n    console.log('[SAVE ALL] Attendance editing:', isAttendanceEditing);\r\n    console.log('[SAVE ALL] Meeting editing:', isMeetingEditing);\r\n    console.log('[SAVE ALL] Grades editing:', isGradesEditing);\r\n\r\n    setIsSavingAll(true);\r\n    try {\r\n      // Save edited meeting descriptions (only if meeting editing active)\r\n      const meetingSavePromises = isMeetingEditing\r\n        ? Object.keys(editedTopics).map((idStr) => Number(idStr)).filter((id) => !Number.isNaN(id)).map((id) => saveTopic(id))\r\n        : [];\r\n\r\n      // Save bobot values if edited (only if grades editing active)\r\n      let bobotSaved = true;\r\n      if (isGradesEditing && hasEditedBobots) {\r\n        console.log('[SAVE ALL] Saving bobot values...');\r\n        bobotSaved = await saveBobots();\r\n        if (!bobotSaved) {\r\n          throw new Error('Failed to save grade weights');\r\n        }\r\n      }\r\n\r\n      // Save all edited grades\r\n      const gradeSavePromises = isGradesEditing\r\n        ? Object.entries(editedGrades).map(([gradeKey]) => {\r\n        let targetStudent: (typeof students)[number] | undefined;\r\n\r\n        // Find the student based on the grade key\r\n        if (gradeKey.startsWith('nim:')) {\r\n          const nim = gradeKey.substring(4);\r\n          targetStudent = students.find((s) => s.nim === nim);\r\n        } else if (gradeKey.startsWith('krs:')) {\r\n          const krsId = Number(gradeKey.substring(4));\r\n          targetStudent = students.find((s) => getStudentKrsId(s) === krsId);\r\n        } else if (gradeKey.startsWith('id:')) {\r\n          const gradeId = Number(gradeKey.substring(3));\r\n          // Find student by looking for their grade with this ID\r\n          targetStudent = students.find((s) => {\r\n            const grade = findGradeForStudent(s);\r\n            return grade?.id === gradeId;\r\n          });\r\n        }\r\n\r\n        const originalGrade = targetStudent\r\n          ? findGradeForStudent(targetStudent)\r\n          : (editedGrades[gradeKey] as GradeRecord);\r\n        return saveGrade(gradeKey, originalGrade, targetStudent);\r\n        })\r\n        : [];\r\n\r\n      console.log('[SAVE ALL] Meeting promises:', meetingSavePromises.length);\r\n      console.log('[SAVE ALL] Grade promises:', gradeSavePromises.length);\r\n\r\n      // Commit attendance changes (skip automatic exit)\r\n      const attendancePromise = isAttendanceEditing ? commitAttendanceChanges(true) : Promise.resolve();\r\n\r\n      await Promise.all([\r\n        Promise.all(meetingSavePromises),\r\n        Promise.all(gradeSavePromises),\r\n        attendancePromise,\r\n      ]);\r\n\r\n      console.log('[SAVE ALL]  All saves completed, exiting edit modes');\r\n\r\n      exitEditMode();\r\n    } catch (err) {\r\n      alert(err instanceof Error ? err.message : 'Failed to save changes');\r\n    } finally {\r\n      setIsSavingAll(false);\r\n    }\r\n  };\r\n\r\n  // updateGradeField is now provided by gradeManager\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // Navigation\r\n  // ---------------------------------------------------------------------------\r\n\r\n  const handleBack = () => {\r\n    navigate(-1);\r\n  };\r\n\r\n  const exitEditMode = () => {\r\n    exitAllEditModes();\r\n  };\r\n\r\n  // enterEditMode removed  use enterAttendanceEditMode / enterMeetingEditMode / enterGradesEditMode as needed\r\n\r\n  const handleGeneratePDF = async () => {\r\n    if (!contentRef.current) return;\r\n    (window.React?.startTransition || ((fn: () => void) => fn()))(() => {\r\n      setIsGeneratingPDF(true);\r\n    });\r\n    await new Promise((r) => setTimeout(r, 0));\r\n    try {\r\n      await downloadPDFReport(contentRef.current, className, courseName);\r\n    } catch (error) {\r\n      console.error('Error generating PDF:', error);\r\n      alert('Failed to generate PDF. Please try again.');\r\n    } finally {\r\n      setIsGeneratingPDF(false);\r\n    }\r\n  };\r\n\r\n  const handleGenerateXLSX = async () => {\r\n    setIsGeneratingXLSX(true);\r\n    try {\r\n      await downloadXLSXReport({\r\n        className,\r\n        courseName,\r\n        courseCode,\r\n        totalSks,\r\n        lecturerNames,\r\n        students: students.map((s) => ({ nim: s.nim, nama: s.nama })),\r\n        sortedMeetings,\r\n        attendanceLookup,\r\n        gradeRecords,\r\n        gradeWeights,\r\n        lecturerLookup,\r\n        findGradeForStudent,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error generating XLSX:', error);\r\n      alert('Failed to generate XLSX. Please try again.');\r\n    } finally {\r\n      setIsGeneratingXLSX(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Breadcrumb */}\r\n      <nav className=\"flex items-center space-x-2 text-sm text-gray-600\">\r\n        <button\r\n          onClick={() => navigate(`/${fromPage}`)}\r\n          className=\"flex items-center hover:text-gray-900 transition-colors\"\r\n        >\r\n          <Home className=\"h-4 w-4\" />\r\n        </button>\r\n        <ChevronRight className=\"h-4 w-4\" />\r\n        <button\r\n          onClick={handleBack}\r\n          className=\"hover:text-gray-900 transition-colors\"\r\n        >\r\n          {fromPage === 'lecturer/class-schedule' ? 'Class Schedule' : \r\n           fromPage === 'admin/class-management' ? 'Class Management' : 'Dashboard'}\r\n        </button>\r\n        <ChevronRight className=\"h-4 w-4\" />\r\n        <span className=\"text-gray-900 font-medium\">Class Summary</span>\r\n      </nav>\r\n\r\n      {/* PDF Generation Button - Outside of PDF Content */}\r\n        <div className=\"flex justify-end gap-3\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <button\r\n            onClick={() => (isAttendanceEditing ? exitAttendanceEditMode() : enterAttendanceEditMode())}\r\n            className={`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${isAttendanceEditing ? 'bg-blue-600 text-white' : ''}`}\r\n          >\r\n            {isAttendanceEditing ? 'Stop Attendance Editing' : 'Edit Attendance'}\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => (isMeetingEditing ? exitMeetingEditMode() : enterMeetingEditMode())}\r\n            className={`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${isMeetingEditing ? 'bg-blue-600 text-white' : ''}`}\r\n          >\r\n            {isMeetingEditing ? 'Stop Meeting Editing' : 'Edit Meetings'}\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => (isGradesEditing ? exitGradesEditMode() : enterGradesEditMode())}\r\n            className={`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${isGradesEditing ? 'bg-blue-600 text-white' : ''}`}\r\n          >\r\n            {isGradesEditing ? 'Stop Grades Editing' : 'Edit Grades'}\r\n          </button>\r\n\r\n          {anyEditing && (\r\n            <>\r\n              <button onClick={saveAllAndFinish} className=\"btn-primary\" disabled={isSavingAll || !hasUnsavedChanges}>Save & Finish</button>\r\n              <button onClick={() => exitAllEditModes()} className=\"btn-secondary\">Cancel</button>\r\n            </>\r\n          )}\r\n        </div>\r\n        {isAttendanceEditing && (\r\n          <div className=\"text-xs text-gray-600 flex flex-col gap-3 p-3 bg-blue-50 rounded border border-blue-200\">\r\n            <div>\r\n              <span className=\"font-medium text-gray-900\">Status Brush:</span>\r\n              <p className=\"text-gray-600 mt-1\">Choose a status with buttons below or use keyboard shortcuts (1..6), then click cells to apply. Press Esc to clear.</p>\r\n            </div>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus('Hadir')}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === 'Hadir'\r\n                    ? 'bg-green-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press 1\"\r\n              >\r\n                1 - Hadir\r\n              </button>\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus('Izin')}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === 'Izin'\r\n                    ? 'bg-blue-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press 2\"\r\n              >\r\n                2 - Izin\r\n              </button>\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus('Sakit')}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === 'Sakit'\r\n                    ? 'bg-yellow-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press 3\"\r\n              >\r\n                3 - Sakit\r\n              </button>\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus('Alfa')}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === 'Alfa'\r\n                    ? 'bg-red-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press 4\"\r\n              >\r\n                4 - Alfa\r\n              </button>\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus('Terlambat')}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === 'Terlambat'\r\n                    ? 'bg-orange-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press 5\"\r\n              >\r\n                5 - Terlambat\r\n              </button>\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus('Pengganti')}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === 'Pengganti'\r\n                    ? 'bg-purple-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press 6\"\r\n              >\r\n                6 - Tugas\r\n              </button>\r\n              <button\r\n                onClick={() => setCurrentShortcutStatus(null)}\r\n                className={`px-3 py-1 rounded text-xs font-medium transition-all ${\r\n                  currentShortcutStatus === null\r\n                    ? 'bg-gray-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n                title=\"Press Esc\"\r\n              >\r\n                Clear Brush\r\n              </button>\r\n            </div>\r\n            <div className=\"text-xs text-gray-700 bg-white p-2 rounded border border-gray-200\">\r\n              <span className=\"font-medium\">Current: </span>\r\n              <span className=\"font-semibold\">\r\n                {currentShortcutStatus === null ? 'None' : (currentShortcutStatus === '' ? 'Kosong' : currentShortcutStatus)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <button\r\n          onClick={handleGeneratePDF}\r\n          disabled={isGeneratingPDF || loading}\r\n          className=\"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n        >\r\n          {isGeneratingPDF ? (\r\n            <>\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              <span>Generating PDF...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Download className=\"h-4 w-4\" />\r\n              <span>Generate PDF Report</span>\r\n            </>\r\n          )}\r\n        </button>\r\n        \r\n        <button\r\n          onClick={handleGenerateXLSX}\r\n          disabled={isGeneratingXLSX || loading}\r\n          className=\"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n        >\r\n          {isGeneratingXLSX ? (\r\n            <>\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              <span>Generating XLSX...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <FileSpreadsheet className=\"h-4 w-4\" />\r\n              <span>Generate XLSX Report</span>\r\n            </>\r\n          )}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Content to be captured in PDF */}\r\n      <div ref={contentRef} className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n        {/* Header */}\r\n        <div className=\"px-6 pt-6 pb-3\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900\">Class Summary</h1>\r\n            <p className=\"text-base text-gray-600 mt-1\">\r\n              {courseCode && <span className=\"font-medium\">{courseCode}</span>}\r\n              {courseCode && ' - '}\r\n              {courseName} - Class {className}\r\n              {totalSks > 0 && ` (${totalSks} SKS)`}\r\n            </p>\r\n            {lecturerNames.length > 0 && (\r\n              <p className=\"text-sm text-gray-500 mt-2\">\r\n                {lecturerNames.join(', ')}\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div>\r\n        {loading ? (\r\n          <div className=\"flex items-center justify-center py-12 bg-white rounded-lg shadow-sm border border-gray-200\">\r\n            <Loader2 className=\"h-8 w-8 text-blue-600 animate-spin\" />\r\n            <span className=\"ml-3 text-gray-600\">Loading attendance data...</span>\r\n          </div>\r\n        ) : error ? (\r\n          <div className=\"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700\">\r\n            <AlertCircle className=\"h-5 w-5 flex-shrink-0\" />\r\n            <div>\r\n              <p className=\"font-medium\">Error loading attendance data</p>\r\n              <p className=\"text-sm text-red-600\">\r\n                {error instanceof Error ? error.message : 'Unknown error'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        ) : meetings.length === 0 ? (\r\n          <div className=\"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200\">\r\n            <AlertCircle className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\r\n            <p>No meetings scheduled for this class</p>\r\n          </div>\r\n        ) : students.length === 0 ? (\r\n          <div className=\"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200\">\r\n            <AlertCircle className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\r\n            <p>No students enrolled in this class</p>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {/* Attendance Table Section */}\r\n            <div className=\"px-6 py-3\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Attendance Overview</h3>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                  <div className=\"flex gap-0\">\r\n                    {/* Fixed NIM/Name Table */}\r\n                    <div className=\"flex-shrink-0 sticky left-0 z-10\">\r\n                      <table className=\"border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50\">\r\n                            <th className=\"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 align-top\">\r\n                              <div className=\"min-h-[3.5rem] flex items-center\">NIM</div>\r\n                            </th>\r\n                            <th className=\"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 align-top\">\r\n                              <div className=\"min-h-[3.5rem] flex items-center\">Name</div>\r\n                            </th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {students.map((student) => (\r\n                            <tr key={student.nim} className=\"hover:bg-gray-50 h-9\">\r\n                              <td className=\"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900\">\r\n                                {student.nim}\r\n                              </td>\r\n                              <td className=\"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate\">\r\n                                {student.nama}\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n\r\n                    {/* Scrollable Meetings Table */}\r\n                    <div className=\"flex-1\">\r\n                      <table className=\"border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50\">\r\n                            {sortedMeetings.map((meeting) => {\r\n                              // Check if tgl_pertemuan exists and is valid\r\n                              const hasValidDate = meeting.tgl_pertemuan && (\r\n                                typeof meeting.tgl_pertemuan === 'string' ||\r\n                                (typeof meeting.tgl_pertemuan === 'object' && 'Valid' in meeting.tgl_pertemuan && meeting.tgl_pertemuan.Valid)\r\n                              );\r\n                              \r\n                              return (\r\n                                <th\r\n                                  key={meeting.id}\r\n                                  className=\"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-14 align-top\"\r\n                                >\r\n                                  <div className=\"min-h-[3.5rem] flex flex-col items-center justify-center gap-0.5\">\r\n                                    <span className=\"font-bold text-[10px]\">P{meeting.pertemuan_ke}</span>\r\n                                    {hasValidDate && (\r\n                                      <span className=\"text-gray-500 font-normal text-[9px] whitespace-pre-line\">\r\n                                        {formatDateCompact(meeting.tgl_pertemuan)}\r\n                                      </span>\r\n                                    )}\r\n                                  </div>\r\n                                </th>\r\n                              );\r\n                            })}\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {students.map((student) => {\r\n                            const studentAttendance = attendanceLookup[student.nim] || {};\r\n                            \r\n                            return (\r\n                              <tr key={student.nim} className=\"hover:bg-gray-50 h-9\">\r\n                                {sortedMeetings.map((meeting) => {\r\n                                  const status = pendingStatusChanges[`${student.nim}-${meeting.id}`] ?? studentAttendance[meeting.id] ?? '';\r\n                                  const cellKey = `${student.nim}-${meeting.id}`;\r\n                                  const isModified = modifiedCells.has(cellKey);\r\n                                  const isSaving = savingCells[cellKey];\r\n                                  return (\r\n                                    <td\r\n                                      key={meeting.id}\r\n                                      className={`border-r border-b border-gray-300 px-1 py-1.5 text-center ${getStatusColor(status)} ${isAttendanceEditing ? 'cursor-pointer' : ''} ${isModified ? 'bg-yellow-50' : ''} ${activeCell === cellKey ? 'outline outline-2 outline-blue-500' : ''}`}\r\n                                      onClick={() => {\r\n                                        if (!isAttendanceEditing) return;\r\n                                        if (currentShortcutStatus !== null) {\r\n                                          updateSingleCell(cellKey, currentShortcutStatus);\r\n                                        } else {\r\n                                          setActiveCell(cellKey);\r\n                                        }\r\n                                      }}\r\n                                    >\r\n                                      {isAttendanceEditing && activeCell === cellKey ? (\r\n                                        <select\r\n                                          autoFocus\r\n                                          value={status}\r\n                                          onChange={(e) => updateSingleCell(cellKey, e.target.value)}\r\n                                          onBlur={() => setActiveCell(null)}\r\n                                          className=\"text-[10px] px-1 py-0.5 bg-white border border-gray-300 rounded w-full\"\r\n                                        >\r\n                                          <option value=\"\"></option>\r\n                                          {ATTENDANCE_STATUSES.slice(1).map((s: string) => <option key={s} value={s}>{s}</option>)}\r\n                                        </select>\r\n                                      ) : isSaving ? (\r\n                                        <Loader2 className=\"h-4 w-4 animate-spin text-gray-500 mx-auto\" />\r\n                                      ) : (\r\n                                        getStatusIcon(status)\r\n                                      )}\r\n                                    </td>\r\n                                  );\r\n                                })}\r\n                              </tr>\r\n                            );\r\n                          })}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div className=\"px-6 py-3\">\r\n              <div className=\"flex items-center gap-4 text-xs flex-wrap\">\r\n                <span className=\"font-medium text-gray-700\">Legend:</span>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                  <span className=\"text-gray-600\">Present</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <ClockAlert className=\"h-4 w-4 text-orange-600\" />\r\n                  <span className=\"text-gray-600\">Late</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Clock className=\"h-4 w-4 text-blue-600\" />\r\n                  <span className=\"text-gray-600\">Excused</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\r\n                  <span className=\"text-gray-600\">Sick</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                  <span className=\"text-gray-600\">Absent</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <CheckCircle className=\"h-4 w-4 text-purple-600\" />\r\n                  <span className=\"text-gray-600\">Tugas</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Minus className=\"h-4 w-4 text-gray-300\" />\r\n                  <span className=\"text-gray-600\">No data</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Meeting Descriptions Table */}\r\n            <div className=\"px-6 py-3\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Meeting Descriptions</h3>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <table className=\"w-full border-collapse text-xs\">\r\n                  <thead>\r\n                    <tr className=\"bg-gray-50\">\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16\">\r\n                        Meeting\r\n                      </th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-40\">Date</th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-20\">Time</th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48\">Lecturers</th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700\">\r\n                        Topic\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {sortedMeetings.map((meeting) => {\r\n                      const hasValidDate = meeting.tgl_pertemuan && (\r\n                        typeof meeting.tgl_pertemuan === 'string' ||\r\n                        (typeof meeting.tgl_pertemuan === 'object' && 'Valid' in meeting.tgl_pertemuan && meeting.tgl_pertemuan.Valid)\r\n                      );\r\n                      let currentTopik = '';\r\n                      if (meeting.topik) {\r\n                        if (typeof meeting.topik === 'string') currentTopik = meeting.topik;\r\n                        else if ('String' in meeting.topik && meeting.topik.Valid) currentTopik = meeting.topik.String;\r\n                      }\r\n                      const timeInputValue = editedTimes[meeting.id] ?? extractTimeHHMM(meeting.jam_pertemuan as string | SqlNullString | SqlNullTime | null | undefined);\r\n                      \r\n                      return (\r\n                        <tr key={meeting.id} className=\"hover:bg-gray-50\">\r\n                          <td className=\"border-b border-gray-300 px-3 py-2 font-medium text-gray-900\">\r\n                            P{meeting.pertemuan_ke}\r\n                          </td>\r\n                          <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                            {editedTopics[meeting.id] !== undefined ? (\r\n                              <input\r\n                                type=\"date\"\r\n                                value={editedDates[meeting.id] || (() => {\r\n                                  if (!hasValidDate) return '';\r\n                                  let rawDate = '';\r\n                                  if (typeof meeting.tgl_pertemuan === 'string') rawDate = meeting.tgl_pertemuan;\r\n                                  else if (typeof meeting.tgl_pertemuan === 'object' && meeting.tgl_pertemuan.Valid) rawDate = meeting.tgl_pertemuan.Time;\r\n                                  if (!rawDate) return '';\r\n                                  const d = new Date(rawDate);\r\n                                  return isNaN(d.getTime()) ? '' : d.toISOString().slice(0,10);\r\n                                })()}\r\n                                onChange={(e) => setEditedDates((p) => ({ ...p, [meeting.id]: e.target.value }))}\r\n                                className=\"input-field text-xs\"\r\n                              />\r\n                            ) : (\r\n                              hasValidDate ? formatDate(meeting.tgl_pertemuan) : '-'\r\n                            )}\r\n                          </td>\r\n                          <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                            {editedTopics[meeting.id] !== undefined ? (\r\n                              <input\r\n                                type=\"time\"\r\n                                value={timeInputValue || ''}\r\n                                onChange={(e) => setEditedTimes((p) => ({ ...p, [meeting.id]: e.target.value }))}\r\n                                className=\"input-field text-xs\"\r\n                              />\r\n                            ) : (\r\n                              formatTime(meeting.jam_pertemuan as string | SqlNullString | SqlNullTime | null | undefined)\r\n                            )}\r\n                          </td>\r\n                          <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                            {editedTopics[meeting.id] !== undefined ? (\r\n                              <select\r\n                                value={editedLecturers[meeting.id] || ''}\r\n                                onChange={(e) => setEditedLecturers((p) => ({ ...p, [meeting.id]: e.target.value }))}\r\n                                className=\"input-field text-xs w-full\"\r\n                              >\r\n                                <option value=\"\">- No Lecturer -</option>\r\n                                {lecturerIds.map((lecturerId) => (\r\n                                  <option key={lecturerId} value={lecturerId}>\r\n                                    {lecturerLookup[lecturerId] || lecturerId}\r\n                                  </option>\r\n                                ))}\r\n                              </select>\r\n                            ) : (\r\n                              (() => {\r\n                                const lecturerId = extractString(meeting.id_dosen as string | SqlNullString);\r\n                                return lecturerId && lecturerLookup[lecturerId] ? lecturerLookup[lecturerId] : '-';\r\n                              })()\r\n                            )}\r\n                          </td>\r\n                          <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                            {isMeetingEditing ? (\r\n                              editedTopics[meeting.id] !== undefined ? (\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <input\r\n                                    value={editedTopics[meeting.id]}\r\n                                    onChange={(e) => setEditedTopics((p) => ({ ...p, [meeting.id]: e.target.value }))}\r\n                                    className=\"input-field w-full text-xs\"\r\n                                    placeholder=\"Enter topic/description\"\r\n                                  />\r\n                                  <button\r\n                                    onClick={() => saveTopic(meeting.id)}\r\n                                    className=\"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50\"\r\n                                  >\r\n                                    Save\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => cancelEditTopic(meeting.id)}\r\n                                    className=\"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300\"\r\n                                  >\r\n                                    Cancel\r\n                                  </button>\r\n                                </div>\r\n                              ) : (\r\n                                <div className=\"flex items-center justify-between gap-2\">\r\n                                  <span className=\"truncate max-w-[28rem]\">{currentTopik || '-'}</span>\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      let dateForInput = '';\r\n                                      if (hasValidDate) {\r\n                                        let rawDate = '';\r\n                                        if (typeof meeting.tgl_pertemuan === 'string') rawDate = meeting.tgl_pertemuan;\r\n                                        else if (typeof meeting.tgl_pertemuan === 'object' && meeting.tgl_pertemuan.Valid) rawDate = meeting.tgl_pertemuan.Time;\r\n                                        if (rawDate) {\r\n                                          const d = new Date(rawDate);\r\n                                          if (!isNaN(d.getTime())) dateForInput = d.toISOString().slice(0,10);\r\n                                        }\r\n                                      }\r\n                                      let timeForInput = '';\r\n                                      const rawTime = extractTimeHHMM(meeting.jam_pertemuan as string | SqlNullString | SqlNullTime | null | undefined);\r\n                                      if (rawTime) {\r\n                                        const parts = rawTime.split(':');\r\n                                        if (parts.length >= 2) timeForInput = `${parts[0].padStart(2,'0')}:${parts[1].padStart(2,'0')}`;\r\n                                      }\r\n                                      const lecturerForInput = extractString(meeting.id_dosen as string | SqlNullString);\r\n                                      startEditTopic(meeting.id, currentTopik, dateForInput, timeForInput, lecturerForInput);\r\n                                    }}\r\n                                    className=\"px-2 py-1 text-xs rounded bg-primary-600 text-white hover:bg-primary-700\"\r\n                                  >\r\n                                    Edit\r\n                                  </button>\r\n                                </div>\r\n                              )\r\n                            ) : (\r\n                              <span>{currentTopik || '-'}</span>\r\n                            )}\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Grades Overview Table */}\r\n            <div className=\"px-6 py-3 pb-6\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">Grades Overview</h3>\r\n                {/* Grade editing is enabled when `isGradesEditing` is active */}\r\n              </div>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full border-collapse text-xs\">\r\n                    <thead>\r\n                      <tr className=\"bg-gray-50\">\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28\">\r\n                          NIM\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48\">\r\n                          Name\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24\">\r\n                          Participation\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24\">\r\n                          Project\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24\">\r\n                          Quiz\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24\">\r\n                          Assignment\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24\">\r\n                          Midterm\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24\">\r\n                          Final\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20\">\r\n                          <div className=\"flex flex-col items-center\">\r\n                            <span>Numeric</span>\r\n                            <span className=\"text-xs font-normal text-gray-500\">(Auto)</span>\r\n                          </div>\r\n                        </th>\r\n                        <th className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20\">\r\n                          <div className=\"flex flex-col items-center\">\r\n                            <span>Letter</span>\r\n                            <span className=\"text-xs font-normal text-gray-500\">(Auto)</span>\r\n                          </div>\r\n                        </th>\r\n                        <th className={`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20 ${isGradesEditing ? 'border-r' : ''}`}>\r\n                          <div className=\"flex flex-col items-center\">\r\n                            <span>Index</span>\r\n                            <span className=\"text-xs font-normal text-gray-500\">(Auto)</span>\r\n                          </div>\r\n                        </th>\r\n                        {isGradesEditing && (\r\n                          <th className=\"border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-16\">\r\n                            Action\r\n                          </th>\r\n                        )}\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {students.map((student) => {\r\n                        const grade = findGradeForStudent(student) || ({\r\n                          id: 0,\r\n                          krs_id: null,\r\n                          aktivitas_partisipatif: null,\r\n                          hasil_proyek: null,\r\n                          quiz: null,\r\n                          tugas: null,\r\n                          uts: null,\r\n                          uas: null,\r\n                          nilai_angka: null,\r\n                          nilai_huruf: null,\r\n                          nilai_indeks: null,\r\n                        } as GradeRecord);\r\n                        \r\n                        const gradeKrsId = (() => {\r\n                          if (typeof grade.krs_id === 'object' && grade.krs_id !== null && 'Int32' in grade.krs_id) {\r\n                            const sqlKrs = grade.krs_id as { Int32: number; Valid: boolean };\r\n                            return sqlKrs.Valid ? sqlKrs.Int32 : null;\r\n                          }\r\n                          if (typeof grade.krs_id === 'number') return grade.krs_id;\r\n                          return grade.krs_id ?? null;\r\n                        })();\r\n                        const studentKrsId = getStudentKrsId(student);\r\n                        const gradeKey = grade.id && grade.id > 0\r\n                          ? `id:${grade.id}`\r\n                          : gradeKrsId !== null && gradeKrsId !== undefined\r\n                            ? `krs:${gradeKrsId}`\r\n                            : studentKrsId !== null\r\n                              ? `krs:${studentKrsId}`\r\n                              : `nim:${student.nim}`;\r\n                        const isCompleted = completedGradeKeys.has(gradeKey);\r\n                        const isEditing = isGradesEditing && !isCompleted;\r\n                        const isSaving = grade.id ? savingGradeIds.has(grade.id) : false;\r\n                        const edited = editedGrades[gradeKey] || grade;\r\n                        \r\n                        // Helper to get display value (properly handles SqlNull types)\r\n                        const getValue = (key: keyof GradeRecord): string | number | '' => {\r\n                          const val = edited[key];\r\n                          if (val === null || val === undefined) return '';\r\n                          if (typeof val === 'object' && 'Float64' in val) return val.Valid ? val.Float64 : '';\r\n                          if (typeof val === 'object' && 'String' in val) return val.Valid ? val.String : '';\r\n                          if (typeof val === 'object' && 'Int32' in val) return val.Valid ? val.Int32 : '';\r\n                          if (typeof val === 'number' || typeof val === 'string') return val;\r\n                          return '';\r\n                        };\r\n\r\n                        // Calculate numeric grade if needed (differentiate between 0 and null)\r\n                        const nilaiAngkaValue = getValue('nilai_angka');\r\n                        const displayNumeric = nilaiAngkaValue !== '' ? nilaiAngkaValue : (isGradesEditing && edited ? calculateNumericGrade(edited, gradeComponents) : null);\r\n                        const normalizedNumeric = typeof displayNumeric === 'string' ? Number(displayNumeric) : displayNumeric;\r\n                        const { huruf: calcHuruf, indeks: calcIndeks } = normalizedNumeric !== null && normalizedNumeric !== undefined ? calculateLetterGrade(normalizedNumeric) : { huruf: '', indeks: 0 };\r\n                        const nilaiHurufValue = getValue('nilai_huruf');\r\n                        const displayHuruf = nilaiHurufValue !== '' ? nilaiHurufValue : calcHuruf;\r\n                        const nilaiIndeksValue = getValue('nilai_indeks');\r\n                        const displayIndeks = nilaiIndeksValue !== '' ? nilaiIndeksValue : calcIndeks;\r\n\r\n                        return (\r\n                          <tr key={student.nim} className=\"hover:bg-gray-50\">\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 font-medium text-gray-900 w-28\">\r\n                              {student.nim}\r\n                            </td>\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-gray-900 w-48\">\r\n                              {student.nama}\r\n                            </td>\r\n                            {/* Participation */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center w-24\">\r\n                              {isEditing ? (\r\n                                <input\r\n                                  type=\"number\"\r\n                                  step=\"0.1\"\r\n                                  value={getValue('aktivitas_partisipatif')}\r\n                                  onChange={(e) => updateGradeField(gradeKey, 'aktivitas_partisipatif', e.target.value ? parseFloat(e.target.value) : null)}\r\n                                  className=\"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-gray-600\">{(() => { const v = getValue('aktivitas_partisipatif'); return v !== '' ? v : '-'; })()}</span>\r\n                              )}\r\n                            </td>\r\n                            {/* Project */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center w-24\">\r\n                              {isEditing ? (\r\n                                <input\r\n                                  type=\"number\"\r\n                                  step=\"0.1\"\r\n                                  value={getValue('hasil_proyek')}\r\n                                      onChange={(e) => updateGradeField(gradeKey, 'hasil_proyek', e.target.value ? parseFloat(e.target.value) : null)}\r\n                                  className=\"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-gray-600\">{(() => { const v = getValue('hasil_proyek'); return v !== '' ? v : '-'; })()}</span>\r\n                              )}\r\n                            </td>\r\n                            {/* Quiz */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center w-24\">\r\n                              {isEditing ? (\r\n                                <input\r\n                                  type=\"number\"\r\n                                  step=\"0.1\"\r\n                                  value={getValue('quiz')}\r\n                                  onChange={(e) => updateGradeField(gradeKey, 'quiz', e.target.value ? parseFloat(e.target.value) : null)}\r\n                                  className=\"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-gray-600\">{(() => { const v = getValue('quiz'); return v !== '' ? v : '-'; })()}</span>\r\n                              )}\r\n                            </td>\r\n                            {/* Assignment */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center w-24\">\r\n                              {isEditing ? (\r\n                                <input\r\n                                  type=\"number\"\r\n                                  step=\"0.1\"\r\n                                  value={getValue('tugas')}\r\n                                  onChange={(e) => updateGradeField(gradeKey, 'tugas', e.target.value ? parseFloat(e.target.value) : null)}\r\n                                  className=\"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-gray-600\">{(() => { const v = getValue('tugas'); return v !== '' ? v : '-'; })()}</span>\r\n                              )}\r\n                            </td>\r\n                            {/* Midterm */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center w-24\">\r\n                              {isEditing ? (\r\n                                <input\r\n                                  type=\"number\"\r\n                                  step=\"0.1\"\r\n                                  value={getValue('uts')}\r\n                                  onChange={(e) => updateGradeField(gradeKey, 'uts', e.target.value ? parseFloat(e.target.value) : null)}\r\n                                  className=\"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-gray-600\">{(() => { const v = getValue('uts'); return v !== '' ? v : '-'; })()}</span>\r\n                              )}\r\n                            </td>\r\n                            {/* Final */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center w-24\">\r\n                              {isEditing ? (\r\n                                <input\r\n                                  type=\"number\"\r\n                                  step=\"0.1\"\r\n                                  value={getValue('uas')}\r\n                                  onChange={(e) => updateGradeField(gradeKey, 'uas', e.target.value ? parseFloat(e.target.value) : null)}\r\n                                  className=\"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-gray-600\">{(() => { const v = getValue('uas'); return v !== '' ? v : '-'; })()}</span>\r\n                              )}\r\n                            </td>\r\n                            {/* Numeric (Auto-calculated) */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20\">\r\n                              <div className={`px-2 py-1 rounded ${isEditing ? 'bg-blue-50 text-blue-900' : ''}`}>\r\n                                <span>{displayNumeric !== null && displayNumeric !== '' ? displayNumeric : '-'}</span>\r\n                                {isEditing && displayNumeric !== null && displayNumeric !== '' && (\r\n                                  <span className=\"text-xs text-blue-600 ml-1\"></span>\r\n                                )}\r\n                              </div>\r\n                            </td>\r\n                            {/* Letter (Auto-calculated) */}\r\n                            <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-bold text-blue-600 w-20\">\r\n                              <div className={`px-2 py-1 rounded ${isEditing ? 'bg-blue-50' : ''}`}>\r\n                                <span>{displayHuruf || '-'}</span>\r\n                                {isEditing && displayHuruf && (\r\n                                  <span className=\"text-xs ml-1\"></span>\r\n                                )}\r\n                              </div>\r\n                            </td>\r\n                            {/* Index (Auto-calculated) */}\r\n                            <td className={`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20 ${isGradesEditing ? 'border-r' : ''}`}>\r\n                              <div className={`px-2 py-1 rounded ${isEditing ? 'bg-blue-50 text-blue-900' : ''}`}>\r\n                                <span>{displayIndeks || '-'}</span>\r\n                                {isEditing && displayIndeks && (\r\n                                  <span className=\"text-xs text-blue-600 ml-1\"></span>\r\n                                )}\r\n                              </div>\r\n                            </td>\r\n                            {/* Action Column */}\r\n                            {isGradesEditing && (\r\n                              <td className=\"border-b border-gray-300 px-3 py-2 text-center\">\r\n                                {isCompleted ? (\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      // Remove from completed set to allow editing again\r\n                                      setCompletedGradeKeys((prev) => {\r\n                                        const next = new Set(prev);\r\n                                        next.delete(gradeKey);\r\n                                        return next;\r\n                                      });\r\n                                      // Re-add to editedGrades\r\n                                      const currentGrade = findGradeForStudent(student);\r\n                                      if (currentGrade) {\r\n                                        setEditedGrades(prev => ({\r\n                                          ...prev,\r\n                                          [gradeKey]: currentGrade,\r\n                                        }));\r\n                                      }\r\n                                    }}\r\n                                    className=\"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700\"\r\n                                  >\r\n                                    Edit\r\n                                  </button>\r\n                                ) : (\r\n                                  <div className=\"flex gap-2 justify-center\">\r\n                                    <button\r\n                                      onClick={() => saveGrade(gradeKey, grade, student)}\r\n                                      disabled={isSaving}\r\n                                      className=\"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50\"\r\n                                    >\r\n                                      {isSaving ? 'Saving...' : 'Save'}\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => {\r\n                                        // Restore original grade data\r\n                                        const originalGrade = findGradeForStudent(student);\r\n                                        if (originalGrade) {\r\n                                          setEditedGrades(prev => ({\r\n                                            ...prev,\r\n                                            [gradeKey]: originalGrade,\r\n                                          }));\r\n                                        } else {\r\n                                          setEditedGrades(prev => {\r\n                                            const next = { ...prev };\r\n                                            delete next[gradeKey];\r\n                                            return next;\r\n                                          });\r\n                                        }\r\n                                        // Mark as completed so it shows Edit button\r\n                                        setCompletedGradeKeys((prev) => new Set([...prev, gradeKey]));\r\n                                      }}\r\n                                      disabled={isSaving}\r\n                                      className=\"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50\"\r\n                                    >\r\n                                      Cancel\r\n                                    </button>\r\n                                  </div>\r\n                                )}\r\n                              </td>\r\n                            )}\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                      {/* Grade Weights Row */}\r\n                      <tr className=\"bg-blue-50 font-bold\">\r\n                        <td colSpan={2} className=\"border-r border-b border-gray-300 px-3 py-2 text-gray-900\">\r\n                          Component Weights\r\n                          {isGradesEditing && (\r\n                            <div className=\"text-xs font-normal text-gray-500 mt-1\">\r\n                              (Total must be 100%)\r\n                            </div>\r\n                          )}\r\n                        </td>\r\n                        <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24\">\r\n                          {isGradesEditing ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={gradeWeights.aktivitas_partisipatif}\r\n                              onChange={(e) => handleBobotChange('bobot_partisipatif', e.target.value)}\r\n                              className=\"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                            />\r\n                          ) : (\r\n                            `${gradeWeights.aktivitas_partisipatif}%`\r\n                          )}\r\n                        </td>\r\n                        <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24\">\r\n                          {isGradesEditing ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={gradeWeights.hasil_proyek}\r\n                              onChange={(e) => handleBobotChange('bobot_proyek', e.target.value)}\r\n                              className=\"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                            />\r\n                          ) : (\r\n                            `${gradeWeights.hasil_proyek}%`\r\n                          )}\r\n                        </td>\r\n                        <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24\">\r\n                          {isGradesEditing ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={gradeWeights.quiz}\r\n                              onChange={(e) => handleBobotChange('bobot_kuis', e.target.value)}\r\n                              className=\"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                            />\r\n                          ) : (\r\n                            `${gradeWeights.quiz}%`\r\n                          )}\r\n                        </td>\r\n                        <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24\">\r\n                          {isGradesEditing ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={gradeWeights.tugas}\r\n                              onChange={(e) => handleBobotChange('bobot_tugas', e.target.value)}\r\n                              className=\"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                            />\r\n                          ) : (\r\n                            `${gradeWeights.tugas}%`\r\n                          )}\r\n                        </td>\r\n                        <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24\">\r\n                          {isGradesEditing ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={gradeWeights.uts}\r\n                              onChange={(e) => handleBobotChange('bobot_uts', e.target.value)}\r\n                              className=\"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                            />\r\n                          ) : (\r\n                            `${gradeWeights.uts}%`\r\n                          )}\r\n                        </td>\r\n                        <td className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24\">\r\n                          {isGradesEditing ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={gradeWeights.uas}\r\n                              onChange={(e) => handleBobotChange('bobot_uas', e.target.value)}\r\n                              className=\"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                            />\r\n                          ) : (\r\n                            `${gradeWeights.uas}%`\r\n                          )}\r\n                        </td>\r\n                        <td colSpan={3} className=\"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900\">\r\n                          <div className=\"text-blue-600\">\r\n                            Total: {(\r\n                              gradeWeights.aktivitas_partisipatif +\r\n                              gradeWeights.hasil_proyek +\r\n                              gradeWeights.quiz +\r\n                              gradeWeights.tugas +\r\n                              gradeWeights.uts +\r\n                              gradeWeights.uas\r\n                            ).toFixed(1)}%\r\n                          </div>\r\n                          {bobotError && (\r\n                            <div className=\"text-xs text-red-600 mt-1\">\r\n                              {bobotError}\r\n                            </div>\r\n                          )}\r\n                        </td>\r\n                        {/* Action Column for Bobot */}\r\n                        <td className={`border-b border-gray-300 px-3 py-2 text-center ${isGradesEditing ? '' : 'hidden'}`}>\r\n                          {isGradesEditing && (\r\n                            <>\r\n                              {isBobotCompleted ? (\r\n                                <button\r\n                                  onClick={() => {\r\n                                    enableBobotEditing();\r\n                                  }}\r\n                                  className=\"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700\"\r\n                                >\r\n                                  Edit\r\n                                </button>\r\n                              ) : (\r\n                                <div className=\"flex gap-2 justify-center\">\r\n                                  <button\r\n                                    onClick={() => saveBobots()}\r\n                                    disabled={isSavingBobots}\r\n                                    className=\"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50\"\r\n                                  >\r\n                                    {isSavingBobots ? 'Saving...' : 'Save'}\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={cancelBobots}\r\n                                    disabled={isSavingBobots}\r\n                                    className=\"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50\"\r\n                                  >\r\n                                    Cancel\r\n                                  </button>\r\n                                </div>\r\n                              )}\r\n                            </>\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ClassSummary;\r\n"],"file":"assets/ClassSummary-DVZeL4YE.js"}