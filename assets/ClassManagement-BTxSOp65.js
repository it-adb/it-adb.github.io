import{u as z,j as e}from"./query-vendor-B--u1oZD.js";import{u as H,r}from"./react-vendor-XXJdR_Id.js";import{b as V,u as J,c as i,e as E,g as o}from"./index-DzRMt0hm.js";import{u as W}from"./usePrograms-Bo5VksDy.js";import{r as X,b as $,B as L,G as D,z as Z,_ as ee,u as se,a0 as ae,p as te,e as re}from"./ui-vendor-C-UqR_Df.js";function ne(l,v){const x=["courses",l?.kode_prodi??null,l?.semester??null,l?.include_classes??null];return z({queryKey:x,queryFn:()=>V.getCourses(l)})}const me=()=>{const{currentSemester:l}=J(),v=H(),[x,w]=r.useState([]),[u,h]=r.useState([]),[F,P]=r.useState([]),[T,Y]=r.useState(!0),[b,y]=r.useState(null),[c,A]=r.useState(""),[k,G]=r.useState(new Set),[m,I]=r.useState("all"),[n,_]=r.useState(""),[g,C]=r.useState("1"),f=r.useMemo(()=>n?`${n}${g}`:"",[n,g]),{data:j}=W(),{data:N,isLoading:S,error:p}=ne(r.useMemo(()=>f?{semester:f,include_classes:!0}:void 0,[f]));r.useEffect(()=>{j&&P(j)},[j]),r.useEffect(()=>{let s=x;c&&(s=s.filter(a=>a.nama_mk.toLowerCase().includes(c.toLowerCase())||a.kode_mk.toLowerCase().includes(c.toLowerCase()))),m!=="all"&&(s=s.filter(a=>a.kode_prodi===m)),h(s)},[c,m,x]),r.useEffect(()=>{if(l&&!n){const s=l.slice(0,4),a=l.slice(4);_(s),C(a)}},[l,n]),r.useEffect(()=>{Y(S||!n&&!0)},[S,n]),r.useEffect(()=>{if(p){const s=p instanceof Error?p.message:"Failed to load courses";y(s),w([]),h([])}else y(null)},[p]),r.useEffect(()=>{if(Array.isArray(N)){const s=N;w(s),h(s)}},[N]);const M=s=>{const a=new Set(k);a.has(s)?a.delete(s):a.add(s),G(a)},U=s=>(s.sks_tatap_muka||0)+(s.sks_praktek||0)+(s.sks_prak_lapangan||0)+(s.sks_simulasi||0),K=s=>s?s.toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",O=s=>{switch(s){case"Online":return"bg-blue-100 text-blue-700";case"Offline":return"bg-green-100 text-green-700";case"Hybrid":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},R=s=>{if(!s||s.length<5)return"Unknown Semester";const a=s.slice(0,4),d=s.slice(4)==="1"?"Ganjil":"Genap";return`${`${a}/${parseInt(a)+1}`} ${d}`},q=u.length,Q=u.reduce((s,a)=>s+(a.classes?.length||0),0);return T||!n?e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(X,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:n?"Loading courses...":"Loading semester information..."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Management"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-500",children:"Current Semester:"}),e.jsx("span",{className:"font-medium text-gray-900",children:R(l)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Courses"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:q})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Classes"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:Q})]})]})})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by course name or code...",value:c,onChange:s=>A(s.target.value),className:"input-field pl-10 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx($,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",value:n,onChange:s=>_(s.target.value),placeholder:"Year",className:"input-field w-[80px] text-center",min:new Date().getFullYear()-10,max:new Date().getFullYear()+5}),e.jsx("span",{className:"text-gray-500 font-medium",children:"/"}),e.jsx("input",{type:"number",value:n?parseInt(n)+1:"",disabled:!0,className:"input-field w-[80px] text-center bg-gray-50 text-gray-600",readOnly:!0})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs("select",{value:g,onChange:s=>C(s.target.value),className:"input-field min-w-[120px]",children:[e.jsx("option",{value:"1",children:"Ganjil"}),e.jsx("option",{value:"2",children:"Genap"})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("select",{value:m,onChange:s=>I(s.target.value),className:"input-field min-w-[200px]",children:[e.jsx("option",{value:"all",children:"All Programs"}),F.map(s=>e.jsxs("option",{value:s.kode_prodi,children:[s.nama_prodi," (",s.kode_prodi,")"]},s.kode_prodi))]})]})]})}),b&&e.jsx("div",{className:"card bg-red-50 border-red-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(se,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading courses"}),e.jsx("p",{className:"text-sm text-red-600",children:b})]})]})}),u.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(L,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No courses found"}),e.jsx("p",{className:"text-sm text-gray-400",children:c||m!=="all"?"Try adjusting your filters or search query":"No courses available for this semester"})]}):e.jsx("div",{className:"space-y-2",children:u.map(s=>{const a=k.has(s.kode_mk),d=s.classes&&s.classes.length>0;return e.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between gap-2 cursor-pointer",onClick:()=>d&&M(s.kode_mk),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:d&&e.jsx("div",{className:"text-gray-400",children:a?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(te,{className:"h-4 w-4"})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 text-xs font-medium rounded whitespace-nowrap",children:s.kode_mk}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:s.nama_mk}),s.jenis_mk&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded whitespace-nowrap",children:s.jenis_mk})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-0.5 whitespace-nowrap",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[U(s)," SKS"]})]}),d&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 font-medium rounded whitespace-nowrap",children:[s.classes.length," classes"]})]})]})}),a&&d&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:s.classes.map(t=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-xs hover:bg-gray-100 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900 whitespace-nowrap",children:["Class ",i(t.nama_kelas)]}),i(t.mode_kuliah)&&e.jsx("span",{className:`px-1.5 py-0.5 text-xs font-medium rounded whitespace-nowrap ${O(i(t.mode_kuliah))}`,children:i(t.mode_kuliah)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600 flex-wrap",children:[E(t.tgl_mulai)&&e.jsx("span",{className:"whitespace-nowrap",children:K(E(t.tgl_mulai))}),o(t.sks_tatap_muka)>0&&e.jsxs("span",{className:"whitespace-nowrap",children:[o(t.sks_tatap_muka),"SKS"]}),e.jsxs("button",{onClick:B=>{B.stopPropagation(),v(`/class-summary/${t.id}?courseCode=${encodeURIComponent(s.kode_mk)}&courseName=${encodeURIComponent(s.nama_mk)}&className=${encodeURIComponent(i(t.nama_kelas))}&sksTatapMuka=${o(t.sks_tatap_muka)}&sksPraktek=${o(t.sks_praktek)}&sksPrakLapangan=${o(t.sks_prak_lapangan)}&sksSimulasi=${o(t.sks_simulasi)}&from=admin/class-management`)},className:"ml-2 px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1 whitespace-nowrap",title:"View attendance matrix",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{children:"Attendance"})]})]})]}),i(t.bahasan)&&e.jsx("p",{className:"text-gray-600 mt-1",children:i(t.bahasan)})]},t.id))})]},s.kode_mk)})})]})};export{me as default};
//# sourceMappingURL=ClassManagement-BTxSOp65.js.map
