import{j as e}from"./query-vendor-B--u1oZD.js";import{r as o,g as Z}from"./react-vendor-XXJdR_Id.js";import{u as ce,a as oe,f as C,g as T}from"./index-BYG0ekbM.js";import{u as xe,a as me}from"./useClasses-BnXaOsS0.js";import{C as q}from"./CheckInModal-C7E_DPTH.js";import{x as ue,t as he,N as E,c as G,O as pe,s as J}from"./ui-vendor-CkH0jJa3.js";const ge=j=>{const r=C(j);if(!r)return null;const m=r.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[m]||null},fe=j=>{const r=T(j);if(!r)return"00:00";const m=r.match(/^(\d{1,2}):(\d{2})(?::\d{2})?$/);if(m){const d=m[1].padStart(2,"0"),b=m[2];return`${d}:${b}`}const N=r.split("T")[1];if(N){const d=N.split(".")[0].split("Z")[0],[b="00",g="00"]=d.split(":");return`${b.padStart(2,"0")}:${g.padStart(2,"0")}`}try{const d=new Date(r);if(!isNaN(d.getTime()))return d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{}return"00:00"},we=()=>{const{user:j}=ce(),{t:r}=oe(),[m,N]=o.useState([]),[d,b]=o.useState([]),[g,A]=o.useState(""),[k,D]=o.useState(""),[Q,F]=o.useState(!1),[X,O]=o.useState(null),[ee,L]=o.useState(""),[te,P]=o.useState(""),[se,B]=o.useState(""),[ae,K]=o.useState(!1),[R,z]=o.useState(null),re=Z.useMemo(()=>{const t={};return g&&(t.start_day=g),k&&(t.end_day=k),t},[g,k]),{data:_,isLoading:ne,error:I}=xe(j?.studentId||"",re),y=Z.useMemo(()=>_??[],[_]),{data:S=[]}=me(),H=I?I instanceof Error?I.message:"Failed to load class schedule":null,V=(t,a)=>{O(t),L(a),F(!0)},le=()=>{F(!1),O(null),L("")},ie=t=>{z(t),P(t.link_bukti||""),B(t.deskripsi||""),K(!0)},de=()=>{z(null),P(""),B(""),K(!1)},$=t=>Array.isArray(S)&&S.some(a=>a.id_pertemuan===t),W=t=>Array.isArray(S)?S.find(a=>a.id_pertemuan===t):void 0,U=(t,a)=>t.actualDate?$(t.meetingId)?{allowed:!1,reason:"Already checked in"}:a?{allowed:!0}:{allowed:!1,reason:"Attendance not yet active"}:{allowed:!1,reason:"Invalid meeting date"},Y=t=>{const a=t.toLowerCase();return a==="hadir"?{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}:a==="izin"||a==="sakit"?{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-700",icon:"text-yellow-600"}:a==="alfa"?{border:"border-red-300",bg:"bg-red-50",text:"text-red-700",icon:"text-red-600"}:a==="terlambat"?{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"}:a==="pengganti"?{border:"border-purple-300",bg:"bg-purple-50",text:"text-purple-700",icon:"text-purple-600"}:{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}};return o.useEffect(()=>{const t=[];(_??[]).forEach(a=>{(a.meeting_schedules??[]).forEach(s=>{const i=ge(s.tgl_pertemuan);if(!i)return;const x=fe(s.jam_pertemuan),n=C(s.tgl_pertemuan);if(!n)return;const p=a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,v=p*60,[w,f]=x.split(":").map(Number),h=w*60+f+v,u=Math.floor(h/60)%24,l=h%60,c=`${String(u).padStart(2,"0")}:${String(l).padStart(2,"0")}`;t.push({id:`${a.kelas_id}-${s.id}`,day:i,startTime:x,endTime:c,courseCode:a.kode_mk,courseName:a.nama_mk,className:a.nama_kelas,credits:p,room:T(s.media_pembelajaran,"TBA"),topic:T(s.topik,""),weekNumber:s.pertemuan_ke,classId:a.kelas_id,actualDate:n,meetingId:s.id})})}),N(t)},[_]),ne?e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading class schedule..."})]})})}):H?e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class & Schedule"}),e.jsx("div",{className:"card bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-3 text-red-800",children:[e.jsx(he,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading schedule"}),e.jsx("p",{className:"text-sm mt-1",children:H})]})]})})]}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 lg:space-y-6",children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold text-gray-900",children:"Class & Schedule"}),e.jsxs("div",{className:"card grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{className:"h-5 w-5 text-primary-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Classes Enrolled"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[y.length," classes"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Total Meetings"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[m.length," sessions"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:col-span-2 lg:col-span-1",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Total Credits"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[y.reduce((t,a)=>t+a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,0)," SKS"]})]})]})]}),y.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Classes Found"}),e.jsx("p",{className:"text-gray-600",children:"You are not enrolled in any classes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4",children:r("student.enrolledClasses")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:y.map(t=>{const a=t.sks_tatap_muka+t.sks_praktek+t.sks_prak_lapangan+t.sks_simulasi,s=t.meeting_schedules?.length??0;return e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:e.jsx("span",{className:"text-xs font-semibold text-primary-600",children:t.kode_mk})}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:t.nama_mk}),t.bahasan&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:t.bahasan})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-x-2 gap-y-0.5 text-xs text-gray-500 border-t border-gray-100 pt-2",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[a," SKS"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s," meetings"]}),t.mode_kuliah&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"text-gray-600 hidden sm:inline",children:t.mode_kuliah})]})]})]},t.kelas_id)})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 lg:mb-4 flex-wrap gap-3",children:e.jsx("h2",{className:"text-base lg:text-lg font-semibold text-gray-900",children:r("student.listOfSchedules")})}),e.jsx("div",{className:"mb-4 lg:mb-6 pb-3 lg:pb-4 border-b border-gray-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3",children:r("student.filterByCourse")}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from(new Set(m.map(t=>t.courseCode))).map(t=>{const a=m.find(i=>i.courseCode===t)?.courseName,s=d.includes(t);return e.jsxs("button",{onClick:()=>{b(s?d.filter(i=>i!==t):[...d,t])},className:`px-2.5 lg:px-3 py-1.5 text-xs font-medium rounded-lg transition-all cursor-pointer ${s?"bg-primary-600 text-white border border-primary-600 hover:bg-primary-700":"bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200 hover:border-gray-300"}`,title:`${t} - ${a}`,type:"button",children:[e.jsxs("span",{className:"hidden sm:inline",children:[t," - ",a]}),e.jsx("span",{className:"sm:hidden",children:a})]},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3",children:r("student.filterByDate")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:g,onChange:t=>A(t.target.value),className:"input-field w-full text-xs",placeholder:"Start date"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:k,onChange:t=>D(t.target.value),className:"input-field w-full text-xs",placeholder:"End date"})}),(g||k)&&e.jsx("button",{onClick:()=>{A(""),D("")},className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-lg hover:bg-gray-200 hover:border-gray-300 transition-all cursor-pointer whitespace-nowrap",type:"button",children:"Clear Dates"})]})]})]})}),(()=>{let t=m;d.length>0&&(t=t.filter(s=>d.includes(s.courseCode)));const a=[...t].sort((s,i)=>{if(!s.actualDate||!i.actualDate)return 0;const x=s.actualDate.getTime()-i.actualDate.getTime();return x!==0?x:s.startTime.localeCompare(i.startTime)});return a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No meetings match the selected filters."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"lg:hidden space-y-2",children:a.map((s,i)=>{const x=y.find(c=>c.kelas_id===s.classId),n=x?.meeting_schedules?.find(c=>`${x.kelas_id}-${c.id}`===s.id),p=n?C(n.tgl_pertemuan):null,v=p?p.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"",w=n?.absensi_aktif===!0||typeof n?.absensi_aktif=="object"&&n.absensi_aktif?.Valid&&n.absensi_aktif?.Bool,f=$(s.meetingId),h=U(s,w),u=W(s.meetingId),l=u?Y(u.status_kehadiran):null;return e.jsxs("div",{className:`p-3 border rounded-lg ${f&&l?`${l.border} ${l.bg}`:"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:s.day}),e.jsx("span",{className:"text-xs text-gray-600",children:v})]}),f&&l&&e.jsx(J,{className:`h-4 w-4 ${l.icon} flex-shrink-0`})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-primary-600 flex-shrink-0",children:s.courseCode}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:s.courseName})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:e.jsxs("span",{children:["Week ",s.weekNumber]})}),e.jsx("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:s.startTime})]})}),f&&u&&l?e.jsxs("div",{className:`text-xs ${l.text} font-medium pt-2 border-t ${l.border}`,children:["✓ ",u.status_kehadiran]}):h.allowed?e.jsx("button",{onClick:()=>V(s.meetingId,s.courseName),className:"w-full text-xs px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all cursor-pointer font-medium mt-2",type:"button",children:"Check In"}):e.jsx("div",{className:"text-xs text-gray-500 italic text-center py-1 mt-2",children:h.reason})]})]},`${s.id}-${i}-mobile`)})}),e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:r("studentSchedule.status")}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:r("studentSchedule.day")}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:r("studentSchedule.date")}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:r("studentSchedule.time")}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:r("studentSchedule.courseCode")}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:r("studentSchedule.courseName")}),e.jsx("th",{className:"px-3 py-2 text-center font-semibold text-gray-700",children:r("studentSchedule.week")}),e.jsx("th",{className:"px-3 py-2 text-center font-semibold text-gray-700",children:r("studentSchedule.action")})]})}),e.jsx("tbody",{children:a.map((s,i)=>{const x=y.find(M=>M.kelas_id===s.classId),n=x?.meeting_schedules?.find(M=>`${x.kelas_id}-${M.id}`===s.id),p=n?C(n.tgl_pertemuan):null,v=p?p.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"",w=n?.absensi_aktif===!0||typeof n?.absensi_aktif=="object"&&n.absensi_aktif?.Valid&&n.absensi_aktif?.Bool,f=i%2===0,h=$(s.meetingId),u=U(s,w),l=W(s.meetingId),c=l?Y(l.status_kehadiran):null;return e.jsxs("tr",{className:`border-b border-gray-200 transition-colors ${h&&c?c.bg:f?"bg-white hover:bg-blue-50":"bg-gray-50 hover:bg-blue-50"}`,children:[e.jsx("td",{className:"px-3 py-2 text-center",children:h&&c&&e.jsx(J,{className:`h-4 w-4 ${c.icon} inline`})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 font-semibold rounded",children:s.day})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-gray-600",children:v}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-gray-600",children:s.startTime}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap font-semibold text-primary-600",children:s.courseCode}),e.jsx("td",{className:"px-3 py-2 max-w-xs",children:e.jsx("div",{className:"truncate text-gray-900 font-medium",children:s.courseName})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-600 whitespace-nowrap",children:s.weekNumber}),e.jsx("td",{className:"px-3 py-2 text-center whitespace-nowrap",children:h&&l&&c?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:`text-xs ${c.text} font-medium whitespace-nowrap`,children:["✓ ",l.status_kehadiran]}),e.jsx("button",{onClick:()=>ie(l),className:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",type:"button",children:r("studentSchedule.updateProof")})]}):u.allowed?e.jsx("button",{onClick:()=>V(s.meetingId,s.courseName),className:"text-xs px-2 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-all cursor-pointer font-medium",type:"button",children:r("studentSchedule.checkIn")}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{disabled:!0,className:"text-xs px-2 py-1 bg-gray-300 text-gray-500 rounded cursor-not-allowed",title:u.reason,children:r("studentSchedule.checkIn")}),e.jsx("span",{className:"text-xs text-gray-500 italic max-w-[120px] text-center",children:u.reason})]})})]},`${s.id}-${i}`)})})]})})]})})()]})]}),e.jsx(q,{isOpen:Q,meetingId:X,courseName:ee,onClose:le}),e.jsx(q,{isOpen:ae,meetingId:R?.id_pertemuan||null,courseName:R?.nama_mk||"",onClose:de,editMode:!0,existingProof:te,existingDescription:se})]})};export{we as default};
//# sourceMappingURL=ClassSchedule-CY-vsrS-.js.map
