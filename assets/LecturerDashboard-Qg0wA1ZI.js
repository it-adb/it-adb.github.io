import{b as Q,u as B,j as e}from"./query-vendor-B--u1oZD.js";import{u as V,r as m,g as X}from"./react-vendor-XXJdR_Id.js";import{u as Y,e as I,c as k,b as T}from"./index-C1kkCffi.js";import{d as Z}from"./useClasses-K0xObK0J.js";import{A as z}from"./AttendanceModal-B2J1rK3l.js";import{C as G}from"./Card-DDjmpwhs.js";import{r as g,t as D,i as p,f as J,W as ee,c as se}from"./ui-vendor-DIF6S0il.js";import"./useAttendances-BtemQHXu.js";import"./useLecturerAssignments-BNW1KFc6.js";const te=l=>{const c=I(l);if(!c)return null;const i=c.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[i]||null},ae=l=>{const c=k(l);if(!c)return"00:00";const i=c.split("T")[1]?.split(".")[0]||c.split("T")[1]?.split("Z")[0];return i?i.substring(0,5):new Date(c).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})},re=()=>{const l=new Date,c=l.getDay(),i=c===0?0:c,d=new Date(l);d.setDate(l.getDate()-i),d.setHours(0,0,0,0);const u=new Date(d);return u.setDate(d.getDate()+6),u.setHours(23,59,59,999),{start:d,end:u}},ge=()=>{const{user:l,currentSemester:c}=Y(),i=V(),d=Q(),[u,A]=m.useState([]),[C,x]=m.useState(null),[N,f]=m.useState(null),[b,h]=m.useState({}),{start:$,end:M}=X.useMemo(()=>re(),[]),L=$.toISOString().split("T")[0],R=M.toISOString().split("T")[0],{data:j,isLoading:W}=Z(l?.employeeId||"",{semester:c,start_day:L,end_day:R}),{data:y,isLoading:P}=B({queryKey:["lecturer-meeting-recap",l?.employeeId,c],queryFn:async()=>!l?.employeeId||!c?null:await T.getLecturerMeetingRecap(l.employeeId,{semester:c}),enabled:!!(l?.employeeId&&c)}),v=m.useMemo(()=>y?.classes?y.classes.map(s=>({classId:s.class_id,courseCode:s.kode_mk,courseName:s.course_name,className:s.class_name,sksTatapMuka:s.sks_tatap_muka,sksPraktek:s.sks_praktek,sksPrakLapangan:s.sks_prak_lapangan,sksSimulasi:s.sks_simulasi,meetings:s.meetings.map(t=>({id:t.id,weekNumber:t.week_number,date:t.tgl_pertemuan?new Date(t.tgl_pertemuan):null,topic:t.topik,studentAttendanceComplete:t.attendance_complete,lecturerAssigned:t.lecturer_assigned,totalStudents:s.total_students,recordedAttendances:t.recorded_attendances,absensiAktif:t.absensi_aktif}))})):[],[y]);m.useEffect(()=>{const s=[];(j??[]).forEach(a=>{a.meeting_schedules.forEach(r=>{const n=te(r.tgl_pertemuan);if(!n)return;const o=ae(r.jam_pertemuan),w=I(r.tgl_pertemuan);if(!w)return;const S=a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,E=S*60,[F,q]=o.split(":").map(Number),_=F*60+q+E,H=Math.floor(_/60)%24,K=_%60,O=`${String(H).padStart(2,"0")}:${String(K).padStart(2,"0")}`;s.push({id:`${a.kelas_id}-${r.id}`,day:n,startTime:o,endTime:O,courseCode:a.kode_mk,courseName:a.nama_mk,className:a.nama_kelas,credits:S,room:k(r.media_pembelajaran,"TBA"),topic:k(r.topik,""),weekNumber:r.pertemuan_ke,classId:a.kelas_id,actualDate:w,meetingId:r.id})})});const t=s.filter(a=>a.actualDate).map(a=>{const r=a.actualDate.getDay();return{...a,weekDay:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[r]||"Monday"}}).sort((a,r)=>!a.actualDate||!r.actualDate?0:a.actualDate.getTime()-r.actualDate.getTime());A(t)},[j]);const U=async(s,t,a)=>{s.stopPropagation(),f(t),h(r=>({...r,[t]:!a}));try{await T.updateMeeting(t,{absensi_aktif:!a}),await d.invalidateQueries({queryKey:["lecturer-meeting-recap",l?.employeeId,c]}),await d.invalidateQueries({queryKey:["class-meetings"]}),h(r=>{const n={...r};return delete n[t],n})}catch(r){console.error("Failed to toggle attendance:",r),h(n=>{const o={...n};return delete o[t],o})}finally{f(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lecturer Dashboard"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Academic Year 2024/2025"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Recap"}),P?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading meeting recap..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Legend"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(g,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Student Attendance Recap Complete"})]},"student-complete"),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(g,{className:"h-4 w-4 text-orange-500 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Student Attendance Recap Partial"})]},"student-partial"),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(D,{className:"h-4 w-4 text-gray-300 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Student Attendance Recap Incomplete"})]},"student-incomplete"),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Lecturer Assigned"})]},"lecturer-assigned"),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(p,{className:"h-4 w-4 text-gray-300 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Lecturer Unassigned"})]},"lecturer-unassigned"),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Attendance Active"})]},"attendance-active"),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:"Attendance Inactive"})]},"attendance-inactive")]})]}),v.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No classes found for this semester"}):e.jsx("div",{className:"space-y-3",children:v.map(s=>e.jsxs(G,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-50 to-secondary-50 px-3 py-2 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h4",{className:"font-semibold text-sm text-gray-900 truncate",children:[s.courseCode," - ",s.courseName]}),e.jsx("p",{className:"text-xs text-gray-600",children:s.className})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[s.meetings.length," meeting",s.meetings.length!==1?"s":""]}),e.jsxs("button",{type:"button",onClick:()=>{i(`/class-summary/${s.classId}?courseCode=${encodeURIComponent(s.courseCode)}&courseName=${encodeURIComponent(s.courseName)}&className=${encodeURIComponent(s.className)}&sksTatapMuka=${s.sksTatapMuka}&sksPraktek=${s.sksPraktek}&sksPrakLapangan=${s.sksPrakLapangan}&sksSimulasi=${s.sksSimulasi}&from=lecturer/dashboard`)},className:"px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1 text-xs whitespace-nowrap",title:"View attendance matrix",children:[e.jsx(J,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Summary"})]})]})]})}),e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"flex gap-1 flex-wrap",children:s.meetings.map(t=>{const a=t.date?t.date.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",r=b[t.id]!==void 0?b[t.id]:t.absensiAktif;return e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>{const n=t.date?new Date(t.date):void 0;x({meetingId:t.id,classId:s.classId,title:`${s.courseCode} • ${s.courseName}`,subtitle:`Week ${t.weekNumber}`,dateLabel:a,meetingDateTime:n,topic:t.topic||void 0})},onKeyDown:n=>{if(n.key==="Enter"||n.key===" "){n.preventDefault();const o=t.date?new Date(t.date):void 0;x({meetingId:t.id,classId:s.classId,title:`${s.courseCode} • ${s.courseName}`,subtitle:`Week ${t.weekNumber}`,dateLabel:a,meetingDateTime:o,topic:t.topic||void 0})}},className:"flex flex-col items-center gap-1 p-2 rounded border border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer min-w-[80px] relative group focus:outline-none focus:ring-2 focus:ring-primary-200",title:`Week ${t.weekNumber} - ${a}${t.topic?` - ${t.topic}`:""}
Student Attendance: ${t.recordedAttendances}/${t.totalStudents}
Lecturer Attendance: ${t.lecturerAssigned?"Complete":"Incomplete"}
Attendance: ${t.absensiAktif?"Active":"Inactive"}`,children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-600",children:["W",t.weekNumber]}),e.jsxs("div",{className:"flex gap-1 items-center justify-center h-6",children:[t.studentAttendanceComplete?e.jsx(g,{className:"h-4 w-4 text-green-600"}):t.recordedAttendances>0?e.jsx(g,{className:"h-4 w-4 text-orange-500"}):e.jsx(D,{className:"h-4 w-4 text-gray-300"}),t.lecturerAssigned?e.jsx(p,{className:"h-4 w-4 text-blue-600"}):e.jsx(p,{className:"h-4 w-4 text-gray-300"})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center leading-tight",children:a||"-"}),e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx("div",{className:`h-2 w-2 rounded-full ${r?"bg-green-600":"bg-gray-400"}`})}),e.jsx("button",{type:"button",onClick:n=>U(n,t.id,r),disabled:N===t.id,"aria-label":r?"Deactivate attendance":"Activate attendance",onMouseEnter:n=>{n.currentTarget.style.opacity="1"},onMouseLeave:n=>{n.currentTarget.style.opacity="0.25"},className:"absolute bottom-1 right-1 p-1.5 rounded bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 transition-opacity shadow-sm cursor-pointer",style:{opacity:.25},title:r?"Deactivate Attendance":"Activate Attendance",children:N===t.id?e.jsx(ee,{className:"h-3.5 w-3.5 text-gray-600 animate-spin"}):e.jsx("div",{className:`h-3.5 w-3.5 rounded-full border-2 ${r?"bg-green-600 border-green-600":"border-gray-300"}`})})]},t.id)})})})]},s.classId))})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"This Week's Schedule"}),W?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading this week's schedule..."}):u.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No classes scheduled for this week"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(s=>{const t=s.actualDate?new Date(s.actualDate):null;if(t&&s.startTime){const[a,r]=s.startTime.split(":").map(Number);t.setHours(a,r,0,0)}return e.jsxs("button",{type:"button",onClick:()=>x({meetingId:s.meetingId,classId:s.classId,title:`${s.courseCode} • ${s.courseName}`,subtitle:`Week ${s.weekNumber}`,dateLabel:s.actualDate?.toLocaleDateString("id-ID",{weekday:"short",day:"numeric",month:"short"}),meetingDateTime:t||void 0,topic:s.topic||void 0}),className:"text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2.5 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:s.weekDay}),s.actualDate&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-0.5 bg-gray-100 rounded",children:s.actualDate.toLocaleDateString("id-ID",{day:"numeric",month:"short"})})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Week ",s.weekNumber]})]}),e.jsx("div",{className:"text-xs font-semibold text-primary-600 mb-1",children:s.courseCode}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:s.courseName})]}),e.jsx("div",{className:"flex flex-col gap-1 text-xs text-gray-600 border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(se,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:[s.startTime," - ",s.endTime]})]})})]},s.id)})})]}),e.jsx(z,{selectedMeeting:C,onClose:()=>x(null)})]})};export{ge as default};
//# sourceMappingURL=LecturerDashboard-Qg0wA1ZI.js.map
