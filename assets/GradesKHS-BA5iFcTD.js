import{j as e}from"./query-vendor-B--u1oZD.js";import{r as h}from"./react-vendor-XXJdR_Id.js";import{u as H,b as N,c as p,d as u,f as c}from"./index-U_9acvuP.js";import{r as q,u as L,c as P,O as U}from"./ui-vendor-C-UqR_Df.js";const Q=()=>{const{user:j,currentSemester:n}=H(),[F,o]=h.useState(!0),[v,y]=h.useState(null),[x,f]=h.useState([]);h.useEffect(()=>{(async()=>{if(!j?.studentId||!n){y("Student information or semester not available"),o(!1);return}try{o(!0),y(null);const a=await N.getEnrollments(j.studentId,n);if(!a||a.length===0){f([]),o(!1);return}const m=new Map,E=a.filter(r=>p(r.kode_mk)).map(async r=>{const s=p(r.kode_mk);try{const i=await N.getCourseByCode(s);i&&m.set(s,i)}catch(i){console.error(`Failed to fetch course ${s}:`,i)}});await Promise.all(E);const D=a.map(async r=>{try{const s=await N.getGrades({krs_id:r.id});return{enrollment:r,grade:s[0]||null}}catch(s){return console.error(`Failed to fetch grade for enrollment ${r.id}:`,s),{enrollment:r,grade:null}}}),K=(await Promise.all(D)).map(({enrollment:r,grade:s})=>{const i=p(r.kode_mk)||"",l=m.get(i),T=u(l?.sks_tatap_muka)+u(l?.sks_praktek)+u(l?.sks_prak_lapangan)+u(l?.sks_simulasi),b=s?c(s.aktivitas_partisipatif)??void 0:void 0,S=s?c(s.hasil_proyek)??void 0:void 0,w=s?c(s.quiz)??void 0:void 0,G=s?c(s.tugas)??void 0:void 0,C=s?c(s.uts)??void 0:void 0,_=s?c(s.uas)??void 0:void 0,z=b!==void 0&&S!==void 0&&w!==void 0&&G!==void 0&&C!==void 0&&_!==void 0;return{enrollmentId:r.id,courseCode:i,courseName:l?.nama_mk||i,credits:T,aktivitasPartisipatif:b,hasilProyek:S,quiz:w,tugas:G,uts:C,uas:_,nilaiAngka:s?c(s.nilai_angka)??void 0:void 0,nilaiHuruf:s?p(s.nilai_huruf)??void 0:void 0,nilaiIndeks:s?c(s.nilai_indeks)??void 0:void 0,hasCompleteGrades:z}});f(K)}catch(a){console.error("Error fetching grades data:",a),y(a instanceof Error?a.message:"Failed to load grades")}finally{o(!1)}})()},[j?.studentId,n]);const k=x.filter(t=>t.hasCompleteGrades),I=x.reduce((t,a)=>t+a.credits,0),g=k.reduce((t,a)=>t+a.credits,0),A=k.reduce((t,a)=>{const m=a.nilaiIndeks??0;return t+a.credits*m},0),d=g>0?A/g:null;return F?e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-center py-12",children:[e.jsx(q,{className:"h-8 w-8 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading grades..."})]}):v?e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"card bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(L,{className:"h-5 w-5"}),e.jsx("span",{children:v})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Grades (KHS)"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Semester: ",n]})]}),e.jsxs("div",{className:"card grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Credits"}),e.jsxs("div",{className:"text-lg font-semibold",children:[I," SKS"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Semester GPA (IPS)"}),e.jsx("div",{className:"text-lg font-semibold",children:d!==null?d.toFixed(2):"-"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-5 w-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{className:"text-lg font-semibold",children:d!==null?d>=3?"Good Standing":d>=2?"Warning":"Probation":"-"})]})]})]}),x.length===0?e.jsx("div",{className:"card text-center py-12 text-gray-500",children:"No grades available for this semester"}):e.jsx("div",{className:"card overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b-2 border-gray-200",children:[e.jsx("th",{className:"py-3 px-2",children:"Course Code"}),e.jsx("th",{className:"py-3 px-2",children:"Course Name"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"SKS"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Partisipasi"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Proyek"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Quiz"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Tugas"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"UTS"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"UAS"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Total"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Grade"}),e.jsx("th",{className:"py-3 px-2 text-center",children:"Index"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2 font-medium text-gray-900",children:t.courseCode}),e.jsx("td",{className:"py-3 px-2",children:t.courseName}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.credits}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.aktivitasPartisipatif?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.hasilProyek?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.quiz?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.tugas?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.uts?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.uas?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center font-medium",children:t.nilaiAngka?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center font-semibold text-primary-600",children:t.hasCompleteGrades?t.nilaiHuruf??"-":"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.hasCompleteGrades?t.nilaiIndeks?.toFixed(2)??"-":"-"})]},t.enrollmentId))})]})})]})};export{Q as default};
//# sourceMappingURL=GradesKHS-BA5iFcTD.js.map
