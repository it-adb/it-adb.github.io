const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-2pqXIzBy.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js"])))=>i.map(i=>d[i]);
import{u as Qe,b as Ae,c as _t,_ as Ye,d as as,j as e}from"./query-vendor-B--u1oZD.js";import{r as i,e as ns,f as is,u as os}from"./react-vendor-XXJdR_Id.js";import{u as ls,a as cs,b as ds,c as us,d as bs}from"./useAttendances-BtemQHXu.js";import{u as ps}from"./useLecturerAssignments-BNW1KFc6.js";import{b as ue}from"./index-C1kkCffi.js";import{H as xs,C as gt,r as _e,c as Xe,s as je,t as He,u as We,v as Ue,w as Me,x as fs,y as hs}from"./ui-vendor-DIF6S0il.js";function ms(t){return Qe({queryKey:["grades",t?.krs_id??null,t?.kelas_id??null],queryFn:()=>ue.getGrades(t),enabled:!!(t&&(t.krs_id!==void 0||t.kelas_id!==void 0))})}function gs(t){const r=Ae();return _t({mutationFn:c=>ue.createGrade(c),onSuccess:async()=>{r.invalidateQueries({queryKey:["grades"]})}})}function ys(t){const r=Ae();return _t({mutationFn:({id:c,data:u})=>ue.updateGrade(c,u),onSuccess:async(c,u)=>{try{const l=await ue.getGrade(u.id);r.setQueriesData({queryKey:["grades"],exact:!1},A=>A&&A.map(C=>C.id===u.id?l:C))}catch(l){console.error("Failed to fetch updated grade, invalidating:",l),r.invalidateQueries({queryKey:["grades"]})}}})}const Ie=["","Hadir","Izin","Sakit","Alfa","Terlambat","Pengganti"],yt={1:"Hadir",2:"Izin",3:"Sakit",4:"Alfa",5:"Terlambat",6:"Pengganti"},ne=t=>t?typeof t=="string"?t:t.Valid?t.String:"":"",Je=t=>{if(!t)return"";let r="";if(typeof t=="string"?r=t:t.Valid&&(r=t.Time),!r)return"";const c=new Date(r);return isNaN(c.getTime())?"":c.toISOString().slice(0,10)},Ne=t=>{if(!t)return"";let r="";if(typeof t=="string"?r=t:"String"in t&&t.Valid?r=t.String:"Time"in t&&t.Valid&&(r=t.Time),!r)return"";const c=r.split(":");return c.length>=2?`${c[0].padStart(2,"0")}:${c[1].padStart(2,"0")}`:r},se=t=>{if(t==null)return null;if(typeof t=="number")return t;if(typeof t=="object"&&t!==null){if("Float64"in t&&t.Valid)return t.Float64;if("Int32"in t&&t.Valid)return t.Int32}return null},kt=t=>{if(t==null)return null;if(typeof t=="number"||typeof t=="string"||typeof t=="boolean")return t;if(typeof t=="object"&&t!==null){if("Float64"in t&&t.Valid)return t.Float64;if("Int32"in t)return t.Int32;if("String"in t&&t.Valid)return t.String}return null},D=t=>{if(t==null)return null;if(typeof t=="number")return t;if(typeof t=="object"&&t!==null&&"Float64"in t&&"Valid"in t){const r=t;return r.Valid?r.Float64:null}return null},we=t=>{const r=t?.id_krs??t?.krs_id??t?.krsId??t?.krs?.id??t?.krs?.KRS?.id;return r!=null?Number(r):null},Ke=(t,r)=>r.find(u=>u.toLowerCase()===t.toLowerCase())??t,jt=t=>{let r="";if(typeof t=="object"&&t!==null){if(!t.Valid)return"-";r=t.Time}else r=t;if(!r)return"-";const c=new Date(r),u=c.toLocaleDateString("en-US",{weekday:"short"}),l=c.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"});return`${u}, ${l}`},ks=t=>{let r="";if(typeof t=="object"&&t!==null){if(!t.Valid)return"-";r=t.Time}else r=t;if(!r)return"-";const c=new Date(r),u=c.toLocaleDateString("en-US",{weekday:"short"}),l=c.toLocaleDateString("en-US",{day:"2-digit"}),A=c.toLocaleDateString("en-US",{month:"short"});return`${u}
${l} ${A}`},Nt=t=>Ne(t)||"-",U={aktivitas_partisipatif:15,hasil_proyek:35,quiz:5,tugas:5,uts:15,uas:25},_s=["bobot_partisipatif","bobot_proyek","bobot_kuis","bobot_tugas","bobot_uts","bobot_uas"],js=["aktivitas_partisipatif","hasil_proyek","quiz","tugas","uts","uas","nilai_angka","nilai_huruf","nilai_indeks"],wt=t=>{const r=D(t?.bobot_partisipatif),c=D(t?.bobot_proyek),u=D(t?.bobot_kuis),l=D(t?.bobot_tugas),A=D(t?.bobot_uts),C=D(t?.bobot_uas);return[{key:"aktivitas_partisipatif",weight:r??U.aktivitas_partisipatif},{key:"hasil_proyek",weight:c??U.hasil_proyek},{key:"quiz",weight:u??U.quiz},{key:"tugas",weight:l??U.tugas},{key:"uts",weight:A??U.uts},{key:"uas",weight:C??U.uas}]},Ze=t=>t==null?{huruf:"",indeks:0}:t>=80?{huruf:"A",indeks:4}:t>=75?{huruf:"AB",indeks:3.5}:t>=70?{huruf:"B",indeks:3}:t>=65?{huruf:"BC",indeks:2.5}:t>=60?{huruf:"C",indeks:2}:t>=55?{huruf:"CD",indeks:1.5}:t>=40?{huruf:"D",indeks:1}:{huruf:"E",indeks:0},et=(t,r)=>{let c=0,u=0,l=!1;return(r??wt()).forEach(({key:C,weight:T})=>{const w=t[C],G=se(w);G!==null&&(u+=G*T,c+=T,l=!0)}),!l||c===0?null:parseFloat((u/c).toFixed(2))},vt=(t,r,c)=>t.id&&t.id>0?`id:${t.id}`:t.krs_id?`krs:${typeof t.krs_id=="object"?t.krs_id.Int32:t.krs_id}`:r?`krs:${r}`:`nim:${c}`,Ns=({classId:t,meetingIds:r,attendanceMap:c,isEditing:u})=>{const l=Ae(),A=i.useRef(!1),[C,T]=i.useState({}),[w,G]=i.useState({}),[q,L]=i.useState(new Set),[n,k]=i.useState({}),[ee,E]=i.useState({}),[g,_]=i.useState(null),[oe,te]=i.useState(null),h=ls(),v=cs(),N=i.useCallback(()=>{if(A.current)return;const P={};Object.values(c).forEach(W=>{W.forEach(V=>{const K=ne(V.status_kehadiran);P[`${V.nim}-${V.id_pertemuan}`]=Ke(K,Ie)})}),G(P),u||E(c)},[c,u]),O=i.useCallback(()=>{const P=new Set;Object.entries(n).forEach(([W,V])=>{const K=w[W]??"";Ke(K,Ie)!==Ke(V,Ie)&&P.add(W)}),L(P)},[n,w]),z=i.useCallback((P,W)=>{const[V,K]=P.split("-"),Q=Number(K),be=["class-attendances",t,r];l.setQueryData(be,de=>{const d={...de||{}},p=[...d[Q]||[]],S=p.findIndex(b=>b.nim===V);return S>=0?p[S]={...p[S],status_kehadiran:W}:p.push({id:-Date.now(),id_pertemuan:Q,nim:V,status_kehadiran:W}),d[Q]=p,d}),k(de=>({...de,[P]:W})),O()},[t,r,l,O]),j=i.useCallback(async(P=!1)=>{if(!u)return;const W=Object.entries(n);if(W.length){T(V=>{const K={...V};return W.forEach(([Q])=>K[Q]=!0),K});try{await Promise.all(W.map(async([K,Q])=>{const[be,de]=K.split("-"),d=Number(de),p=c[d]?.find(S=>S.nim===be);p&&p.id>0?await v.mutateAsync({id:p.id,data:{status_kehadiran:Q||void 0}}):await h.mutateAsync({id_pertemuan:d,nim:be,status_kehadiran:Q||void 0})}));const V={};await Promise.all(r.map(async K=>{const Q=await ue.getMeetingAttendances(K);V[K]=Q})),l.setQueryData(["class-attendances",t,r],V),E(V),A.current=!0,P||(k({}),L(new Set),_(null))}finally{T({})}}},[u,n,c,r,v,h,l,t]),I=i.useCallback(()=>{E(c),k({}),L(new Set),_(null),te(null)},[c]),le=i.useCallback(()=>{const P=["class-attendances",t,r];A.current?A.current=!1:l.setQueryData(P,ee),k({}),L(new Set),_(null),te(null)},[t,r,l,ee]),R=i.useMemo(()=>q.size>0,[q]);return{savingCells:C,initialAttendanceSnapshot:w,modifiedCells:q,pendingStatusChanges:n,activeCell:g,currentShortcutStatus:oe,hasUnsavedChanges:R,setActiveCell:_,setCurrentShortcutStatus:te,setPendingStatusChanges:k,buildInitialSnapshot:N,updateSingleCell:z,commitAttendanceChanges:j,enterEditMode:I,exitEditMode:le,recalcModified:O}},ws=({classIdNum:t,meetings:r})=>{const c=Ae(),[u,l]=i.useState({}),[A,C]=i.useState({}),[T,w]=i.useState({}),[G,q]=i.useState({}),[L,n]=i.useState({}),k=ds(),ee=i.useCallback((h,v,N,O,z,j)=>{l(I=>({...I,[h]:v||""})),C(I=>({...I,[h]:N||""})),w(I=>({...I,[h]:O||""})),q(I=>({...I,[h]:z||""})),n(I=>({...I,[h]:j}))},[]),E=i.useCallback(h=>{l(v=>{const N={...v};return delete N[h],N}),C(v=>{const N={...v};return delete N[h],N}),w(v=>{const N={...v};return delete N[h],N}),q(v=>{const N={...v};return delete N[h],N}),n(v=>{const N={...v};return delete N[h],N})},[]),g=i.useCallback(async h=>{const v=u[h]??"",N=A[h]??"",O=T[h]??"",z=G[h]??"",j=L[h]??!1,I=N?`${N}T00:00:00.000Z`:void 0,le=O?`${O}:00`:void 0;await k.mutateAsync({id:h,data:{topik:v||void 0,tgl_pertemuan:I,jam_pertemuan:le,id_dosen:z||void 0,absensi_aktif:j}}),c.setQueryData(["class-meetings",t],R=>R&&R.map(P=>P.id===h?{...P,topik:v,tgl_pertemuan:I||P.tgl_pertemuan,jam_pertemuan:le||P.jam_pertemuan,id_dosen:z||P.id_dosen,absensi_aktif:j}:P)),E(h)},[u,A,T,G,L,k,c,t,E]),_=i.useCallback(()=>{const h={},v={},N={},O={},z={};r.forEach(j=>{h[j.id]=ne(j.topik),v[j.id]=Je(j.tgl_pertemuan),N[j.id]=Ne(j.jam_pertemuan),O[j.id]=ne(j.id_dosen);let I=!1;j.absensi_aktif!==null&&j.absensi_aktif!==void 0&&(typeof j.absensi_aktif=="boolean"?I=j.absensi_aktif:typeof j.absensi_aktif=="object"&&"Bool"in j.absensi_aktif&&(I=j.absensi_aktif.Valid?j.absensi_aktif.Bool:!1)),z[j.id]=I}),l(h),C(v),w(N),q(O),n(z)},[r]),oe=i.useCallback(()=>{l({}),C({}),w({}),q({}),n({})},[]),te=i.useMemo(()=>{for(const h of r){const v=h.id,N=u[v]??"",O=ne(h.topik);if(N!==O)return!0;const z=A[v]??"",j=Je(h.tgl_pertemuan);if(z!==j)return!0;const I=T[v]??"",le=Ne(h.jam_pertemuan);if(I!==le)return!0;const R=G[v]??"",P=ne(h.id_dosen);if(R!==P)return!0;const W=L[v]??!1;let V=!1;if(h.absensi_aktif!==null&&h.absensi_aktif!==void 0&&(typeof h.absensi_aktif=="boolean"?V=h.absensi_aktif:typeof h.absensi_aktif=="object"&&"Bool"in h.absensi_aktif&&(V=h.absensi_aktif.Valid?h.absensi_aktif.Bool:!1)),W!==V)return!0}return!1},[r,u,A,T,G,L]);return{editedTopics:u,editedDates:A,editedTimes:T,editedLecturers:G,editedAbsensiAktif:L,hasUnsavedChanges:te,setEditedTopics:l,setEditedDates:C,setEditedTimes:w,setEditedLecturers:q,setEditedAbsensiAktif:n,startEditTopic:ee,cancelEditTopic:E,saveTopic:g,enterEditMode:_,exitEditMode:oe}},vs=({classIdNum:t,classId:r,students:c,gradeRecords:u,classData:l})=>{const A=Ae(),[C,T]=i.useState({}),[w,G]=i.useState(new Set),[q,L]=i.useState(new Set),[n,k]=i.useState({}),[ee,E]=i.useState(!1),[g,_]=i.useState(null),[oe,te]=i.useState(!1),h=ys(),v=gs(),N=i.useMemo(()=>{const d=n.bobot_partisipatif??D(l?.bobot_partisipatif),p=n.bobot_proyek??D(l?.bobot_proyek),S=n.bobot_kuis??D(l?.bobot_kuis),b=n.bobot_tugas??D(l?.bobot_tugas),y=n.bobot_uts??D(l?.bobot_uts),F=n.bobot_uas??D(l?.bobot_uas);return{aktivitas_partisipatif:d??U.aktivitas_partisipatif,hasil_proyek:p??U.hasil_proyek,quiz:S??U.quiz,tugas:b??U.tugas,uts:y??U.uts,uas:F??U.uas}},[l,n]),O=i.useMemo(()=>{const d={bobot_partisipatif:n.bobot_partisipatif??D(l?.bobot_partisipatif),bobot_proyek:n.bobot_proyek??D(l?.bobot_proyek),bobot_kuis:n.bobot_kuis??D(l?.bobot_kuis),bobot_tugas:n.bobot_tugas??D(l?.bobot_tugas),bobot_uts:n.bobot_uts??D(l?.bobot_uts),bobot_uas:n.bobot_uas??D(l?.bobot_uas)};return wt(d)},[l,n]),z=i.useMemo(()=>({bobot_partisipatif:D(l?.bobot_partisipatif)??U.aktivitas_partisipatif,bobot_proyek:D(l?.bobot_proyek)??U.hasil_proyek,bobot_kuis:D(l?.bobot_kuis)??U.quiz,bobot_tugas:D(l?.bobot_tugas)??U.tugas,bobot_uts:D(l?.bobot_uts)??U.uts,bobot_uas:D(l?.bobot_uas)??U.uas}),[l]),j=i.useMemo(()=>_s.some(d=>{const p=n[d];return p===void 0?!1:p!==z[d]}),[n,z]),I=i.useCallback(d=>{const p=u,S=d?.nim??d?.krs?.nim??d?.student?.nim??"";let b;if(b=p.find(F=>F.student?.nim===S||F.krs?.student?.nim===S||F.krs?.nim===S),b)return b;const y=we(d);return y!==null&&(b=u.find(F=>{const Y=se(F.krs_id);return Y!==null&&Y===y}),b)||(b=p.find(F=>Object.values(F).some(Y=>typeof Y=="string"&&Y===S)),b)?b:{id:0,krs_id:null,aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null}},[u]),le=i.useCallback(async(d,p,S)=>{const b=p?.id&&p.id>0?p.id:null;b&&G(y=>new Set([...y,b]));try{const y=C[d];if(!y)return;if(!["aktivitas_partisipatif","hasil_proyek","quiz","tugas","uts","uas"].some(J=>{const re=se(p[J]),Pe=se(y[J]);return re!==Pe})){L(J=>new Set([...J,d])),b&&G(J=>new Set([...J].filter(re=>re!==b)));return}const pe=et(y,O),fe=pe!==null?pe:se(y.nilai_angka);let ve,Se;if(fe!==null){const{huruf:J,indeks:re}=Ze(fe);ve=J,Se=re}const ge={aktivitas_partisipatif:se(y.aktivitas_partisipatif)??void 0,hasil_proyek:se(y.hasil_proyek)??void 0,quiz:se(y.quiz)??void 0,tugas:se(y.tugas)??void 0,uts:se(y.uts)??void 0,uas:se(y.uas)??void 0,nilai_angka:fe??void 0,nilai_huruf:ve,nilai_indeks:Se};if(p.id&&p.id>0)await h.mutateAsync({id:p.id,data:ge});else if(p.krs_id){const J=se(p.krs_id);await v.mutateAsync({krs_id:Number(J),...ge})}else{const re=we(S)??se(y?.krs_id);if(re)await v.mutateAsync({krs_id:Number(re),...ge});else throw new Error("Missing KRS id for grade creation")}T(J=>{const re={...J};return delete re[d],re}),L(J=>new Set([...J,d]))}catch(y){throw y}finally{b&&G(y=>new Set([...y].filter(F=>F!==b)))}},[C,O,h,v]),R=i.useCallback((d,p,S)=>{T(b=>{const y={...b[d],[p]:S===""?null:S};if(O.some(Y=>Y.key===p)){const Y=et(y,O);if(Y!==null){const{huruf:pe,indeks:fe}=Ze(Y);y.nilai_angka=Y,y.nilai_huruf=pe,y.nilai_indeks=fe}else y.nilai_angka=null,y.nilai_huruf=null,y.nilai_indeks=null}return{...b,[d]:y}})},[O]),P=i.useCallback((d,p)=>{const S=p===""?void 0:parseFloat(p);k(b=>({...b,[d]:S})),_(null)},[]),W=i.useCallback(()=>{k({}),_(null),te(!0)},[]),V=i.useCallback(()=>{te(!1)},[]),K=i.useCallback(async()=>{try{E(!0),_(null);const d={bobot_partisipatif:n.bobot_partisipatif??N.aktivitas_partisipatif,bobot_proyek:n.bobot_proyek??N.hasil_proyek,bobot_kuis:n.bobot_kuis??N.quiz,bobot_tugas:n.bobot_tugas??N.tugas,bobot_uts:n.bobot_uts??N.uts,bobot_uas:n.bobot_uas??N.uas},p=d.bobot_partisipatif+d.bobot_proyek+d.bobot_kuis+d.bobot_tugas+d.bobot_uts+d.bobot_uas;return Math.abs(p-100)>.01?(_(`Total must be 100%. Current total: ${p.toFixed(1)}%`),!1):(await ue.updateClass(t,d),await A.invalidateQueries({queryKey:["class",r]}),k({}),te(!0),!0)}catch(d){return console.error("[BOBOTS] ❌ Failed to save bobot values:",d),_(d instanceof Error?d.message:"Failed to save grade weights"),!1}finally{E(!1)}},[n,N,t,A,r]),Q=i.useCallback(()=>{const d={};c.forEach(p=>{const S=I(p)||{},b=we(p),y=p?.nim??p?.krs?.nim??p?.student?.nim??"",F=vt(S,b,y);d[F]=S}),T(d)},[c,I]),be=i.useCallback(()=>{T({}),L(new Set),k({}),_(null),te(!1)},[]),de=i.useMemo(()=>{for(const[d,p]of Object.entries(C)){let S=null;if(d.startsWith("id:")){const b=Number(d.split(":")[1]);S=u.find(y=>y.id===b)??null}else if(d.startsWith("krs:")){const b=Number(d.split(":")[1]);S=u.find(y=>{const F=se(y.krs_id);return F!==null&&F===b})??null}else if(d.startsWith("nim:")){const b=d.split(":")[1];S=u.find(F=>F.student?.nim===b||F.krs?.student?.nim===b||F.krs?.nim===b)??null}if(!S){if(Object.values(p).some(b=>b!=null&&b!==""))return!0;continue}for(const b of js){const y=kt(p[b]),F=kt(S[b]);if(y!==F)return!0}}return!!j},[C,u,j]);return{editedGrades:C,savingGradeIds:w,completedGradeKeys:q,editedBobots:n,isSavingBobots:ee,bobotError:g,isBobotCompleted:oe,gradeWeights:N,gradeComponents:O,hasEditedBobots:j,hasUnsavedChanges:de,setEditedGrades:T,setCompletedGradeKeys:L,findGradeForStudent:I,saveGrade:le,updateGradeField:R,handleBobotChange:P,cancelBobots:W,enableBobotEditing:V,saveBobots:K,enterEditMode:Q,exitEditMode:be}},Ss=async t=>{try{const[{default:r},{default:c}]=await Promise.all([Ye(()=>import("./html2canvas-pro.esm-BvaDPKdU.js"),[]),Ye(()=>import("./jspdf.es.min-2pqXIzBy.js").then(L=>L.j),__vite__mapDeps([0,1,2]))]),u=await r(t,{scale:1.5,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),l=210,A=297,C=u.height*l/u.width;let T=C;const w=new c("p","mm","a4");let G=0;const q=u.toDataURL("image/jpeg",.85);for(w.addImage(q,"JPEG",0,G,l,C),T-=A;T>0;)G=T-C,w.addPage(),w.addImage(q,"JPEG",0,G,l,C),T-=A;return w}catch(r){throw console.error("Error generating PDF:",r),new Error("Failed to generate PDF. Please try again.")}},Cs=async t=>{try{const r=await Ye(()=>import("./xlsx-DGuHH-KN.js"),[]),c=r.utils.book_new(),u=[["Class Summary Report"],[],["Course Code",t.courseCode],["Course Name",t.courseName],["Class",t.className],["Total SKS",t.totalSks],["Lecturers",t.lecturerNames.join(", ")],["Total Students",t.students.length],["Total Meetings",t.sortedMeetings.length],["Generated Date",new Date().toLocaleDateString("id-ID")]],l=r.utils.aoa_to_sheet(u);l["!cols"]=[{wch:20},{wch:40}],r.utils.book_append_sheet(c,l,"Class Description");const C=[["NIM","Name",...t.sortedMeetings.map(k=>`P${k.pertemuan_ke}`)]];t.students.forEach(k=>{const ee=t.attendanceLookup[k.nim]||{},E=[k.nim,k.nama];t.sortedMeetings.forEach(g=>{const _=ee[g.id]||"";E.push(_||"-")}),C.push(E)});const T=r.utils.aoa_to_sheet(C);T["!cols"]=[{wch:15},{wch:25},...t.sortedMeetings.map(()=>({wch:12}))],r.utils.book_append_sheet(c,T,"Attendance Overview");const w=[["Meeting","Date","Time","Lecturers","Topic"],...t.sortedMeetings.map(k=>{const ee=k.tgl_pertemuan&&(typeof k.tgl_pertemuan=="string"||typeof k.tgl_pertemuan=="object"&&"Valid"in k.tgl_pertemuan&&k.tgl_pertemuan.Valid);let E="";k.topik&&(typeof k.topik=="string"?E=k.topik:"String"in k.topik&&k.topik.Valid&&(E=k.topik.String));const g=ne(k.id_dosen),_=g&&t.lecturerLookup[g]?t.lecturerLookup[g]:"-";return[`P${k.pertemuan_ke}`,ee?jt(k.tgl_pertemuan):"-",Nt(k.jam_pertemuan),_,E||"-"]})],G=r.utils.aoa_to_sheet(w);G["!cols"]=[{wch:15},{wch:20},{wch:12},{wch:25},{wch:40}],r.utils.book_append_sheet(c,G,"Meeting Summary");const L=[["NIM","Name","Participation","Project","Quiz","Assignment","Midterm","Final","Numeric Grade","Letter Grade","Grade Index"]];t.students.forEach(k=>{const ee=t.findGradeForStudent(k)||{aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null},E=g=>{const _=ee[g];return _==null?"":typeof _=="object"&&"Float64"in _?_.Valid?_.Float64:"":typeof _=="object"&&"String"in _?_.Valid?_.String:"":typeof _=="object"&&"Int32"in _?_.Valid?_.Int32:"":typeof _=="number"||typeof _=="string"?_:""};L.push([k.nim,k.nama,(()=>{const g=E("aktivitas_partisipatif");return g!==""?g:"-"})(),(()=>{const g=E("hasil_proyek");return g!==""?g:"-"})(),(()=>{const g=E("quiz");return g!==""?g:"-"})(),(()=>{const g=E("tugas");return g!==""?g:"-"})(),(()=>{const g=E("uts");return g!==""?g:"-"})(),(()=>{const g=E("uas");return g!==""?g:"-"})(),(()=>{const g=E("nilai_angka");return g!==""?g:"-"})(),(()=>{const g=E("nilai_huruf");return g!==""?g:"-"})(),(()=>{const g=E("nilai_indeks");return g!==""?g:"-"})()])}),L.push(["Component Weights","",`${t.gradeWeights.aktivitas_partisipatif}%`,`${t.gradeWeights.hasil_proyek}%`,`${t.gradeWeights.quiz}%`,`${t.gradeWeights.tugas}%`,`${t.gradeWeights.uts}%`,`${t.gradeWeights.uas}%`,"Total: 100%","",""]);const n=r.utils.aoa_to_sheet(L);return n["!cols"]=[{wch:15},{wch:25},{wch:13},{wch:10},{wch:8},{wch:12},{wch:10},{wch:8},{wch:13},{wch:12},{wch:11}],r.utils.book_append_sheet(c,n,"Grades Overview"),{workbook:c,XLSX:r}}catch(r){throw console.error("Error generating XLSX:",r),new Error("Failed to generate XLSX. Please try again.")}},Es=async(t,r,c)=>{const u=await Ss(t),l=`Class_Summary_${r}_${c.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;u.save(l)},As=async t=>{const{workbook:r,XLSX:c}=await Cs(t),u=`Class_Summary_${t.className}_${t.courseName.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.xlsx`;c.writeFile(r,u)},Gs=()=>{const{classId:t}=ns(),[r]=is(),c=os(),u=i.useRef(null),[l,A]=i.useState(!1),[C,T]=i.useState(!1),[w,G]=i.useState(!1),[q,L]=i.useState(!1),[n,k]=i.useState(!1),[ee,E]=i.useState(!1),g=r.get("className")||"",_=r.get("courseName")||"",oe=r.get("courseCode")||"",te=r.get("from")||"dashboard",h=parseInt(r.get("sksTatapMuka")||"0",10),v=parseInt(r.get("sksPraktek")||"0",10),N=parseInt(r.get("sksPrakLapangan")||"0",10),O=parseInt(r.get("sksSimulasi")||"0",10),z=Number(t),{data:j=[],isLoading:I,error:le}=us(z),{data:R=[],isLoading:P,error:W}=bs(z),{data:V=[],isLoading:K}=ms({kelas_id:z}),{data:Q=[],isLoading:be}=ps({id_kelas:String(t)}),{data:de,isLoading:d}=Qe({queryKey:["class",t],queryFn:()=>ue.getClassById(z),enabled:!!t}),p=i.useMemo(()=>{const s=new Set;return Q.forEach(o=>{const x=ne(o.id_dosen);x&&s.add(x)}),Array.from(s)},[Q]),S=as({queries:p.map(s=>({queryKey:["lecturer",s],queryFn:()=>ue.getLecturerByID(s),enabled:!!s}))}),b=i.useMemo(()=>{const s={};return S.forEach(o=>{const x=o.data;x?.id&&x?.nama_dosen&&(s[x.id]=x.nama_dosen)}),s},[S]),y=h+v+N+O,F=i.useMemo(()=>Q.map(s=>{const o=ne(s.id_dosen);return o?b[o]||o:null}).filter(Boolean),[Q,b]),Y=i.useMemo(()=>j.map(s=>s.id),[j]),{data:pe={},isLoading:fe}=Qe({queryKey:["class-attendances",t,Y],queryFn:async()=>{const s={};return await Promise.all(Y.map(async o=>{const x=await ue.getMeetingAttendances(o);s[o]=x})),s},enabled:Y.length>0}),ve=Ns({classId:t,meetingIds:Y,attendanceMap:pe,isEditing:w}),Se=ws({classIdNum:z,meetings:j}),ge=vs({classIdNum:z,classId:t,students:R,gradeRecords:V,classData:de}),{savingCells:J,modifiedCells:re,pendingStatusChanges:Pe,activeCell:tt,currentShortcutStatus:ie,setActiveCell:st,setCurrentShortcutStatus:ce,updateSingleCell:rt,commitAttendanceChanges:St,enterEditMode:Ct,exitEditMode:Et}=ve,{editedTopics:he,editedDates:At,editedTimes:Tt,editedLecturers:Ft,editedAbsensiAktif:Mt,setEditedTopics:$e,setEditedDates:Ge,setEditedTimes:Le,setEditedLecturers:De,setEditedAbsensiAktif:Ve,startEditTopic:It,cancelEditTopic:Pt,saveTopic:at}=Se,{editedGrades:Be,savingGradeIds:$t,completedGradeKeys:Gt,isSavingBobots:qe,bobotError:nt,isBobotCompleted:Lt,gradeWeights:H,gradeComponents:Dt,hasEditedBobots:Vt,setEditedGrades:Te,setCompletedGradeKeys:it,findGradeForStudent:me,saveGrade:ot,updateGradeField:ye,handleBobotChange:ke,cancelBobots:Bt,enableBobotEditing:qt,saveBobots:lt,exitEditMode:Ot}=ge,zt=S.some(s=>s.isLoading),Oe=I||P||fe||be||K||d||zt,ze=le||W,Rt=w||q||n,Fe=i.useMemo(()=>{const s=o=>{if(!o)return Number.POSITIVE_INFINITY;if(typeof o=="string"){const x=Date.parse(o);return isNaN(x)?Number.POSITIVE_INFINITY:x}if("Valid"in o){if(!o.Valid)return Number.POSITIVE_INFINITY;const x=Date.parse(o.Time);return isNaN(x)?Number.POSITIVE_INFINITY:x}return Number.POSITIVE_INFINITY};return[...j].sort((o,x)=>{const X=o.pertemuan_ke-x.pertemuan_ke;return X!==0?X:s(o.tgl_pertemuan)-s(x.tgl_pertemuan)})},[j]),ct=i.useMemo(()=>{const s={};return Object.values(pe).forEach(o=>{o.forEach(x=>{s[x.nim]||(s[x.nim]={});const X=ne(x.status_kehadiran);s[x.nim][x.id_pertemuan]=X})}),s},[pe]),Xt=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return e.jsx(_e,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(Xe,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(je,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(We,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(_e,{className:"h-4 w-4 text-purple-600"});case"alpa":case"alfa":case"absent":return e.jsx(He,{className:"h-4 w-4 text-red-600"});default:return e.jsx(Ue,{className:"h-4 w-4 text-gray-300"})}},Ht=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return"bg-green-50 text-green-700";case"izin":case"excused":return"bg-blue-50 text-blue-700";case"sakit":case"sick":return"bg-yellow-50 text-yellow-700";case"terlambat":case"late":return"bg-orange-50 text-orange-700";case"pengganti":case"substitute":return"bg-purple-50 text-purple-700";case"alpa":case"alfa":case"absent":return"bg-red-50 text-red-700";default:return"bg-gray-50 text-gray-400"}};i.useEffect(()=>{if(!w)return;const s=o=>{yt[o.key]?(o.preventDefault(),ce(yt[o.key])):o.key==="Escape"&&ce(null)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[w,ce]);const Wt=ve.hasUnsavedChanges||Se.hasUnsavedChanges||ge.hasUnsavedChanges,Ut=()=>{Ct(),G(!0)},dt=()=>{Et(),G(!1)},Kt=()=>{const s={},o={},x={},X={},a={};j.forEach(m=>{s[m.id]=ne(m.topik),o[m.id]=Je(m.tgl_pertemuan),x[m.id]=Ne(m.jam_pertemuan),X[m.id]=ne(m.id_dosen);let B=!1;m.absensi_aktif!==null&&m.absensi_aktif!==void 0&&(typeof m.absensi_aktif=="boolean"?B=m.absensi_aktif:typeof m.absensi_aktif=="object"&&"Bool"in m.absensi_aktif&&(B=m.absensi_aktif.Valid?m.absensi_aktif.Bool:!1)),a[m.id]=B}),$e(s),Ge(o),Le(x),De(X),Ve(a),L(!0)},ut=()=>{$e({}),Ge({}),Le({}),De({}),Ve({}),L(!1)},Qt=()=>{const s={};R.forEach(o=>{const x=me(o)||{},X=we(o),a=vt(x,X,o.nim);s[a]=x}),Te(s),k(!0)},bt=()=>{Ot(),k(!1)},pt=()=>{dt(),ut(),bt()},Yt=async()=>{E(!0);try{const s=q?Object.keys(he).map(a=>Number(a)).filter(a=>!Number.isNaN(a)).map(a=>at(a)):[];let o=!0;if(n&&Vt&&(o=await lt(),!o))throw new Error("Failed to save grade weights");const x=n?Object.entries(Be).map(([a])=>{let m;if(a.startsWith("nim:")){const Z=a.substring(4);m=R.find(ae=>ae.nim===Z)}else if(a.startsWith("krs:")){const Z=Number(a.substring(4));m=R.find(ae=>we(ae)===Z)}else if(a.startsWith("id:")){const Z=Number(a.substring(3));m=R.find(ae=>me(ae)?.id===Z)}const B=m?me(m):Be[a];return ot(a,B,m)}):[],X=w?St(!0):Promise.resolve();await Promise.all([Promise.all(s),Promise.all(x),X]),Zt()}catch(s){alert(s instanceof Error?s.message:"Failed to save changes")}finally{E(!1)}},Jt=()=>{c(-1)},Zt=()=>{pt()},es=async()=>{if(u.current){(window.React?.startTransition||(s=>s()))(()=>{A(!0)}),await new Promise(s=>setTimeout(s,0));try{await Es(u.current,g,_)}catch(s){console.error("Error generating PDF:",s),alert("Failed to generate PDF. Please try again.")}finally{A(!1)}}},ts=async()=>{T(!0);try{await As({className:g,courseName:_,courseCode:oe,totalSks:y,lecturerNames:F,students:R.map(s=>({nim:s.nim,nama:s.nama})),sortedMeetings:Fe,attendanceLookup:ct,gradeRecords:V,gradeWeights:H,lecturerLookup:b,findGradeForStudent:me})}catch(s){console.error("Error generating XLSX:",s),alert("Failed to generate XLSX. Please try again.")}finally{T(!1)}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("nav",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>c(`/${te}`),className:"flex items-center hover:text-gray-900 transition-colors",children:e.jsx(xs,{className:"h-4 w-4"})}),e.jsx(gt,{className:"h-4 w-4"}),e.jsx("button",{onClick:Jt,className:"hover:text-gray-900 transition-colors",children:te==="lecturer/class-schedule"?"Class Schedule":te==="admin/class-management"?"Class Management":"Dashboard"}),e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Class Summary"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>w?dt():Ut(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${w?"bg-blue-600 text-white":""}`,children:w?"Stop Attendance Editing":"Edit Attendance"}),e.jsx("button",{onClick:()=>q?ut():Kt(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${q?"bg-blue-600 text-white":""}`,children:q?"Stop Meeting Editing":"Edit Meetings"}),e.jsx("button",{onClick:()=>n?bt():Qt(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${n?"bg-blue-600 text-white":""}`,children:n?"Stop Grades Editing":"Edit Grades"}),Rt&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Yt,className:"btn-primary",disabled:ee||!Wt,children:"Save & Finish"}),e.jsx("button",{onClick:()=>pt(),className:"btn-secondary",children:"Cancel"})]})]}),w&&e.jsxs("div",{className:"text-xs text-gray-600 flex flex-col gap-3 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Status Brush:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a status with buttons below or use keyboard shortcuts (1..6), then click cells to apply. Press Esc to clear."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>ce("Hadir"),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie==="Hadir"?"bg-green-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 1",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"1 - Hadir"})]}),e.jsxs("button",{onClick:()=>ce("Izin"),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie==="Izin"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 2",children:[e.jsx(Xe,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"2 - Izin"})]}),e.jsxs("button",{onClick:()=>ce("Sakit"),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie==="Sakit"?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 3",children:[e.jsx(je,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"3 - Sakit"})]}),e.jsxs("button",{onClick:()=>ce("Alfa"),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie==="Alfa"?"bg-red-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 4",children:[e.jsx(He,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"4 - Alfa"})]}),e.jsxs("button",{onClick:()=>ce("Terlambat"),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie==="Terlambat"?"bg-orange-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 5",children:[e.jsx(We,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"5 - Terlambat"})]}),e.jsxs("button",{onClick:()=>ce("Pengganti"),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie==="Pengganti"?"bg-purple-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 6",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"6 - Pengganti"})]}),e.jsxs("button",{onClick:()=>ce(null),className:`px-3 py-1 rounded text-xs font-medium transition-all flex items-center gap-1.5 ${ie===null?"bg-gray-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press Esc",children:[e.jsx(Ue,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Clear Brush"})]})]}),e.jsxs("div",{className:"text-xs text-gray-700 bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"font-medium",children:"Current: "}),e.jsx("span",{className:"font-semibold",children:ie===null?"None":ie===""?"Kosong":ie})]})]}),e.jsx("button",{onClick:es,disabled:l||Oe,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate PDF Report"})]})}),e.jsx("button",{onClick:ts,disabled:C||Oe,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:C?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating XLSX..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(hs,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate XLSX Report"})]})})]}),e.jsxs("div",{ref:u,className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 pt-6 pb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Summary"}),e.jsxs("p",{className:"text-base text-gray-600 mt-1",children:[oe&&e.jsx("span",{className:"font-medium",children:oe}),oe&&" - ",_," - Class ",g,y>0&&` (${y} SKS)`]}),F.length>0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:F.join(", ")})]})}),e.jsx("div",{children:Oe?e.jsxs("div",{className:"flex items-center justify-center py-12 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(Me,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading attendance data..."})]}):ze?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[e.jsx(je,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading attendance data"}),e.jsx("p",{className:"text-sm text-red-600",children:ze instanceof Error?ze.message:"Unknown error"})]})]}):j.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(je,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No meetings scheduled for this class"})]}):R.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(je,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No students enrolled in this class"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attendance Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex gap-0",children:[e.jsx("div",{className:"flex-shrink-0 sticky left-0 z-10",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 align-top",children:e.jsx("div",{className:"min-h-[3.5rem] flex items-center",children:"NIM"})}),e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 align-top",children:e.jsx("div",{className:"min-h-[3.5rem] flex items-center",children:"Name"})})]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9",children:[e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900",children:s.nim}),e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate",children:s.nama})]},s.nim))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:Fe.map(s=>{const o=s.tgl_pertemuan&&(typeof s.tgl_pertemuan=="string"||typeof s.tgl_pertemuan=="object"&&"Valid"in s.tgl_pertemuan&&s.tgl_pertemuan.Valid);return e.jsx("th",{className:"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-14 align-top",children:e.jsxs("div",{className:"min-h-[3.5rem] flex flex-col items-center justify-center gap-0.5",children:[e.jsxs("span",{className:"font-bold text-[10px]",children:["P",s.pertemuan_ke]}),o&&e.jsx("span",{className:"text-gray-500 font-normal text-[9px] whitespace-pre-line",children:ks(s.tgl_pertemuan)})]})},s.id)})})}),e.jsx("tbody",{children:R.map(s=>{const o=ct[s.nim]||{};return e.jsx("tr",{className:"hover:bg-gray-50 h-9",children:Fe.map(x=>{const X=Pe[`${s.nim}-${x.id}`]??o[x.id]??"",a=`${s.nim}-${x.id}`,m=re.has(a),B=J[a];return e.jsx("td",{className:`border-r border-b border-gray-300 px-1 py-1.5 text-center ${Ht(X)} ${w?"cursor-pointer":""} ${m?"bg-yellow-50":""} ${tt===a?"outline outline-2 outline-blue-500":""}`,onClick:()=>{w&&(ie!==null?rt(a,ie):st(a))},children:w&&tt===a?e.jsxs("select",{autoFocus:!0,value:X,onChange:Z=>rt(a,Z.target.value),onBlur:()=>st(null),className:"text-[10px] px-1 py-0.5 bg-white border border-gray-300 rounded w-full",children:[e.jsx("option",{value:""}),Ie.slice(1).map(Z=>e.jsx("option",{value:Z,children:Z},Z))]}):B?e.jsx(Me,{className:"h-4 w-4 animate-spin text-gray-500 mx-auto"}):Xt(X)},x.id)})},s.nim)})})]})})]})})})]}),e.jsx("div",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-gray-600",children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Substitute"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ue,{className:"h-4 w-4 text-gray-300"}),e.jsx("span",{className:"text-gray-600",children:"No data"})]})]})}),e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Descriptions"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16",children:"Meeting"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-40",children:"Date"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-20",children:"Time"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48",children:"Lecturers"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Attendance"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Topic"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Realized Topic"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Meeting Notes"})]})}),e.jsx("tbody",{children:Fe.map(s=>{const o=s.tgl_pertemuan&&(typeof s.tgl_pertemuan=="string"||typeof s.tgl_pertemuan=="object"&&"Valid"in s.tgl_pertemuan&&s.tgl_pertemuan.Valid);let x="";s.topik&&(typeof s.topik=="string"?x=s.topik:"String"in s.topik&&s.topik.Valid&&(x=s.topik.String));const X=Tt[s.id]??Ne(s.jam_pertemuan);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"border-b border-gray-300 px-3 py-2 font-medium text-gray-900",children:["P",s.pertemuan_ke]}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:he[s.id]!==void 0?e.jsx("input",{type:"date",value:At[s.id]||(()=>{if(!o)return"";let a="";if(typeof s.tgl_pertemuan=="string"?a=s.tgl_pertemuan:typeof s.tgl_pertemuan=="object"&&s.tgl_pertemuan.Valid&&(a=s.tgl_pertemuan.Time),!a)return"";const m=new Date(a);return isNaN(m.getTime())?"":m.toISOString().slice(0,10)})(),onChange:a=>Ge(m=>({...m,[s.id]:a.target.value})),className:"input-field text-xs"}):o?jt(s.tgl_pertemuan):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:he[s.id]!==void 0?e.jsx("input",{type:"time",value:X||"",onChange:a=>Le(m=>({...m,[s.id]:a.target.value})),className:"input-field text-xs"}):Nt(s.jam_pertemuan)}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:he[s.id]!==void 0?e.jsxs("select",{value:Ft[s.id]||"",onChange:a=>De(m=>({...m,[s.id]:a.target.value})),className:"input-field text-xs w-full",children:[e.jsx("option",{value:"",children:"- No Lecturer -"}),p.map(a=>e.jsx("option",{value:a,children:b[a]||a},a))]}):(()=>{const a=ne(s.id_dosen);return a&&b[a]?b[a]:"-"})()}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-center",children:he[s.id]!==void 0?e.jsx("label",{className:"flex items-center justify-center gap-1",children:e.jsx("input",{type:"checkbox",checked:Mt[s.id]??!1,onChange:a=>Ve(m=>({...m,[s.id]:a.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}):(()=>{let a=!1;return s.absensi_aktif!==null&&s.absensi_aktif!==void 0&&(typeof s.absensi_aktif=="boolean"?a=s.absensi_aktif:typeof s.absensi_aktif=="object"&&"Bool"in s.absensi_aktif&&(a=s.absensi_aktif.Valid?s.absensi_aktif.Bool:!1)),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${a?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${a?"bg-green-600":"bg-gray-400"}`}),a?"Enabled":"Disabled"]})})()}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:q?he[s.id]!==void 0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:he[s.id],onChange:a=>$e(m=>({...m,[s.id]:a.target.value})),className:"input-field w-full text-xs",placeholder:"Enter topic/description"}),e.jsx("button",{onClick:()=>at(s.id),className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:"Save"}),e.jsx("button",{onClick:()=>Pt(s.id),className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate max-w-[28rem]",children:x||"-"}),e.jsx("button",{onClick:()=>{let a="";if(o){let $="";if(typeof s.tgl_pertemuan=="string"?$=s.tgl_pertemuan:typeof s.tgl_pertemuan=="object"&&s.tgl_pertemuan.Valid&&($=s.tgl_pertemuan.Time),$){const Ce=new Date($);isNaN(Ce.getTime())||(a=Ce.toISOString().slice(0,10))}}let m="";const B=Ne(s.jam_pertemuan);if(B){const $=B.split(":");$.length>=2&&(m=`${$[0].padStart(2,"0")}:${$[1].padStart(2,"0")}`)}const Z=ne(s.id_dosen);let ae=!1;s.absensi_aktif!==null&&s.absensi_aktif!==void 0&&(typeof s.absensi_aktif=="boolean"?ae=s.absensi_aktif:typeof s.absensi_aktif=="object"&&"Bool"in s.absensi_aktif&&(ae=s.absensi_aktif.Valid?s.absensi_aktif.Bool:!1)),It(s.id,x,a,m,Z,ae)},className:"px-2 py-1 text-xs rounded bg-primary-600 text-white hover:bg-primary-700",children:"Edit"})]}):e.jsx("span",{children:x||"-"})}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:(()=>{let a="";return s.realisasi_topik&&(typeof s.realisasi_topik=="string"?a=s.realisasi_topik:"String"in s.realisasi_topik&&s.realisasi_topik.Valid&&(a=s.realisasi_topik.String)),e.jsx("span",{children:a||"-"})})()}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:(()=>{let a="";return s.catatan_pertemuan&&(typeof s.catatan_pertemuan=="string"?a=s.catatan_pertemuan:"String"in s.catatan_pertemuan&&s.catatan_pertemuan.Valid&&(a=s.catatan_pertemuan.String)),e.jsx("span",{className:"max-w-sm break-words",children:a||"-"})})()})]},s.id)})})]})})]}),e.jsxs("div",{className:"px-6 py-3 pb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Grades Overview"})}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28",children:"NIM"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48",children:"Name"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Participation"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Project"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Quiz"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Assignment"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Midterm"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Final"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Numeric"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Letter"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),e.jsx("th",{className:`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20 ${n?"border-r":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Index"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),n&&e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-16",children:"Action"})]})}),e.jsxs("tbody",{children:[R.map(s=>{const o=me(s)||{id:0,krs_id:null,aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null},x=(()=>{if(typeof o.krs_id=="object"&&o.krs_id!==null&&"Int32"in o.krs_id){const f=o.krs_id;return f.Valid?f.Int32:null}return typeof o.krs_id=="number"?o.krs_id:o.krs_id??null})(),X=we(s),a=o.id&&o.id>0?`id:${o.id}`:x!=null?`krs:${x}`:X!==null?`krs:${X}`:`nim:${s.nim}`,m=Gt.has(a),B=n&&!m,Z=o.id?$t.has(o.id):!1,ae=Be[a]||o,$=f=>{const M=ae[f];return M==null?"":typeof M=="object"&&"Float64"in M?M.Valid?M.Float64:"":typeof M=="object"&&"String"in M?M.Valid?M.String:"":typeof M=="object"&&"Int32"in M?M.Valid?M.Int32:"":typeof M=="number"||typeof M=="string"?M:""},Ce=$("nilai_angka"),xe=Ce!==""?Ce:n&&ae?et(ae,Dt):null,Re=typeof xe=="string"?Number(xe):xe,{huruf:ss,indeks:rs}=Re!=null?Ze(Re):{huruf:"",indeks:0},xt=$("nilai_huruf"),ft=xt!==""?xt:ss,ht=$("nilai_indeks"),mt=ht!==""?ht:rs;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 font-medium text-gray-900 w-28",children:s.nim}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-gray-900 w-48",children:s.nama}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:$("aktivitas_partisipatif"),onChange:f=>ye(a,"aktivitas_partisipatif",f.target.value?parseFloat(f.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const f=$("aktivitas_partisipatif");return f!==""?f:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:$("hasil_proyek"),onChange:f=>ye(a,"hasil_proyek",f.target.value?parseFloat(f.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const f=$("hasil_proyek");return f!==""?f:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:$("quiz"),onChange:f=>ye(a,"quiz",f.target.value?parseFloat(f.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const f=$("quiz");return f!==""?f:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:$("tugas"),onChange:f=>ye(a,"tugas",f.target.value?parseFloat(f.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const f=$("tugas");return f!==""?f:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:$("uts"),onChange:f=>ye(a,"uts",f.target.value?parseFloat(f.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const f=$("uts");return f!==""?f:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:$("uas"),onChange:f=>ye(a,"uas",f.target.value?parseFloat(f.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const f=$("uas");return f!==""?f:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20",children:e.jsxs("div",{className:`px-2 py-1 rounded ${B?"bg-blue-50 text-blue-900":""}`,children:[e.jsx("span",{children:xe!==null&&xe!==""?xe:"-"}),B&&xe!==null&&xe!==""&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"✓"})]})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-bold text-blue-600 w-20",children:e.jsxs("div",{className:`px-2 py-1 rounded ${B?"bg-blue-50":""}`,children:[e.jsx("span",{children:ft||"-"}),B&&ft&&e.jsx("span",{className:"text-xs ml-1",children:"✓"})]})}),e.jsx("td",{className:`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20 ${n?"border-r":""}`,children:e.jsxs("div",{className:`px-2 py-1 rounded ${B?"bg-blue-50 text-blue-900":""}`,children:[e.jsx("span",{children:mt||"-"}),B&&mt&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"✓"})]})}),n&&e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-center",children:m?e.jsx("button",{onClick:()=>{it(M=>{const Ee=new Set(M);return Ee.delete(a),Ee});const f=me(s);f&&Te(M=>({...M,[a]:f}))},className:"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>ot(a,o,s),disabled:Z,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:Z?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{const f=me(s);Te(f?M=>({...M,[a]:f}):M=>{const Ee={...M};return delete Ee[a],Ee}),it(M=>new Set([...M,a]))},disabled:Z,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})})]},s.nim)}),e.jsxs("tr",{className:"bg-blue-50 font-bold",children:[e.jsxs("td",{colSpan:2,className:"border-r border-b border-gray-300 px-3 py-2 text-gray-900",children:["Component Weights",n&&e.jsx("div",{className:"text-xs font-normal text-gray-500 mt-1",children:"(Total must be 100%)"})]}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:n?e.jsx("input",{type:"text",value:H.aktivitas_partisipatif,onChange:s=>ke("bobot_partisipatif",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${H.aktivitas_partisipatif}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:n?e.jsx("input",{type:"text",value:H.hasil_proyek,onChange:s=>ke("bobot_proyek",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${H.hasil_proyek}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:n?e.jsx("input",{type:"text",value:H.quiz,onChange:s=>ke("bobot_kuis",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${H.quiz}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:n?e.jsx("input",{type:"text",value:H.tugas,onChange:s=>ke("bobot_tugas",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${H.tugas}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:n?e.jsx("input",{type:"text",value:H.uts,onChange:s=>ke("bobot_uts",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${H.uts}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:n?e.jsx("input",{type:"text",value:H.uas,onChange:s=>ke("bobot_uas",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${H.uas}%`}),e.jsxs("td",{colSpan:3,className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900",children:[e.jsxs("div",{className:"text-blue-600",children:["Total: ",(H.aktivitas_partisipatif+H.hasil_proyek+H.quiz+H.tugas+H.uts+H.uas).toFixed(1),"%"]}),nt&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:nt})]}),e.jsx("td",{className:`border-b border-gray-300 px-3 py-2 text-center ${n?"":"hidden"}`,children:n&&e.jsx(e.Fragment,{children:Lt?e.jsx("button",{onClick:()=>{qt()},className:"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>lt(),disabled:qe,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:qe?"Saving...":"Save"}),e.jsx("button",{onClick:Bt,disabled:qe,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})})})]})]})]})})})]})]})})]})]})};export{Gs as default};
//# sourceMappingURL=ClassSummary-BkR4oW0H.js.map
