{"version":3,"file":"AttendanceModal-Dh8-EeX1.js","sources":["../../src/components/shared/AttendanceModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Clock, Edit2, User } from 'lucide-react';\r\nimport type { Mahasiswa, SqlNullString } from '../../types';\r\nimport { extractString } from '../../utils/sqlNull';\r\nimport { getStatusDisplayLabel } from '@/utils';\r\nimport {\r\n  useClassStudents,\r\n  useMeetingAttendances,\r\n  useCreateAttendance,\r\n  useUpdateAttendance,\r\n  useUpdateMeeting,\r\n  useClassMeetings,\r\n} from '../../hooks/useAttendances';\r\nimport { useLecturerAssignments } from '../../hooks/useLecturerAssignments';\r\nimport { useQueries } from '@tanstack/react-query';\r\nimport { apiService } from '../../services/api';\r\n\r\ninterface AttendanceModalProps {\r\n  selectedMeeting: {\r\n    meetingId: number;\r\n    classId: number;\r\n    title: string;\r\n    subtitle: string;\r\n    dateLabel?: string;\r\n    meetingDateTime?: Date;\r\n    topic?: string;\r\n  } | null;\r\n  onClose: () => void;\r\n}\r\n\r\ntype NullableSqlStringLike = string | SqlNullString | { Time?: string; String?: string } | null | undefined;\r\n\r\nconst getStringValue = (value: NullableSqlStringLike, fallback = ''): string => {\r\n  if (!value) return fallback;\r\n  if (typeof value === 'string') return value;\r\n  if ('String' in value && typeof value.String === 'string') {\r\n    return value.String;\r\n  }\r\n  if ('Time' in value && typeof value.Time === 'string') {\r\n    return value.Time;\r\n  }\r\n  return extractString(value as SqlNullString, fallback);\r\n};\r\n\r\nconst AttendanceModal: React.FC<AttendanceModalProps> = ({ selectedMeeting, onClose }) => {\r\n  const { data: studentsRaw, isLoading: studentsLoading } = useClassStudents(\r\n    selectedMeeting?.classId\r\n  );\r\n  const { data: attendancesRaw, isLoading: attendancesLoading } = useMeetingAttendances(\r\n    selectedMeeting?.meetingId\r\n  );\r\n  const { data: meetingsData, refetch: refetchMeetings } = useClassMeetings(selectedMeeting?.classId);\r\n  const students = React.useMemo(() => studentsRaw ?? [], [studentsRaw]);\r\n  const attendances = React.useMemo(() => attendancesRaw ?? [], [attendancesRaw]);\r\n\r\n  // Fetch lecturer assignments for this class\r\n  const { data: lecturerAssignments = [] } = useLecturerAssignments({\r\n    id_kelas: selectedMeeting?.classId ? String(selectedMeeting.classId) : undefined,\r\n  });\r\n\r\n  // Extract unique lecturer IDs\r\n  const lecturerIds = React.useMemo(() => {\r\n    const idSet = new Set<string>();\r\n    lecturerAssignments.forEach((assignment) => {\r\n      const id = extractString(assignment.id_dosen as string | SqlNullString);\r\n      if (id) idSet.add(id);\r\n    });\r\n    return Array.from(idSet);\r\n  }, [lecturerAssignments]);\r\n\r\n  // Fetch lecturer details for all assigned lecturers\r\n  const lecturerQueryResults = useQueries({\r\n    queries: lecturerIds.map((id) => ({\r\n      queryKey: ['lecturer', id],\r\n      queryFn: () => apiService.getLecturerByID(id),\r\n      enabled: !!id,\r\n    })),\r\n  });\r\n\r\n  // Create lookup map for lecturer names\r\n  const lecturerLookup = React.useMemo(() => {\r\n    const lookup: Record<string, string> = {};\r\n    lecturerQueryResults.forEach((q) => {\r\n      const lecturer = q.data as { id: string; nama_dosen: string } | undefined;\r\n      if (lecturer?.id && lecturer?.nama_dosen) {\r\n        lookup[lecturer.id] = lecturer.nama_dosen;\r\n      }\r\n    });\r\n    return lookup;\r\n  }, [lecturerQueryResults]);\r\n\r\n  // Find the current meeting from the fetched meetings data to get updated values\r\n  const currentMeeting = React.useMemo(() => {\r\n    if (!selectedMeeting || !meetingsData || meetingsData.length === 0) return null;\r\n    const found = meetingsData.find(m => m.id === selectedMeeting.meetingId);\r\n    if (!found) return null;\r\n\r\n    // Parse the meeting date and time - handle both SqlNullString/SqlNullTime and plain strings\r\n    let tglPertemuan = '';\r\n    let jamPertemuan = '';\r\n    let topik = '';\r\n    let idDosen = '';\r\n\r\n    // Handle tgl_pertemuan (could be string, SqlNullTime with Time field, or object with String field)\r\n    tglPertemuan = getStringValue(found.tgl_pertemuan as NullableSqlStringLike, '');\r\n\r\n    // Handle jam_pertemuan\r\n    jamPertemuan = getStringValue(found.jam_pertemuan as NullableSqlStringLike, '');\r\n\r\n    // Handle topik\r\n    topik = getStringValue(found.topik as NullableSqlStringLike, '');\r\n\r\n    // Handle id_dosen\r\n    idDosen = getStringValue(found.id_dosen as NullableSqlStringLike, '');\r\n\r\n    console.log('üìÖ Meeting data from API:', { tglPertemuan, jamPertemuan, topik, idDosen, rawData: found.tgl_pertemuan });\r\n\r\n    let meetingDateTime: Date | undefined;\r\n    if (tglPertemuan && jamPertemuan) {\r\n      // Extract just the date part (YYYY-MM-DD) and time part (HH:MM:SS)\r\n      const datePart = tglPertemuan.includes('T') ? tglPertemuan.split('T')[0] : tglPertemuan.split(' ')[0] || tglPertemuan;\r\n      const timePart = jamPertemuan.length === 5 ? `${jamPertemuan}:00` : jamPertemuan.split('.')[0] || jamPertemuan;\r\n      const dateTimeStr = `${datePart}T${timePart}`;\r\n      meetingDateTime = new Date(dateTimeStr);\r\n      console.log('üìÖ Parsed meeting datetime:', dateTimeStr, '‚Üí', meetingDateTime);\r\n    } else {\r\n      console.warn('‚ö†Ô∏è Missing date or time:', { tglPertemuan, jamPertemuan });\r\n    }\r\n\r\n    return {\r\n      meetingDateTime,\r\n      topic: topik,\r\n      lecturerId: idDosen,\r\n    };\r\n  }, [selectedMeeting, meetingsData]);\r\n\r\n  const createAttendanceMutation = useCreateAttendance();\r\n  const updateAttendanceMutation = useUpdateAttendance();\r\n  const updateMeetingMutation = useUpdateMeeting();\r\n\r\n  const [editingStates, setEditingStates] = React.useState<Record<string, string>>({});\r\n  const [isBulkEditing, setIsBulkEditing] = React.useState(false);\r\n  const [isSavingAll, setIsSavingAll] = React.useState(false);\r\n  const [isEditingMeeting, setIsEditingMeeting] = React.useState(false);\r\n  const [editedMeetingDate, setEditedMeetingDate] = React.useState('');\r\n  const [editedMeetingTime, setEditedMeetingTime] = React.useState('');\r\n  const [editedMeetingTopic, setEditedMeetingTopic] = React.useState('');\r\n  const [editedMeetingLecturer, setEditedMeetingLecturer] = React.useState('');\r\n\r\n  const mergedAttendance: Array<Mahasiswa & { status: string; attendanceId?: number }> = React.useMemo(() => {\r\n    if (!students || students.length === 0) return [];\r\n    const attendanceByNim = new Map(\r\n      attendances.map((a) => [\r\n        a.nim,\r\n        {\r\n          status: extractString(a.status_kehadiran as string | SqlNullString | undefined | null, ''),\r\n          id: a.id,\r\n        },\r\n      ])\r\n    );\r\n    return students.map((s) => {\r\n      const record = attendanceByNim.get(s.nim);\r\n      return {\r\n        ...s,\r\n        status: record?.status || 'Belum Absen',\r\n        attendanceId: record?.id,\r\n      };\r\n    });\r\n  }, [students, attendances]);\r\n\r\n  // Check if the meeting is accessible (5 minutes before start time or later)\r\n  const isMeetingAccessible = React.useMemo(() => {\r\n    const meetingDateTime = currentMeeting?.meetingDateTime || selectedMeeting?.meetingDateTime;\r\n    if (!meetingDateTime) return false;\r\n\r\n    const now = new Date();\r\n    const meetingTime = new Date(meetingDateTime);\r\n    const fiveMinutesBeforeMeeting = new Date(meetingTime.getTime() - 5 * 60 * 1000);\r\n\r\n    return now >= fiveMinutesBeforeMeeting;\r\n  }, [currentMeeting?.meetingDateTime, selectedMeeting?.meetingDateTime]);\r\n\r\n  const handleStatusChange = async (nim: string, newStatus: string, attendanceId?: number) => {\r\n    if (!selectedMeeting) return;\r\n\r\n    const currentTime = new Date().toISOString();\r\n\r\n    try {\r\n      if (attendanceId) {\r\n        await updateAttendanceMutation.mutateAsync({\r\n          id: attendanceId,\r\n          data: {\r\n            status_kehadiran: newStatus,\r\n            waktu_masuk: currentTime\r\n          }\r\n        });\r\n      } else {\r\n        await createAttendanceMutation.mutateAsync({\r\n          id_pertemuan: selectedMeeting.meetingId,\r\n          nim,\r\n          status_kehadiran: newStatus,\r\n          waktu_masuk: currentTime\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update attendance:', error);\r\n      alert(`Failed to update attendance: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  };\r\n\r\n  const handleSaveAll = async () => {\r\n    if (!selectedMeeting || Object.keys(editingStates).length === 0) return;\r\n\r\n    setIsSavingAll(true);\r\n    const errors: string[] = [];\r\n\r\n    const currentTime = new Date().toISOString();\r\n\r\n    for (const nim of Object.keys(editingStates)) {\r\n      const newStatus = editingStates[nim];\r\n      const student = mergedAttendance.find(s => s.nim === nim);\r\n\r\n      if (!student) continue;\r\n\r\n      try {\r\n        if (student.attendanceId) {\r\n          await updateAttendanceMutation.mutateAsync({\r\n            id: student.attendanceId,\r\n            data: {\r\n              status_kehadiran: newStatus,\r\n              waktu_masuk: currentTime\r\n            }\r\n          });\r\n        } else {\r\n          await createAttendanceMutation.mutateAsync({\r\n            id_pertemuan: selectedMeeting.meetingId,\r\n            nim,\r\n            status_kehadiran: newStatus,\r\n            waktu_masuk: currentTime\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(`Failed to update attendance for ${nim}:`, error);\r\n        errors.push(`${student.nama} (${nim})`);\r\n      }\r\n    }\r\n\r\n    setIsSavingAll(false);\r\n\r\n    if (errors.length > 0) {\r\n      alert(`Failed to update attendance for: ${errors.join(', ')}`);\r\n    } else {\r\n      setEditingStates({});\r\n      setIsBulkEditing(false);\r\n    }\r\n  };\r\n\r\n  const handleEditAll = () => {\r\n    const allStates: Record<string, string> = {};\r\n    mergedAttendance.forEach(s => {\r\n      allStates[s.nim] = s.status === 'Belum Absen' ? 'Hadir' : (s.status || 'Hadir');\r\n    });\r\n    setEditingStates(allStates);\r\n    setIsBulkEditing(true);\r\n  };\r\n\r\n  const handleCancelAll = () => {\r\n    setEditingStates({});\r\n    setIsBulkEditing(false);\r\n  };\r\n\r\n  const handleUpdateMeeting = async () => {\r\n    if (!selectedMeeting || !editedMeetingDate || !editedMeetingTime) return;\r\n\r\n    try {\r\n      const timeWithSeconds = editedMeetingTime.length === 5 ? `${editedMeetingTime}:00` : editedMeetingTime;\r\n\r\n      console.log('üíæ Saving meeting update:', {\r\n        id: selectedMeeting.meetingId,\r\n        tgl_pertemuan: editedMeetingDate,\r\n        jam_pertemuan: timeWithSeconds,\r\n        topik: editedMeetingTopic || undefined,\r\n        id_dosen: editedMeetingLecturer || undefined,\r\n      });\r\n\r\n      await updateMeetingMutation.mutateAsync({\r\n        id: selectedMeeting.meetingId,\r\n        data: {\r\n          tgl_pertemuan: editedMeetingDate,\r\n          jam_pertemuan: timeWithSeconds,\r\n          topik: editedMeetingTopic || undefined,\r\n          id_dosen: editedMeetingLecturer || undefined,\r\n        }\r\n      });\r\n\r\n      console.log('‚úÖ Meeting saved, refetching data...');\r\n      // Manually refetch to ensure we get the latest data\r\n      await refetchMeetings();\r\n      console.log('‚úÖ Data refetched');\r\n\r\n      setIsEditingMeeting(false);\r\n      alert('Meeting schedule updated successfully!');\r\n    } catch (error) {\r\n      console.error('Failed to update meeting:', error);\r\n      alert(`Failed to update meeting: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  };\r\n\r\n  // Sync edit form values with currentMeeting (which updates from API after save)\r\n  React.useEffect(() => {\r\n    const meetingDateTime = currentMeeting?.meetingDateTime || selectedMeeting?.meetingDateTime;\r\n    const topic = currentMeeting?.topic || selectedMeeting?.topic || '';\r\n    const lecturerId = currentMeeting?.lecturerId || '';\r\n\r\n    if (meetingDateTime) {\r\n      const date = new Date(meetingDateTime);\r\n      const dateStr = date.toISOString().split('T')[0];\r\n      const timeStr = `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\r\n\r\n      setEditedMeetingDate(dateStr);\r\n      setEditedMeetingTime(timeStr);\r\n      setEditedMeetingTopic(topic);\r\n      setEditedMeetingLecturer(lecturerId);\r\n    }\r\n  }, [currentMeeting?.meetingDateTime, currentMeeting?.topic, currentMeeting?.lecturerId, selectedMeeting?.meetingDateTime, selectedMeeting?.topic]);\r\n\r\n  const handleStartEditMeeting = () => {\r\n    setIsEditingMeeting(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setEditingStates({});\r\n    setIsBulkEditing(false);\r\n    setIsEditingMeeting(false);\r\n    onClose();\r\n  };\r\n\r\n  // Compute current date label from fresh meeting data\r\n  const displayDateTime = currentMeeting?.meetingDateTime || selectedMeeting?.meetingDateTime;\r\n  const displayDateLabel = React.useMemo(() => {\r\n    if (!displayDateTime) return selectedMeeting?.dateLabel;\r\n    const date = new Date(displayDateTime);\r\n    return date.toLocaleDateString('en-US', {\r\n      weekday: 'short',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric'\r\n    });\r\n  }, [displayDateTime, selectedMeeting?.dateLabel]);\r\n\r\n  const displayTopic = currentMeeting?.topic || selectedMeeting?.topic;\r\n\r\n  if (!selectedMeeting) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4 bg-black/30\">\r\n      <div className=\"w-full h-full max-h-screen sm:max-h-[90vh] max-w-sm sm:max-w-2xl lg:max-w-4xl bg-white rounded-lg shadow-lg flex flex-col\">\r\n        <div className=\"px-3 sm:px-4 py-3 border-b border-gray-200 flex items-center justify-between flex-shrink-0\">\r\n          <div className=\"flex-1 min-w-0 pr-2\">\r\n            <div className=\"text-xs sm:text-sm text-gray-500 truncate\">{selectedMeeting.subtitle}</div>\r\n            <h3 className=\"text-sm sm:text-base font-semibold text-gray-900 line-clamp-2\">{selectedMeeting.title}</h3>\r\n            {displayDateLabel && (\r\n              <div className=\"text-xs text-gray-500 mt-0.5\">{displayDateLabel}</div>\r\n            )}\r\n            {displayDateTime && (\r\n              <div className=\"text-xs text-gray-600 mt-0.5 font-medium\">\r\n                <Clock className=\"inline h-3 w-3 mr-1\" />\r\n                {new Date(displayDateTime).toLocaleTimeString('en-US', {\r\n                  hour: '2-digit',\r\n                  minute: '2-digit',\r\n                  hour12: false\r\n                })}\r\n              </div>\r\n            )}\r\n            {displayTopic && !isEditingMeeting && (\r\n              <div className=\"text-xs text-gray-600 mt-1 italic\">Topic: {displayTopic}</div>\r\n            )}\r\n            {currentMeeting?.lecturerId && lecturerLookup[currentMeeting.lecturerId] && !isEditingMeeting && (\r\n              <div className=\"text-xs text-gray-600 mt-0.5 flex items-center\">\r\n                <User className=\"inline h-3 w-3 mr-1\" />\r\n                {lecturerLookup[currentMeeting.lecturerId]}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-1 sm:gap-2 flex-shrink-0\">\r\n            {!isEditingMeeting && (\r\n              <button\r\n                onClick={handleStartEditMeeting}\r\n                className=\"px-2 py-1 text-xs font-medium rounded bg-blue-600 text-white hover:bg-blue-700 cursor-pointer flex items-center gap-1 whitespace-nowrap\"\r\n                title=\"Edit meeting schedule\"\r\n              >\r\n                <Edit2 className=\"h-3 w-3\" />\r\n                <span className=\"hidden sm:inline\">Edit Schedule</span>\r\n                <span className=\"sm:hidden\">Edit</span>\r\n              </button>\r\n            )}\r\n            <button\r\n              onClick={handleClose}\r\n              className=\"px-2 py-1 text-sm rounded hover:bg-gray-100 cursor-pointer\"\r\n              aria-label=\"Close\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex-1 overflow-y-auto p-3 sm:p-4\">\r\n          {/* Meeting Edit Form */}\r\n          {isEditingMeeting && (\r\n            <div className=\"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n              <h4 className=\"text-sm font-semibold text-gray-900 mb-3\">Edit Meeting Schedule</h4>\r\n              <div className=\"grid grid-cols-2 gap-3 mb-3\">\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-gray-700 mb-1\">Date</label>\r\n                  <input\r\n                    type=\"date\"\r\n                    value={editedMeetingDate}\r\n                    onChange={(e) => setEditedMeetingDate(e.target.value)}\r\n                    className=\"input-field w-full text-sm\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-gray-700 mb-1\">Time</label>\r\n                  <input\r\n                    type=\"time\"\r\n                    value={editedMeetingTime}\r\n                    onChange={(e) => setEditedMeetingTime(e.target.value)}\r\n                    className=\"input-field w-full text-sm\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"mb-3\">\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">Topic/Description (Optional)</label>\r\n                <textarea\r\n                  value={editedMeetingTopic}\r\n                  onChange={(e) => setEditedMeetingTopic(e.target.value)}\r\n                  className=\"input-field w-full text-sm\"\r\n                  rows={3}\r\n                  placeholder=\"Enter meeting topic or description...\"\r\n                  maxLength={500}\r\n                />\r\n                <div className=\"text-xs text-gray-500 mt-1\">{editedMeetingTopic.length}/500 characters</div>\r\n              </div>\r\n              <div className=\"mb-3\">\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">Lecturer (Optional)</label>\r\n                <select\r\n                  value={editedMeetingLecturer}\r\n                  onChange={(e) => setEditedMeetingLecturer(e.target.value)}\r\n                  className=\"input-field w-full text-sm\"\r\n                >\r\n                  <option value=\"\">- No Lecturer -</option>\r\n                  {lecturerIds.map((lecturerId) => (\r\n                    <option key={lecturerId} value={lecturerId}>\r\n                      {lecturerLookup[lecturerId] || lecturerId}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={handleUpdateMeeting}\r\n                  disabled={updateMeetingMutation.isPending || !editedMeetingDate || !editedMeetingTime}\r\n                  className=\"px-3 py-1.5 text-sm font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer\"\r\n                >\r\n                  {updateMeetingMutation.isPending ? 'Saving...' : 'Save Changes'}\r\n                </button>\r\n                <button\r\n                  onClick={() => setIsEditingMeeting(false)}\r\n                  disabled={updateMeetingMutation.isPending}\r\n                  className=\"px-3 py-1.5 text-sm font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {!isMeetingAccessible ? (\r\n            <div className=\"text-center py-8\">\r\n              <Clock className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Attendance Not Available Yet</h3>\r\n              <p className=\"text-gray-600\">\r\n                Attendance editing will be available 5 minutes before the class starts.\r\n              </p>\r\n              {displayDateTime && (\r\n                <p className=\"text-sm text-gray-500 mt-2\">\r\n                  Class starts at: {new Date(displayDateTime).toLocaleString('en-US', {\r\n                    weekday: 'short',\r\n                    year: 'numeric',\r\n                    month: 'short',\r\n                    day: 'numeric',\r\n                    hour: '2-digit',\r\n                    minute: '2-digit'\r\n                  })}\r\n                </p>\r\n              )}\r\n            </div>\r\n          ) : (studentsLoading || attendancesLoading) ? (\r\n            <div className=\"text-center text-gray-500 py-6\">Loading students and attendances...</div>\r\n          ) : mergedAttendance.length === 0 ? (\r\n            <div className=\"text-center text-gray-500 py-6\">No students found for this class.</div>\r\n          ) : (\r\n            <>\r\n              {/* Bulk Action Buttons */}\r\n              <div className=\"mb-3 sm:mb-4 flex gap-1 sm:gap-2 justify-end flex-wrap\">\r\n                {isBulkEditing ? (\r\n                  <>\r\n                    <button\r\n                      onClick={handleSaveAll}\r\n                      disabled={isSavingAll || Object.keys(editingStates).length === 0}\r\n                      className=\"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer whitespace-nowrap\"\r\n                    >\r\n                      {isSavingAll ? 'Saving...' : `Save (${Object.keys(editingStates).length})`}\r\n                    </button>\r\n                    <button\r\n                      onClick={handleCancelAll}\r\n                      disabled={isSavingAll}\r\n                      className=\"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer whitespace-nowrap\"\r\n                    >\r\n                      Cancel\r\n                    </button>\r\n                  </>\r\n                ) : (\r\n                  <button\r\n                    onClick={handleEditAll}\r\n                    className=\"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded bg-primary-600 text-white hover:bg-primary-700 cursor-pointer whitespace-nowrap\"\r\n                  >\r\n                    Edit All\r\n                  </button>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"space-y-2 sm:overflow-x-auto sm:border sm:border-gray-200 sm:rounded-lg\">\r\n                {/* Mobile Card View */}\r\n                <div className=\"sm:hidden space-y-2\">\r\n                  {mergedAttendance.map((s) => {\r\n                    const status = s.status;\r\n                    const isEditing = editingStates[s.nim] !== undefined;\r\n                    const displayStatus = isEditing ? editingStates[s.nim] : status;\r\n\r\n                    return (\r\n                      <div key={s.nim} className=\"border border-gray-200 rounded-lg p-2 bg-white\">\r\n                        <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"text-xs font-semibold text-gray-900 break-words\">{s.nama}</p>\r\n                            <p className=\"text-xs text-gray-500 font-mono\">{s.nim}</p>\r\n                          </div>\r\n                          {!isEditing && (\r\n                            <span className={`flex-shrink-0 px-2 py-0.5 rounded text-xs font-medium inline-block ${\r\n                              status === 'Hadir' ? 'bg-green-100 text-green-700' :\r\n                                status === 'Izin' || status === 'Sakit' ? 'bg-yellow-100 text-yellow-700' :\r\n                                  status === 'Terlambat' ? 'bg-blue-100 text-blue-700' :\r\n                                    status === 'Pengganti' ? 'bg-purple-100 text-purple-700' :\r\n                                      status === 'Belum Absen' ? 'bg-gray-100 text-gray-700' :\r\n                                        'bg-red-100 text-red-700'\r\n                            }`}>\r\n                              {getStatusDisplayLabel(status) || 'Belum Absen'}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n\r\n                        {isEditing ? (\r\n                          <div className=\"space-y-2\">\r\n                            <div className=\"grid grid-cols-3 gap-0.5\">\r\n                              {['Hadir', 'Izin', 'Sakit', 'Alfa', 'Terlambat', 'Pengganti'].map(statusOption => (\r\n                                <button\r\n                                  key={statusOption}\r\n                                  onClick={() => setEditingStates(prev => ({ ...prev, [s.nim]: statusOption }))}\r\n                                  className={`px-1.5 py-1 text-xs font-medium rounded transition-colors cursor-pointer ${\r\n                                    displayStatus === statusOption\r\n                                      ? 'bg-primary-600 text-white'\r\n                                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                                  }`}\r\n                                >\r\n                                  {getStatusDisplayLabel(statusOption)}\r\n                                </button>\r\n                              ))}\r\n                            </div>\r\n                            <div className=\"flex gap-1\">\r\n                              <button\r\n                                onClick={async () => {\r\n                                  await handleStatusChange(s.nim, displayStatus, s.attendanceId);\r\n                                  setEditingStates(prev => {\r\n                                    const newStates = { ...prev };\r\n                                    delete newStates[s.nim];\r\n                                    return newStates;\r\n                                  });\r\n                                }}\r\n                                disabled={createAttendanceMutation.isPending || updateAttendanceMutation.isPending}\r\n                                className=\"flex-1 px-2 py-1 text-xs font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 cursor-pointer\"\r\n                              >\r\n                                {(createAttendanceMutation.isPending || updateAttendanceMutation.isPending) ? 'Saving...' : 'Save'}\r\n                              </button>\r\n                              <button\r\n                                onClick={() => setEditingStates(prev => {\r\n                                  const newStates = { ...prev };\r\n                                  delete newStates[s.nim];\r\n                                  return newStates;\r\n                                })}\r\n                                disabled={createAttendanceMutation.isPending || updateAttendanceMutation.isPending}\r\n                                className=\"px-2 py-1 text-xs font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer\"\r\n                              >\r\n                                X\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        ) : (\r\n                          <button\r\n                            onClick={() => setEditingStates(prev => ({ ...prev, [s.nim]: status === 'Belum Absen' ? 'Hadir' : (status || 'Hadir') }))}\r\n                            className=\"w-full px-2 py-1 text-xs font-medium rounded bg-primary-600 text-white hover:bg-primary-700 cursor-pointer\"\r\n                          >\r\n                            Edit\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                {/* Desktop Table View */}\r\n                <table className=\"hidden sm:table w-full text-xs sm:text-sm\">\r\n                  <thead>\r\n                    <tr className=\"bg-gray-50 border-b border-gray-200\">\r\n                      <th className=\"px-2 sm:px-3 py-2 text-left font-semibold text-gray-700 whitespace-nowrap\">NIM</th>\r\n                      <th className=\"px-2 sm:px-3 py-2 text-left font-semibold text-gray-700\">Name</th>\r\n                      <th className=\"px-2 sm:px-3 py-2 text-left font-semibold text-gray-700 whitespace-nowrap\">Status</th>\r\n                      <th className=\"px-2 sm:px-3 py-2 text-left font-semibold text-gray-700 whitespace-nowrap\">Action</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {mergedAttendance.map((s) => {\r\n                      const status = s.status;\r\n                      const isEditing = editingStates[s.nim] !== undefined;\r\n                      const displayStatus = isEditing ? editingStates[s.nim] : status;\r\n\r\n                      return (\r\n                        <tr key={s.nim} className=\"border-b border-gray-100 hover:bg-gray-50\">\r\n                          <td className=\"px-2 sm:px-3 py-2 font-mono text-gray-900 whitespace-nowrap text-xs\">{s.nim}</td>\r\n                          <td className=\"px-2 sm:px-3 py-2 text-gray-900\">{s.nama}</td>\r\n                          <td className=\"px-2 sm:px-3 py-2\">\r\n                            {isEditing ? (\r\n                              <div className=\"flex gap-1 flex-wrap\">\r\n                                {['Hadir', 'Izin', 'Sakit', 'Alfa', 'Terlambat', 'Pengganti'].map(statusOption => (\r\n                                  <button\r\n                                    key={statusOption}\r\n                                    onClick={() => setEditingStates(prev => ({ ...prev, [s.nim]: statusOption }))}\r\n                                    className={`px-2 py-0.5 text-xs font-medium rounded transition-colors cursor-pointer ${\r\n                                      displayStatus === statusOption\r\n                                        ? 'bg-primary-600 text-white'\r\n                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                                    }`}\r\n                                  >\r\n                                    {getStatusDisplayLabel(statusOption)}\r\n                                  </button>\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <span className={`px-2 py-0.5 rounded text-xs font-medium inline-block ${\r\n                                status === 'Hadir' ? 'bg-green-100 text-green-700' :\r\n                                  status === 'Izin' || status === 'Sakit' ? 'bg-yellow-100 text-yellow-700' :\r\n                                    status === 'Terlambat' ? 'bg-blue-100 text-blue-700' :\r\n                                      status === 'Pengganti' ? 'bg-purple-100 text-purple-700' :\r\n                                        status === 'Belum Absen' ? 'bg-gray-100 text-gray-700' :\r\n                                          'bg-red-100 text-red-700'\r\n                              }`}>\r\n                                {getStatusDisplayLabel(status) || 'Belum Absen'}\r\n                              </span>\r\n                            )}\r\n                          </td>\r\n                          <td className=\"px-2 sm:px-3 py-2 whitespace-nowrap\">\r\n                            {isEditing ? (\r\n                              <div className=\"flex gap-1\">\r\n                                <button\r\n                                  onClick={async () => {\r\n                                    await handleStatusChange(s.nim, displayStatus, s.attendanceId);\r\n                                    setEditingStates(prev => {\r\n                                      const newStates = { ...prev };\r\n                                      delete newStates[s.nim];\r\n                                      return newStates;\r\n                                    });\r\n                                  }}\r\n                                  disabled={createAttendanceMutation.isPending || updateAttendanceMutation.isPending}\r\n                                  className=\"px-2 py-1 text-xs font-medium rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 cursor-pointer\"\r\n                                >\r\n                                  {(createAttendanceMutation.isPending || updateAttendanceMutation.isPending) ? 'Saving...' : 'Save'}\r\n                                </button>\r\n                                <button\r\n                                  onClick={() => setEditingStates(prev => {\r\n                                    const newStates = { ...prev };\r\n                                    delete newStates[s.nim];\r\n                                    return newStates;\r\n                                  })}\r\n                                  disabled={createAttendanceMutation.isPending || updateAttendanceMutation.isPending}\r\n                                  className=\"px-2 py-1 text-xs font-medium rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50 cursor-pointer\"\r\n                                >\r\n                                  Cancel\r\n                                </button>\r\n                              </div>\r\n                            ) : (\r\n                              <button\r\n                                onClick={() => setEditingStates(prev => ({ ...prev, [s.nim]: status === 'Belum Absen' ? 'Hadir' : (status || 'Hadir') }))}\r\n                                className=\"px-2 py-1 text-xs font-medium rounded bg-primary-600 text-white hover:bg-primary-700 cursor-pointer\"\r\n                              >\r\n                                Edit\r\n                              </button>\r\n                            )}\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AttendanceModal;\r\n"],"names":["getStringValue","value","fallback","extractString","AttendanceModal","selectedMeeting","onClose","studentsRaw","studentsLoading","useClassStudents","attendancesRaw","attendancesLoading","useMeetingAttendances","meetingsData","refetchMeetings","useClassMeetings","students","React","attendances","lecturerAssignments","useLecturerAssignments","lecturerIds","idSet","assignment","id","lecturerQueryResults","useQueries","apiService","lecturerLookup","lookup","q","lecturer","currentMeeting","found","m","tglPertemuan","jamPertemuan","topik","idDosen","meetingDateTime","datePart","timePart","dateTimeStr","createAttendanceMutation","useCreateAttendance","updateAttendanceMutation","useUpdateAttendance","updateMeetingMutation","useUpdateMeeting","editingStates","setEditingStates","isBulkEditing","setIsBulkEditing","isSavingAll","setIsSavingAll","isEditingMeeting","setIsEditingMeeting","editedMeetingDate","setEditedMeetingDate","editedMeetingTime","setEditedMeetingTime","editedMeetingTopic","setEditedMeetingTopic","editedMeetingLecturer","setEditedMeetingLecturer","mergedAttendance","attendanceByNim","a","record","isMeetingAccessible","now","meetingTime","fiveMinutesBeforeMeeting","handleStatusChange","nim","newStatus","attendanceId","currentTime","error","handleSaveAll","errors","student","s","handleEditAll","allStates","handleCancelAll","handleUpdateMeeting","timeWithSeconds","topic","lecturerId","date","dateStr","timeStr","handleStartEditMeeting","handleClose","displayDateTime","displayDateLabel","displayTopic","jsxs","jsx","Clock","User","Edit2","e","Fragment","status","isEditing","displayStatus","getStatusDisplayLabel","statusOption","prev","newStates"],"mappings":"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"}