import{j as e}from"./query-vendor-B--u1oZD.js";import{r as h,g as Y}from"./react-vendor-XXJdR_Id.js";import{u as ee,a as te,e as A,f as j}from"./index-CU8_O-g9.js";import{u as se,a as ae}from"./useClasses-C1GF1DtM.js";import{C as $}from"./CheckInModal-DWjULiZ3.js";import{s as ne,c as re}from"./ui-vendor-CkH0jJa3.js";const oe=u=>{const n=A(u);if(!n)return null;const l=n.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[l]||null},de=u=>{const n=j(u);if(!n)return"00:00";const l=n.match(/^(\d{1,2}):(\d{2})(?::\d{2})?$/);if(l){const o=l[1].padStart(2,"0"),p=l[2];return`${o}:${p}`}const i=n.split("T")[1];if(i){const o=i.split(".")[0].split("Z")[0],[p="00",b="00"]=o.split(":");return`${p.padStart(2,"0")}:${b.padStart(2,"0")}`}try{const o=new Date(n);if(!isNaN(o.getTime()))return o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{}return"00:00"},ce=()=>{const u=new Date,n=u.getDay(),l=n===0?0:n,i=new Date(u);i.setDate(u.getDate()-l),i.setHours(0,0,0,0);const o=new Date(i);return o.setDate(i.getDate()+6),o.setHours(23,59,59,999),{start:i,end:o}},ge=()=>{const{user:u}=ee(),{t:n}=te(),[l,i]=h.useState([]),[o,p]=h.useState(!1),[b,N]=h.useState(null),[E,w]=h.useState(""),[O,D]=h.useState(""),[W,I]=h.useState(""),[P,S]=h.useState(!1),[_,v]=h.useState(null),{start:F,end:L}=Y.useMemo(()=>ce(),[]),B=F.toISOString().split("T")[0],H=L.toISOString().split("T")[0],{data:k=[]}=se(u?.studentId||"",{start_day:B,end_day:H}),{data:f=[]}=ae(),R=(t,a)=>{N(t),w(a),p(!0)},z=()=>{p(!1),N(null),w("")},U=t=>{v(t),D(t.link_bukti||""),I(t.deskripsi||""),S(!0)},K=()=>{v(null),D(""),I(""),S(!1)},T=t=>Array.isArray(f)&&f.some(a=>a.id_pertemuan===t),V=t=>Array.isArray(f)?f.find(a=>a.id_pertemuan===t):void 0,Z=(t,a)=>t.actualDate?T(t.meetingId)?{allowed:!1,reason:"Already checked in"}:a?{allowed:!0}:{allowed:!1,reason:"Attendance not yet active"}:{allowed:!1,reason:"Invalid meeting date"},q=t=>{const a=t.toLowerCase();return a==="hadir"?{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}:a==="izin"||a==="sakit"?{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-700",icon:"text-yellow-600"}:a==="alfa"?{border:"border-red-300",bg:"bg-red-50",text:"text-red-700",icon:"text-red-600"}:a==="terlambat"?{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"}:{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}},C=t=>{if(!t)return null;try{const a=new Date(t);return isNaN(a.getTime())?null:{date:a.toLocaleDateString("id-ID",{day:"numeric",month:"short"}),time:a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}}catch{return null}};return h.useEffect(()=>{const t=[];k.forEach(s=>{(s.meeting_schedules??[]).forEach(r=>{const g=oe(r.tgl_pertemuan);if(!g)return;const m=de(r.jam_pertemuan),d=A(r.tgl_pertemuan);if(!d)return;const c=s.sks_tatap_muka+s.sks_praktek+s.sks_prak_lapangan+s.sks_simulasi,x=c*60,[y,G]=m.split(":").map(Number),M=y*60+G+x,J=Math.floor(M/60)%24,Q=M%60,X=`${String(J).padStart(2,"0")}:${String(Q).padStart(2,"0")}`;t.push({id:`${s.kelas_id}-${r.id}`,day:g,startTime:m,endTime:X,courseCode:s.kode_mk,courseName:s.nama_mk,className:s.nama_kelas,credits:c,room:j(r.media_pembelajaran,"TBA"),topic:j(r.topik,""),weekNumber:r.pertemuan_ke,classId:s.kelas_id,actualDate:d,meetingId:r.id})})});const a=t.filter(s=>s.actualDate).map(s=>{const r=s.actualDate.getDay();return{...s,weekDay:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[r]||"Monday"}}).sort((s,r)=>!s.actualDate||!r.actualDate?0:s.actualDate.getTime()-r.actualDate.getTime());i(a)},[k]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n("dashboard.welcomeBack")})}),l.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:n("studentDashboard.thisWeekSchedule")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(t=>{const s=k.find(x=>x.kelas_id===t.classId)?.meeting_schedules?.find(x=>x.id===t.meetingId),r=s?.absensi_aktif===!0||typeof s?.absensi_aktif=="object"&&s.absensi_aktif?.Valid&&s.absensi_aktif?.Bool,g=T(t.meetingId),m=Z(t,r),d=V(t.meetingId),c=d?q(d.status_kehadiran):null;return e.jsxs("div",{onClick:()=>m.allowed&&R(t.meetingId,t.courseName),className:`p-3 border rounded-lg transition-colors flex flex-col ${g&&c?`${c.border} ${c.bg} cursor-default`:m.allowed?"border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer":"border-gray-300 bg-gray-100 cursor-not-allowed"}`,title:m.allowed?void 0:m.reason,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2.5 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:t.weekDay}),t.actualDate&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-0.5 bg-gray-100 rounded",children:t.actualDate.toLocaleDateString("id-ID",{day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[g&&d&&c&&e.jsxs("div",{className:`flex items-center gap-1 text-xs ${c.text} font-medium`,children:[e.jsx(ne,{className:`h-3 w-3 ${c.icon}`}),e.jsx("span",{children:n("studentDashboard.checkedIn")})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Week ",t.weekNumber]})]})]}),e.jsx("div",{className:"text-xs font-semibold text-primary-600 mb-1",children:t.courseCode}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:t.courseName}),t.topic&&e.jsx("div",{className:"text-xs text-gray-600 mb-2 italic line-clamp-2",children:t.topic})]}),e.jsx("div",{className:"flex flex-col gap-1 text-xs text-gray-600 border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(re,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:[t.startTime," - ",t.endTime]})]})}),g&&d&&c&&e.jsx("div",{className:`mt-2 pt-2 border-t ${c.border}`,children:e.jsx("div",{className:"text-xs text-gray-600 space-y-0.5",children:(()=>{const x=C(d.waktu_masuk),y=d.waktu_keluar?C(d.waktu_keluar):null;return e.jsxs(e.Fragment,{children:[x&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[n("studentDashboard.checkIn"),":"]}),e.jsxs("span",{className:"font-medium",children:[x.date," ",x.time]})]}),y&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[n("studentDashboard.checkOut"),":"]}),e.jsx("span",{className:"font-medium",children:y.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[n("studentDashboard.status"),":"]}),e.jsx("span",{className:`font-medium ${c.text}`,children:d.status_kehadiran})]}),e.jsx("button",{onClick:()=>U(d),className:"mt-2 w-full text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",type:"button",children:n("studentDashboard.updateProof")})]})})()})}),!g&&!m.allowed&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center italic",children:m.reason})]},t.id)})})]}),e.jsx($,{isOpen:o,meetingId:b,courseName:E,onClose:z}),e.jsx($,{isOpen:P,meetingId:_?.id_pertemuan||null,courseName:_?.nama_mk||"",onClose:K,editMode:!0,existingProof:O,existingDescription:W})]})};export{ge as default};
//# sourceMappingURL=StudentDashboard-XcVvBhqT.js.map
