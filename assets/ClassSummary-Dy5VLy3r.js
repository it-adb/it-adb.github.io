const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-2pqXIzBy.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js"])))=>i.map(i=>d[i]);
import{u as Ke,b as Xe,c as St,d as xs,j as e,_ as qe}from"./query-vendor-B--u1oZD.js";import{e as gs,f as ms,u as hs,r as b}from"./react-vendor-XXJdR_Id.js";import{u as fs,a as ys,b as js,c as _s,d as Ns,e as ks}from"./useLecturerAssignments-lytpHA33.js";import{b as q}from"./index-DzRMt0hm.js";import{H as ws,C as gt,r as ve,s as Ss,t as vs,u as ue,v as Ee,w as mt,g as ht,x as ft,y as yt}from"./ui-vendor-C-UqR_Df.js";function Es(r){return Ke({queryKey:["grades",r?.krs_id??null,r?.kelas_id??null],queryFn:()=>q.getGrades(r),enabled:!!(r&&(r.krs_id!==void 0||r.kelas_id!==void 0))})}function Cs(r){const u=Xe();return St({mutationFn:m=>q.createGrade(m),onSuccess:async()=>{u.invalidateQueries({queryKey:["grades"]})}})}function Is(r){const u=Xe();return St({mutationFn:({id:m,data:E})=>q.updateGrade(m,E),onSuccess:async(m,E)=>{try{const C=await q.getGrade(E.id);u.setQueriesData({queryKey:["grades"],exact:!1},T=>T&&T.map(V=>V.id===E.id?C:V))}catch(C){console.error("Failed to fetch updated grade, invalidating:",C),u.invalidateQueries({queryKey:["grades"]})}}})}const vt=["","Hadir","Izin","Sakit","Alfa","Terlambat","Pengganti"],jt={1:"Hadir",2:"Izin",3:"Sakit",4:"Alfa",5:"Terlambat",6:"Pengganti"},I={aktivitas_partisipatif:15,hasil_proyek:35,quiz:5,tugas:5,uts:15,uas:25},Ds=["bobot_partisipatif","bobot_proyek","bobot_kuis","bobot_tugas","bobot_uts","bobot_uas"],y=r=>{if(r==null)return null;if(typeof r=="number")return r;if(typeof r=="object"&&r!==null&&"Float64"in r&&"Valid"in r){const u=r;return u.Valid?u.Float64:null}return null},Et=r=>{const u=y(r?.bobot_partisipatif),m=y(r?.bobot_proyek),E=y(r?.bobot_kuis),C=y(r?.bobot_tugas),T=y(r?.bobot_uts),V=y(r?.bobot_uas);return[{key:"aktivitas_partisipatif",weight:u??I.aktivitas_partisipatif},{key:"hasil_proyek",weight:m??I.hasil_proyek},{key:"quiz",weight:E??I.quiz},{key:"tugas",weight:C??I.tugas},{key:"uts",weight:T??I.uts},{key:"uas",weight:V??I.uas}]},As=["aktivitas_partisipatif","hasil_proyek","quiz","tugas","uts","uas","nilai_angka","nilai_huruf","nilai_indeks"],M=r=>r?typeof r=="string"?r:r.Valid?r.String:"":"",_t=r=>{if(!r)return"";let u="";if(typeof r=="string"?u=r:r.Valid&&(u=r.Time),!u)return"";const m=new Date(u);return isNaN(m.getTime())?"":m.toISOString().slice(0,10)},Ue=r=>{if(!r)return"";let u="";if(typeof r=="string"?u=r:"String"in r&&r.Valid?u=r.String:"Time"in r&&r.Valid&&(u=r.Time),!u)return"";const m=u.split(":");return m.length>=2?`${m[0].padStart(2,"0")}:${m[1].padStart(2,"0")}`:u},A=r=>{if(r==null)return null;if(typeof r=="number")return r;if(typeof r=="object"&&r!==null){if("Float64"in r&&r.Valid)return r.Float64;if("Int32"in r&&r.Valid)return r.Int32}return null},Nt=r=>{if(r==null)return null;if(typeof r=="number"||typeof r=="string"||typeof r=="boolean")return r;if(typeof r=="object"&&r!==null){if("Float64"in r&&r.Valid)return r.Float64;if("Int32"in r)return r.Int32;if("String"in r&&r.Valid)return r.String}return null},Ce=r=>{const u=r?.id_krs??r?.krs_id??r?.krsId??r?.krs?.id??r?.krs?.KRS?.id;return u!=null?Number(u):null},ze=r=>vt.find(m=>m.toLowerCase()===r.toLowerCase())??r,Be=r=>r==null?{huruf:"",indeks:0}:r>=80?{huruf:"A",indeks:4}:r>=75?{huruf:"AB",indeks:3.5}:r>=70?{huruf:"B",indeks:3}:r>=65?{huruf:"BC",indeks:2.5}:r>=60?{huruf:"C",indeks:2}:r>=55?{huruf:"CD",indeks:1.5}:r>=40?{huruf:"D",indeks:1}:{huruf:"E",indeks:0},He=(r,u)=>{let m=0,E=0,C=!1;return(u??Et()).forEach(({key:V,weight:se})=>{const pe=r[V],re=A(pe);re!==null&&(E+=re*se,m+=se,C=!0)}),!C||m===0?null:parseFloat((E/m).toFixed(2))},kt=r=>{let u="";if(typeof r=="object"&&r!==null){if(!r.Valid)return"-";u=r.Time}else u=r;if(!u)return"-";const m=new Date(u),E=m.toLocaleDateString("en-US",{weekday:"short"}),C=m.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"});return`${E}, ${C}`},Ts=r=>{let u="";if(typeof r=="object"&&r!==null){if(!r.Valid)return"-";u=r.Time}else u=r;if(!u)return"-";const m=new Date(u),E=m.toLocaleDateString("en-US",{weekday:"short"}),C=m.toLocaleDateString("en-US",{day:"2-digit"}),T=m.toLocaleDateString("en-US",{month:"short"});return`${E}
${C} ${T}`},wt=r=>Ue(r)||"-",Fs=(r,u,m)=>r.id&&r.id>0?`id:${r.id}`:r.krs_id?`krs:${typeof r.krs_id=="object"?r.krs_id.Int32:r.krs_id}`:u?`krs:${u}`:`nim:${m}`,Vs=()=>{const{classId:r}=gs(),[u]=ms(),m=hs(),E=b.useRef(null),C=Xe(),T=b.useRef(!1),[V,se]=b.useState(!1),[pe,re]=b.useState(!1),[D,be]=b.useState(!1),[B,We]=b.useState(!1),[j,Qe]=b.useState(!1),[Ct,Ye]=b.useState(!1),[O,ae]=b.useState({}),[xe,ne]=b.useState({}),[ge,ie]=b.useState({}),[me,oe]=b.useState({}),[It,Je]=b.useState({}),[Dt,At]=b.useState({}),[Ie,he]=b.useState(new Set),[De,fe]=b.useState({}),[Tt,Ae]=b.useState({}),[Ze,le]=b.useState(null),[F,G]=b.useState(null),[Y,H]=b.useState({}),[Ft,Te]=b.useState(new Set),[Gt,ce]=b.useState(new Set),[_,ye]=b.useState({}),[Fe,et]=b.useState(!1),[tt,J]=b.useState(null),[Lt,je]=b.useState(!1),_e=u.get("className")||"",Ne=u.get("courseName")||"",ke=u.get("courseCode")||"",Ge=u.get("from")||"dashboard",Mt=parseInt(u.get("sksTatapMuka")||"0",10),$t=parseInt(u.get("sksPraktek")||"0",10),Pt=parseInt(u.get("sksPrakLapangan")||"0",10),Vt=parseInt(u.get("sksSimulasi")||"0",10),Z=Number(r),{data:R=[],isLoading:Ot,error:Rt}=fs(Z),{data:L=[],isLoading:qt,error:zt}=ys(Z),{data:z=[],isLoading:Bt}=Es({kelas_id:Z}),{data:we=[],isLoading:Ht}=js({id_kelas:String(r)}),{data:N,isLoading:Kt}=Ke({queryKey:["class",r],queryFn:()=>q.getClassById(Z),enabled:!!r}),h=b.useMemo(()=>{const t=_.bobot_partisipatif??y(N?.bobot_partisipatif),s=_.bobot_proyek??y(N?.bobot_proyek),i=_.bobot_kuis??y(N?.bobot_kuis),a=_.bobot_tugas??y(N?.bobot_tugas),n=_.bobot_uts??y(N?.bobot_uts),l=_.bobot_uas??y(N?.bobot_uas);return{aktivitas_partisipatif:t??I.aktivitas_partisipatif,hasil_proyek:s??I.hasil_proyek,quiz:i??I.quiz,tugas:a??I.tugas,uts:n??I.uts,uas:l??I.uas}},[N,_]),Se=b.useMemo(()=>{const t={bobot_partisipatif:_.bobot_partisipatif??y(N?.bobot_partisipatif),bobot_proyek:_.bobot_proyek??y(N?.bobot_proyek),bobot_kuis:_.bobot_kuis??y(N?.bobot_kuis),bobot_tugas:_.bobot_tugas??y(N?.bobot_tugas),bobot_uts:_.bobot_uts??y(N?.bobot_uts),bobot_uas:_.bobot_uas??y(N?.bobot_uas)};return Et(t)},[N,_]),st=b.useMemo(()=>({bobot_partisipatif:y(N?.bobot_partisipatif)??I.aktivitas_partisipatif,bobot_proyek:y(N?.bobot_proyek)??I.hasil_proyek,bobot_kuis:y(N?.bobot_kuis)??I.quiz,bobot_tugas:y(N?.bobot_tugas)??I.tugas,bobot_uts:y(N?.bobot_uts)??I.uts,bobot_uas:y(N?.bobot_uas)??I.uas}),[N]),Le=b.useMemo(()=>Ds.some(t=>{const s=_[t];return s===void 0?!1:s!==st[t]}),[_,st]),rt=b.useMemo(()=>{const t=new Set;return we.forEach(s=>{const i=M(s.id_dosen);i&&t.add(i)}),Array.from(t)},[we]),Me=xs({queries:rt.map(t=>({queryKey:["lecturer",t],queryFn:()=>q.getLecturerByID(t),enabled:!!t}))}),K=b.useMemo(()=>{const t={};return Me.forEach(s=>{const i=s.data;i?.id&&i?.nama_dosen&&(t[i.id]=i.nama_dosen)}),t},[Me]),$e=Mt+$t+Pt+Vt,Pe=b.useMemo(()=>we.map(t=>{const s=M(t.id_dosen);return s?K[s]||s:null}).filter(Boolean),[we,K]),U=b.useMemo(()=>R.map(t=>t.id),[R]),{data:X={},isLoading:Ut}=Ke({queryKey:["class-attendances",r,U],queryFn:async()=>{const t={};return await Promise.all(U.map(async s=>{const i=await q.getMeetingAttendances(s);t[s]=i})),t},enabled:U.length>0}),Ve=_s(),Xt=Ns(),Wt=ks(),Qt=Is(),at=Cs(),Yt=Me.some(t=>t.isLoading),Oe=Ot||qt||Ut||Ht||Bt||Kt||Yt,Re=Rt||zt,Jt=D||B||j,W=t=>{let s=z.find(a=>a.nim===t.nim);if(s||(s=z.find(a=>a.student?.nim===t.nim||a.krs?.student?.nim===t.nim||a.krs?.nim===t.nim),s))return s;const i=Ce(t);return i!==null&&(s=z.find(a=>{const n=A(a.krs_id);return n!==null&&n===i}),s)||(s=z.find(a=>Object.values(a).some(n=>typeof n=="string"&&n===t.nim)),s)?s:{id:0,krs_id:null,aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null}},Zt=(t,s,i,a,n)=>{ae(l=>({...l,[t]:s||""})),ne(l=>({...l,[t]:i||""})),ie(l=>({...l,[t]:a||""})),oe(l=>({...l,[t]:n||""}))},nt=t=>{ae(s=>{const i={...s};return delete i[t],i}),ne(s=>{const i={...s};return delete i[t],i}),ie(s=>{const i={...s};return delete i[t],i}),oe(s=>{const i={...s};return delete i[t],i})},it=async t=>{const s=O[t]??"",i=xe[t]??"",a=ge[t]??"",n=me[t]??"",l=i?`${i}T00:00:00.000Z`:void 0,g=a?`${a}:00`:void 0;console.log("[MEETING] ðŸ’¾ Saving meeting",t,"with topic:",s),console.log("[MEETING] Date input:",i,"â†’ ISO:",l),console.log("[MEETING] Lecturer:",n);try{await Ve.mutateAsync({id:t,data:{topik:s||void 0,tgl_pertemuan:l,jam_pertemuan:g,id_dosen:n||void 0}}),console.log("[MEETING] âœ… Meeting saved successfully"),C.setQueryData(["class-meetings",Z],d=>d&&d.map(c=>c.id===t?{...c,topik:s,tgl_pertemuan:l||c.tgl_pertemuan,jam_pertemuan:g||c.jam_pertemuan,id_dosen:n||c.id_dosen}:c)),nt(t)}catch(d){alert(d instanceof Error?d.message:"Failed to update topic")}},Q=b.useMemo(()=>{const t=s=>{if(!s)return Number.POSITIVE_INFINITY;if(typeof s=="string"){const i=Date.parse(s);return isNaN(i)?Number.POSITIVE_INFINITY:i}if("Valid"in s){if(!s.Valid)return Number.POSITIVE_INFINITY;const i=Date.parse(s.Time);return isNaN(i)?Number.POSITIVE_INFINITY:i}return Number.POSITIVE_INFINITY};return[...R].sort((s,i)=>{const a=t(s.tgl_pertemuan)-t(i.tgl_pertemuan);return a!==0?a:s.pertemuan_ke-i.pertemuan_ke})},[R]),ot=b.useMemo(()=>{const t={};return Object.values(X).forEach(s=>{s.forEach(i=>{t[i.nim]||(t[i.nim]={});const a=M(i.status_kehadiran);t[i.nim][i.id_pertemuan]=a})}),t},[X]),es=t=>{switch(t?.toLowerCase()){case"hadir":case"present":return e.jsx(Ee,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(ht,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(ue,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(mt,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(Ee,{className:"h-4 w-4 text-purple-600"});case"alpa":case"alfa":case"absent":return e.jsx(ft,{className:"h-4 w-4 text-red-600"});default:return e.jsx(yt,{className:"h-4 w-4 text-gray-300"})}},ts=t=>{switch(t?.toLowerCase()){case"hadir":case"present":return"bg-green-50 text-green-700";case"izin":case"excused":return"bg-blue-50 text-blue-700";case"sakit":case"sick":return"bg-yellow-50 text-yellow-700";case"terlambat":case"late":return"bg-orange-50 text-orange-700";case"pengganti":case"substitute":return"bg-purple-50 text-purple-700";case"alpa":case"alfa":case"absent":return"bg-red-50 text-red-700";default:return"bg-gray-50 text-gray-400"}};b.useEffect(()=>{if(T.current){console.log("[EFFECT] Skipping attendance snapshot update - just saved");return}console.log("[EFFECT] Building attendance snapshot, isEditing:",D);const t={};Object.values(X).forEach(s=>{s.forEach(i=>{const a=M(i.status_kehadiran);t[`${i.nim}-${i.id_pertemuan}`]=ze(a)})}),At(t),D||(console.log("[EFFECT] Setting original cache (not editing)"),Ae(X))},[X,D]),b.useEffect(()=>{if(!D)return;const t=s=>{jt[s.key]?(s.preventDefault(),G(jt[s.key])):s.key==="Escape"&&G(null)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[D]);const ss=()=>{const t=new Set;Object.entries(De).forEach(([s,i])=>{const a=Dt[s]??"";ze(a)!==ze(i)&&t.add(s)}),he(t)},rs=b.useMemo(()=>{if(Ie.size>0)return!0;for(const t of R){const s=t.id,i=O[s]??"",a=M(t.topik);if(i!==a)return!0;const n=xe[s]??"",l=_t(t.tgl_pertemuan);if(n!==l)return!0;const g=ge[s]??"",d=Ue(t.jam_pertemuan);if(g!==d)return!0;const c=me[s]??"",S=M(t.id_dosen);if(c!==S)return!0}for(const[t,s]of Object.entries(Y)){let i=null;if(t.startsWith("id:")){const a=Number(t.split(":")[1]);i=z.find(n=>n.id===a)??null}else if(t.startsWith("krs:")){const a=Number(t.split(":")[1]);i=z.find(n=>{const l=A(n.krs_id);return l!==null&&l===a})??null}else if(t.startsWith("nim:")){const a=t.split(":")[1];i=z.find(n=>n.nim===a||n.student?.nim===a)??null}if(!i){if(Object.values(s).some(a=>a!=null&&a!==""))return!0;continue}for(const a of As){const n=Nt(s[a]),l=Nt(i[a]);if(n!==l)return!0}}return!!Le},[Ie,Y,O,xe,ge,me,R,z,Le]),lt=(t,s)=>{const[i,a]=t.split("-"),n=Number(a),l=["class-attendances",r,U];C.setQueryData(l,g=>{const d={...g||{}},c=[...d[n]||[]],S=c.findIndex(k=>k.nim===i);return S>=0?c[S]={...c[S],status_kehadiran:s}:c.push({id:-Date.now(),id_pertemuan:n,nim:i,status_kehadiran:s}),d[n]=c,d}),fe(g=>({...g,[t]:s})),ss()},as=async(t=!1)=>{if(!D)return;const s=Object.entries(De);if(!s.length){t||be(!1);return}Je(i=>{const a={...i};return s.forEach(([n])=>a[n]=!0),a});try{await Promise.all(s.map(async([a,n])=>{const[l,g]=a.split("-"),d=Number(g),c=X[d]?.find(S=>S.nim===l);c&&c.id>0?await Wt.mutateAsync({id:c.id,data:{status_kehadiran:n||void 0}}):await Xt.mutateAsync({id_pertemuan:d,nim:l,status_kehadiran:n||void 0})}));const i={};await Promise.all(U.map(async a=>{const n=await q.getMeetingAttendances(a);i[a]=n})),C.setQueryData(["class-attendances",r,U],i),Ae(i),T.current=!0,t||be(!1),fe({}),he(new Set),le(null)}catch(i){alert(i instanceof Error?i.message:"Failed to commit changes")}finally{Je({})}},ns=()=>{Ae(X),fe({}),he(new Set),le(null),G(null),be(!0)},ct=()=>{const t=["class-attendances",r,U];T.current?T.current=!1:C.setQueryData(t,Tt),fe({}),he(new Set),le(null),G(null),be(!1)},is=()=>{console.log("[MEETING] ðŸ“ Entering meeting edit mode");const t={},s={},i={},a={};R.forEach(n=>{t[n.id]=M(n.topik),s[n.id]=_t(n.tgl_pertemuan),i[n.id]=Ue(n.jam_pertemuan),a[n.id]=M(n.id_dosen)}),ae(t),ne(s),ie(i),oe(a),We(!0)},dt=()=>{console.log("[MEETING] ðŸšª Exiting meeting edit mode - clearing edits"),ae({}),ne({}),ie({}),oe({}),We(!1)},os=()=>{console.log("[GRADES] ðŸ“ Entering grades edit mode");const t={};L.forEach(s=>{const i=W(s)||{},a=Ce(s),n=Fs(i,a,s.nim);t[n]=i}),console.log("[GRADES] Initial grade map:",t),H(t),Qe(!0)},ut=()=>{console.log("[GRADES] ðŸšª Exiting grades edit mode - clearing edits"),H({}),ce(new Set),ye({}),J(null),je(!1),Qe(!1)},pt=()=>{ct(),dt(),ut()},bt=async(t,s,i)=>{console.log("[GRADES] ðŸ’¾ Saving grade for key:",t,"Grade ID:",s?.id);const a=s?.id&&s.id>0?s.id:null;a&&Te(n=>new Set([...n,a]));try{const n=Y[t];if(!n){console.log("[GRADES] âš ï¸ No edited grade found for key:",t);return}if(!["aktivitas_partisipatif","hasil_proyek","quiz","tugas","uts","uas"].some(w=>{const p=A(s[w]),P=A(n[w]);return p!==P})){console.log("[GRADES] â„¹ï¸ No changes detected, skipping save"),ce(w=>new Set([...w,t])),a&&Te(w=>new Set([...w].filter(p=>p!==a)));return}const d=He(n,Se),c=d!==null?d:A(n.nilai_angka);let S,k;if(c!==null){const{huruf:w,indeks:p}=Be(c);S=w,k=p,console.log("[GRADES] ðŸ“Š Auto-calculated: Numeric=",c,"Letter=",S,"Index=",k)}const $={aktivitas_partisipatif:A(n.aktivitas_partisipatif)??void 0,hasil_proyek:A(n.hasil_proyek)??void 0,quiz:A(n.quiz)??void 0,tugas:A(n.tugas)??void 0,uts:A(n.uts)??void 0,uas:A(n.uas)??void 0,nilai_angka:c??void 0,nilai_huruf:S,nilai_indeks:k};if(s.id&&s.id>0)console.log("[GRADES] ðŸ”„ Updating existing grade with ID:",s.id),await Qt.mutateAsync({id:s.id,data:$});else if(s.krs_id){const w=A(s.krs_id);console.log("[GRADES] âž• Creating new grade with KRS ID:",w),await at.mutateAsync({krs_id:w,...$})}else{const p=Ce(i)??A(n?.krs_id);if(p)console.log("[GRADES] âž• Creating new grade with KRS ID from student:",p),await at.mutateAsync({krs_id:Number(p),...$});else throw console.log("[GRADES] âŒ Missing KRS ID for grade creation"),new Error("Missing KRS id for grade creation")}console.log("[GRADES] âœ… Grade saved successfully"),H(w=>{const p={...w};return delete p[t],p}),ce(w=>new Set([...w,t]))}catch(n){console.log("[GRADES] âŒ Error saving grade:",n),alert(n instanceof Error?n.message:"Failed to save grade")}finally{a&&Te(n=>new Set([...n].filter(l=>l!==a)))}},ee=(t,s)=>{const i=s===""?void 0:parseFloat(s);ye(a=>({...a,[t]:i})),J(null)},ls=()=>{ye({}),J(null),je(!0)},xt=async()=>{try{et(!0),J(null);const t={bobot_partisipatif:_.bobot_partisipatif??h.aktivitas_partisipatif,bobot_proyek:_.bobot_proyek??h.hasil_proyek,bobot_kuis:_.bobot_kuis??h.quiz,bobot_tugas:_.bobot_tugas??h.tugas,bobot_uts:_.bobot_uts??h.uts,bobot_uas:_.bobot_uas??h.uas},s=t.bobot_partisipatif+t.bobot_proyek+t.bobot_kuis+t.bobot_tugas+t.bobot_uts+t.bobot_uas;return Math.abs(s-100)>.01?(J(`Total must be 100%. Current total: ${s.toFixed(1)}%`),!1):(await q.updateClass(Z,t),await C.invalidateQueries({queryKey:["class",r]}),ye({}),je(!0),console.log("[BOBOTS] âœ… Bobot values saved successfully"),!0)}catch(t){return console.error("[BOBOTS] âŒ Failed to save bobot values:",t),J(t instanceof Error?t.message:"Failed to save grade weights"),!1}finally{et(!1)}},cs=async()=>{console.log("[SAVE ALL] ðŸš€ Starting save all and finish"),console.log("[SAVE ALL] Attendance editing:",D),console.log("[SAVE ALL] Meeting editing:",B),console.log("[SAVE ALL] Grades editing:",j),Ye(!0);try{const t=B?Object.keys(O).map(n=>Number(n)).filter(n=>!Number.isNaN(n)).map(n=>it(n)):[];let s=!0;if(j&&Le&&(console.log("[SAVE ALL] Saving bobot values..."),s=await xt(),!s))throw new Error("Failed to save grade weights");const i=j?Object.entries(Y).map(([n])=>{let l;if(n.startsWith("nim:")){const d=n.substring(4);l=L.find(c=>c.nim===d)}else if(n.startsWith("krs:")){const d=Number(n.substring(4));l=L.find(c=>Ce(c)===d)}else if(n.startsWith("id:")){const d=Number(n.substring(3));l=L.find(c=>W(c)?.id===d)}const g=l?W(l):Y[n];return bt(n,g,l)}):[];console.log("[SAVE ALL] Meeting promises:",t.length),console.log("[SAVE ALL] Grade promises:",i.length);const a=D?as(!0):Promise.resolve();await Promise.all([Promise.all(t),Promise.all(i),a]),console.log("[SAVE ALL] âœ… All saves completed, exiting edit modes"),us()}catch(t){alert(t instanceof Error?t.message:"Failed to save changes")}finally{Ye(!1)}},te=(t,s,i)=>{H(a=>{const n={...a[t],[s]:i===""?null:i};if(Se.some(g=>g.key===s)){const g=He(n,Se);if(g!==null){const{huruf:d,indeks:c}=Be(g);n.nilai_angka=g,n.nilai_huruf=d,n.nilai_indeks=c}else n.nilai_angka=null,n.nilai_huruf=null,n.nilai_indeks=null}return{...a,[t]:n}})},ds=()=>{m(-1)},us=()=>{pt()},ps=async()=>{if(E.current){(window.React?.startTransition||(t=>t()))(()=>{se(!0)}),await new Promise(t=>setTimeout(t,0));try{const[{default:t},{default:s}]=await Promise.all([qe(()=>import("./html2canvas-pro.esm-BvaDPKdU.js"),[]),qe(()=>import("./jspdf.es.min-2pqXIzBy.js").then($=>$.j),__vite__mapDeps([0,1,2]))]),i=await t(E.current,{scale:1.5,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),a=210,n=297,l=i.height*a/i.width;let g=l;const d=new s("p","mm","a4");let c=0;const S=i.toDataURL("image/jpeg",.85);for(d.addImage(S,"JPEG",0,c,a,l),g-=n;g>0;)c=g-l,d.addPage(),d.addImage(S,"JPEG",0,c,a,l),g-=n;const k=`Class_Summary_${_e}_${Ne.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;d.save(k)}catch(t){console.error("Error generating PDF:",t),alert("Failed to generate PDF. Please try again.")}finally{se(!1)}}},bs=async()=>{re(!0);try{const t=await qe(()=>import("./xlsx-DGuHH-KN.js"),[]),s=t.utils.book_new(),i=[["Class Summary Report"],[],["Course Code",ke],["Course Name",Ne],["Class",_e],["Total SKS",$e],["Lecturers",Pe.join(", ")],["Total Students",L.length],["Total Meetings",R.length],["Generated Date",new Date().toLocaleDateString("id-ID")]],a=t.utils.aoa_to_sheet(i);a["!cols"]=[{wch:20},{wch:40}],t.utils.book_append_sheet(s,a,"Class Description");const l=[["NIM","Name",...Q.map(p=>`P${p.pertemuan_ke}`)]];L.forEach(p=>{const P=ot[p.nim]||{},v=[p.nim,p.nama];Q.forEach(x=>{const o=P[x.id]||"";v.push(o||"-")}),l.push(v)});const g=t.utils.aoa_to_sheet(l);g["!cols"]=[{wch:15},{wch:25},...Q.map(()=>({wch:12}))],t.utils.book_append_sheet(s,g,"Attendance Overview");const d=[["Meeting","Date","Time","Lecturers","Topic"],...Q.map(p=>{const P=p.tgl_pertemuan&&(typeof p.tgl_pertemuan=="string"||typeof p.tgl_pertemuan=="object"&&"Valid"in p.tgl_pertemuan&&p.tgl_pertemuan.Valid);let v="";p.topik&&(typeof p.topik=="string"?v=p.topik:"String"in p.topik&&p.topik.Valid&&(v=p.topik.String));const x=M(p.id_dosen),o=x&&K[x]?K[x]:"-";return[`P${p.pertemuan_ke}`,P?kt(p.tgl_pertemuan):"-",wt(p.jam_pertemuan),o,v||"-"]})],c=t.utils.aoa_to_sheet(d);c["!cols"]=[{wch:15},{wch:20},{wch:12},{wch:25},{wch:40}],t.utils.book_append_sheet(s,c,"Meeting Summary");const k=[["NIM","Name","Participation","Project","Quiz","Assignment","Midterm","Final","Numeric Grade","Letter Grade","Grade Index"]];L.forEach(p=>{const P=W(p)||{aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null},v=x=>{const o=P[x];return o==null?"":typeof o=="object"&&"Float64"in o?o.Valid?o.Float64:"":typeof o=="object"&&"String"in o?o.Valid?o.String:"":typeof o=="object"&&"Int32"in o?o.Valid?o.Int32:"":o};k.push([p.nim,p.nama,(()=>{const x=v("aktivitas_partisipatif");return x!==""?x:"-"})(),(()=>{const x=v("hasil_proyek");return x!==""?x:"-"})(),(()=>{const x=v("quiz");return x!==""?x:"-"})(),(()=>{const x=v("tugas");return x!==""?x:"-"})(),(()=>{const x=v("uts");return x!==""?x:"-"})(),(()=>{const x=v("uas");return x!==""?x:"-"})(),(()=>{const x=v("nilai_angka");return x!==""?x:"-"})(),(()=>{const x=v("nilai_huruf");return x!==""?x:"-"})(),(()=>{const x=v("nilai_indeks");return x!==""?x:"-"})()])}),k.push(["Component Weights","",`${h.aktivitas_partisipatif}%`,`${h.hasil_proyek}%`,`${h.quiz}%`,`${h.tugas}%`,`${h.uts}%`,`${h.uas}%`,"Total: 100%","",""]);const $=t.utils.aoa_to_sheet(k);$["!cols"]=[{wch:15},{wch:25},{wch:13},{wch:10},{wch:8},{wch:12},{wch:10},{wch:8},{wch:13},{wch:12},{wch:11}],t.utils.book_append_sheet(s,$,"Grades Overview");const w=`Class_Summary_${_e}_${Ne.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.xlsx`;t.writeFile(s,w)}catch(t){console.error("Error generating XLSX:",t),alert("Failed to generate XLSX. Please try again.")}finally{re(!1)}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("nav",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>m(`/${Ge}`),className:"flex items-center hover:text-gray-900 transition-colors",children:e.jsx(ws,{className:"h-4 w-4"})}),e.jsx(gt,{className:"h-4 w-4"}),e.jsx("button",{onClick:ds,className:"hover:text-gray-900 transition-colors",children:Ge==="lecturer/class-schedule"?"Class Schedule":Ge==="admin/class-management"?"Class Management":"Dashboard"}),e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Class Summary"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>D?ct():ns(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${D?"bg-blue-600 text-white":""}`,children:D?"Stop Attendance Editing":"Edit Attendance"}),e.jsx("button",{onClick:()=>B?dt():is(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${B?"bg-blue-600 text-white":""}`,children:B?"Stop Meeting Editing":"Edit Meetings"}),e.jsx("button",{onClick:()=>j?ut():os(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${j?"bg-blue-600 text-white":""}`,children:j?"Stop Grades Editing":"Edit Grades"}),Jt&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:cs,className:"btn-primary",disabled:Ct||!rs,children:"Save & Finish"}),e.jsx("button",{onClick:()=>pt(),className:"btn-secondary",children:"Cancel"})]})]}),D&&e.jsxs("div",{className:"text-xs text-gray-600 flex flex-col gap-3 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Status Brush:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a status with buttons below or use keyboard shortcuts (1..6), then click cells to apply. Press Esc to clear."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>G("Hadir"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F==="Hadir"?"bg-green-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 1",children:"1 - Hadir"}),e.jsx("button",{onClick:()=>G("Izin"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F==="Izin"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 2",children:"2 - Izin"}),e.jsx("button",{onClick:()=>G("Sakit"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F==="Sakit"?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 3",children:"3 - Sakit"}),e.jsx("button",{onClick:()=>G("Alfa"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F==="Alfa"?"bg-red-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 4",children:"4 - Alfa"}),e.jsx("button",{onClick:()=>G("Terlambat"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F==="Terlambat"?"bg-orange-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 5",children:"5 - Terlambat"}),e.jsx("button",{onClick:()=>G("Pengganti"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F==="Pengganti"?"bg-purple-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 6",children:"6 - Tugas"}),e.jsx("button",{onClick:()=>G(null),className:`px-3 py-1 rounded text-xs font-medium transition-all ${F===null?"bg-gray-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press Esc",children:"Clear Brush"})]}),e.jsxs("div",{className:"text-xs text-gray-700 bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"font-medium",children:"Current: "}),e.jsx("span",{className:"font-semibold",children:F===null?"None":F===""?"Kosong":F})]})]}),e.jsx("button",{onClick:ps,disabled:V||Oe,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:V?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate PDF Report"})]})}),e.jsx("button",{onClick:bs,disabled:pe||Oe,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:pe?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating XLSX..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate XLSX Report"})]})})]}),e.jsxs("div",{ref:E,className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 pt-6 pb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Summary"}),e.jsxs("p",{className:"text-base text-gray-600 mt-1",children:[ke&&e.jsx("span",{className:"font-medium",children:ke}),ke&&" - ",Ne," - Class ",_e,$e>0&&` (${$e} SKS)`]}),Pe.length>0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:Pe.join(", ")})]})}),e.jsx("div",{children:Oe?e.jsxs("div",{className:"flex items-center justify-center py-12 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading attendance data..."})]}):Re?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[e.jsx(ue,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading attendance data"}),e.jsx("p",{className:"text-sm text-red-600",children:Re instanceof Error?Re.message:"Unknown error"})]})]}):R.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No meetings scheduled for this class"})]}):L.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No students enrolled in this class"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attendance Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex gap-0",children:[e.jsx("div",{className:"flex-shrink-0 sticky left-0 z-10",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 align-top",children:e.jsx("div",{className:"min-h-[3.5rem] flex items-center",children:"NIM"})}),e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 align-top",children:e.jsx("div",{className:"min-h-[3.5rem] flex items-center",children:"Name"})})]})}),e.jsx("tbody",{children:L.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9",children:[e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900",children:t.nim}),e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate",children:t.nama})]},t.nim))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:Q.map(t=>{const s=t.tgl_pertemuan&&(typeof t.tgl_pertemuan=="string"||typeof t.tgl_pertemuan=="object"&&"Valid"in t.tgl_pertemuan&&t.tgl_pertemuan.Valid);return e.jsx("th",{className:"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-14 align-top",children:e.jsxs("div",{className:"min-h-[3.5rem] flex flex-col items-center justify-center gap-0.5",children:[e.jsxs("span",{className:"font-bold text-[10px]",children:["P",t.pertemuan_ke]}),s&&e.jsx("span",{className:"text-gray-500 font-normal text-[9px] whitespace-pre-line",children:Ts(t.tgl_pertemuan)})]})},t.id)})})}),e.jsx("tbody",{children:L.map(t=>{const s=ot[t.nim]||{};return e.jsx("tr",{className:"hover:bg-gray-50 h-9",children:Q.map(i=>{const a=De[`${t.nim}-${i.id}`]??s[i.id]??"",n=`${t.nim}-${i.id}`,l=Ie.has(n),g=It[n];return e.jsx("td",{className:`border-r border-b border-gray-300 px-1 py-1.5 text-center ${ts(a)} ${D?"cursor-pointer":""} ${l?"bg-yellow-50":""} ${Ze===n?"outline outline-2 outline-blue-500":""}`,onClick:()=>{D&&(F!==null?lt(n,F):le(n))},children:D&&Ze===n?e.jsxs("select",{autoFocus:!0,value:a,onChange:d=>lt(n,d.target.value),onBlur:()=>le(null),className:"text-[10px] px-1 py-0.5 bg-white border border-gray-300 rounded w-full",children:[e.jsx("option",{value:""}),vt.slice(1).map(d=>e.jsx("option",{value:d,children:d},d))]}):g?e.jsx(ve,{className:"h-4 w-4 animate-spin text-gray-500 mx-auto"}):es(a)},i.id)})},t.nim)})})]})})]})})})]}),e.jsx("div",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(mt,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-gray-600",children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ht,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Tugas"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"h-4 w-4 text-gray-300"}),e.jsx("span",{className:"text-gray-600",children:"No data"})]})]})}),e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Descriptions"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16",children:"Meeting"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-40",children:"Date"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-20",children:"Time"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48",children:"Lecturers"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Topic"})]})}),e.jsx("tbody",{children:Q.map(t=>{const s=t.tgl_pertemuan&&(typeof t.tgl_pertemuan=="string"||typeof t.tgl_pertemuan=="object"&&"Valid"in t.tgl_pertemuan&&t.tgl_pertemuan.Valid);let i="";return t.topik&&(typeof t.topik=="string"?i=t.topik:"String"in t.topik&&t.topik.Valid&&(i=t.topik.String)),e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"border-b border-gray-300 px-3 py-2 font-medium text-gray-900",children:["P",t.pertemuan_ke]}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:O[t.id]!==void 0?e.jsx("input",{type:"date",value:xe[t.id]||(()=>{if(!s)return"";let a="";if(typeof t.tgl_pertemuan=="string"?a=t.tgl_pertemuan:typeof t.tgl_pertemuan=="object"&&t.tgl_pertemuan.Valid&&(a=t.tgl_pertemuan.Time),!a)return"";const n=new Date(a);return isNaN(n.getTime())?"":n.toISOString().slice(0,10)})(),onChange:a=>ne(n=>({...n,[t.id]:a.target.value})),className:"input-field text-xs"}):s?kt(t.tgl_pertemuan):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:O[t.id]!==void 0?e.jsx("input",{type:"time",value:ge[t.id]||(()=>{const a=typeof t.jam_pertemuan=="string"?t.jam_pertemuan:t.jam_pertemuan&&"String"in t.jam_pertemuan&&t.jam_pertemuan.Valid?t.jam_pertemuan.String:"";if(!a)return"";const n=a.split(":");return n.length>=2?`${n[0].padStart(2,"0")}:${n[1].padStart(2,"0")}`:a})(),onChange:a=>ie(n=>({...n,[t.id]:a.target.value})),className:"input-field text-xs"}):wt(t.jam_pertemuan)}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:O[t.id]!==void 0?e.jsxs("select",{value:me[t.id]||"",onChange:a=>oe(n=>({...n,[t.id]:a.target.value})),className:"input-field text-xs w-full",children:[e.jsx("option",{value:"",children:"- No Lecturer -"}),rt.map(a=>e.jsx("option",{value:a,children:K[a]||a},a))]}):(()=>{const a=M(t.id_dosen);return a&&K[a]?K[a]:"-"})()}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:B?O[t.id]!==void 0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:O[t.id],onChange:a=>ae(n=>({...n,[t.id]:a.target.value})),className:"input-field w-full text-xs",placeholder:"Enter topic/description"}),e.jsx("button",{onClick:()=>it(t.id),disabled:Ve.isPending,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:"Save"}),e.jsx("button",{onClick:()=>nt(t.id),disabled:Ve.isPending,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate max-w-[28rem]",children:i||"-"}),e.jsx("button",{onClick:()=>{let a="";if(s){let d="";if(typeof t.tgl_pertemuan=="string"?d=t.tgl_pertemuan:typeof t.tgl_pertemuan=="object"&&t.tgl_pertemuan.Valid&&(d=t.tgl_pertemuan.Time),d){const c=new Date(d);isNaN(c.getTime())||(a=c.toISOString().slice(0,10))}}let n="";const l=typeof t.jam_pertemuan=="string"?t.jam_pertemuan:t.jam_pertemuan&&"String"in t.jam_pertemuan&&t.jam_pertemuan.Valid?t.jam_pertemuan.String:"";if(l){const d=l.split(":");d.length>=2&&(n=`${d[0].padStart(2,"0")}:${d[1].padStart(2,"0")}`)}const g=M(t.id_dosen);Zt(t.id,i,a,n,g)},className:"px-2 py-1 text-xs rounded bg-primary-600 text-white hover:bg-primary-700",children:"Edit"})]}):e.jsx("span",{children:i||"-"})})]},t.id)})})]})})]}),e.jsxs("div",{className:"px-6 py-3 pb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Grades Overview"})}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28",children:"NIM"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48",children:"Name"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Participation"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Project"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Quiz"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Assignment"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Midterm"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Final"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Numeric"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Letter"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),e.jsx("th",{className:`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20 ${j?"border-r":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Index"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),j&&e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-16",children:"Action"})]})}),e.jsxs("tbody",{children:[L.map(t=>{const s=W(t)||{id:0,krs_id:null,aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null},i=t.id_krs??t.krs_id??t.krsId??t.krs?.id??t.krs?.KRS?.id,a=s.id&&s.id>0?`id:${s.id}`:s.krs_id?`krs:${typeof s.krs_id=="object"?s.krs_id.Int32:s.krs_id}`:i?`krs:${i}`:`nim:${t.nim}`,n=Gt.has(a),l=j&&!n,g=s.id?Ft.has(s.id):!1,d=Y[a]||s,c=o=>{const f=d[o];return f==null?"":typeof f=="object"&&"Float64"in f?f.Valid?f.Float64:"":typeof f=="object"&&"String"in f?f.Valid?f.String:"":typeof f=="object"&&"Int32"in f?f.Valid?f.Int32:"":f},S=c("nilai_angka"),k=S!==""?S:j&&d?He(d,Se):null,{huruf:$,indeks:w}=k!==null&&k!==""?Be(k):{huruf:"",indeks:0},p=c("nilai_huruf"),P=p!==""?p:$,v=c("nilai_indeks"),x=v!==""?v:w;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 font-medium text-gray-900 w-28",children:t.nim}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-gray-900 w-48",children:t.nama}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:l?e.jsx("input",{type:"number",step:"0.1",value:c("aktivitas_partisipatif"),onChange:o=>te(a,"aktivitas_partisipatif",o.target.value?parseFloat(o.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const o=c("aktivitas_partisipatif");return o!==""?o:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:l?e.jsx("input",{type:"number",step:"0.1",value:c("hasil_proyek"),onChange:o=>te(a,"hasil_proyek",o.target.value?parseFloat(o.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const o=c("hasil_proyek");return o!==""?o:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:l?e.jsx("input",{type:"number",step:"0.1",value:c("quiz"),onChange:o=>te(a,"quiz",o.target.value?parseFloat(o.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const o=c("quiz");return o!==""?o:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:l?e.jsx("input",{type:"number",step:"0.1",value:c("tugas"),onChange:o=>te(a,"tugas",o.target.value?parseFloat(o.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const o=c("tugas");return o!==""?o:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:l?e.jsx("input",{type:"number",step:"0.1",value:c("uts"),onChange:o=>te(a,"uts",o.target.value?parseFloat(o.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const o=c("uts");return o!==""?o:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:l?e.jsx("input",{type:"number",step:"0.1",value:c("uas"),onChange:o=>te(a,"uas",o.target.value?parseFloat(o.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const o=c("uas");return o!==""?o:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20",children:e.jsxs("div",{className:`px-2 py-1 rounded ${l?"bg-blue-50 text-blue-900":""}`,children:[e.jsx("span",{children:k!==null&&k!==""?k:"-"}),l&&k!==null&&k!==""&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"âœ“"})]})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-bold text-blue-600 w-20",children:e.jsxs("div",{className:`px-2 py-1 rounded ${l?"bg-blue-50":""}`,children:[e.jsx("span",{children:P||"-"}),l&&P&&e.jsx("span",{className:"text-xs ml-1",children:"âœ“"})]})}),e.jsx("td",{className:`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20 ${j?"border-r":""}`,children:e.jsxs("div",{className:`px-2 py-1 rounded ${l?"bg-blue-50 text-blue-900":""}`,children:[e.jsx("span",{children:x||"-"}),l&&x&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"âœ“"})]})}),j&&e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-center",children:n?e.jsx("button",{onClick:()=>{ce(f=>{const de=new Set(f);return de.delete(a),de});const o=W(t);o&&H(f=>({...f,[a]:o}))},className:"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>bt(a,s,t),disabled:g,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:g?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{const o=W(t);H(o?f=>({...f,[a]:o}):f=>{const de={...f};return delete de[a],de}),ce(f=>new Set([...f,a]))},disabled:g,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})})]},t.nim)}),e.jsxs("tr",{className:"bg-blue-50 font-bold",children:[e.jsxs("td",{colSpan:2,className:"border-r border-b border-gray-300 px-3 py-2 text-gray-900",children:["Component Weights",j&&e.jsx("div",{className:"text-xs font-normal text-gray-500 mt-1",children:"(Total must be 100%)"})]}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:j?e.jsx("input",{type:"text",value:h.aktivitas_partisipatif,onChange:t=>ee("bobot_partisipatif",t.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${h.aktivitas_partisipatif}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:j?e.jsx("input",{type:"text",value:h.hasil_proyek,onChange:t=>ee("bobot_proyek",t.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${h.hasil_proyek}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:j?e.jsx("input",{type:"text",value:h.quiz,onChange:t=>ee("bobot_kuis",t.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${h.quiz}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:j?e.jsx("input",{type:"text",value:h.tugas,onChange:t=>ee("bobot_tugas",t.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${h.tugas}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:j?e.jsx("input",{type:"text",value:h.uts,onChange:t=>ee("bobot_uts",t.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${h.uts}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:j?e.jsx("input",{type:"text",value:h.uas,onChange:t=>ee("bobot_uas",t.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${h.uas}%`}),e.jsxs("td",{colSpan:3,className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900",children:[e.jsxs("div",{className:"text-blue-600",children:["Total: ",(h.aktivitas_partisipatif+h.hasil_proyek+h.quiz+h.tugas+h.uts+h.uas).toFixed(1),"%"]}),tt&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:tt})]}),e.jsx("td",{className:`border-b border-gray-300 px-3 py-2 text-center ${j?"":"hidden"}`,children:j&&e.jsx(e.Fragment,{children:Lt?e.jsx("button",{onClick:()=>{je(!1)},className:"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>xt(),disabled:Fe,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:Fe?"Saving...":"Save"}),e.jsx("button",{onClick:ls,disabled:Fe,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})})})]})]})]})})})]})]})})]})]})};export{Vs as default};
//# sourceMappingURL=ClassSummary-Dy5VLy3r.js.map
