import{j as e}from"./query-vendor-B--u1oZD.js";import{r as h}from"./react-vendor-XXJdR_Id.js";import{u as L,a as M,d as v,f as p,g as j,h as n}from"./index-CU8_O-g9.js";import{x as T,t as W,d as P,Q as $}from"./ui-vendor-CkH0jJa3.js";const O=()=>{const{user:y,currentSemester:o}=L(),{t:a}=M(),[I,x]=h.useState(!0),[f,N]=h.useState(null),[m,G]=h.useState([]);h.useEffect(()=>{(async()=>{if(!y?.studentId||!o){N("Student information or semester not available"),x(!1);return}try{x(!0),N(null);const r=await v.getEnrollments(y.studentId,o);if(!r||!Array.isArray(r)||r.length===0){G([]),x(!1);return}const u=new Map,D=r.filter(d=>p(d.kode_mk)).map(async d=>{const s=p(d.kode_mk);try{const i=await v.getCourseByCode(s);i&&u.set(s,i)}catch(i){console.error(`Failed to fetch course ${s}:`,i)}});await Promise.all(D);const q=r.map(async d=>{try{const s=await v.getGrades({krs_id:d.id});return{enrollment:d,grade:s[0]||null}}catch(s){return console.error(`Failed to fetch grade for enrollment ${d.id}:`,s),{enrollment:d,grade:null}}}),z=(await Promise.all(q)).map(({enrollment:d,grade:s})=>{const i=p(d.kode_mk)||"",l=u.get(i),H=j(l?.sks_tatap_muka)+j(l?.sks_praktek)+j(l?.sks_prak_lapangan)+j(l?.sks_simulasi),b=s?n(s.aktivitas_partisipatif)??void 0:void 0,w=s?n(s.hasil_proyek)??void 0:void 0,_=s?n(s.quiz)??void 0:void 0,C=s?n(s.tugas)??void 0:void 0,S=s?n(s.uts)??void 0:void 0,F=s?n(s.uas)??void 0:void 0,K=b!==void 0&&w!==void 0&&_!==void 0&&C!==void 0&&S!==void 0&&F!==void 0;return{enrollmentId:d.id,courseCode:i,courseName:l?.nama_mk||i,credits:H,aktivitasPartisipatif:b,hasilProyek:w,quiz:_,tugas:C,uts:S,uas:F,nilaiAngka:s?n(s.nilai_angka)??void 0:void 0,nilaiHuruf:s?p(s.nilai_huruf)??void 0:void 0,nilaiIndeks:s?n(s.nilai_indeks)??void 0:void 0,hasCompleteGrades:K}});G(z)}catch(r){console.error("Error fetching grades data:",r),N(r instanceof Error?r.message:"Failed to load grades")}finally{x(!1)}})()},[y?.studentId,o]);const k=m.filter(t=>t.hasCompleteGrades),A=m.reduce((t,r)=>t+r.credits,0),g=k.reduce((t,r)=>t+r.credits,0),E=k.reduce((t,r)=>{const u=r.nilaiIndeks??0;return t+r.credits*u},0),c=g>0?E/g:null;return I?e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-center py-12",children:[e.jsx(T,{className:"h-8 w-8 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:a("common.loading")})]}):f?e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"card bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(W,{className:"h-5 w-5"}),e.jsx("span",{children:f})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a("studentGrades.title")}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a("studentGrades.semester"),": ",o]})]}),e.jsxs("div",{className:"card grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:a("studentGrades.totalCredits")}),e.jsxs("div",{className:"text-lg font-semibold",children:[A," SKS"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:a("studentGrades.semesterGPA")}),e.jsx("div",{className:"text-lg font-semibold",children:c!==null?c.toFixed(2):"-"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-5 w-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:a("studentGrades.status")}),e.jsx("div",{className:"text-lg font-semibold",children:c!==null?c>=3?a("studentGrades.goodStanding"):c>=2?a("studentGrades.warning"):a("studentGrades.probation"):"-"})]})]})]}),m.length===0?e.jsx("div",{className:"card text-center py-12 text-gray-500",children:a("studentGrades.noGrades")}):e.jsx("div",{className:"card overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b-2 border-gray-200",children:[e.jsx("th",{className:"py-3 px-2",children:a("studentGrades.courseCode")}),e.jsx("th",{className:"py-3 px-2",children:a("studentGrades.courseName")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.credits")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.participation")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.project")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.quiz")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.assignment")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.uts")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.uas")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.total")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.grade")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.index")})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2 font-medium text-gray-900",children:t.courseCode}),e.jsx("td",{className:"py-3 px-2",children:t.courseName}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.credits}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.aktivitasPartisipatif?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.hasilProyek?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.quiz?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.tugas?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.uts?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.uas?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center font-medium",children:t.nilaiAngka?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center font-semibold text-primary-600",children:t.hasCompleteGrades?t.nilaiHuruf??"-":"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:t.hasCompleteGrades?t.nilaiIndeks?.toFixed(2)??"-":"-"})]},t.enrollmentId))})]})})]})};export{O as default};
//# sourceMappingURL=GradesKHS-NTmgfbTb.js.map
