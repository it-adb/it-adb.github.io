const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-2pqXIzBy.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js"])))=>i.map(i=>d[i]);
import{j as e,_ as A}from"./query-vendor-B--u1oZD.js";import{r as p}from"./react-vendor-XXJdR_Id.js";import{g as pe}from"./status-sB_rSvKV.js";import"./index-1e-qg3UH.js";import{X as Y,r as T,s as q,v as w,w as Q,g as Z,u as G,x as ee,y as se,F as M,a6 as ue}from"./ui-vendor-C-UqR_Df.js";const De=()=>{const[h,_]=p.useState([]),[v,O]=p.useState(!1),[D,S]=p.useState(null),[X,I]=p.useState(null),[r,C]=p.useState(null),N=p.useRef(null),[U,F]=p.useState(!1),[L,B]=p.useState(!1),[K,$]=p.useState({current:0,total:0}),te=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return e.jsx(w,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(Z,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(G,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(Q,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(w,{className:"h-4 w-4 text-purple-600"});case"alpa":case"absent":return e.jsx(ee,{className:"h-4 w-4 text-red-600"});default:return e.jsx(se,{className:"h-4 w-4 text-gray-300"})}},ae=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return"bg-green-50 text-green-700";case"izin":case"excused":return"bg-blue-50 text-blue-700";case"sakit":case"sick":return"bg-yellow-50 text-yellow-700";case"terlambat":case"late":return"bg-orange-50 text-orange-700";case"pengganti":case"substitute":return"bg-purple-50 text-purple-700";case"alpa":case"absent":return"bg-red-50 text-red-700";default:return"bg-gray-50 text-gray-400"}},re=async s=>{const l=await A(()=>import("./xlsx-DGuHH-KN.js"),[]),t=await s.arrayBuffer(),a=l.read(t,{type:"array"}),i=a.Sheets["Class Description"];if(!i)throw new Error("Class Description sheet not found");const n=l.utils.sheet_to_json(i,{header:1});let d="",x="",g="";const o={};n.forEach(m=>{const c=m;c[0]&&c[1]&&(o[c[0]]=c[1])}),d=o["Course Code"]||"N/A",x=o.Class||"N/A",g=o["Course Name"]||"N/A";const f=o.Lecturers||"",k=o["Total SKS"]||o.SKS||"",P=a.Sheets["Attendance Overview"];if(!P)throw new Error("Attendance Overview sheet not found");let b=l.utils.sheet_to_json(P,{header:1});const E=m=>!m||m.every(c=>c==null||String(c).trim()==="");b.length>0&&(b=[b[0],...b.slice(1).filter(m=>!E(m))]);const he=n,W=a.Sheets["Meeting Summary"];if(!W)throw new Error("Meeting Summary sheet not found");let j=l.utils.sheet_to_json(W,{header:1});if(j.length>0){j=[j[0],...j.slice(1).filter(c=>!E(c))];const m=c=>{if(c instanceof Date&&!isNaN(c.getTime()))return c.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"});const R=typeof c=="number"?c:typeof c=="string"&&/^\d+(\.\d+)?$/.test(c.trim())?parseFloat(c):NaN;if(!isNaN(R)){const u=new Date(Date.UTC(1899,11,30)),ge=R*24*60*60*1e3;return new Date(u.getTime()+ge).toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"})}return typeof c=="string"?c:""};j=j.map((c,R)=>{if(R===0)return c;const u=[...c];return u[1]!==void 0&&u[1]!==null&&String(u[1]).trim()!==""&&(u[1]=m(u[1])),u})}let y;const J=a.Sheets["Grades Overview"];return J&&(y=l.utils.sheet_to_json(J,{header:1}),y.length>0&&(y=[y[0],...y.slice(1).filter(m=>!E(m))])),{id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fileName:s.name,courseCode:d,className:x,courseName:g,lecturers:f,totalSKS:k,classDescData:he,attendanceData:b,meetingSummaryData:j,gradesData:y}},V=async s=>{const l=Array.from(s||[]).filter(n=>/\.xlsx?$/i.test(n.name));if(l.length===0)return;O(!0),S(null);const t=await Promise.allSettled(l.map(n=>re(n))),a=[];let i=0;if(t.forEach(n=>{n.status==="fulfilled"?a.push(n.value):i+=1}),a.length>0){_(x=>[...x,...a]);const n=a.length===1?"1 file":`${a.length} files`,d=i>0?` (⚠️ ${i} failed)`:"";S({type:"success",text:`${n} berhasil diimpor${d}.`})}else S({type:"error",text:"Gagal membaca semua file. Pastikan setiap file memiliki sheet: Class Description, Attendance Overview, Meeting Summary."});O(!1)},le=async s=>{const l=s.target.files;l&&l.length>0&&await V(l),s.target.value=""},z=s=>{s.preventDefault(),s.stopPropagation(),U||F(!0)},ne=s=>{s.preventDefault(),s.stopPropagation(),F(!1)},ce=async s=>{s.preventDefault(),s.stopPropagation(),F(!1),s.dataTransfer?.files&&s.dataTransfer.files.length>0&&(await V(s.dataTransfer.files),s.dataTransfer.clearData())},ie=s=>{C(s)},de=()=>{C(null)},H=async(s,l)=>{try{const[{default:t},{default:a}]=await Promise.all([A(()=>import("./html2canvas-pro.esm-BvaDPKdU.js"),[]),A(()=>import("./jspdf.es.min-2pqXIzBy.js").then(b=>b.j),__vite__mapDeps([0,1,2]))]),i=await t(l,{scale:1.5,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),n=210,d=297,x=i.height*n/i.width;let g=x;const o=new a("p","mm","a4");let f=0;const k=i.toDataURL("image/jpeg",.85);for(o.addImage(k,"JPEG",0,f,n,x),g-=d;g>0;)f=g-x,o.addPage(),o.addImage(k,"JPEG",0,f,n,x),g-=d;const P=`Class_Summary_${s.className}_${s.courseName.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;return o.save(P),!0}catch(t){return console.error("Error generating PDF:",t),!1}},oe=async()=>{if(N.current){I("pdf-generation");try{await H(r,N.current)}catch(s){console.error("Error generating PDF:",s),alert("Failed to generate PDF. Please try again.")}finally{I(null)}}},xe=async()=>{if(h.length===0)return;B(!0),$({current:0,total:h.length});let s=0,l=0;for(let a=0;a<h.length;a++){const i=h[a];$({current:a+1,total:h.length}),C(i),await new Promise(n=>setTimeout(n,100)),N.current&&(await H(i,N.current)?s++:l++,await new Promise(d=>setTimeout(d,300)))}C(null),B(!1),$({current:0,total:0});const t=l>0?`Bulk generation complete: ${s} succeeded, ${l} failed`:`Successfully generated ${s} PDF reports!`;S({type:l>0?"error":"success",text:t})},me=s=>{_(l=>l.filter(t=>t.id!==s))};if(r){const s=r.attendanceData&&r.attendanceData.length>0?r.attendanceData[0].slice(2):[],l={};return r.meetingSummaryData&&r.meetingSummaryData.length>1&&r.meetingSummaryData.slice(1).forEach(t=>{const a=t[0],i=t[1];a&&i&&(l[a]=i)}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:de,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Close Report"})]}),e.jsx("button",{onClick:oe,disabled:X==="pdf-generation",className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:X==="pdf-generation"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate PDF Report"})]})})]}),e.jsxs("div",{ref:N,className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 pt-6 pb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Summary"}),e.jsxs("p",{className:"text-base text-gray-600 mt-1",children:[r.courseCode&&e.jsx("span",{className:"font-medium",children:r.courseCode}),r.courseCode&&" - ",r.courseName," - Class ",r.className,r.totalSKS&&` (${r.totalSKS} SKS)`]}),r.lecturers&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:r.lecturers})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attendance Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex gap-0",children:[e.jsx("div",{className:"flex-shrink-0 sticky left-0 z-10",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 h-14",children:"NIM"}),e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 h-14",children:"Name"})]})}),e.jsx("tbody",{children:r.attendanceData?.slice(1).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9",children:[e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900",children:t[0]||"-"}),e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate",children:t[1]||"-"})]},a))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:s.map((t,a)=>e.jsx("th",{className:"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-16 h-14",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("span",{className:"font-bold text-[10px]",children:t}),l[t]&&e.jsx("span",{className:"text-gray-500 font-normal text-[9px]",children:l[t]})]})},a))})}),e.jsx("tbody",{children:r.attendanceData?.slice(1).map((t,a)=>e.jsx("tr",{className:"hover:bg-gray-50 h-9",children:t.slice(2).map((i,n)=>e.jsx("td",{className:`border-r border-b border-gray-300 px-1 py-1.5 text-center ${ae(i)}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1 justify-center",children:[te(i),e.jsx("span",{className:"text-[10px] text-gray-700",children:pe(i)})]})},n))},a))})]})})]})})})]}),e.jsx("div",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-gray-600",children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Tugas"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4 text-gray-300"}),e.jsx("span",{className:"text-gray-600",children:"No data"})]})]})}),e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Descriptions"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16",children:"Meeting"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28",children:"Date"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Topic"})]})}),e.jsx("tbody",{children:r.meetingSummaryData?.slice(1).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 font-medium text-gray-900",children:t[0]||"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:t[1]||"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:t[2]||"-"})]},a))})]})})]}),r.gradesData&&r.gradesData.length>0&&e.jsxs("div",{className:"px-6 py-3 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grades Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:r.gradesData[0].map((t,a)=>e.jsx("th",{className:`border-${a<r.gradesData[0].length-1?"r":""} border-b border-gray-300 px-3 py-2 ${a<=1?"text-left":"text-center"} font-semibold text-gray-700`,children:t},a))})}),e.jsx("tbody",{children:r.gradesData.slice(1).map((t,a)=>a===r.gradesData.length-2||t[0]&&String(t[0]).toLowerCase().includes("weight")?e.jsxs("tr",{className:"bg-blue-50 font-bold",children:[e.jsx("td",{colSpan:2,className:"border-r border-b border-gray-300 px-3 py-2 text-left text-gray-900",children:t[0]}),t.slice(2,8).map((n,d)=>e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600",children:n},d+2)),e.jsx("td",{colSpan:3,className:"border-b border-gray-300 px-3 py-2 text-center text-blue-600",children:t[8]})]},a):e.jsx("tr",{className:"hover:bg-gray-50",children:t.map((n,d)=>{const x=d===0,g=d===1,o=d===r.gradesData[0].length-2,f=d>=r.gradesData[0].length-3;return e.jsx("td",{className:`border-${d<t.length-1?"r":""} border-b border-gray-300 px-3 py-2 ${d<=1?"text-left":"text-center"} ${x?"font-medium text-gray-900":g?"text-gray-900":o?"font-bold text-blue-600":f?"font-semibold text-gray-900":"text-gray-600"}`,children:n??"-"},d)})},a))})]})})})]})]})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Report Generator"}),e.jsx("p",{className:"text-gray-600",children:"Import XLSX files dan generate laporan kelas"})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Upload XLSX Report"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${U?"border-blue-500 bg-blue-50":"border-blue-300 hover:border-blue-400"}`,onDragOver:z,onDragEnter:z,onDragLeave:ne,onDrop:ce,children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",multiple:!0,onChange:le,disabled:v,className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(ue,{className:"h-12 w-12 text-blue-400 mb-3"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Drag and drop your XLSX files"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"atau klik untuk memilih file"}),e.jsx("p",{className:"text-xs text-gray-400 mt-3",children:"File harus memiliki sheet: Class Description, Attendance Overview, Meeting Summary"}),v&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-blue-600",children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Processing file(s)..."})]})]})})]}),D&&e.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-lg ${D.type==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[D.type==="success"?e.jsx(w,{className:"h-5 w-5 flex-shrink-0"}):e.jsx(G,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:D.text})]})]})}),h.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Imported Reports (",h.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:xe,disabled:L||v,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:L?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsxs("span",{children:["Generating ",K.current,"/",K.total,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Bulk Generate All PDFs"})]})}),e.jsxs("button",{onClick:()=>_([]),disabled:L||v||h.length===0,className:"btn-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Remove All"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:h.map(s=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:[s.courseCode&&e.jsx("span",{className:"text-blue-600",children:s.courseCode}),s.courseCode&&" - ",s.courseName," - Class ",s.className]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["File: ",s.fileName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>ie(s),className:"flex-1 btn-primary flex items-center justify-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"View Report"})]}),e.jsx("button",{onClick:()=>me(s.id),className:"flex-1 btn-secondary flex items-center justify-center space-x-2",children:e.jsx("span",{children:"Remove"})})]})]})},s.id))})]}):e.jsxs("div",{className:"text-center py-12 card p-6",children:[e.jsx(M,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Reports Imported Yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Upload XLSX files to generate class reports"})]})]})};export{De as default};
//# sourceMappingURL=Reports-DBROH0z7.js.map
