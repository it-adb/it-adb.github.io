import{j as e}from"./query-vendor-B--u1oZD.js";import{r as m,g as X}from"./react-vendor-XXJdR_Id.js";import{u as Y,e as M,c as y}from"./index-C1kkCffi.js";import{u as ee,a as te}from"./useClasses-K0xObK0J.js";import{C as T}from"./CheckInModal-BF5kcR8_.js";import{r as se,c as ae}from"./ui-vendor-DIF6S0il.js";const ne=d=>{const r=M(d);if(!r)return null;const x=r.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[x]||null},re=d=>{const r=y(d);if(!r)return"00:00";const x=r.split("T")[1]?.split(".")[0]||r.split("T")[1]?.split("Z")[0];return x?x.substring(0,5):new Date(r).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})},oe=()=>{const d=new Date,r=d.getDay(),x=r===0?0:r,c=new Date(d);c.setDate(d.getDate()-x),c.setHours(0,0,0,0);const h=new Date(c);return h.setDate(c.getDate()+6),h.setHours(23,59,59,999),{start:c,end:h}},xe=()=>{const{user:d}=Y(),[r,x]=m.useState([]),[c,h]=m.useState(!1),[A,b]=m.useState(null),[E,j]=m.useState(""),[$,N]=m.useState(""),[O,w]=m.useState(""),[W,I]=m.useState(!1),[D,S]=m.useState(null),{start:P,end:F}=X.useMemo(()=>oe(),[]),L=P.toISOString().split("T")[0],H=F.toISOString().split("T")[0],{data:k=[]}=ee(d?.studentId||"",{start_day:L,end_day:H}),{data:p=[]}=te(),B=(t,a)=>{b(t),j(a),h(!0)},R=()=>{h(!1),b(null),j("")},U=t=>{S(t),N(t.link_bukti||""),w(t.deskripsi||""),I(!0)},z=()=>{S(null),N(""),w(""),I(!1)},_=t=>Array.isArray(p)&&p.some(a=>a.id_pertemuan===t),K=t=>Array.isArray(p)?p.find(a=>a.id_pertemuan===t):void 0,V=(t,a)=>t.actualDate?_(t.meetingId)?{allowed:!1,reason:"Already checked in"}:a?{allowed:!0}:{allowed:!1,reason:"Attendance not yet active"}:{allowed:!1,reason:"Invalid meeting date"},Z=t=>{const a=t.toLowerCase();return a==="hadir"?{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}:a==="izin"||a==="sakit"?{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-700",icon:"text-yellow-600"}:a==="alfa"?{border:"border-red-300",bg:"bg-red-50",text:"text-red-700",icon:"text-red-600"}:a==="terlambat"?{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"}:{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}},C=t=>{if(!t)return null;try{const a=new Date(t);return isNaN(a.getTime())?null:{date:a.toLocaleDateString("id-ID",{day:"numeric",month:"short"}),time:a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}}catch{return null}};return m.useEffect(()=>{const t=[];k.forEach(s=>{s.meeting_schedules.forEach(n=>{const g=ne(n.tgl_pertemuan);if(!g)return;const l=re(n.jam_pertemuan),o=M(n.tgl_pertemuan);if(!o)return;const i=s.sks_tatap_muka+s.sks_praktek+s.sks_prak_lapangan+s.sks_simulasi,u=i*60,[f,q]=l.split(":").map(Number),v=f*60+q+u,G=Math.floor(v/60)%24,J=v%60,Q=`${String(G).padStart(2,"0")}:${String(J).padStart(2,"0")}`;t.push({id:`${s.kelas_id}-${n.id}`,day:g,startTime:l,endTime:Q,courseCode:s.kode_mk,courseName:s.nama_mk,className:s.nama_kelas,credits:i,room:y(n.media_pembelajaran,"TBA"),topic:y(n.topik,""),weekNumber:n.pertemuan_ke,classId:s.kelas_id,actualDate:o,meetingId:n.id})})});const a=t.filter(s=>s.actualDate).map(s=>{const n=s.actualDate.getDay();return{...s,weekDay:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[n]||"Monday"}}).sort((s,n)=>!s.actualDate||!n.actualDate?0:s.actualDate.getTime()-n.actualDate.getTime());x(a)},[k]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Dashboard"})}),r.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"This Week's Schedule"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(t=>{const s=k.find(u=>u.kelas_id===t.classId)?.meeting_schedules.find(u=>u.id===t.meetingId),n=s?.absensi_aktif===!0||typeof s?.absensi_aktif=="object"&&s.absensi_aktif?.Valid&&s.absensi_aktif?.Bool,g=_(t.meetingId),l=V(t,n),o=K(t.meetingId),i=o?Z(o.status_kehadiran):null;return e.jsxs("div",{onClick:()=>l.allowed&&B(t.meetingId,t.courseName),className:`p-3 border rounded-lg transition-colors flex flex-col ${g&&i?`${i.border} ${i.bg} cursor-default`:l.allowed?"border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer":"border-gray-300 bg-gray-100 cursor-not-allowed"}`,title:l.allowed?void 0:l.reason,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2.5 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:t.weekDay}),t.actualDate&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-0.5 bg-gray-100 rounded",children:t.actualDate.toLocaleDateString("id-ID",{day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[g&&o&&i&&e.jsxs("div",{className:`flex items-center gap-1 text-xs ${i.text} font-medium`,children:[e.jsx(se,{className:`h-3 w-3 ${i.icon}`}),e.jsx("span",{children:"Checked In"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Week ",t.weekNumber]})]})]}),e.jsx("div",{className:"text-xs font-semibold text-primary-600 mb-1",children:t.courseCode}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:t.courseName}),t.topic&&e.jsx("div",{className:"text-xs text-gray-600 mb-2 italic line-clamp-2",children:t.topic})]}),e.jsx("div",{className:"flex flex-col gap-1 text-xs text-gray-600 border-t border-gray-100 pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ae,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:[t.startTime," - ",t.endTime]})]})}),g&&o&&i&&e.jsx("div",{className:`mt-2 pt-2 border-t ${i.border}`,children:e.jsx("div",{className:"text-xs text-gray-600 space-y-0.5",children:(()=>{const u=C(o.waktu_masuk),f=o.waktu_keluar?C(o.waktu_keluar):null;return e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Check-in:"}),e.jsxs("span",{className:"font-medium",children:[u.date," ",u.time]})]}),f&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Check-out:"}),e.jsx("span",{className:"font-medium",children:f.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`font-medium ${i.text}`,children:o.status_kehadiran})]}),e.jsx("button",{onClick:()=>U(o),className:"mt-2 w-full text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",type:"button",children:"Update Proof/Description"})]})})()})}),!g&&!l.allowed&&e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center italic",children:l.reason})]},t.id)})})]}),e.jsx(T,{isOpen:c,meetingId:A,courseName:E,onClose:R}),e.jsx(T,{isOpen:W,meetingId:D?.id_pertemuan||null,courseName:D?.nama_mk||"",onClose:z,editMode:!0,existingProof:$,existingDescription:O})]})};export{xe as default};
//# sourceMappingURL=StudentDashboard-D-xsUco4.js.map
