{"version":3,"file":"index-D-Q98uHv.js","sources":["../../src/hooks/useUsers.ts","../../src/pages/admin/UserManagement/UserStatsCards.tsx","../../src/pages/admin/UserManagement/types.ts","../../src/pages/admin/UserManagement/UserTable.tsx","../../src/pages/admin/UserManagement/UserFormModal.tsx","../../src/pages/admin/UserManagement/UserGrades.tsx","../../src/pages/admin/UserManagement/UserAttendance.tsx","../../src/pages/admin/UserManagement/UserAssignments.tsx","../../src/pages/admin/UserManagement/useUserManagement.ts","../../src/pages/admin/UserManagement/index.tsx"],"sourcesContent":["import { useQuery, useMutation, useQueryClient, type UseMutationOptions, type UseQueryOptions } from '@tanstack/react-query';\r\nimport { apiService, type MessageResponse } from '../services/api';\r\nimport type { BackendUser, PaginatedUsersResponse, CreateUserRequest, UpdateUserRequest, Mahasiswa, Dosen, BulkCreateUsersRequest } from '../types';\r\n\r\n// Users list with pagination/search\r\nexport function useUsersList(\r\n  params: { q?: string; limit?: number; offset?: number },\r\n  options?: Omit<UseQueryOptions<PaginatedUsersResponse, Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['users', params.q ?? null, params.limit ?? null, params.offset ?? null] as const;\r\n  return useQuery<PaginatedUsersResponse, Error>({\r\n    queryKey: key,\r\n    queryFn: () => apiService.getUsers(params),\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n\r\nexport const usersQueryRootKey = ['users'] as const;\r\n\r\n// Students and lecturers master lists (optionally filter by program)\r\nexport function useStudentsList(\r\n  kode_prodi?: string,\r\n  options?: Omit<UseQueryOptions<Mahasiswa[], Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['students', kode_prodi ?? null] as const;\r\n  return useQuery<Mahasiswa[], Error>({\r\n    queryKey: key,\r\n    queryFn: () => apiService.getStudents(kode_prodi),\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n\r\nexport function useLecturersList(\r\n  kode_prodi?: string,\r\n  options?: Omit<UseQueryOptions<Dosen[], Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['lecturers', kode_prodi ?? null] as const;\r\n  return useQuery<Dosen[], Error>({\r\n    queryKey: key,\r\n    queryFn: () => apiService.getLecturers(kode_prodi),\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n\r\n// Fetch single lecturer by id\r\nexport function useLecturerById(\r\n  id?: string,\r\n  options?: Omit<UseQueryOptions<Dosen, Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['lecturer', id ?? null] as const;\r\n  return useQuery<Dosen, Error>({\r\n    queryKey: key,\r\n    queryFn: () => apiService.getLecturerByID(String(id)),\r\n    enabled: !!id,\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n\r\n// User mutations\r\nexport function useCreateUser(\r\n  options?: UseMutationOptions<BackendUser, Error, CreateUserRequest>\r\n) {\r\n  const qc = useQueryClient();\r\n  return useMutation<BackendUser, Error, CreateUserRequest>({\r\n    mutationFn: (payload) => apiService.createUser(payload),\r\n    onSuccess: (...args) => {\r\n      // Invalidate all users queries\r\n      qc.invalidateQueries({ queryKey: usersQueryRootKey });\r\n      options?.onSuccess?.(...args);\r\n    },\r\n    ...options,\r\n  });\r\n}\r\n\r\nexport function useUpdateUser(\r\n  options?: UseMutationOptions<MessageResponse, Error, { id: number; data: UpdateUserRequest }>\r\n) {\r\n  const qc = useQueryClient();\r\n  return useMutation<MessageResponse, Error, { id: number; data: UpdateUserRequest}>({\r\n    mutationFn: ({ id, data }) => apiService.updateUser(id, data),\r\n    onSuccess: (...args) => {\r\n      qc.invalidateQueries({ queryKey: usersQueryRootKey });\r\n      options?.onSuccess?.(...args);\r\n    },\r\n    ...options,\r\n  });\r\n}\r\n\r\nexport function useDeleteUser(\r\n  options?: UseMutationOptions<MessageResponse, Error, { id: number }>\r\n) {\r\n  const qc = useQueryClient();\r\n  return useMutation<MessageResponse, Error, { id: number }>({\r\n    mutationFn: ({ id }) => apiService.deleteUser(id),\r\n    onSuccess: (...args) => {\r\n      qc.invalidateQueries({ queryKey: usersQueryRootKey });\r\n      options?.onSuccess?.(...args);\r\n    },\r\n    ...options,\r\n  });\r\n}\r\n\r\nexport function useBulkCreateUsers(\r\n  options?: UseMutationOptions<MessageResponse, Error, BulkCreateUsersRequest>\r\n) {\r\n  const qc = useQueryClient();\r\n  return useMutation<MessageResponse, Error, BulkCreateUsersRequest>({\r\n    mutationFn: (payload) => apiService.bulkCreateUsers(payload),\r\n    onSuccess: (...args) => {\r\n      qc.invalidateQueries({ queryKey: usersQueryRootKey });\r\n      options?.onSuccess?.(...args);\r\n    },\r\n    ...options,\r\n  });\r\n}\r\n\r\n// Entity mutations used by bulk import flows\r\nexport function useCreateStudent(\r\n  options?: UseMutationOptions<MessageResponse, Error, import('../types').CreateMahasiswaRequest>\r\n) {\r\n  const qc = useQueryClient();\r\n  return useMutation<MessageResponse, Error, import('../types').CreateMahasiswaRequest>({\r\n    mutationFn: (payload) => apiService.createStudent(payload),\r\n    onSuccess: (...args) => {\r\n      qc.invalidateQueries({ queryKey: ['students'] });\r\n      options?.onSuccess?.(...args);\r\n    },\r\n    ...options,\r\n  });\r\n}\r\n\r\nexport function useCreateLecturer(\r\n  options?: UseMutationOptions<MessageResponse, Error, import('../types').CreateDosenRequest>\r\n) {\r\n  const qc = useQueryClient();\r\n  return useMutation<MessageResponse, Error, import('../types').CreateDosenRequest>({\r\n    mutationFn: (payload) => apiService.createLecturer(payload),\r\n    onSuccess: (...args) => {\r\n      qc.invalidateQueries({ queryKey: ['lecturers'] });\r\n      options?.onSuccess?.(...args);\r\n    },\r\n    ...options,\r\n  });\r\n}\r\n","/**\r\n * User Statistics Cards Component\r\n */\r\n\r\nimport React from 'react';\r\nimport { Users, Shield } from 'lucide-react';\r\nimport type { UserStats } from './types';\r\n\r\ninterface UserStatsCardsProps {\r\n  stats: UserStats;\r\n}\r\n\r\nexport const UserStatsCards: React.FC<UserStatsCardsProps> = ({ stats }) => {\r\n  const statItems = [\r\n    {\r\n      icon: Users,\r\n      label: 'Total Pengguna',\r\n      value: stats.total,\r\n      color: 'text-blue-600',\r\n      bgColor: 'bg-blue-50',\r\n    },\r\n    {\r\n      icon: Users,\r\n      label: 'Mahasiswa',\r\n      value: stats.students,\r\n      color: 'text-green-600',\r\n      bgColor: 'bg-green-50',\r\n    },\r\n    {\r\n      icon: Users,\r\n      label: 'Dosen',\r\n      value: stats.lecturers,\r\n      color: 'text-purple-600',\r\n      bgColor: 'bg-purple-50',\r\n    },\r\n    {\r\n      icon: Shield,\r\n      label: 'Admin',\r\n      value: stats.admins,\r\n      color: 'text-red-600',\r\n      bgColor: 'bg-red-50',\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n      {statItems.map((item) => (\r\n        <div\r\n          key={item.label}\r\n          className=\"bg-white rounded-lg border border-gray-200 p-4\"\r\n        >\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-gray-500\">{item.label}</p>\r\n              <p className=\"text-2xl font-semibold text-gray-900\">{item.value}</p>\r\n            </div>\r\n            <div className={`p-3 rounded-lg ${item.bgColor}`}>\r\n              <item.icon className={`w-6 h-6 ${item.color}`} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserStatsCards;\r\n","/**\r\n * User Management Types\r\n * Shared types and utilities for the UserManagement module\r\n */\r\n\r\nimport type { BackendUser, Mahasiswa, Dosen, RoleAssignmentRequest, CreateUserRequest } from '@/types';\r\nimport { extractString } from '@/utils';\r\n\r\n/**\r\n * Extended user type with student/lecturer details\r\n */\r\nexport interface UserWithDetails extends BackendUser {\r\n  studentInfo?: Mahasiswa;\r\n  lecturerInfo?: Dosen;\r\n  lastLogin?: string;\r\n}\r\n\r\n/**\r\n * Form data for creating/editing users\r\n */\r\nexport interface UserFormData {\r\n  email: string;\r\n  name: string;\r\n  password: string;\r\n  roles: RoleAssignmentRequest[];\r\n}\r\n\r\n/**\r\n * Initial form data state\r\n */\r\nexport const initialFormData: UserFormData = {\r\n  email: '',\r\n  name: '',\r\n  password: '',\r\n  roles: [],\r\n};\r\n\r\n/**\r\n * User statistics interface\r\n */\r\nexport interface UserStats {\r\n  total: number;\r\n  students: number;\r\n  lecturers: number;\r\n  admins: number;\r\n  staff: number;\r\n}\r\n\r\n/**\r\n * Role color mapping\r\n */\r\nexport const getRoleColor = (role: string): string => {\r\n  switch (role) {\r\n    case 'admin':\r\n      return 'bg-red-100 text-red-800';\r\n    case 'lecturer':\r\n      return 'bg-blue-100 text-blue-800';\r\n    case 'student':\r\n      return 'bg-green-100 text-green-800';\r\n    case 'staff':\r\n      return 'bg-purple-100 text-purple-800';\r\n    case 'student_applicant':\r\n      return 'bg-yellow-100 text-yellow-800';\r\n    case 'alumni':\r\n      return 'bg-gray-100 text-gray-800';\r\n    default:\r\n      return 'bg-gray-100 text-gray-800';\r\n  }\r\n};\r\n\r\n/**\r\n * Role label mapping (Indonesian)\r\n */\r\nexport const getRoleLabel = (role: string): string => {\r\n  const labels: Record<string, string> = {\r\n    admin: 'Admin',\r\n    lecturer: 'Dosen',\r\n    student: 'Mahasiswa',\r\n    staff: 'Staff',\r\n    student_applicant: 'Pendaftar',\r\n    alumni: 'Alumni',\r\n    guest: 'Guest',\r\n  };\r\n  return labels[role] || role;\r\n};\r\n\r\n/**\r\n * Extract value from SQL NullString or plain value\r\n * Re-exported from @/utils for backward compatibility within this module\r\n */\r\nexport const getSqlValue = extractString;\r\n\r\n/**\r\n * Bulk user import types\r\n */\r\nexport interface BulkUserEntry extends CreateUserRequest {\r\n  // Additional fields for display\r\n  displayName?: string;\r\n}\r\n\r\n/**\r\n * Available roles for selection\r\n */\r\nexport const availableRoles = [\r\n  { value: 'admin', label: 'Admin' },\r\n  { value: 'staff', label: 'Staff' },\r\n  { value: 'lecturer', label: 'Dosen' },\r\n  { value: 'student', label: 'Mahasiswa' },\r\n  { value: 'alumni', label: 'Alumni' },\r\n  { value: 'student_applicant', label: 'Pendaftar' },\r\n] as const;\r\n\r\n","import React from 'react';\r\nimport { Edit, Trash2, Mail, Phone, ChevronLeft, ChevronRight, BookOpen } from 'lucide-react';\r\nimport type { UserWithDetails } from './types';\r\nimport { getRoleColor, getRoleLabel, getSqlValue } from './types';\r\n\r\ninterface UserTableProps {\r\n  users: UserWithDetails[];\r\n  loading: boolean;\r\n  currentPage: number;\r\n  totalUsers: number;\r\n  itemsPerPage: number;\r\n  onPageChange: (page: number) => void;\r\n  onEditUser: (user: UserWithDetails) => void;\r\n  onDeleteUser: (user: UserWithDetails) => void;\r\n  onManageAssignments: (user: UserWithDetails) => void;\r\n}\r\n\r\nexport const UserTable: React.FC<UserTableProps> = ({\r\n  users,\r\n  loading,\r\n  currentPage,\r\n  totalUsers,\r\n  itemsPerPage,\r\n  onPageChange,\r\n  onEditUser,\r\n  onDeleteUser,\r\n  onManageAssignments,\r\n}) => {\r\n  const totalPages = Math.ceil(totalUsers / itemsPerPage);\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg border border-gray-200\">\r\n      {/* Table */}\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"w-full\">\r\n          <thead className=\"bg-gray-50 border-b border-gray-200\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Pengguna\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Role\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Entitas\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Kontak\r\n              </th>\r\n              <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Aksi\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"divide-y divide-gray-200\">\r\n            {loading ? (\r\n              <tr>\r\n                <td colSpan={5} className=\"px-6 py-12 text-center\">\r\n                  <div className=\"flex items-center justify-center\">\r\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                    <span className=\"ml-2 text-gray-500\">Memuat data...</span>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ) : users.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={5} className=\"px-6 py-12 text-center text-gray-500\">\r\n                  Tidak ada pengguna ditemukan\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              users.map((user) => (\r\n                <UserTableRow\r\n                  key={user.id}\r\n                  user={user}\r\n                  onEdit={onEditUser}\r\n                  onDelete={onDeleteUser}\r\n                  onManageAssignments={onManageAssignments}\r\n                />\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Pagination */}\r\n      {totalPages > 1 && (\r\n        <div className=\"px-6 py-4 border-t border-gray-200 flex items-center justify-between\">\r\n          <div className=\"text-sm text-gray-500\">\r\n            Menampilkan {(currentPage - 1) * itemsPerPage + 1} -{' '}\r\n            {Math.min(currentPage * itemsPerPage, totalUsers)} dari {totalUsers} pengguna\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={() => onPageChange(currentPage - 1)}\r\n              disabled={currentPage === 1}\r\n              className=\"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <ChevronLeft className=\"w-4 h-4\" />\r\n            </button>\r\n            <span className=\"text-sm text-gray-700\">\r\n              Halaman {currentPage} dari {totalPages}\r\n            </span>\r\n            <button\r\n              onClick={() => onPageChange(currentPage + 1)}\r\n              disabled={currentPage === totalPages}\r\n              className=\"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <ChevronRight className=\"w-4 h-4\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Individual user row component\r\n */\r\ninterface UserTableRowProps {\r\n  user: UserWithDetails;\r\n  onEdit: (user: UserWithDetails) => void;\r\n  onDelete: (user: UserWithDetails) => void;\r\n  onManageAssignments: (user: UserWithDetails) => void;\r\n}\r\n\r\nconst UserTableRow: React.FC<UserTableRowProps> = ({ user, onEdit, onDelete, onManageAssignments }) => {\r\n  const userName = getSqlValue(user.name) || user.email.split('@')[0];\r\n  const roles = user.roles || [];\r\n\r\n  // Get contact info from entity\r\n  const getContactInfo = () => {\r\n    if (user.studentInfo) {\r\n      return {\r\n        email: getSqlValue(user.studentInfo.email),\r\n        phone: getSqlValue(user.studentInfo.no_hp),\r\n      };\r\n    }\r\n    if (user.lecturerInfo) {\r\n      return {\r\n        email: getSqlValue(user.lecturerInfo.email),\r\n        phone: getSqlValue(user.lecturerInfo.no_hp),\r\n      };\r\n    }\r\n    return { email: user.email, phone: '' };\r\n  };\r\n\r\n  const contact = getContactInfo();\r\n\r\n  // Get entity info\r\n  const getEntityInfo = () => {\r\n    const entities: string[] = [];\r\n    \r\n    if (user.studentInfo) {\r\n      entities.push(`NIM: ${user.studentInfo.nim}`);\r\n    }\r\n    if (user.lecturerInfo) {\r\n      entities.push(`NIDN: ${getSqlValue(user.lecturerInfo.nuptk) || user.lecturerInfo.id}`);\r\n    }\r\n    \r\n    return entities;\r\n  };\r\n\r\n  const entityInfo = getEntityInfo();\r\n\r\n  return (\r\n    <tr className=\"hover:bg-gray-50\">\r\n      <td className=\"px-6 py-4\">\r\n        <div className=\"flex items-center\">\r\n          <div className=\"h-10 w-10 flex-shrink-0\">\r\n            <div className=\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center\">\r\n              <span className=\"text-blue-600 font-medium text-sm\">\r\n                {userName.charAt(0).toUpperCase()}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"ml-4\">\r\n            <div className=\"text-sm font-medium text-gray-900\">{userName}</div>\r\n            <div className=\"text-sm text-gray-500\">{user.email}</div>\r\n          </div>\r\n        </div>\r\n      </td>\r\n      <td className=\"px-6 py-4\">\r\n        <div className=\"flex flex-wrap gap-1\">\r\n          {roles.map((roleObj, idx) => (\r\n            <span\r\n              key={idx}\r\n              className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${getRoleColor(roleObj.role)}`}\r\n            >\r\n              {getRoleLabel(roleObj.role)}\r\n            </span>\r\n          ))}\r\n          {roles.length === 0 && (\r\n            <span className=\"text-gray-400 text-sm\">-</span>\r\n          )}\r\n        </div>\r\n      </td>\r\n      <td className=\"px-6 py-4\">\r\n        <div className=\"text-sm text-gray-900\">\r\n          {entityInfo.length > 0 ? (\r\n            entityInfo.map((info, idx) => (\r\n              <div key={idx}>{info}</div>\r\n            ))\r\n          ) : (\r\n            <span className=\"text-gray-400\">-</span>\r\n          )}\r\n        </div>\r\n      </td>\r\n      <td className=\"px-6 py-4\">\r\n        <div className=\"text-sm text-gray-500 space-y-1\">\r\n          {contact.email && (\r\n            <div className=\"flex items-center gap-1\">\r\n              <Mail className=\"w-3 h-3\" />\r\n              <span className=\"truncate max-w-[150px]\">{contact.email}</span>\r\n            </div>\r\n          )}\r\n          {contact.phone && (\r\n            <div className=\"flex items-center gap-1\">\r\n              <Phone className=\"w-3 h-3\" />\r\n              {contact.phone}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </td>\r\n      <td className=\"px-6 py-4 text-right\">\r\n        <div className=\"flex items-center justify-end gap-2\">\r\n          {(user.roles?.some((r) => r.role === 'student' || r.role === 'lecturer')) && (\r\n            <button\r\n              onClick={() => onManageAssignments(user)}\r\n              className=\"p-2 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors\"\r\n              title=\"Manage Assignments\"\r\n            >\r\n              <BookOpen className=\"w-4 h-4\" />\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={() => onEdit(user)}\r\n            className=\"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n            title=\"Edit\"\r\n          >\r\n            <Edit className=\"w-4 h-4\" />\r\n          </button>\r\n          <button\r\n            onClick={() => onDelete(user)}\r\n            className=\"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n            title=\"Hapus\"\r\n          >\r\n            <Trash2 className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n      </td>\r\n    </tr>\r\n  );\r\n};\r\n\r\nexport default UserTable;\r\n","/**\r\n * User Form Modal Component\r\n * Used for adding and editing users\r\n */\r\n\r\nimport React from 'react';\r\nimport { X, Loader, Trash2 } from 'lucide-react';\r\nimport type { UserFormData } from './types';\r\nimport { getRoleLabel, availableRoles } from './types';\r\nimport type { Mahasiswa, Dosen } from '@/types';\r\n\r\ninterface UserFormModalProps {\r\n  isOpen: boolean;\r\n  isEdit: boolean;\r\n  formData: UserFormData;\r\n  formError: string | null;\r\n  actionLoading: boolean;\r\n  students: Mahasiswa[];\r\n  lecturers: Dosen[];\r\n  onClose: () => void;\r\n  onSubmit: (e: React.FormEvent) => void;\r\n  onFormChange: (data: Partial<UserFormData>) => void;\r\n  onAddRole: (role: string) => void;\r\n  onRemoveRole: (index: number) => void;\r\n  onUpdateRoleEntity: (index: number, entityType: string, entityId: string) => void;\r\n}\r\n\r\nexport const UserFormModal: React.FC<UserFormModalProps> = ({\r\n  isOpen,\r\n  isEdit,\r\n  formData,\r\n  formError,\r\n  actionLoading,\r\n  students,\r\n  lecturers,\r\n  onClose,\r\n  onSubmit,\r\n  onFormChange,\r\n  onAddRole,\r\n  onRemoveRole,\r\n  onUpdateRoleEntity,\r\n}) => {\r\n  if (!isOpen) return null;\r\n\r\n  const title = isEdit ? 'Edit Pengguna' : 'Tambah Pengguna';\r\n  const submitLabel = isEdit ? 'Simpan Perubahan' : 'Tambah Pengguna';\r\n\r\n  return (\r\n    <>\r\n      {/* Backdrop */}\r\n      <div className=\"fixed inset-0 bg-black/50 z-40\" onClick={onClose} />\r\n      \r\n      {/* Modal */}\r\n      <div className=\"fixed inset-0 flex items-center justify-center z-50 p-4 pointer-events-none\">\r\n        <div className=\"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto pointer-events-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-200\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900\">{title}</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <form onSubmit={onSubmit}>\r\n          <div className=\"px-6 py-4 space-y-4\">\r\n            {formError && (\r\n              <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm\">\r\n                {formError}\r\n              </div>\r\n            )}\r\n\r\n            {/* Email */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Email <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                value={formData.email}\r\n                onChange={(e) => onFormChange({ email: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder=\"email@example.com\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            {/* Name */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Nama\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.name}\r\n                onChange={(e) => onFormChange({ name: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder=\"Nama lengkap\"\r\n              />\r\n            </div>\r\n\r\n            {/* Password */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Password {!isEdit && <span className=\"text-red-500\">*</span>}\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                value={formData.password}\r\n                onChange={(e) => onFormChange({ password: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder={isEdit ? 'Kosongkan jika tidak ingin mengubah' : 'Masukkan password'}\r\n                required={!isEdit}\r\n              />\r\n            </div>\r\n\r\n            {/* Roles */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Role\r\n              </label>\r\n              \r\n              {/* Existing roles */}\r\n              <div className=\"space-y-2 mb-3\">\r\n                {formData.roles.map((roleObj, idx) => (\r\n                  <RoleEntry\r\n                    key={idx}\r\n                    role={roleObj.role}\r\n                    entityId={roleObj.entity_id}\r\n                    students={students}\r\n                    lecturers={lecturers}\r\n                    onUpdateEntity={(entityType, entityId) =>\r\n                      onUpdateRoleEntity(idx, entityType, entityId)\r\n                    }\r\n                    onRemove={() => onRemoveRole(idx)}\r\n                  />\r\n                ))}\r\n              </div>\r\n\r\n              {/* Add role dropdown */}\r\n              <select\r\n                onChange={(e) => {\r\n                  if (e.target.value) {\r\n                    onAddRole(e.target.value);\r\n                    e.target.value = '';\r\n                  }\r\n                }}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                defaultValue=\"\"\r\n              >\r\n                <option value=\"\">+ Tambah Role</option>\r\n                {availableRoles\r\n                  .filter((r) => !formData.roles.some((fr) => fr.role === r.value))\r\n                  .map((r) => (\r\n                    <option key={r.value} value={r.value}>\r\n                      {r.label}\r\n                    </option>\r\n                  ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"px-6 py-4 border-t border-gray-200 flex justify-end gap-3\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\r\n              disabled={actionLoading}\r\n            >\r\n              Batal\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-2\"\r\n              disabled={actionLoading}\r\n            >\r\n              {actionLoading && <Loader className=\"w-4 h-4 animate-spin\" />}\r\n              {submitLabel}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\n/**\r\n * Role entry component with entity selection\r\n */\r\ninterface RoleEntryProps {\r\n  role: string;\r\n  entityId?: string;\r\n  students: Mahasiswa[];\r\n  lecturers: Dosen[];\r\n  onUpdateEntity: (entityType: string, entityId: string) => void;\r\n  onRemove: () => void;\r\n}\r\n\r\nconst RoleEntry: React.FC<RoleEntryProps> = ({\r\n  role,\r\n  entityId,\r\n  students,\r\n  lecturers,\r\n  onUpdateEntity,\r\n  onRemove,\r\n}) => {\r\n  const showStudentSelect = role === 'student' || role === 'alumni';\r\n  const showLecturerSelect = role === 'lecturer';\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 p-2 bg-gray-50 rounded-lg\">\r\n      <span className=\"text-sm font-medium text-gray-700 min-w-[80px]\">\r\n        {getRoleLabel(role)}\r\n      </span>\r\n\r\n      {showStudentSelect && (\r\n        <select\r\n          value={entityId || ''}\r\n          onChange={(e) => onUpdateEntity('mahasiswa', e.target.value)}\r\n          className=\"flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500\"\r\n        >\r\n          <option value=\"\">Pilih Mahasiswa</option>\r\n          {students.map((s) => (\r\n            <option key={s.nim} value={s.nim}>\r\n              {s.nim} - {s.nama || '(No Name)'}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      )}\r\n\r\n      {showLecturerSelect && (\r\n        <select\r\n          value={entityId || ''}\r\n          onChange={(e) => onUpdateEntity('dosen', e.target.value)}\r\n          className=\"flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500\"\r\n        >\r\n          <option value=\"\">Pilih Dosen</option>\r\n          {lecturers.map((l) => (\r\n            <option key={l.id} value={l.id}>\r\n              {l.id} - {l.nama_dosen || '(No Name)'}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      )}\r\n\r\n      {!showStudentSelect && !showLecturerSelect && (\r\n        <span className=\"flex-1 text-sm text-gray-500\">\r\n          Tidak memerlukan entitas\r\n        </span>\r\n      )}\r\n\r\n      <button\r\n        type=\"button\"\r\n        onClick={onRemove}\r\n        className=\"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors\"\r\n      >\r\n        <Trash2 className=\"w-4 h-4\" />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserFormModal;\r\n","/**\r\n * User Grades Component (Admin View)\r\n * Displays a student's grades similar to the student's KHS page\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Award, TrendingUp, Loader2, AlertCircle } from 'lucide-react';\r\nimport { apiService } from '@/services';\r\nimport { extractString, extractFloat, extractInt } from '@/utils';\r\nimport type { CourseWithClasses } from '@/types';\r\n\r\ninterface CourseGradeData {\r\n  enrollmentId: number;\r\n  courseCode: string;\r\n  courseName: string;\r\n  credits: number;\r\n  // Grade components\r\n  aktivitasPartisipatif?: number;\r\n  hasilProyek?: number;\r\n  quiz?: number;\r\n  tugas?: number;\r\n  uts?: number;\r\n  uas?: number;\r\n  nilaiAngka?: number;\r\n  nilaiHuruf?: string;\r\n  nilaiIndeks?: number;\r\n  // Flag to indicate if all grade components are present\r\n  hasCompleteGrades: boolean;\r\n}\r\n\r\ninterface UserGradesProps {\r\n  studentId: string;\r\n  semester: string;\r\n}\r\n\r\nexport const UserGrades: React.FC<UserGradesProps> = ({ studentId, semester }) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [gradesData, setGradesData] = useState<CourseGradeData[]>([]);\r\n\r\n  useEffect(() => {\r\n    const fetchGradesData = async () => {\r\n      if (!studentId || !semester) {\r\n        setError('Student ID or semester not available');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        // Fetch enrollments for the student\r\n        const enrollments = await apiService.getEnrollments(studentId, semester);\r\n\r\n        if (!enrollments || enrollments.length === 0) {\r\n          setGradesData([]);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Fetch course details for all enrolled courses\r\n        const courseMap = new Map<string, CourseWithClasses>();\r\n        const coursePromises = enrollments\r\n          .filter(e => extractString(e.kode_mk))\r\n          .map(async (enrollment) => {\r\n            const kode_mk = extractString(enrollment.kode_mk)!;\r\n            try {\r\n              const course = await apiService.getCourseByCode(kode_mk);\r\n              if (course) {\r\n                courseMap.set(kode_mk, course);\r\n              }\r\n            } catch (err) {\r\n              console.error(`Failed to fetch course ${kode_mk}:`, err);\r\n            }\r\n          });\r\n\r\n        await Promise.all(coursePromises);\r\n\r\n        // Fetch grades for all enrollments\r\n        const gradePromises = enrollments.map(async (enrollment) => {\r\n          try {\r\n            const grades = await apiService.getGrades({ krs_id: enrollment.id });\r\n            return { enrollment, grade: grades[0] || null };\r\n          } catch (err) {\r\n            console.error(`Failed to fetch grade for enrollment ${enrollment.id}:`, err);\r\n            return { enrollment, grade: null };\r\n          }\r\n        });\r\n\r\n        const enrollmentGrades = await Promise.all(gradePromises);\r\n\r\n        // Combine enrollment, course, and grade data\r\n        const combinedData: CourseGradeData[] = enrollmentGrades.map(({ enrollment, grade }) => {\r\n          const courseCode = extractString(enrollment.kode_mk) || '';\r\n          const course = courseMap.get(courseCode);\r\n\r\n          // Calculate total SKS (credits)\r\n          const totalSKS = extractInt(course?.sks_tatap_muka) +\r\n                          extractInt(course?.sks_praktek) +\r\n                          extractInt(course?.sks_prak_lapangan) +\r\n                          extractInt(course?.sks_simulasi);\r\n\r\n          // Extract grade components\r\n          const aktivitasPartisipatif = grade ? extractFloat(grade.aktivitas_partisipatif) ?? undefined : undefined;\r\n          const hasilProyek = grade ? extractFloat(grade.hasil_proyek) ?? undefined : undefined;\r\n          const quiz = grade ? extractFloat(grade.quiz) ?? undefined : undefined;\r\n          const tugas = grade ? extractFloat(grade.tugas) ?? undefined : undefined;\r\n          const uts = grade ? extractFloat(grade.uts) ?? undefined : undefined;\r\n          const uas = grade ? extractFloat(grade.uas) ?? undefined : undefined;\r\n\r\n          // Check if all grade components are present\r\n          const hasCompleteGrades = !!(\r\n            aktivitasPartisipatif !== undefined &&\r\n            hasilProyek !== undefined &&\r\n            quiz !== undefined &&\r\n            tugas !== undefined &&\r\n            uts !== undefined &&\r\n            uas !== undefined\r\n          );\r\n\r\n          return {\r\n            enrollmentId: enrollment.id,\r\n            courseCode,\r\n            courseName: course?.nama_mk || courseCode,\r\n            credits: totalSKS,\r\n            aktivitasPartisipatif,\r\n            hasilProyek,\r\n            quiz,\r\n            tugas,\r\n            uts,\r\n            uas,\r\n            nilaiAngka: grade ? extractFloat(grade.nilai_angka) ?? undefined : undefined,\r\n            nilaiHuruf: grade ? extractString(grade.nilai_huruf) ?? undefined : undefined,\r\n            nilaiIndeks: grade ? extractFloat(grade.nilai_indeks) ?? undefined : undefined,\r\n            hasCompleteGrades,\r\n          };\r\n        });\r\n\r\n        setGradesData(combinedData);\r\n      } catch (err) {\r\n        console.error('Error fetching grades data:', err);\r\n        setError(err instanceof Error ? err.message : 'Failed to load grades');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchGradesData();\r\n  }, [studentId, semester]);\r\n\r\n  // Calculate summary statistics (only for courses with complete grades)\r\n  const coursesWithCompleteGrades = gradesData.filter(g => g.hasCompleteGrades);\r\n  const totalCredits = gradesData.reduce((sum, g) => sum + g.credits, 0);\r\n  const totalCreditsWithGrades = coursesWithCompleteGrades.reduce((sum, g) => sum + g.credits, 0);\r\n  const weightedGPA = coursesWithCompleteGrades.reduce((sum, g) => {\r\n    const indeks = g.nilaiIndeks ?? 0;\r\n    return sum + (g.credits * indeks);\r\n  }, 0);\r\n  const IPS = totalCreditsWithGrades > 0 ? (weightedGPA / totalCreditsWithGrades) : null;\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-8\">\r\n        <Loader2 className=\"h-6 w-6 animate-spin text-primary-600\" />\r\n        <span className=\"ml-2 text-gray-600\">Loading grades...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n        <div className=\"flex items-center space-x-2 text-red-700\">\r\n          <AlertCircle className=\"h-5 w-5\" />\r\n          <span>{error}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (gradesData.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-8 text-gray-500\">\r\n        No grades available for this semester\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Summary */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 bg-white border border-gray-200 rounded-lg p-4\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <Award className=\"h-5 w-5 text-primary-600\" />\r\n          <div>\r\n            <div className=\"text-xs text-gray-500\">Total Credits</div>\r\n            <div className=\"text-lg font-semibold\">{totalCredits} SKS</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center space-x-3\">\r\n          <TrendingUp className=\"h-5 w-5 text-green-600\" />\r\n          <div>\r\n            <div className=\"text-xs text-gray-500\">Semester GPA (IPS)</div>\r\n            <div className=\"text-lg font-semibold\">{IPS !== null ? IPS.toFixed(2) : '-'}</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center space-x-3\">\r\n          <Award className=\"h-5 w-5 text-amber-600\" />\r\n          <div>\r\n            <div className=\"text-xs text-gray-500\">Status</div>\r\n            <div className=\"text-lg font-semibold\">\r\n              {IPS !== null ? (IPS >= 3.0 ? 'Good Standing' : IPS >= 2.0 ? 'Warning' : 'Probation') : '-'}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Grades Table */}\r\n      <div className=\"bg-white border border-gray-200 rounded-lg overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead>\r\n            <tr className=\"text-left text-gray-600 border-b-2 border-gray-200\">\r\n              <th className=\"py-2 px-3\">Course Code</th>\r\n              <th className=\"py-2 px-3\">Course Name</th>\r\n              <th className=\"py-2 px-3 text-center\">SKS</th>\r\n              <th className=\"py-2 px-3 text-center\">Partisipasi</th>\r\n              <th className=\"py-2 px-3 text-center\">Proyek</th>\r\n              <th className=\"py-2 px-3 text-center\">Quiz</th>\r\n              <th className=\"py-2 px-3 text-center\">Tugas</th>\r\n              <th className=\"py-2 px-3 text-center\">UTS</th>\r\n              <th className=\"py-2 px-3 text-center\">UAS</th>\r\n              <th className=\"py-2 px-3 text-center\">Total</th>\r\n              <th className=\"py-2 px-3 text-center\">Grade</th>\r\n              <th className=\"py-2 px-3 text-center\">Index</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {gradesData.map((g) => (\r\n              <tr key={g.enrollmentId} className=\"border-t border-gray-100 hover:bg-gray-50\">\r\n                <td className=\"py-2 px-3 font-medium text-gray-900\">{g.courseCode}</td>\r\n                <td className=\"py-2 px-3\">{g.courseName}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.credits}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.aktivitasPartisipatif?.toFixed(1) ?? '-'}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.hasilProyek?.toFixed(1) ?? '-'}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.quiz?.toFixed(1) ?? '-'}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.tugas?.toFixed(1) ?? '-'}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.uts?.toFixed(1) ?? '-'}</td>\r\n                <td className=\"py-2 px-3 text-center\">{g.uas?.toFixed(1) ?? '-'}</td>\r\n                <td className=\"py-2 px-3 text-center font-medium\">\r\n                  {g.nilaiAngka?.toFixed(1) ?? '-'}\r\n                </td>\r\n                <td className=\"py-2 px-3 text-center font-semibold text-primary-600\">\r\n                  {g.hasCompleteGrades ? (g.nilaiHuruf ?? '-') : '-'}\r\n                </td>\r\n                <td className=\"py-2 px-3 text-center\">\r\n                  {g.hasCompleteGrades ? (g.nilaiIndeks?.toFixed(2) ?? '-') : '-'}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","/**\r\n * User Attendance Component (Admin View)\r\n * Displays a student's attendance record similar to the student's attendance page\r\n */\r\n\r\nimport React, { useMemo } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { CheckCircle, XCircle, Clock, AlertCircle, ClockAlert, Minus, Loader2 } from 'lucide-react';\r\nimport { apiService } from '@/services';\r\nimport type { AttendanceRecord, StudentClass, MeetingSchedule } from '@/types';\r\nimport { extractString, extractDate } from '@/utils';\r\nimport type { SqlNullString } from '@/types';\r\n\r\ninterface CourseAttendanceData {\r\n  course: StudentClass;\r\n  meetings: Array<{\r\n    id: number;\r\n    topik?: string;\r\n    tgl_pertemuan: string;\r\n    pertemuan_ke: number;\r\n    attendance?: AttendanceRecord;\r\n  }>;\r\n  stats: {\r\n    totalMeetings: number;\r\n    attended: number;\r\n    excused: number;\r\n    sick: number;\r\n    late: number;\r\n    substitute: number;\r\n    absent: number;\r\n    attendancePercentage: number;\r\n  };\r\n}\r\n\r\ninterface UserAttendanceProps {\r\n  studentId: string;\r\n  semester: string;\r\n}\r\n\r\nexport const UserAttendance: React.FC<UserAttendanceProps> = ({ studentId, semester }) => {\r\n  // Fetch student classes\r\n  const { data: studentClasses = [], isLoading: loadingClasses } = useQuery({\r\n    queryKey: ['admin-student-classes', studentId, semester],\r\n    queryFn: async () => {\r\n      return await apiService.getStudentClasses(studentId, { semester });\r\n    },\r\n    enabled: !!studentId && !!semester,\r\n  });\r\n\r\n  // Fetch all meetings for student's classes\r\n  const classIds = useMemo(() => studentClasses.map((c: StudentClass) => c.kelas_id), [studentClasses]);\r\n\r\n  const meetingsQueries = useQuery({\r\n    queryKey: ['admin-student-meetings', classIds],\r\n    queryFn: async () => {\r\n      if (classIds.length === 0) return {};\r\n\r\n      const result: Record<number, MeetingSchedule[]> = {};\r\n\r\n      await Promise.all(\r\n        classIds.map(async (classId: number) => {\r\n          try {\r\n            const meetings = await apiService.getMeetingsByClass(classId);\r\n            result[classId] = meetings;\r\n          } catch (error) {\r\n            console.error(`Failed to fetch meetings for class ${classId}:`, error);\r\n            result[classId] = [];\r\n          }\r\n        })\r\n      );\r\n\r\n      return result;\r\n    },\r\n    enabled: classIds.length > 0,\r\n  });\r\n\r\n  // Fetch attendances for all meetings\r\n  const meetingIds = useMemo(() => {\r\n    if (!meetingsQueries.data) return [];\r\n    return Object.values(meetingsQueries.data).flat().map(m => m.id);\r\n  }, [meetingsQueries.data]);\r\n\r\n  const attendancesQuery = useQuery({\r\n    queryKey: ['admin-student-attendances', studentId, meetingIds],\r\n    queryFn: async () => {\r\n      if (meetingIds.length === 0) return {};\r\n\r\n      const result: Record<number, AttendanceRecord> = {};\r\n\r\n      await Promise.all(\r\n        meetingIds.map(async (meetingId) => {\r\n          try {\r\n            const attendances = await apiService.getMeetingAttendances(meetingId);\r\n            const studentAttendance = attendances.find(a => a.nim === studentId);\r\n            if (studentAttendance) {\r\n              result[meetingId] = studentAttendance;\r\n            }\r\n          } catch (error) {\r\n            console.error(`Failed to fetch attendances for meeting ${meetingId}:`, error);\r\n          }\r\n        })\r\n      );\r\n\r\n      return result;\r\n    },\r\n    enabled: meetingIds.length > 0,\r\n  });\r\n\r\n  // Process data into course attendance groups with stats\r\n  const courseAttendanceData = useMemo(() => {\r\n    if (!meetingsQueries.data || !studentClasses.length) return [];\r\n\r\n    return studentClasses\r\n      .map((course: StudentClass) => {\r\n        const meetings = (meetingsQueries.data?.[course.kelas_id] || []).sort((a, b) => a.pertemuan_ke - b.pertemuan_ke);\r\n\r\n        const courseData: CourseAttendanceData = {\r\n          course,\r\n          meetings: meetings.map(m => ({\r\n            id: m.id,\r\n            topik: extractString(m.topik as string | SqlNullString),\r\n            tgl_pertemuan: typeof m.tgl_pertemuan === 'string' ? m.tgl_pertemuan : m.tgl_pertemuan?.Time || '',\r\n            pertemuan_ke: m.pertemuan_ke,\r\n            attendance: attendancesQuery.data?.[m.id],\r\n          })),\r\n          stats: {\r\n            totalMeetings: meetings.length,\r\n            attended: 0,\r\n            excused: 0,\r\n            sick: 0,\r\n            late: 0,\r\n            substitute: 0,\r\n            absent: 0,\r\n            attendancePercentage: 0,\r\n          },\r\n        };\r\n\r\n        // Calculate stats\r\n        meetings.forEach(m => {\r\n          const attendance = attendancesQuery.data?.[m.id];\r\n          if (attendance) {\r\n            const status = extractString(attendance.status_kehadiran as string | SqlNullString)?.toLowerCase();\r\n            switch (status) {\r\n              case 'hadir':\r\n              case 'present':\r\n                courseData.stats.attended++;\r\n                break;\r\n              case 'izin':\r\n              case 'excused':\r\n                courseData.stats.excused++;\r\n                break;\r\n              case 'sakit':\r\n              case 'sick':\r\n                courseData.stats.sick++;\r\n                break;\r\n              case 'terlambat':\r\n              case 'late':\r\n                courseData.stats.late++;\r\n                break;\r\n              case 'pengganti':\r\n              case 'substitute':\r\n                courseData.stats.substitute++;\r\n                break;\r\n              case 'alpa':\r\n              case 'alfa':\r\n              case 'absent':\r\n                courseData.stats.absent++;\r\n                break;\r\n            }\r\n          }\r\n        });\r\n\r\n        if (courseData.stats.totalMeetings > 0) {\r\n          const presentMeetings = courseData.stats.attended + courseData.stats.late + courseData.stats.substitute;\r\n          courseData.stats.attendancePercentage = Math.round((presentMeetings / courseData.stats.totalMeetings) * 100);\r\n        }\r\n\r\n        return courseData;\r\n      })\r\n      .sort((a: CourseAttendanceData, b: CourseAttendanceData) => extractString(a.course.kode_mk || '').localeCompare(extractString(b.course.kode_mk || '')));\r\n  }, [studentClasses, meetingsQueries.data, attendancesQuery.data, studentId]);\r\n\r\n  const isLoading = loadingClasses || meetingsQueries.isLoading || attendancesQuery.isLoading;\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'izin':\r\n      case 'excused':\r\n        return <Clock className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'sakit':\r\n      case 'sick':\r\n        return <AlertCircle className=\"h-4 w-4 text-yellow-600\" />;\r\n      case 'terlambat':\r\n      case 'late':\r\n        return <ClockAlert className=\"h-4 w-4 text-orange-600\" />;\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return <CheckCircle className=\"h-4 w-4 text-purple-600\" />;\r\n      case 'alpa':\r\n      case 'alfa':\r\n      case 'absent':\r\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\r\n      default:\r\n        return <Minus className=\"h-4 w-4 text-gray-300\" />;\r\n    }\r\n  };\r\n\r\n  const getAttendanceColorForPercentage = (percentage: number): string => {\r\n    if (percentage >= 80) return 'text-green-600';\r\n    if (percentage >= 70) return 'text-yellow-600';\r\n    return 'text-red-600';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center py-8\">\r\n        <Loader2 className=\"h-6 w-6 animate-spin text-primary-600\" />\r\n        <span className=\"ml-2 text-gray-600\">Loading attendance...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (courseAttendanceData.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-8 text-gray-500\">\r\n        No attendance records found for this semester\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {courseAttendanceData.map((courseData: CourseAttendanceData) => (\r\n        <div key={courseData.course.kelas_id} className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\r\n          {/* Course Info and Summary - Single Compact Row */}\r\n          <div className=\"bg-gradient-to-r from-primary-50 to-secondary-50 px-3 py-2 border-b border-gray-200\">\r\n            <div className=\"flex justify-between items-center gap-3\">\r\n              <div className=\"flex-1 min-w-0\">\r\n                <h4 className=\"font-semibold text-sm text-gray-900 truncate\">\r\n                  {extractString(courseData.course.kode_mk || '')} - {extractString(courseData.course.nama_mk || '')}\r\n                </h4>\r\n                <p className=\"text-xs text-gray-600 truncate\">\r\n                  {extractString(courseData.course.nama_kelas || '')}\r\n                </p>\r\n              </div>\r\n              \r\n              {/* Compact Stats */}\r\n              <div className=\"flex items-center gap-2 text-xs flex-shrink-0\">\r\n                <div className=\"text-center\">\r\n                  <div className={`font-bold text-base ${getAttendanceColorForPercentage(courseData.stats.attendancePercentage)}`}>\r\n                    {courseData.stats.attendancePercentage}%\r\n                  </div>\r\n                </div>\r\n                <div className=\"h-6 w-px bg-gray-300\"></div>\r\n                <div className=\"flex gap-1.5\">\r\n                  <span className=\"bg-green-100 text-green-700 px-1.5 py-0.5 rounded text-xs font-medium\">{courseData.stats.attended}</span>\r\n                  <span className=\"bg-orange-100 text-orange-700 px-1.5 py-0.5 rounded text-xs font-medium\">{courseData.stats.late}</span>\r\n                  <span className=\"bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded text-xs font-medium\">{courseData.stats.excused}</span>\r\n                  <span className=\"bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded text-xs font-medium\">{courseData.stats.sick}</span>\r\n                  <span className=\"bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded text-xs font-medium\">{courseData.stats.substitute}</span>\r\n                  <span className=\"bg-red-100 text-red-700 px-1.5 py-0.5 rounded text-xs font-medium\">{courseData.stats.absent}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Attendance Grid - Weeks as Columns */}\r\n          {courseData.meetings.length === 0 ? (\r\n            <div className=\"p-3 text-center text-xs text-gray-500\">\r\n              No meetings recorded for this course.\r\n            </div>\r\n          ) : (\r\n            <div className=\"p-3\">\r\n              <div className=\"flex gap-2 flex-wrap items-start\">\r\n                {/* Legend */}\r\n                <div className=\"text-xs text-gray-600 mb-1 w-full\">\r\n                  <div className=\"flex gap-2 flex-wrap\">\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <CheckCircle className=\"h-3 w-3 text-green-600\" />\r\n                      <span>Present</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <ClockAlert className=\"h-3 w-3 text-orange-600\" />\r\n                      <span>Late</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <Clock className=\"h-3 w-3 text-blue-600\" />\r\n                      <span>Excused</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <AlertCircle className=\"h-3 w-3 text-yellow-600\" />\r\n                      <span>Sick</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <CheckCircle className=\"h-3 w-3 text-purple-600\" />\r\n                      <span>Substitute</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <XCircle className=\"h-3 w-3 text-red-600\" />\r\n                      <span>Absent</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <Minus className=\"h-3 w-3 text-gray-400\" />\r\n                      <span>Not Marked</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Week columns with attendance status icons */}\r\n                <div className=\"flex gap-1 flex-wrap\">\r\n                  {courseData.meetings.map((meeting: CourseAttendanceData['meetings'][0]) => {\r\n                    const attendance = meeting.attendance;\r\n                    const status = attendance ? extractString(attendance.status_kehadiran as string | SqlNullString) : undefined;\r\n                    const meetingDate = extractDate(meeting.tgl_pertemuan);\r\n                    const dateStr = meetingDate ? meetingDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : '';\r\n\r\n                    return (\r\n                      <div\r\n                        key={meeting.id}\r\n                        className=\"flex flex-col items-center gap-0.5 p-1.5 rounded border border-gray-200 hover:bg-gray-50 transition-colors cursor-help\"\r\n                        title={`Week ${meeting.pertemuan_ke} - ${dateStr}${meeting.topik ? ` - ${extractString(meeting.topik as string | SqlNullString)}` : ''}`}\r\n                      >\r\n                        <div className=\"text-xs font-semibold text-gray-600\">W{meeting.pertemuan_ke}</div>\r\n                        <div className=\"flex justify-center h-5\">\r\n                          {status ? (\r\n                            getStatusIcon(status)\r\n                          ) : (\r\n                            <Minus className=\"h-4 w-4 text-gray-300\" />\r\n                          )}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 text-center leading-tight max-w-12 break-words\">\r\n                          {dateStr}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n","/**\r\n * User Assignments Component\r\n * Manages class enrollments for students and teaching assignments for lecturers\r\n */\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport { X, Plus, BookOpen, Users, Trash2, Save, Loader, Award, Calendar } from 'lucide-react';\r\nimport type { UserWithDetails } from './types';\r\nimport { useCourses, useLecturerAssignments } from '@/hooks';\r\nimport { apiService } from '@/services';\r\nimport type { CreateEnrollmentRequest, CreateDosenPengajarRequest, DosenPengajar, KelasResponse } from '@/types';\r\nimport { extractString, extractNumber } from '@/utils';\r\nimport { UserGrades } from './UserGrades';\r\nimport { UserAttendance } from './UserAttendance';\r\n\r\ninterface UserAssignmentsProps {\r\n  user: UserWithDetails;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  currentSemester?: string;\r\n}\r\n\r\nexport const UserAssignments: React.FC<UserAssignmentsProps> = ({\r\n  user,\r\n  isOpen,\r\n  onClose,\r\n  currentSemester,\r\n}) => {\r\n  const [activeTab, setActiveTab] = useState<'enrollments' | 'teaching' | 'grades' | 'attendance'>('enrollments');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  // Enrollment management (for students)\r\n  const [enrollments, setEnrollments] = useState<{ kode_mk: string; id_kelas?: number }[]>([]);\r\n  const [newEnrollment, setNewEnrollment] = useState({ kode_mk: '', id_kelas: '' });\r\n\r\n  // Teaching assignment management (for lecturers)\r\n  const [teachingAssignments, setTeachingAssignments] = useState<DosenPengajar[]>([]);\r\n  const [newAssignment, setNewAssignment] = useState({\r\n    kode_mk: '',\r\n    id_kelas: '',\r\n    sks_ajar: '',\r\n    tatap_muka: '',\r\n  });\r\n  const [showAddAssignmentForm, setShowAddAssignmentForm] = useState(false);\r\n\r\n  // Fetch courses with classes\r\n  const { data: courses = [] } = useCourses({ \r\n    semester: currentSemester, \r\n    include_classes: true \r\n  });\r\n  \r\n  // Flatten classes from all courses\r\n  const classes = useMemo(() => {\r\n    const allClasses: KelasResponse[] = [];\r\n    courses.forEach((course) => {\r\n      if (course.classes && Array.isArray(course.classes)) {\r\n        allClasses.push(...course.classes);\r\n      }\r\n    });\r\n    return allClasses;\r\n  }, [courses]);\r\n\r\n  const studentRole = user?.roles?.find((r) => r.role === 'student');\r\n  const lecturerRole = user?.roles?.find((r) => r.role === 'lecturer');\r\n  \r\n  const { data: lecturerAssignmentsData } = useLecturerAssignments(\r\n    lecturerRole?.entity_id && currentSemester\r\n      ? { id_dosen: lecturerRole.entity_id, semester: currentSemester }\r\n      : undefined\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (lecturerAssignmentsData) {\r\n      setTeachingAssignments(lecturerAssignmentsData);\r\n    }\r\n  }, [lecturerAssignmentsData]);\r\n\r\n  // Load enrollments for student\r\n  React.useEffect(() => {\r\n    if (isOpen && studentRole?.entity_id && currentSemester) {\r\n      loadEnrollments();\r\n    }\r\n  }, [isOpen, studentRole?.entity_id, currentSemester]);\r\n\r\n  const loadEnrollments = async () => {\r\n    if (!studentRole?.entity_id || !currentSemester) return;\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      const data = await apiService.getEnrollments(studentRole.entity_id, currentSemester);\r\n      setEnrollments(data.map((e) => ({\r\n        kode_mk: extractString(e.kode_mk) || '',\r\n        id_kelas: extractNumber(e.id_kelas) ?? undefined,\r\n      })));\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to load enrollments');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddEnrollment = () => {\r\n    if (!newEnrollment.kode_mk) {\r\n      setError('Please select a course');\r\n      return;\r\n    }\r\n\r\n    const classId = newEnrollment.id_kelas ? Number(newEnrollment.id_kelas) : undefined;\r\n    \r\n    // Check if already enrolled\r\n    if (enrollments.some((e) => e.kode_mk === newEnrollment.kode_mk && e.id_kelas === classId)) {\r\n      setError('Already enrolled in this class');\r\n      return;\r\n    }\r\n\r\n    setEnrollments([...enrollments, { kode_mk: newEnrollment.kode_mk, id_kelas: classId }]);\r\n    setNewEnrollment({ kode_mk: '', id_kelas: '' });\r\n    setError(null);\r\n  };\r\n\r\n  const handleRemoveEnrollment = (index: number) => {\r\n    setEnrollments(enrollments.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleSaveEnrollments = async () => {\r\n    if (!studentRole?.entity_id || !currentSemester) return;\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n    setSuccess(null);\r\n\r\n    try {\r\n      const payload: CreateEnrollmentRequest[] = enrollments.map((e) => ({\r\n        nim: studentRole.entity_id!,\r\n        kode_mk: e.kode_mk,\r\n        semester: currentSemester,\r\n        id_kelas: e.id_kelas,\r\n      }));\r\n\r\n      await apiService.updateEnrollments(studentRole.entity_id, currentSemester, payload);\r\n      setSuccess('Enrollments saved successfully!');\r\n      setTimeout(() => setSuccess(null), 3000);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to save enrollments');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddTeachingAssignment = async () => {\r\n    if (!lecturerRole?.entity_id || !newAssignment.kode_mk || !newAssignment.id_kelas || !currentSemester) {\r\n      setError('Please fill in all required fields');\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      const payload: CreateDosenPengajarRequest = {\r\n        id_dosen: lecturerRole.entity_id,\r\n        id_kelas: newAssignment.id_kelas,\r\n        kode_mk: newAssignment.kode_mk,\r\n        semester: currentSemester,\r\n        sks_ajar: newAssignment.sks_ajar ? parseInt(newAssignment.sks_ajar, 10) : undefined,\r\n        tatap_muka: newAssignment.tatap_muka ? parseInt(newAssignment.tatap_muka, 10) : undefined,\r\n      };\r\n\r\n      await apiService.createLecturerAssignment(payload);\r\n      setSuccess('Teaching assignment created successfully');\r\n      setNewAssignment({ kode_mk: '', id_kelas: '', sks_ajar: '', tatap_muka: '' });\r\n      setShowAddAssignmentForm(false);\r\n\r\n      // Reload assignments\r\n      if (lecturerRole?.entity_id && currentSemester) {\r\n        const updated = await apiService.getLecturerAssignments({\r\n          id_dosen: lecturerRole.entity_id,\r\n          semester: currentSemester,\r\n        });\r\n        setTeachingAssignments(updated);\r\n      }\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to add teaching assignment');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRemoveTeachingAssignment = async (assignmentId: number) => {\r\n    if (!confirm('Are you sure you want to remove this teaching assignment?')) return;\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      await apiService.deleteLecturerAssignment(assignmentId);\r\n      setSuccess('Teaching assignment removed successfully');\r\n      setTeachingAssignments(teachingAssignments.filter((a) => a.id !== assignmentId));\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to remove teaching assignment');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Get unique course codes from classes\r\n  const availableCourses = useMemo(() => {\r\n    const coursesMap = new Map<string, string>();\r\n    classes.forEach((cls: KelasResponse) => {\r\n      const kode = extractString(cls.kode_mk);\r\n      if (kode && !coursesMap.has(kode)) {\r\n        coursesMap.set(kode, kode);\r\n      }\r\n    });\r\n    return Array.from(coursesMap.values());\r\n  }, [classes]);\r\n\r\n  // Get classes for selected course\r\n  const availableClasses = useMemo(() => {\r\n    if (!newEnrollment.kode_mk) return [];\r\n    return classes.filter((cls: KelasResponse) => extractString(cls.kode_mk) === newEnrollment.kode_mk);\r\n  }, [classes, newEnrollment.kode_mk]);\r\n\r\n  if (!isOpen || !user) return null;\r\n\r\n  const isStudent = !!studentRole;\r\n  const isLecturer = !!lecturerRole;\r\n\r\n  return (\r\n    <>\r\n      {/* Backdrop */}\r\n      <div className=\"fixed inset-0 bg-black/50 z-40\" onClick={onClose} />\r\n      \r\n      {/* Modal */}\r\n      <div className=\"fixed inset-0 flex items-center justify-center z-50 p-4 pointer-events-none\">\r\n        <div className=\"bg-white rounded-xl shadow-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto pointer-events-auto\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 sticky top-0 bg-white z-10\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">\r\n              Manage Assignments - {extractString(user.name) || user.email}\r\n            </h2>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Tabs */}\r\n          {(isStudent || isLecturer) && (\r\n            <div className=\"px-6 pt-4 border-b border-gray-200\">\r\n              <div className=\"flex gap-4 overflow-x-auto\">\r\n                {isStudent && (\r\n                  <>\r\n                    <button\r\n                      onClick={() => setActiveTab('enrollments')}\r\n                      className={`pb-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${\r\n                        activeTab === 'enrollments'\r\n                          ? 'border-blue-600 text-blue-600'\r\n                          : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                      }`}\r\n                    >\r\n                      <Users className=\"w-4 h-4 inline mr-2\" />\r\n                      Enrollments\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setActiveTab('grades')}\r\n                      className={`pb-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${\r\n                        activeTab === 'grades'\r\n                          ? 'border-blue-600 text-blue-600'\r\n                          : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                      }`}\r\n                    >\r\n                      <Award className=\"w-4 h-4 inline mr-2\" />\r\n                      Grades\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setActiveTab('attendance')}\r\n                      className={`pb-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${\r\n                        activeTab === 'attendance'\r\n                          ? 'border-blue-600 text-blue-600'\r\n                          : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                      }`}\r\n                    >\r\n                      <Calendar className=\"w-4 h-4 inline mr-2\" />\r\n                      Attendance\r\n                    </button>\r\n                  </>\r\n                )}\r\n                {isLecturer && (\r\n                  <button\r\n                    onClick={() => setActiveTab('teaching')}\r\n                    className={`pb-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ${\r\n                      activeTab === 'teaching'\r\n                        ? 'border-blue-600 text-blue-600'\r\n                        : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                    }`}\r\n                  >\r\n                    <BookOpen className=\"w-4 h-4 inline mr-2\" />\r\n                    Teaching\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Content */}\r\n          <div className=\"p-6 space-y-4\">\r\n            {/* Alerts */}\r\n            {error && (\r\n              <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            {success && (\r\n              <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg text-green-600 text-sm\">\r\n                {success}\r\n              </div>\r\n            )}\r\n\r\n            {/* Grades Tab */}\r\n            {activeTab === 'grades' && isStudent && studentRole?.entity_id && currentSemester && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-sm font-medium text-gray-900\">Student Grades (KHS)</h3>\r\n                  <span className=\"text-xs text-gray-500\">\r\n                    Semester: {currentSemester}\r\n                  </span>\r\n                </div>\r\n                <UserGrades studentId={studentRole.entity_id} semester={currentSemester} />\r\n              </div>\r\n            )}\r\n\r\n            {/* Attendance Tab */}\r\n            {activeTab === 'attendance' && isStudent && studentRole?.entity_id && currentSemester && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-sm font-medium text-gray-900\">Student Attendance</h3>\r\n                  <span className=\"text-xs text-gray-500\">\r\n                    Semester: {currentSemester}\r\n                  </span>\r\n                </div>\r\n                <UserAttendance studentId={studentRole.entity_id} semester={currentSemester} />\r\n              </div>\r\n            )}\r\n\r\n            {/* Enrollments Tab */}\r\n            {activeTab === 'enrollments' && isStudent && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-sm font-medium text-gray-900\">Student Enrollments</h3>\r\n                  <span className=\"text-xs text-gray-500\">\r\n                    Semester: {currentSemester || 'N/A'}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Add New Enrollment */}\r\n                <div className=\"border border-gray-200 rounded-lg p-4 space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-700\">Add Enrollment</h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                    <select\r\n                      value={newEnrollment.kode_mk}\r\n                      onChange={(e) => setNewEnrollment({ ...newEnrollment, kode_mk: e.target.value, id_kelas: '' })}\r\n                      className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    >\r\n                      <option value=\"\">Select Course</option>\r\n                      {availableCourses.map((code) => (\r\n                        <option key={code} value={code}>\r\n                          {code}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n\r\n                    <select\r\n                      value={newEnrollment.id_kelas}\r\n                      onChange={(e) => setNewEnrollment({ ...newEnrollment, id_kelas: e.target.value })}\r\n                      className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                      disabled={!newEnrollment.kode_mk}\r\n                    >\r\n                      <option value=\"\">Any Class</option>\r\n                      {availableClasses.map((cls: KelasResponse) => (\r\n                        <option key={cls.id} value={cls.id}>\r\n                          {extractString(cls.nama_kelas) || `Class ${cls.id}`}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n\r\n                    <button\r\n                      onClick={handleAddEnrollment}\r\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center justify-center gap-2\"\r\n                      disabled={!newEnrollment.kode_mk}\r\n                    >\r\n                      <Plus className=\"w-4 h-4\" />\r\n                      Add\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Current Enrollments */}\r\n                <div className=\"border border-gray-200 rounded-lg overflow-hidden\">\r\n                  {enrollments.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-500 text-sm\">\r\n                      No enrollments yet. Add courses above.\r\n                    </div>\r\n                  ) : (\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            Course Code\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            Class\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase\">\r\n                            Action\r\n                          </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-200\">\r\n                        {enrollments.map((enrollment, idx) => {\r\n                          const cls = classes.find((c: KelasResponse) => c.id === enrollment.id_kelas);\r\n                          return (\r\n                            <tr key={idx} className=\"hover:bg-gray-50\">\r\n                              <td className=\"px-4 py-3 font-medium text-gray-900\">\r\n                                {enrollment.kode_mk}\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-gray-600\">\r\n                                {cls ? extractString(cls.nama_kelas) || `Class ${cls.id}` : 'Any Class'}\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-right\">\r\n                                <button\r\n                                  onClick={() => handleRemoveEnrollment(idx)}\r\n                                  className=\"p-1 text-red-600 hover:bg-red-50 rounded transition-colors\"\r\n                                >\r\n                                  <Trash2 className=\"w-4 h-4\" />\r\n                                </button>\r\n                              </td>\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Save Button */}\r\n                <div className=\"flex justify-end\">\r\n                  <button\r\n                    onClick={handleSaveEnrollments}\r\n                    disabled={isLoading}\r\n                    className=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50\"\r\n                  >\r\n                    {isLoading ? (\r\n                      <>\r\n                        <Loader className=\"w-4 h-4 animate-spin\" />\r\n                        Saving...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Save className=\"w-4 h-4\" />\r\n                        Save Enrollments\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Teaching Assignments Tab */}\r\n            {activeTab === 'teaching' && isLecturer && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-sm font-medium text-gray-900\">Teaching Assignments</h3>\r\n                  <button\r\n                    onClick={() => setShowAddAssignmentForm(!showAddAssignmentForm)}\r\n                    disabled={isLoading}\r\n                    className=\"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2 disabled:opacity-50\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    Add Assignment\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Add Assignment Form */}\r\n                {showAddAssignmentForm && (\r\n                  <div className=\"p-4 bg-gray-50 border border-gray-200 rounded-lg space-y-3\">\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                      {/* Course Selection */}\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                          Course <span className=\"text-red-600\">*</span>\r\n                        </label>\r\n                        <select\r\n                          value={newAssignment.kode_mk}\r\n                          onChange={(e) => setNewAssignment({ ...newAssignment, kode_mk: e.target.value })}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm\"\r\n                        >\r\n                          <option value=\"\">Select course...</option>\r\n                          {Array.from(new Set(classes.map((c: KelasResponse) => extractString(c.kode_mk)))).map((kode) => (\r\n                            <option key={kode} value={kode || ''}>\r\n                              {kode}\r\n                            </option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n\r\n                      {/* Class Selection */}\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                          Class <span className=\"text-red-600\">*</span>\r\n                        </label>\r\n                        <select\r\n                          value={newAssignment.id_kelas}\r\n                          onChange={(e) => setNewAssignment({ ...newAssignment, id_kelas: e.target.value })}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm\"\r\n                        >\r\n                          <option value=\"\">Select class...</option>\r\n                          {classes\r\n                            .filter((c: KelasResponse) => extractString(c.kode_mk) === newAssignment.kode_mk)\r\n                            .map((c: KelasResponse) => (\r\n                              <option key={c.id} value={c.id.toString()}>\r\n                                {extractString(c.nama_kelas) || `Class ${c.id}`}\r\n                              </option>\r\n                            ))}\r\n                        </select>\r\n                      </div>\r\n\r\n                      {/* SKS Ajar */}\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                          SKS Ajar\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={newAssignment.sks_ajar}\r\n                          onChange={(e) => setNewAssignment({ ...newAssignment, sks_ajar: e.target.value })}\r\n                          min=\"0\"\r\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm\"\r\n                          placeholder=\"0\"\r\n                        />\r\n                      </div>\r\n\r\n                      {/* Tatap Muka */}\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                          Tatap Muka\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={newAssignment.tatap_muka}\r\n                          onChange={(e) => setNewAssignment({ ...newAssignment, tatap_muka: e.target.value })}\r\n                          min=\"0\"\r\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm\"\r\n                          placeholder=\"0\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Form Actions */}\r\n                    <div className=\"flex justify-end gap-2\">\r\n                      <button\r\n                        onClick={() => {\r\n                          setShowAddAssignmentForm(false);\r\n                          setNewAssignment({ kode_mk: '', id_kelas: '', sks_ajar: '', tatap_muka: '' });\r\n                        }}\r\n                        disabled={isLoading}\r\n                        className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm disabled:opacity-50\"\r\n                      >\r\n                        Cancel\r\n                      </button>\r\n                      <button\r\n                        onClick={handleAddTeachingAssignment}\r\n                        disabled={isLoading || !newAssignment.kode_mk || !newAssignment.id_kelas}\r\n                        className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2 disabled:opacity-50\"\r\n                      >\r\n                        {isLoading ? (\r\n                          <>\r\n                            <Loader className=\"w-4 h-4 animate-spin\" />\r\n                            Creating...\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            Create Assignment\r\n                          </>\r\n                        )}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Assignments Table */}\r\n                <div className=\"border border-gray-200 rounded-lg overflow-hidden\">\r\n                  {teachingAssignments.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-500 text-sm\">\r\n                      No teaching assignments found.\r\n                    </div>\r\n                  ) : (\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            Course\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            Class\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            Semester\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            SKS\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                            Tatap Muka\r\n                          </th>\r\n                          <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase\">\r\n                            Action\r\n                          </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-200\">\r\n                        {teachingAssignments.map((assignment) => (\r\n                          <tr key={assignment.id} className=\"hover:bg-gray-50\">\r\n                            <td className=\"px-4 py-3 font-medium text-gray-900\">\r\n                              {extractString(assignment.kode_mk) || '-'}\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-gray-600\">\r\n                              {extractString(assignment.id_kelas) || '-'}\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-gray-600\">\r\n                              {extractString(assignment.semester) || '-'}\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-gray-600\">\r\n                              {extractNumber(assignment.sks_ajar) || '-'}\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-gray-600\">\r\n                              {extractNumber(assignment.tatap_muka) || '-'}\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-right\">\r\n                              <button\r\n                                onClick={() => handleRemoveTeachingAssignment(assignment.id)}\r\n                                disabled={isLoading}\r\n                                className=\"p-1 text-red-600 hover:bg-red-50 rounded transition-colors disabled:opacity-50\"\r\n                              >\r\n                                <Trash2 className=\"w-4 h-4\" />\r\n                              </button>\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {!isStudent && !isLecturer && (\r\n              <div className=\"p-8 text-center text-gray-500\">\r\n                This user doesn't have student or lecturer role.\r\n                <br />\r\n                Add appropriate roles first to manage assignments.\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","/**\r\n * Custom hook for UserManagement logic\r\n */\r\n\r\nimport { useMemo, useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  useUsersList,\r\n  useStudentsList,\r\n  useLecturersList,\r\n  useCreateUser,\r\n  useUpdateUser,\r\n  useDeleteUser,\r\n} from '@/hooks/useUsers';\r\nimport type { CreateUserRequest, UpdateUserRequest, Mahasiswa, Dosen } from '@/types';\r\nimport type { UserWithDetails, UserFormData, UserStats } from './types';\r\nimport { getSqlValue, initialFormData } from './types';\r\n\r\ninterface UseUserManagementReturn {\r\n  // Data\r\n  users: UserWithDetails[];\r\n  students: Mahasiswa[];\r\n  lecturers: Dosen[];\r\n  userStats: UserStats;\r\n  totalUsers: number;\r\n  \r\n  // Loading states\r\n  loading: boolean;\r\n  loadError: Error | null;\r\n  actionLoading: boolean;\r\n  \r\n  // Pagination\r\n  currentPage: number;\r\n  itemsPerPage: number;\r\n  setCurrentPage: (page: number) => void;\r\n  \r\n  // Search and filter\r\n  searchTerm: string;\r\n  setSearchTerm: (term: string) => void;\r\n  selectedRole: string;\r\n  setSelectedRole: (role: string) => void;\r\n  filteredUsers: UserWithDetails[];\r\n  \r\n  // Form state\r\n  formData: UserFormData;\r\n  setFormData: React.Dispatch<React.SetStateAction<UserFormData>>;\r\n  formError: string | null;\r\n  setFormError: (error: string | null) => void;\r\n  \r\n  // Modal state\r\n  isAddModalOpen: boolean;\r\n  setIsAddModalOpen: (open: boolean) => void;\r\n  isEditModalOpen: boolean;\r\n  setIsEditModalOpen: (open: boolean) => void;\r\n  editingUser: UserWithDetails | null;\r\n  setEditingUser: (user: UserWithDetails | null) => void;\r\n  \r\n  // Actions\r\n  handleAddUser: (e: React.FormEvent) => Promise<void>;\r\n  handleEditUser: (e: React.FormEvent) => Promise<void>;\r\n  handleDeleteUser: (user: UserWithDetails) => Promise<void>;\r\n  openAddModal: () => void;\r\n  openEditModal: (user: UserWithDetails) => void;\r\n  closeAddModal: () => void;\r\n  closeEditModal: () => void;\r\n  \r\n  // Role management\r\n  addRole: (role: string) => void;\r\n  removeRole: (index: number) => void;\r\n  updateRoleEntity: (index: number, entityType: string, entityId: string) => void;\r\n}\r\n\r\nexport function useUserManagement(): UseUserManagementReturn {\r\n  // Pagination state\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalUsers, setTotalUsers] = useState(0);\r\n  const itemsPerPage = 50;\r\n\r\n  // Search and filter state\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRole, setSelectedRole] = useState<string>('all');\r\n\r\n  // Modal state\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n  const [editingUser, setEditingUser] = useState<UserWithDetails | null>(null);\r\n\r\n  // Form state\r\n  const [formData, setFormData] = useState<UserFormData>(initialFormData);\r\n  const [formError, setFormError] = useState<string | null>(null);\r\n  const [actionLoading, setActionLoading] = useState(false);\r\n\r\n  // Local entity state\r\n  const [students, setStudents] = useState<Mahasiswa[]>([]);\r\n  const [lecturers, setLecturers] = useState<Dosen[]>([]);\r\n\r\n  // Queries\r\n  const { data: studentsData, isLoading: isStudentsLoading, error: studentsError } = useStudentsList();\r\n  const { data: lecturersData, isLoading: isLecturersLoading, error: lecturersError } = useLecturersList();\r\n  \r\n  const usersParams = useMemo(\r\n    () => ({\r\n      q: searchTerm || undefined,\r\n      limit: itemsPerPage,\r\n      offset: (currentPage - 1) * itemsPerPage,\r\n    }),\r\n    [itemsPerPage, currentPage, searchTerm]\r\n  );\r\n  \r\n  const usersQuery = useUsersList(usersParams, { enabled: true });\r\n\r\n  // Mutations\r\n  const createUserMutation = useCreateUser();\r\n  const updateUserMutation = useUpdateUser();\r\n  const deleteUserMutation = useDeleteUser();\r\n\r\n  // Sync local state with query data\r\n  useEffect(() => {\r\n    if (studentsData) setStudents(studentsData);\r\n  }, [studentsData]);\r\n\r\n  useEffect(() => {\r\n    if (lecturersData) setLecturers(lecturersData);\r\n  }, [lecturersData]);\r\n\r\n  useEffect(() => {\r\n    if (usersQuery.data) {\r\n      setTotalUsers(usersQuery.data.total);\r\n    }\r\n  }, [usersQuery.data]);\r\n\r\n  // Reset page on search/filter change\r\n  useEffect(() => {\r\n    setCurrentPage(1);\r\n  }, [searchTerm, selectedRole]);\r\n\r\n  // Derived state\r\n  const loading = usersQuery.isLoading || isStudentsLoading || isLecturersLoading;\r\n  const loadError = usersQuery.error || studentsError || lecturersError;\r\n\r\n  // Enrich users with entity info\r\n  const users: UserWithDetails[] = useMemo(() => {\r\n    const base = usersQuery.data?.data ?? [];\r\n    return base.map((user) => {\r\n      const userRoles = user.roles || [];\r\n      const studentRole = userRoles.find((r) => r.role === 'student');\r\n      const lecturerRole = userRoles.find((r) => r.role === 'lecturer');\r\n      const enriched: UserWithDetails = { ...user };\r\n      \r\n      if (studentRole?.entity_id && studentsData) {\r\n        enriched.studentInfo = studentsData.find((s) => s.nim === studentRole.entity_id);\r\n      }\r\n      if (lecturerRole?.entity_id && lecturersData) {\r\n        enriched.lecturerInfo = lecturersData.find((l) => l.id === lecturerRole.entity_id);\r\n      }\r\n      \r\n      return enriched;\r\n    });\r\n  }, [usersQuery.data, studentsData, lecturersData]);\r\n\r\n  // Filter users client-side (for role filter)\r\n  const filteredUsers = useMemo(() => {\r\n    return users.filter((user) => {\r\n      const userRoles = user.roles?.map((r) => r.role) || [];\r\n      return selectedRole === 'all' || userRoles.includes(selectedRole);\r\n    });\r\n  }, [users, selectedRole]);\r\n\r\n  // Calculate stats\r\n  const userStats: UserStats = useMemo(() => {\r\n    const allRoles = users.flatMap((u) => u.roles?.map((r) => r.role) || []);\r\n    return {\r\n      total: totalUsers,\r\n      students: allRoles.filter((r) => r === 'student').length,\r\n      lecturers: allRoles.filter((r) => r === 'lecturer').length,\r\n      admins: allRoles.filter((r) => r === 'admin').length,\r\n      staff: allRoles.filter((r) => r === 'staff').length,\r\n    };\r\n  }, [users, totalUsers]);\r\n\r\n  // Modal handlers\r\n  const openAddModal = useCallback(() => {\r\n    setFormError(null);\r\n    setFormData(initialFormData);\r\n    setIsAddModalOpen(true);\r\n  }, []);\r\n\r\n  const closeAddModal = useCallback(() => {\r\n    setIsAddModalOpen(false);\r\n  }, []);\r\n\r\n  const openEditModal = useCallback((user: UserWithDetails) => {\r\n    setFormError(null);\r\n    setEditingUser(user);\r\n    setFormData({\r\n      email: user.email,\r\n      name: getSqlValue(user.name),\r\n      password: '',\r\n      roles: user.roles || [],\r\n    });\r\n    setIsEditModalOpen(true);\r\n  }, []);\r\n\r\n  const closeEditModal = useCallback(() => {\r\n    setIsEditModalOpen(false);\r\n    setEditingUser(null);\r\n  }, []);\r\n\r\n  // Form actions\r\n  const handleAddUser = useCallback(async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setFormError(null);\r\n\r\n    if (!formData.email.trim() || !formData.email.includes('@')) {\r\n      setFormError('Email tidak valid');\r\n      return;\r\n    }\r\n\r\n    if (!formData.password.trim()) {\r\n      setFormError('Password wajib diisi jika tidak menggunakan Google OAuth');\r\n      return;\r\n    }\r\n\r\n    setActionLoading(true);\r\n    try {\r\n      const payload: CreateUserRequest = {\r\n        email: formData.email.trim(),\r\n        name: formData.name.trim() || undefined,\r\n        password: formData.password.trim() || undefined,\r\n        auth_provider: 'local',\r\n        roles: formData.roles,\r\n      };\r\n\r\n      await createUserMutation.mutateAsync(payload);\r\n      setIsAddModalOpen(false);\r\n    } catch (error: unknown) {\r\n      const err = error as Error;\r\n      setFormError(err.message || 'Gagal menambahkan pengguna');\r\n    } finally {\r\n      setActionLoading(false);\r\n    }\r\n  }, [formData, createUserMutation]);\r\n\r\n  const handleEditUser = useCallback(async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!editingUser) return;\r\n\r\n    setFormError(null);\r\n\r\n    if (!formData.email.trim() || !formData.email.includes('@')) {\r\n      setFormError('Email tidak valid');\r\n      return;\r\n    }\r\n\r\n    setActionLoading(true);\r\n    try {\r\n      const payload: UpdateUserRequest = {\r\n        email: formData.email.trim(),\r\n        name: formData.name.trim() || undefined,\r\n        roles: formData.roles,\r\n      };\r\n\r\n      if (formData.password.trim()) {\r\n        payload.password = formData.password.trim();\r\n      }\r\n\r\n      await updateUserMutation.mutateAsync({ id: editingUser.id, data: payload });\r\n      setIsEditModalOpen(false);\r\n    } catch (error: unknown) {\r\n      const err = error as Error;\r\n      setFormError(err.message || 'Gagal mengupdate pengguna');\r\n    } finally {\r\n      setActionLoading(false);\r\n    }\r\n  }, [formData, editingUser, updateUserMutation]);\r\n\r\n  const handleDeleteUser = useCallback(async (user: UserWithDetails) => {\r\n    const userName = getSqlValue(user.name) || user.email;\r\n    if (!confirm(`Apakah Anda yakin ingin menghapus pengguna \"${userName}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await deleteUserMutation.mutateAsync({ id: user.id });\r\n    } catch (error: unknown) {\r\n      const err = error as Error;\r\n      alert(`Gagal menghapus pengguna: ${err.message}`);\r\n    }\r\n  }, [deleteUserMutation]);\r\n\r\n  // Role management\r\n  const addRole = useCallback((role: string) => {\r\n    if (formData.roles.some((r) => r.role === role)) {\r\n      setFormError(`Role sudah ditambahkan`);\r\n      return;\r\n    }\r\n\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      roles: [...prev.roles, { role }],\r\n    }));\r\n  }, [formData.roles]);\r\n\r\n  const removeRole = useCallback((index: number) => {\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      roles: prev.roles.filter((_, i) => i !== index),\r\n    }));\r\n  }, []);\r\n\r\n  const updateRoleEntity = useCallback((index: number, entityType: string, entityId: string) => {\r\n    setFormData((prev) => {\r\n      const newRoles = [...prev.roles];\r\n      if (entityId) {\r\n        newRoles[index] = {\r\n          ...newRoles[index],\r\n          entity_type: entityType,\r\n          entity_id: entityId,\r\n        };\r\n      } else {\r\n        const { entity_type, entity_id, ...rest } = newRoles[index];\r\n        void entity_type;\r\n        void entity_id;\r\n        newRoles[index] = rest;\r\n      }\r\n      return { ...prev, roles: newRoles };\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    // Data\r\n    users,\r\n    students,\r\n    lecturers,\r\n    userStats,\r\n    totalUsers,\r\n    \r\n    // Loading states\r\n    loading,\r\n    loadError,\r\n    actionLoading,\r\n    \r\n    // Pagination\r\n    currentPage,\r\n    itemsPerPage,\r\n    setCurrentPage,\r\n    \r\n    // Search and filter\r\n    searchTerm,\r\n    setSearchTerm,\r\n    selectedRole,\r\n    setSelectedRole,\r\n    filteredUsers,\r\n    \r\n    // Form state\r\n    formData,\r\n    setFormData,\r\n    formError,\r\n    setFormError,\r\n    \r\n    // Modal state\r\n    isAddModalOpen,\r\n    setIsAddModalOpen,\r\n    isEditModalOpen,\r\n    setIsEditModalOpen,\r\n    editingUser,\r\n    setEditingUser,\r\n    \r\n    // Actions\r\n    handleAddUser,\r\n    handleEditUser,\r\n    handleDeleteUser,\r\n    openAddModal,\r\n    openEditModal,\r\n    closeAddModal,\r\n    closeEditModal,\r\n    \r\n    // Role management\r\n    addRole,\r\n    removeRole,\r\n    updateRoleEntity,\r\n  };\r\n}\r\n\r\nexport default useUserManagement;\r\n","/**\r\n * User Management Page\r\n * \r\n * Refactored to use smaller components for better maintainability.\r\n * This is the main entry point that composes all sub-components.\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { Plus, Search, Filter } from 'lucide-react';\r\nimport { PageHeader } from '@/components/ui';\r\nimport { UserStatsCards } from './UserStatsCards';\r\nimport { UserTable } from './UserTable';\r\nimport { UserFormModal } from './UserFormModal';\r\nimport { UserAssignments } from './UserAssignments';\r\nimport { useUserManagement } from './useUserManagement';\r\nimport { useAuth } from '@/contexts';\r\nimport type { UserWithDetails } from './types';\r\n\r\nconst UserManagement: React.FC = () => {\r\n  const { currentSemester } = useAuth();\r\n  const [assignmentsUser, setAssignmentsUser] = useState<UserWithDetails | null>(null);\r\n  \r\n  const {\r\n    // Data\r\n    students,\r\n    lecturers,\r\n    userStats,\r\n    totalUsers,\r\n    \r\n    // Loading states\r\n    loading,\r\n    loadError,\r\n    actionLoading,\r\n    \r\n    // Pagination\r\n    currentPage,\r\n    itemsPerPage,\r\n    setCurrentPage,\r\n    \r\n    // Search and filter\r\n    searchTerm,\r\n    setSearchTerm,\r\n    selectedRole,\r\n    setSelectedRole,\r\n    filteredUsers,\r\n    \r\n    // Form state\r\n    formData,\r\n    setFormData,\r\n    formError,\r\n    \r\n    // Modal state\r\n    isAddModalOpen,\r\n    isEditModalOpen,\r\n    \r\n    // Actions\r\n    handleAddUser,\r\n    handleEditUser,\r\n    handleDeleteUser,\r\n    openAddModal,\r\n    openEditModal,\r\n    closeAddModal,\r\n    closeEditModal,\r\n    \r\n    // Role management\r\n    addRole,\r\n    removeRole,\r\n    updateRoleEntity,\r\n  } = useUserManagement();\r\n\r\n  // Handle form change\r\n  const handleFormChange = (data: Partial<typeof formData>) => {\r\n    setFormData((prev) => ({ ...prev, ...data }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6\">\r\n        <PageHeader\r\n          title=\"Manajemen Pengguna\"\r\n          subtitle=\"Kelola pengguna sistem dan hak akses\"\r\n        />\r\n        <div className=\"flex gap-2 mt-4 sm:mt-0\">\r\n          <button\r\n            onClick={openAddModal}\r\n            className=\"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >\r\n            <Plus className=\"w-4 h-4\" />\r\n            Tambah Pengguna\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Error Display */}\r\n      {loadError && (\r\n        <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600\">\r\n          Gagal memuat data: {loadError.message}\r\n        </div>\r\n      )}\r\n\r\n      {/* Statistics */}\r\n      <UserStatsCards stats={userStats} />\r\n\r\n      {/* Search and Filter */}\r\n      <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\r\n        {/* Search */}\r\n        <div className=\"flex-1 relative\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Cari berdasarkan nama atau email...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          />\r\n        </div>\r\n\r\n        {/* Role Filter */}\r\n        <div className=\"relative\">\r\n          <Filter className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n          <select\r\n            value={selectedRole}\r\n            onChange={(e) => setSelectedRole(e.target.value)}\r\n            className=\"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white\"\r\n          >\r\n            <option value=\"all\">Semua Role</option>\r\n            <option value=\"admin\">Admin</option>\r\n            <option value=\"lecturer\">Dosen</option>\r\n            <option value=\"student\">Mahasiswa</option>\r\n            <option value=\"staff\">Staff</option>\r\n            <option value=\"alumni\">Alumni</option>\r\n            <option value=\"student_applicant\">Pendaftar</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* User Table */}\r\n      <UserTable\r\n        users={filteredUsers}\r\n        loading={loading}\r\n        currentPage={currentPage}\r\n        totalUsers={selectedRole === 'all' ? totalUsers : filteredUsers.length}\r\n        itemsPerPage={itemsPerPage}\r\n        onManageAssignments={setAssignmentsUser}\r\n        onPageChange={setCurrentPage}\r\n        onEditUser={openEditModal}\r\n        onDeleteUser={handleDeleteUser}\r\n      />\r\n\r\n      {/* Add User Modal */}\r\n      <UserFormModal\r\n        isOpen={isAddModalOpen}\r\n        isEdit={false}\r\n        formData={formData}\r\n        formError={formError}\r\n        actionLoading={actionLoading}\r\n        students={students}\r\n        lecturers={lecturers}\r\n        onClose={closeAddModal}\r\n        onSubmit={handleAddUser}\r\n        onFormChange={handleFormChange}\r\n        onAddRole={addRole}\r\n        onRemoveRole={removeRole}\r\n        onUpdateRoleEntity={updateRoleEntity}\r\n      />\r\n\r\n      {/* Edit User Modal */}\r\n      <UserFormModal\r\n        isOpen={isEditModalOpen}\r\n        isEdit={true}\r\n        formData={formData}\r\n        formError={formError}\r\n        actionLoading={actionLoading}\r\n        students={students}\r\n        lecturers={lecturers}\r\n        onClose={closeEditModal}\r\n        onSubmit={handleEditUser}\r\n        onFormChange={handleFormChange}\r\n        onAddRole={addRole}\r\n        onRemoveRole={removeRole}\r\n        onUpdateRoleEntity={updateRoleEntity}\r\n      />\r\n\r\n      {/* User Assignments Modal */}\r\n      <UserAssignments\r\n        user={assignmentsUser!}\r\n        isOpen={!!assignmentsUser}\r\n        onClose={() => setAssignmentsUser(null)}\r\n        currentSemester={currentSemester}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserManagement;\r\n"],"names":["useUsersList","params","options","key","useQuery","apiService","usersQueryRootKey","useStudentsList","kode_prodi","useLecturersList","useCreateUser","qc","useQueryClient","useMutation","payload","args","useUpdateUser","id","data","useDeleteUser","UserStatsCards","stats","statItems","Users","Shield","item","jsx","jsxs","initialFormData","getRoleColor","role","getRoleLabel","getSqlValue","extractString","availableRoles","UserTable","users","loading","currentPage","totalUsers","itemsPerPage","onPageChange","onEditUser","onDeleteUser","onManageAssignments","totalPages","user","UserTableRow","ChevronLeft","ChevronRight","onEdit","onDelete","userName","roles","contact","entityInfo","entities","roleObj","idx","info","Mail","Phone","r","BookOpen","Edit","Trash2","UserFormModal","isOpen","isEdit","formData","formError","actionLoading","students","lecturers","onClose","onSubmit","onFormChange","onAddRole","onRemoveRole","onUpdateRoleEntity","title","submitLabel","Fragment","X","e","RoleEntry","entityType","entityId","fr","Loader","onUpdateEntity","onRemove","showStudentSelect","showLecturerSelect","s","l","UserGrades","studentId","semester","setLoading","useState","error","setError","gradesData","setGradesData","useEffect","enrollments","courseMap","coursePromises","enrollment","kode_mk","course","err","gradePromises","grades","combinedData","grade","courseCode","totalSKS","extractInt","aktivitasPartisipatif","extractFloat","hasilProyek","quiz","tugas","uts","uas","hasCompleteGrades","coursesWithCompleteGrades","g","totalCredits","sum","totalCreditsWithGrades","weightedGPA","indeks","IPS","Loader2","AlertCircle","Award","TrendingUp","UserAttendance","studentClasses","loadingClasses","classIds","useMemo","c","meetingsQueries","result","classId","meetings","meetingIds","m","attendancesQuery","meetingId","studentAttendance","a","courseAttendanceData","b","courseData","attendance","presentMeetings","isLoading","getStatusIcon","status","CheckCircle","Clock","ClockAlert","XCircle","Minus","getAttendanceColorForPercentage","percentage","meeting","meetingDate","extractDate","dateStr","UserAssignments","currentSemester","activeTab","setActiveTab","setIsLoading","success","setSuccess","setEnrollments","newEnrollment","setNewEnrollment","teachingAssignments","setTeachingAssignments","newAssignment","setNewAssignment","showAddAssignmentForm","setShowAddAssignmentForm","courses","useCourses","classes","allClasses","studentRole","lecturerRole","lecturerAssignmentsData","useLecturerAssignments","React","loadEnrollments","extractNumber","handleAddEnrollment","handleRemoveEnrollment","index","_","i","handleSaveEnrollments","handleAddTeachingAssignment","updated","handleRemoveTeachingAssignment","assignmentId","availableCourses","coursesMap","cls","kode","availableClasses","isStudent","isLecturer","Calendar","code","Plus","Save","assignment","useUserManagement","setCurrentPage","setTotalUsers","searchTerm","setSearchTerm","selectedRole","setSelectedRole","isAddModalOpen","setIsAddModalOpen","isEditModalOpen","setIsEditModalOpen","editingUser","setEditingUser","setFormData","setFormError","setActionLoading","setStudents","setLecturers","studentsData","isStudentsLoading","studentsError","lecturersData","isLecturersLoading","lecturersError","usersParams","usersQuery","createUserMutation","updateUserMutation","deleteUserMutation","loadError","userRoles","enriched","filteredUsers","userStats","allRoles","u","openAddModal","useCallback","closeAddModal","openEditModal","closeEditModal","handleAddUser","handleEditUser","handleDeleteUser","addRole","prev","removeRole","updateRoleEntity","newRoles","entity_type","entity_id","rest","UserManagement","useAuth","assignmentsUser","setAssignmentsUser","handleFormChange","PageHeader","Search","Filter"],"mappings":"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"}