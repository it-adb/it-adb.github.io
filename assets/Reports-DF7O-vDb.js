const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-2pqXIzBy.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js"])))=>i.map(i=>d[i]);
import{j as e,_ as L}from"./query-vendor-B--u1oZD.js";import{r as f}from"./react-vendor-XXJdR_Id.js";import{a as ue}from"./index-ysxJ7eO1.js";import{X as Q,y as G,z as Y,t as S,w as Z,c as ee,u as M,v as se,x as te,F as O,a7 as be}from"./ui-vendor-DMb5NT47.js";const Se=()=>{const{t:o}=ue(),[p,$]=f.useState([]),[D,B]=f.useState(!1),[R,C]=f.useState(null),[I,U]=f.useState(null),[r,k]=f.useState(null),w=f.useRef(null),[K,F]=f.useState(!1),[E,V]=f.useState(!1),[z,T]=f.useState({current:0,total:0}),ae=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return e.jsx(S,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(ee,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(M,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(Z,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(S,{className:"h-4 w-4 text-purple-600"});case"alpa":case"absent":return e.jsx(se,{className:"h-4 w-4 text-red-600"});default:return e.jsx(te,{className:"h-4 w-4 text-gray-300"})}},re=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return"bg-green-50 text-green-700";case"izin":case"excused":return"bg-blue-50 text-blue-700";case"sakit":case"sick":return"bg-yellow-50 text-yellow-700";case"terlambat":case"late":return"bg-orange-50 text-orange-700";case"pengganti":case"substitute":return"bg-purple-50 text-purple-700";case"alpa":case"absent":return"bg-red-50 text-red-700";default:return"bg-gray-50 text-gray-400"}},le=async s=>{const n=await L(()=>import("./xlsx-DGuHH-KN.js"),[]),t=await s.arrayBuffer(),a=n.read(t,{type:"array"}),c=a.Sheets["Class Description"];if(!c)throw new Error("Class Description sheet not found");const l=n.utils.sheet_to_json(c,{header:1});let i="",m="",u="";const x={};l.forEach(g=>{const[d,b]=g;if(d===void 0||b===void 0)return;const h=typeof b=="number"?b:String(b);x[String(d)]=h}),i=x["Course Code"]||"N/A",m=x.Class||"N/A",u=x["Course Name"]||"N/A";const j=x.Lecturers||"",_=x["Total SKS"]||x.SKS||"",P=a.Sheets["Attendance Overview"];if(!P)throw new Error("Attendance Overview sheet not found");let y=n.utils.sheet_to_json(P,{header:1});const A=g=>!g||g.every(d=>d==null||String(d).trim()==="");y.length>0&&(y=[y[0],...y.slice(1).filter(g=>!A(g))]);const he=l,J=a.Sheets["Meeting Summary"];if(!J)throw new Error("Meeting Summary sheet not found");let N=n.utils.sheet_to_json(J,{header:1});if(N.length>0){N=[N[0],...N.slice(1).filter(d=>!A(d))];const g=d=>{if(d instanceof Date&&!isNaN(d.getTime()))return d.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"});const b=typeof d=="number"?d:typeof d=="string"&&/^\d+(\.\d+)?$/.test(d.trim())?parseFloat(d):NaN;if(!isNaN(b)){const h=new Date(Date.UTC(1899,11,30)),pe=b*24*60*60*1e3;return new Date(h.getTime()+pe).toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"})}return typeof d=="string"?d:""};N=N.map((d,b)=>{if(b===0)return d;const h=[...d];return h[1]!==void 0&&h[1]!==null&&String(h[1]).trim()!==""&&(h[1]=g(h[1])),h})}let v;const q=a.Sheets["Grades Overview"];return q&&(v=n.utils.sheet_to_json(q,{header:1}),v.length>0&&(v=[v[0],...v.slice(1).filter(g=>!A(g))])),{id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fileName:s.name,courseCode:i,className:m,courseName:u,lecturers:j,totalSKS:_,classDescData:he,attendanceData:y,meetingSummaryData:N,gradesData:v}},X=async s=>{const n=Array.from(s||[]).filter(l=>/\.xlsx?$/i.test(l.name));if(n.length===0)return;B(!0),C(null);const t=await Promise.allSettled(n.map(l=>le(l))),a=[];let c=0;if(t.forEach(l=>{l.status==="fulfilled"?a.push(l.value):c+=1}),a.length>0){$(m=>[...m,...a]);const l=a.length===1?"1 file":`${a.length} files`,i=c>0?` (⚠️ ${c} failed)`:"";C({type:"success",text:`${l} berhasil diimpor${i}.`})}else C({type:"error",text:"Gagal membaca semua file. Pastikan setiap file memiliki sheet: Class Description, Attendance Overview, Meeting Summary."});B(!1)},ne=async s=>{const n=s.target.files;n&&n.length>0&&await X(n),s.target.value=""},H=s=>{s.preventDefault(),s.stopPropagation(),K||F(!0)},ie=s=>{s.preventDefault(),s.stopPropagation(),F(!1)},ce=async s=>{s.preventDefault(),s.stopPropagation(),F(!1),s.dataTransfer?.files&&s.dataTransfer.files.length>0&&(await X(s.dataTransfer.files),s.dataTransfer.clearData())},de=s=>{k(s)},oe=()=>{k(null)},W=async(s,n)=>{try{const[{default:t},{default:a}]=await Promise.all([L(()=>import("./html2canvas-pro.esm-BvaDPKdU.js"),[]),L(()=>import("./jspdf.es.min-2pqXIzBy.js").then(y=>y.j),__vite__mapDeps([0,1,2]))]),c=await t(n,{scale:1.5,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),l=210,i=297,m=c.height*l/c.width;let u=m;const x=new a("p","mm","a4");let j=0;const _=c.toDataURL("image/jpeg",.85);for(x.addImage(_,"JPEG",0,j,l,m),u-=i;u>0;)j=u-m,x.addPage(),x.addImage(_,"JPEG",0,j,l,m),u-=i;const P=`Class_Summary_${s.className}_${s.courseName.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;return x.save(P),!0}catch{return!1}},xe=async()=>{if(w.current){U("pdf-generation");try{await W(r,w.current)}catch{alert("Failed to generate PDF. Please try again.")}finally{U(null)}}},me=async()=>{if(p.length===0)return;V(!0),T({current:0,total:p.length});let s=0,n=0;for(let a=0;a<p.length;a++){const c=p[a];T({current:a+1,total:p.length}),k(c),await new Promise(l=>setTimeout(l,100)),w.current&&(await W(c,w.current)?s++:n++,await new Promise(i=>setTimeout(i,300)))}k(null),V(!1),T({current:0,total:0});const t=n>0?`Bulk generation complete: ${s} succeeded, ${n} failed`:`Successfully generated ${s} PDF reports!`;C({type:n>0?"error":"success",text:t})},ge=s=>{$(n=>n.filter(t=>t.id!==s))};if(r){const s=r.attendanceData&&r.attendanceData.length>0?r.attendanceData[0].slice(2).map(t=>String(t)):[],n={};return r.meetingSummaryData&&r.meetingSummaryData.length>1&&r.meetingSummaryData.slice(1).forEach(t=>{const a=t[0],c=t[1];a!=null&&c!==void 0&&c!==null&&(n[String(a)]=String(c))}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:oe,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Close Report"})]}),e.jsx("button",{onClick:xe,disabled:I==="pdf-generation",className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:I==="pdf-generation"?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate PDF Report"})]})})]}),e.jsxs("div",{ref:w,className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 pt-6 pb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Summary"}),e.jsxs("p",{className:"text-base text-gray-600 mt-1",children:[r.courseCode&&e.jsx("span",{className:"font-medium",children:r.courseCode}),r.courseCode&&" - ",r.courseName," - Class ",r.className,r.totalSKS&&` (${r.totalSKS} SKS)`]}),r.lecturers&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:r.lecturers})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attendance Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex gap-0",children:[e.jsx("div",{className:"flex-shrink-0 sticky left-0 z-10",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 h-14",children:"NIM"}),e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 h-14",children:"Name"})]})}),e.jsx("tbody",{children:r.attendanceData?.slice(1).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9",children:[e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900",children:t[0]?String(t[0]):"-"}),e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate",children:t[1]?String(t[1]):"-"})]},a))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:s.map((t,a)=>e.jsx("th",{className:"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-16 h-14",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("span",{className:"font-bold text-[10px]",children:String(t)}),n[t]&&e.jsx("span",{className:"text-gray-500 font-normal text-[9px]",children:n[t]})]})},a))})}),e.jsx("tbody",{children:r.attendanceData?.slice(1).map((t,a)=>e.jsx("tr",{className:"hover:bg-gray-50 h-9",children:t.slice(2).map((c,l)=>{const i=c==null?"":String(c);return e.jsx("td",{className:`border-r border-b border-gray-300 px-1 py-1.5 text-center ${re(i)}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1 justify-center",children:[ae(i),e.jsx("span",{className:"text-[10px] text-gray-700",children:i})]})},l)})},a))})]})})]})})})]}),e.jsx("div",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-gray-600",children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Substitute"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-4 w-4 text-gray-300"}),e.jsx("span",{className:"text-gray-600",children:"No data"})]})]})}),e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Descriptions"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16",children:"Meeting"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28",children:"Date"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Topic"})]})}),e.jsx("tbody",{children:r.meetingSummaryData?.slice(1).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 font-medium text-gray-900",children:t[0]?String(t[0]):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:t[1]?String(t[1]):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:t[2]?String(t[2]):"-"})]},a))})]})})]}),r.gradesData&&r.gradesData.length>0&&e.jsxs("div",{className:"px-6 py-3 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grades Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:r.gradesData[0].map((t,a)=>e.jsx("th",{className:`border-${a<r.gradesData[0].length-1?"r":""} border-b border-gray-300 px-3 py-2 ${a<=1?"text-left":"text-center"} font-semibold text-gray-700`,children:String(t)},a))})}),e.jsx("tbody",{children:r.gradesData.slice(1).map((t,a)=>a===r.gradesData.length-2||t[0]&&String(t[0]).toLowerCase().includes("weight")?e.jsxs("tr",{className:"bg-blue-50 font-bold",children:[e.jsx("td",{colSpan:2,className:"border-r border-b border-gray-300 px-3 py-2 text-left text-gray-900",children:t[0]===null||t[0]===void 0?"-":String(t[0])}),t.slice(2,8).map((l,i)=>e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600",children:l==null?"-":String(l)},i+2)),e.jsx("td",{colSpan:3,className:"border-b border-gray-300 px-3 py-2 text-center text-blue-600",children:t[8]===null||t[8]===void 0?"-":String(t[8])})]},a):e.jsx("tr",{className:"hover:bg-gray-50",children:t.map((l,i)=>{const m=i===0,u=i===1,x=i===r.gradesData[0].length-2,j=i>=r.gradesData[0].length-3;return e.jsx("td",{className:`border-${i<t.length-1?"r":""} border-b border-gray-300 px-3 py-2 ${i<=1?"text-left":"text-center"} ${m?"font-medium text-gray-900":u?"text-gray-900":x?"font-bold text-blue-600":j?"font-semibold text-gray-900":"text-gray-600"}`,children:l==null?"-":String(l)},i)})},a))})]})})})]})]})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:o("adminReports.title")}),e.jsx("p",{className:"text-gray-600",children:o("adminReports.subtitle")})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:o("adminReports.uploadTitle")}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${K?"border-blue-500 bg-blue-50":"border-blue-300 hover:border-blue-400"}`,onDragOver:H,onDragEnter:H,onDragLeave:ie,onDrop:ce,children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",multiple:!0,onChange:ne,disabled:D,className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(be,{className:"h-12 w-12 text-blue-400 mb-3"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:o("adminReports.dragDrop")}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:o("adminReports.orClick")}),e.jsx("p",{className:"text-xs text-gray-400 mt-3",children:o("adminReports.fileRequirements")}),D&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-blue-600",children:[e.jsx(G,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:o("adminReports.processing")})]})]})})]}),R&&e.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-lg ${R.type==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[R.type==="success"?e.jsx(S,{className:"h-5 w-5 flex-shrink-0"}):e.jsx(M,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:R.text})]})]})}),p.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[o("adminReports.importedReports")," (",p.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:me,disabled:E||D,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:E?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 animate-spin"}),e.jsxs("span",{children:[o("adminReports.generating")," ",z.current,"/",z.total,"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:o("adminReports.bulkGenerate")})]})}),e.jsxs("button",{onClick:()=>$([]),disabled:E||D||p.length===0,className:"btn-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:o("adminReports.removeAll")})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:p.map(s=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:[s.courseCode&&e.jsx("span",{className:"text-blue-600",children:s.courseCode}),s.courseCode&&" - ",s.courseName," - Class ",s.className]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[o("adminReports.file"),": ",s.fileName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>de(s),className:"flex-1 btn-primary flex items-center justify-center space-x-2",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:o("adminReports.viewReport")})]}),e.jsx("button",{onClick:()=>ge(s.id),className:"flex-1 btn-secondary flex items-center justify-center space-x-2",children:e.jsx("span",{children:o("adminReports.remove")})})]})]})},s.id))})]}):e.jsxs("div",{className:"text-center py-12 card p-6",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:o("adminReports.noReports")}),e.jsx("p",{className:"text-gray-500 mb-6",children:o("adminReports.uploadPrompt")})]})]})};export{Se as default};
//# sourceMappingURL=Reports-DF7O-vDb.js.map
