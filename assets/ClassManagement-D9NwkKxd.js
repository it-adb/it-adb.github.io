import{j as e}from"./query-vendor-B--u1oZD.js";import{u as z,r}from"./react-vendor-XXJdR_Id.js";import{u as H,c as l,e as S,g as d}from"./index-BFadXLuC.js";import{u as V}from"./useCourses-bNuKZiCW.js";import{u as J}from"./usePrograms-Bh6G_nyH.js";import{w as W,b as E,B as $,G as L,z as X,_ as Z,s as ee,a0 as se,p as ae,e as te}from"./ui-vendor-Bvty7Z9l.js";const me=()=>{const{currentSemester:m}=H(),D=z(),[N,w]=r.useState([]),[x,u]=r.useState([]),[F,P]=r.useState([]),[T,Y]=r.useState(!0),[v,b]=r.useState(null),[i,A]=r.useState(""),[y,G]=r.useState(new Set),[o,I]=r.useState("all"),[n,k]=r.useState(""),[h,_]=r.useState("1"),g=r.useMemo(()=>n?`${n}${h}`:"",[n,h]),{data:f}=J(),{data:j,isLoading:C,error:p}=V(r.useMemo(()=>g?{semester:g,include_classes:!0}:void 0,[g]));r.useEffect(()=>{f&&P(f)},[f]),r.useEffect(()=>{let s=N;i&&(s=s.filter(a=>a.nama_mk.toLowerCase().includes(i.toLowerCase())||a.kode_mk.toLowerCase().includes(i.toLowerCase()))),o!=="all"&&(s=s.filter(a=>a.kode_prodi===o)),u(s)},[i,o,N]),r.useEffect(()=>{if(m&&!n){const s=m.slice(0,4),a=m.slice(4);k(s),_(a)}},[m,n]),r.useEffect(()=>{Y(C||!n&&!0)},[C,n]),r.useEffect(()=>{if(p){const s=p instanceof Error?p.message:"Failed to load courses";b(s),w([]),u([])}else b(null)},[p]),r.useEffect(()=>{if(Array.isArray(j)){const s=j;w(s),u(s)}},[j]);const M=s=>{const a=new Set(y);a.has(s)?a.delete(s):a.add(s),G(a)},U=s=>(s.sks_tatap_muka||0)+(s.sks_praktek||0)+(s.sks_prak_lapangan||0)+(s.sks_simulasi||0),O=s=>s?s.toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",R=s=>{switch(s){case"Online":return"bg-blue-100 text-blue-700";case"Offline":return"bg-green-100 text-green-700";case"Hybrid":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},K=s=>{if(!s||s.length<5)return"Unknown Semester";const a=s.slice(0,4),c=s.slice(4)==="1"?"Ganjil":"Genap";return`${`${a}/${parseInt(a)+1}`} ${c}`},B=x.length,Q=x.reduce((s,a)=>s+(a.classes?.length||0),0);return T||!n?e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(W,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:n?"Loading courses...":"Loading semester information..."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Management"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(E,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-500",children:"Current Semester:"}),e.jsx("span",{className:"font-medium text-gray-900",children:K(m)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx($,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Courses"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:B})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Classes"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:Q})]})]})})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by course name or code...",value:i,onChange:s=>A(s.target.value),className:"input-field pl-10 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(E,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",value:n,onChange:s=>k(s.target.value),placeholder:"Year",className:"input-field w-[80px] text-center",min:new Date().getFullYear()-10,max:new Date().getFullYear()+5}),e.jsx("span",{className:"text-gray-500 font-medium",children:"/"}),e.jsx("input",{type:"number",value:n?parseInt(n)+1:"",disabled:!0,className:"input-field w-[80px] text-center bg-gray-50 text-gray-600",readOnly:!0})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs("select",{value:h,onChange:s=>_(s.target.value),className:"input-field min-w-[120px]",children:[e.jsx("option",{value:"1",children:"Ganjil"}),e.jsx("option",{value:"2",children:"Genap"})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Z,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("select",{value:o,onChange:s=>I(s.target.value),className:"input-field min-w-[200px]",children:[e.jsx("option",{value:"all",children:"All Programs"}),F.map(s=>e.jsxs("option",{value:s.kode_prodi,children:[s.nama_prodi," (",s.kode_prodi,")"]},s.kode_prodi))]})]})]})}),v&&e.jsx("div",{className:"card bg-red-50 border-red-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(ee,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading courses"}),e.jsx("p",{className:"text-sm text-red-600",children:v})]})]})}),x.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx($,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No courses found"}),e.jsx("p",{className:"text-sm text-gray-400",children:i||o!=="all"?"Try adjusting your filters or search query":"No courses available for this semester"})]}):e.jsx("div",{className:"space-y-2",children:x.map(s=>{const a=y.has(s.kode_mk),c=s.classes&&s.classes.length>0;return e.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between gap-2 cursor-pointer",onClick:()=>c&&M(s.kode_mk),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:c&&e.jsx("div",{className:"text-gray-400",children:a?e.jsx(se,{className:"h-4 w-4"}):e.jsx(ae,{className:"h-4 w-4"})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 text-xs font-medium rounded whitespace-nowrap",children:s.kode_mk}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:s.nama_mk}),s.jenis_mk&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded whitespace-nowrap",children:s.jenis_mk})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-0.5 whitespace-nowrap",children:[e.jsx(L,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[U(s)," SKS"]})]}),c&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 font-medium rounded whitespace-nowrap",children:[s.classes.length," classes"]})]})]})}),a&&c&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:s.classes.map(t=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-xs hover:bg-gray-100 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900 whitespace-nowrap",children:["Class ",l(t.nama_kelas)]}),l(t.mode_kuliah)&&e.jsx("span",{className:`px-1.5 py-0.5 text-xs font-medium rounded whitespace-nowrap ${R(l(t.mode_kuliah))}`,children:l(t.mode_kuliah)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600 flex-wrap",children:[S(t.tgl_mulai)&&e.jsx("span",{className:"whitespace-nowrap",children:O(S(t.tgl_mulai))}),d(t.sks_tatap_muka)>0&&e.jsxs("span",{className:"whitespace-nowrap",children:[d(t.sks_tatap_muka),"SKS"]}),e.jsxs("button",{onClick:q=>{q.stopPropagation(),D(`/class-summary/${t.id}?courseCode=${encodeURIComponent(s.kode_mk)}&courseName=${encodeURIComponent(s.nama_mk)}&className=${encodeURIComponent(l(t.nama_kelas))}&sksTatapMuka=${d(t.sks_tatap_muka)}&sksPraktek=${d(t.sks_praktek)}&sksPrakLapangan=${d(t.sks_prak_lapangan)}&sksSimulasi=${d(t.sks_simulasi)}&from=admin/class-management`)},className:"ml-2 px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1 whitespace-nowrap",title:"View attendance matrix",children:[e.jsx(te,{className:"h-3 w-3"}),e.jsx("span",{children:"Attendance"})]})]})]}),l(t.bahasan)&&e.jsx("p",{className:"text-gray-600 mt-1",children:l(t.bahasan)})]},t.id))})]},s.kode_mk)})})]})};export{me as default};
//# sourceMappingURL=ClassManagement-D9NwkKxd.js.map
