const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-2pqXIzBy.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js"])))=>i.map(i=>d[i]);
import{u as ze,b as Ee,c as kt,_ as Xe,d as ss,j as e}from"./query-vendor-B--u1oZD.js";import{r as o,e as rs,f as as,u as ns}from"./react-vendor-XXJdR_Id.js";import{u as os,a as is,b as ls,c as cs,d as ds,e as us}from"./useLecturerAssignments-DiRZGo_n.js";import{b as de}from"./index-U_9acvuP.js";import{H as ps,C as bt,r as Ae,s as bs,t as xs,u as Se,v as Te,w as xt,g as gt,x as mt,y as ht}from"./ui-vendor-C-UqR_Df.js";function gs(t){return ze({queryKey:["grades",t?.krs_id??null,t?.kelas_id??null],queryFn:()=>de.getGrades(t),enabled:!!(t&&(t.krs_id!==void 0||t.kelas_id!==void 0))})}function ms(t){const r=Ee();return kt({mutationFn:c=>de.createGrade(c),onSuccess:async()=>{r.invalidateQueries({queryKey:["grades"]})}})}function hs(t){const r=Ee();return kt({mutationFn:({id:c,data:u})=>de.updateGrade(c,u),onSuccess:async(c,u)=>{try{const i=await de.getGrade(u.id);r.setQueriesData({queryKey:["grades"],exact:!1},S=>S&&S.map(w=>w.id===u.id?i:w))}catch(i){console.error("Failed to fetch updated grade, invalidating:",i),r.invalidateQueries({queryKey:["grades"]})}}})}const Ge=["","Hadir","Izin","Sakit","Alfa","Terlambat","Pengganti"],ft={1:"Hadir",2:"Izin",3:"Sakit",4:"Alfa",5:"Terlambat",6:"Pengganti"},oe=t=>t?typeof t=="string"?t:t.Valid?t.String:"":"",He=t=>{if(!t)return"";let r="";if(typeof t=="string"?r=t:t.Valid&&(r=t.Time),!r)return"";const c=new Date(r);return isNaN(c.getTime())?"":c.toISOString().slice(0,10)},Ne=t=>{if(!t)return"";let r="";if(typeof t=="string"?r=t:"String"in t&&t.Valid?r=t.String:"Time"in t&&t.Valid&&(r=t.Time),!r)return"";const c=r.split(":");return c.length>=2?`${c[0].padStart(2,"0")}:${c[1].padStart(2,"0")}`:r},ne=t=>{if(t==null)return null;if(typeof t=="number")return t;if(typeof t=="object"&&t!==null){if("Float64"in t&&t.Valid)return t.Float64;if("Int32"in t&&t.Valid)return t.Int32}return null},yt=t=>{if(t==null)return null;if(typeof t=="number"||typeof t=="string"||typeof t=="boolean")return t;if(typeof t=="object"&&t!==null){if("Float64"in t&&t.Valid)return t.Float64;if("Int32"in t)return t.Int32;if("String"in t&&t.Valid)return t.String}return null},L=t=>{if(t==null)return null;if(typeof t=="number")return t;if(typeof t=="object"&&t!==null&&"Float64"in t&&"Valid"in t){const r=t;return r.Valid?r.Float64:null}return null},we=t=>{const r=t?.id_krs??t?.krs_id??t?.krsId??t?.krs?.id??t?.krs?.KRS?.id;return r!=null?Number(r):null},Oe=(t,r)=>r.find(u=>u.toLowerCase()===t.toLowerCase())??t,_t=t=>{let r="";if(typeof t=="object"&&t!==null){if(!t.Valid)return"-";r=t.Time}else r=t;if(!r)return"-";const c=new Date(r),u=c.toLocaleDateString("en-US",{weekday:"short"}),i=c.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"});return`${u}, ${i}`},fs=t=>{let r="";if(typeof t=="object"&&t!==null){if(!t.Valid)return"-";r=t.Time}else r=t;if(!r)return"-";const c=new Date(r),u=c.toLocaleDateString("en-US",{weekday:"short"}),i=c.toLocaleDateString("en-US",{day:"2-digit"}),S=c.toLocaleDateString("en-US",{month:"short"});return`${u}
${i} ${S}`},jt=t=>Ne(t)||"-",U={aktivitas_partisipatif:15,hasil_proyek:35,quiz:5,tugas:5,uts:15,uas:25},ys=["bobot_partisipatif","bobot_proyek","bobot_kuis","bobot_tugas","bobot_uts","bobot_uas"],ks=["aktivitas_partisipatif","hasil_proyek","quiz","tugas","uts","uas","nilai_angka","nilai_huruf","nilai_indeks"],Nt=t=>{const r=L(t?.bobot_partisipatif),c=L(t?.bobot_proyek),u=L(t?.bobot_kuis),i=L(t?.bobot_tugas),S=L(t?.bobot_uts),w=L(t?.bobot_uas);return[{key:"aktivitas_partisipatif",weight:r??U.aktivitas_partisipatif},{key:"hasil_proyek",weight:c??U.hasil_proyek},{key:"quiz",weight:u??U.quiz},{key:"tugas",weight:i??U.tugas},{key:"uts",weight:S??U.uts},{key:"uas",weight:w??U.uas}]},Ue=t=>t==null?{huruf:"",indeks:0}:t>=80?{huruf:"A",indeks:4}:t>=75?{huruf:"AB",indeks:3.5}:t>=70?{huruf:"B",indeks:3}:t>=65?{huruf:"BC",indeks:2.5}:t>=60?{huruf:"C",indeks:2}:t>=55?{huruf:"CD",indeks:1.5}:t>=40?{huruf:"D",indeks:1}:{huruf:"E",indeks:0},We=(t,r)=>{let c=0,u=0,i=!1;return(r??Nt()).forEach(({key:w,weight:C})=>{const _=t[w],F=ne(_);F!==null&&(u+=F*C,c+=C,i=!0)}),!i||c===0?null:parseFloat((u/c).toFixed(2))},wt=(t,r,c)=>t.id&&t.id>0?`id:${t.id}`:t.krs_id?`krs:${typeof t.krs_id=="object"?t.krs_id.Int32:t.krs_id}`:r?`krs:${r}`:`nim:${c}`,_s=({classId:t,meetingIds:r,attendanceMap:c,isEditing:u})=>{const i=Ee(),S=o.useRef(!1),[w,C]=o.useState({}),[_,F]=o.useState({}),[D,P]=o.useState(new Set),[l,f]=o.useState({}),[se,I]=o.useState({}),[h,y]=o.useState(null),[k,j]=o.useState(null),v=os(),z=is(),E=o.useCallback(()=>{if(S.current){console.log("[EFFECT] Skipping attendance snapshot update - just saved");return}console.log("[EFFECT] Building attendance snapshot, isEditing:",u);const ee={};Object.values(c).forEach(te=>{te.forEach(R=>{const W=oe(R.status_kehadiran);ee[`${R.nim}-${R.id_pertemuan}`]=Oe(W,Ge)})}),F(ee),u||(console.log("[EFFECT] Setting original cache (not editing)"),I(c))},[c,u]),G=o.useCallback(()=>{const ee=new Set;Object.entries(l).forEach(([te,R])=>{const W=_[te]??"";Oe(W,Ge)!==Oe(R,Ge)&&ee.add(te)}),P(ee)},[l,_]),J=o.useCallback((ee,te)=>{const[R,W]=ee.split("-"),K=Number(W),ue=["class-attendances",t,r];i.setQueryData(ue,ce=>{const d={...ce||{}},p=[...d[K]||[]],N=p.findIndex(b=>b.nim===R);return N>=0?p[N]={...p[N],status_kehadiran:te}:p.push({id:-Date.now(),id_pertemuan:K,nim:R,status_kehadiran:te}),d[K]=p,d}),f(ce=>({...ce,[ee]:te})),G()},[t,r,i,G]),V=o.useCallback(async(ee=!1)=>{if(!u)return;const te=Object.entries(l);if(te.length){C(R=>{const W={...R};return te.forEach(([K])=>W[K]=!0),W});try{await Promise.all(te.map(async([W,K])=>{const[ue,ce]=W.split("-"),d=Number(ce),p=c[d]?.find(N=>N.nim===ue);p&&p.id>0?await z.mutateAsync({id:p.id,data:{status_kehadiran:K||void 0}}):await v.mutateAsync({id_pertemuan:d,nim:ue,status_kehadiran:K||void 0})}));const R={};await Promise.all(r.map(async W=>{const K=await de.getMeetingAttendances(W);R[W]=K})),i.setQueryData(["class-attendances",t,r],R),I(R),S.current=!0,ee||(f({}),P(new Set),y(null))}finally{C({})}}},[u,l,c,r,z,v,i,t]),Z=o.useCallback(()=>{I(c),f({}),P(new Set),y(null),j(null)},[c]),ge=o.useCallback(()=>{const ee=["class-attendances",t,r];S.current?S.current=!1:i.setQueryData(ee,se),f({}),P(new Set),y(null),j(null)},[t,r,i,se]),re=o.useMemo(()=>D.size>0,[D]);return{savingCells:w,initialAttendanceSnapshot:_,modifiedCells:D,pendingStatusChanges:l,activeCell:h,currentShortcutStatus:k,hasUnsavedChanges:re,setActiveCell:y,setCurrentShortcutStatus:j,setPendingStatusChanges:f,buildInitialSnapshot:E,updateSingleCell:J,commitAttendanceChanges:V,enterEditMode:Z,exitEditMode:ge,recalcModified:G}},js=({classIdNum:t,meetings:r})=>{const c=Ee(),[u,i]=o.useState({}),[S,w]=o.useState({}),[C,_]=o.useState({}),[F,D]=o.useState({}),P=ls(),l=o.useCallback((k,j,v,z,E)=>{i(G=>({...G,[k]:j||""})),w(G=>({...G,[k]:v||""})),_(G=>({...G,[k]:z||""})),D(G=>({...G,[k]:E||""}))},[]),f=o.useCallback(k=>{i(j=>{const v={...j};return delete v[k],v}),w(j=>{const v={...j};return delete v[k],v}),_(j=>{const v={...j};return delete v[k],v}),D(j=>{const v={...j};return delete v[k],v})},[]),se=o.useCallback(async k=>{const j=u[k]??"",v=S[k]??"",z=C[k]??"",E=F[k]??"",G=v?`${v}T00:00:00.000Z`:void 0,J=z?`${z}:00`:void 0;console.log("[MEETING] ðŸ’¾ Saving meeting",k,"with topic:",j),console.log("[MEETING] Date input:",v,"â†’ ISO:",G),console.log("[MEETING] Lecturer:",E),await P.mutateAsync({id:k,data:{topik:j||void 0,tgl_pertemuan:G,jam_pertemuan:J,id_dosen:E||void 0}}),console.log("[MEETING] âœ… Meeting saved successfully"),c.setQueryData(["class-meetings",t],V=>V&&V.map(Z=>Z.id===k?{...Z,topik:j,tgl_pertemuan:G||Z.tgl_pertemuan,jam_pertemuan:J||Z.jam_pertemuan,id_dosen:E||Z.id_dosen}:Z)),f(k)},[u,S,C,F,P,c,t,f]),I=o.useCallback(()=>{console.log("[MEETING] ðŸ“ Entering meeting edit mode");const k={},j={},v={},z={};r.forEach(E=>{k[E.id]=oe(E.topik),j[E.id]=He(E.tgl_pertemuan),v[E.id]=Ne(E.jam_pertemuan),z[E.id]=oe(E.id_dosen)}),i(k),w(j),_(v),D(z)},[r]),h=o.useCallback(()=>{console.log("[MEETING] ðŸšª Exiting meeting edit mode - clearing edits"),i({}),w({}),_({}),D({})},[]),y=o.useMemo(()=>{for(const k of r){const j=k.id,v=u[j]??"",z=oe(k.topik);if(v!==z)return!0;const E=S[j]??"",G=He(k.tgl_pertemuan);if(E!==G)return!0;const J=C[j]??"",V=Ne(k.jam_pertemuan);if(J!==V)return!0;const Z=F[j]??"",ge=oe(k.id_dosen);if(Z!==ge)return!0}return!1},[r,u,S,C,F]);return{editedTopics:u,editedDates:S,editedTimes:C,editedLecturers:F,hasUnsavedChanges:y,setEditedTopics:i,setEditedDates:w,setEditedTimes:_,setEditedLecturers:D,startEditTopic:l,cancelEditTopic:f,saveTopic:se,enterEditMode:I,exitEditMode:h}},Ns=({classIdNum:t,classId:r,students:c,gradeRecords:u,classData:i})=>{const S=Ee(),[w,C]=o.useState({}),[_,F]=o.useState(new Set),[D,P]=o.useState(new Set),[l,f]=o.useState({}),[se,I]=o.useState(!1),[h,y]=o.useState(null),[k,j]=o.useState(!1),v=hs(),z=ms(),E=o.useMemo(()=>{const d=l.bobot_partisipatif??L(i?.bobot_partisipatif),p=l.bobot_proyek??L(i?.bobot_proyek),N=l.bobot_kuis??L(i?.bobot_kuis),b=l.bobot_tugas??L(i?.bobot_tugas),m=l.bobot_uts??L(i?.bobot_uts),A=l.bobot_uas??L(i?.bobot_uas);return{aktivitas_partisipatif:d??U.aktivitas_partisipatif,hasil_proyek:p??U.hasil_proyek,quiz:N??U.quiz,tugas:b??U.tugas,uts:m??U.uts,uas:A??U.uas}},[i,l]),G=o.useMemo(()=>{const d={bobot_partisipatif:l.bobot_partisipatif??L(i?.bobot_partisipatif),bobot_proyek:l.bobot_proyek??L(i?.bobot_proyek),bobot_kuis:l.bobot_kuis??L(i?.bobot_kuis),bobot_tugas:l.bobot_tugas??L(i?.bobot_tugas),bobot_uts:l.bobot_uts??L(i?.bobot_uts),bobot_uas:l.bobot_uas??L(i?.bobot_uas)};return Nt(d)},[i,l]),J=o.useMemo(()=>({bobot_partisipatif:L(i?.bobot_partisipatif)??U.aktivitas_partisipatif,bobot_proyek:L(i?.bobot_proyek)??U.hasil_proyek,bobot_kuis:L(i?.bobot_kuis)??U.quiz,bobot_tugas:L(i?.bobot_tugas)??U.tugas,bobot_uts:L(i?.bobot_uts)??U.uts,bobot_uas:L(i?.bobot_uas)??U.uas}),[i]),V=o.useMemo(()=>ys.some(d=>{const p=l[d];return p===void 0?!1:p!==J[d]}),[l,J]),Z=o.useCallback(d=>{const p=u,N=d?.nim??d?.krs?.nim??d?.student?.nim??"";let b;if(b=p.find(A=>A.student?.nim===N||A.krs?.student?.nim===N||A.krs?.nim===N),b)return b;const m=we(d);return m!==null&&(b=u.find(A=>{const Q=ne(A.krs_id);return Q!==null&&Q===m}),b)||(b=p.find(A=>Object.values(A).some(Q=>typeof Q=="string"&&Q===N)),b)?b:{id:0,krs_id:null,aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null}},[u]),ge=o.useCallback(async(d,p,N)=>{console.log("[GRADES] ðŸ’¾ Saving grade for key:",d,"Grade ID:",p?.id);const b=p?.id&&p.id>0?p.id:null;b&&F(m=>new Set([...m,b]));try{const m=w[d];if(!m){console.log("[GRADES] âš ï¸ No edited grade found for key:",d);return}if(!["aktivitas_partisipatif","hasil_proyek","quiz","tugas","uts","uas"].some(X=>{const ae=ne(p[X]),Me=ne(m[X]);return ae!==Me})){console.log("[GRADES] â„¹ï¸ No changes detected, skipping save"),P(X=>new Set([...X,d])),b&&F(X=>new Set([...X].filter(ae=>ae!==b)));return}const pe=We(m,G),be=pe!==null?pe:ne(m.nilai_angka);let he,fe;if(be!==null){const{huruf:X,indeks:ae}=Ue(be);he=X,fe=ae,console.log("[GRADES] ðŸ“Š Auto-calculated: Numeric=",be,"Letter=",he,"Index=",fe)}const ye={aktivitas_partisipatif:ne(m.aktivitas_partisipatif)??void 0,hasil_proyek:ne(m.hasil_proyek)??void 0,quiz:ne(m.quiz)??void 0,tugas:ne(m.tugas)??void 0,uts:ne(m.uts)??void 0,uas:ne(m.uas)??void 0,nilai_angka:be??void 0,nilai_huruf:he,nilai_indeks:fe};if(p.id&&p.id>0)console.log("[GRADES] ðŸ”„ Updating existing grade with ID:",p.id),await v.mutateAsync({id:p.id,data:ye});else if(p.krs_id){const X=ne(p.krs_id);console.log("[GRADES] âž• Creating new grade with KRS ID:",X),await z.mutateAsync({krs_id:Number(X),...ye})}else{const ae=we(N)??ne(m?.krs_id);if(ae)console.log("[GRADES] âž• Creating new grade with KRS ID from student:",ae),await z.mutateAsync({krs_id:Number(ae),...ye});else throw console.log("[GRADES] âŒ Missing KRS ID for grade creation"),new Error("Missing KRS id for grade creation")}console.log("[GRADES] âœ… Grade saved successfully"),C(X=>{const ae={...X};return delete ae[d],ae}),P(X=>new Set([...X,d]))}catch(m){throw console.log("[GRADES] âŒ Error saving grade:",m),m}finally{b&&F(m=>new Set([...m].filter(A=>A!==b)))}},[w,G,v,z]),re=o.useCallback((d,p,N)=>{C(b=>{const m={...b[d],[p]:N===""?null:N};if(G.some(Q=>Q.key===p)){const Q=We(m,G);if(Q!==null){const{huruf:pe,indeks:be}=Ue(Q);m.nilai_angka=Q,m.nilai_huruf=pe,m.nilai_indeks=be}else m.nilai_angka=null,m.nilai_huruf=null,m.nilai_indeks=null}return{...b,[d]:m}})},[G]),ee=o.useCallback((d,p)=>{const N=p===""?void 0:parseFloat(p);f(b=>({...b,[d]:N})),y(null)},[]),te=o.useCallback(()=>{f({}),y(null),j(!0)},[]),R=o.useCallback(()=>{j(!1)},[]),W=o.useCallback(async()=>{try{I(!0),y(null);const d={bobot_partisipatif:l.bobot_partisipatif??E.aktivitas_partisipatif,bobot_proyek:l.bobot_proyek??E.hasil_proyek,bobot_kuis:l.bobot_kuis??E.quiz,bobot_tugas:l.bobot_tugas??E.tugas,bobot_uts:l.bobot_uts??E.uts,bobot_uas:l.bobot_uas??E.uas},p=d.bobot_partisipatif+d.bobot_proyek+d.bobot_kuis+d.bobot_tugas+d.bobot_uts+d.bobot_uas;return Math.abs(p-100)>.01?(y(`Total must be 100%. Current total: ${p.toFixed(1)}%`),!1):(await de.updateClass(t,d),await S.invalidateQueries({queryKey:["class",r]}),f({}),j(!0),console.log("[BOBOTS] âœ… Bobot values saved successfully"),!0)}catch(d){return console.error("[BOBOTS] âŒ Failed to save bobot values:",d),y(d instanceof Error?d.message:"Failed to save grade weights"),!1}finally{I(!1)}},[l,E,t,S,r]),K=o.useCallback(()=>{console.log("[GRADES] ðŸ“ Entering grades edit mode");const d={};c.forEach(p=>{const N=Z(p)||{},b=we(p),m=p?.nim??p?.krs?.nim??p?.student?.nim??"",A=wt(N,b,m);d[A]=N}),console.log("[GRADES] Initial grade map:",d),C(d)},[c,Z]),ue=o.useCallback(()=>{console.log("[GRADES] ðŸšª Exiting grades edit mode - clearing edits"),C({}),P(new Set),f({}),y(null),j(!1)},[]),ce=o.useMemo(()=>{for(const[d,p]of Object.entries(w)){let N=null;if(d.startsWith("id:")){const b=Number(d.split(":")[1]);N=u.find(m=>m.id===b)??null}else if(d.startsWith("krs:")){const b=Number(d.split(":")[1]);N=u.find(m=>{const A=ne(m.krs_id);return A!==null&&A===b})??null}else if(d.startsWith("nim:")){const b=d.split(":")[1];N=u.find(A=>A.student?.nim===b||A.krs?.student?.nim===b||A.krs?.nim===b)??null}if(!N){if(Object.values(p).some(b=>b!=null&&b!==""))return!0;continue}for(const b of ks){const m=yt(p[b]),A=yt(N[b]);if(m!==A)return!0}}return!!V},[w,u,V]);return{editedGrades:w,savingGradeIds:_,completedGradeKeys:D,editedBobots:l,isSavingBobots:se,bobotError:h,isBobotCompleted:k,gradeWeights:E,gradeComponents:G,hasEditedBobots:V,hasUnsavedChanges:ce,setEditedGrades:C,setCompletedGradeKeys:P,findGradeForStudent:Z,saveGrade:ge,updateGradeField:re,handleBobotChange:ee,cancelBobots:te,enableBobotEditing:R,saveBobots:W,enterEditMode:K,exitEditMode:ue}},ws=async t=>{try{const[{default:r},{default:c}]=await Promise.all([Xe(()=>import("./html2canvas-pro.esm-BvaDPKdU.js"),[]),Xe(()=>import("./jspdf.es.min-2pqXIzBy.js").then(P=>P.j),__vite__mapDeps([0,1,2]))]),u=await r(t,{scale:1.5,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}),i=210,S=297,w=u.height*i/u.width;let C=w;const _=new c("p","mm","a4");let F=0;const D=u.toDataURL("image/jpeg",.85);for(_.addImage(D,"JPEG",0,F,i,w),C-=S;C>0;)F=C-w,_.addPage(),_.addImage(D,"JPEG",0,F,i,w),C-=S;return _}catch(r){throw console.error("Error generating PDF:",r),new Error("Failed to generate PDF. Please try again.")}},vs=async t=>{try{const r=await Xe(()=>import("./xlsx-DGuHH-KN.js"),[]),c=r.utils.book_new(),u=[["Class Summary Report"],[],["Course Code",t.courseCode],["Course Name",t.courseName],["Class",t.className],["Total SKS",t.totalSks],["Lecturers",t.lecturerNames.join(", ")],["Total Students",t.students.length],["Total Meetings",t.sortedMeetings.length],["Generated Date",new Date().toLocaleDateString("id-ID")]],i=r.utils.aoa_to_sheet(u);i["!cols"]=[{wch:20},{wch:40}],r.utils.book_append_sheet(c,i,"Class Description");const w=[["NIM","Name",...t.sortedMeetings.map(f=>`P${f.pertemuan_ke}`)]];t.students.forEach(f=>{const se=t.attendanceLookup[f.nim]||{},I=[f.nim,f.nama];t.sortedMeetings.forEach(h=>{const y=se[h.id]||"";I.push(y||"-")}),w.push(I)});const C=r.utils.aoa_to_sheet(w);C["!cols"]=[{wch:15},{wch:25},...t.sortedMeetings.map(()=>({wch:12}))],r.utils.book_append_sheet(c,C,"Attendance Overview");const _=[["Meeting","Date","Time","Lecturers","Topic"],...t.sortedMeetings.map(f=>{const se=f.tgl_pertemuan&&(typeof f.tgl_pertemuan=="string"||typeof f.tgl_pertemuan=="object"&&"Valid"in f.tgl_pertemuan&&f.tgl_pertemuan.Valid);let I="";f.topik&&(typeof f.topik=="string"?I=f.topik:"String"in f.topik&&f.topik.Valid&&(I=f.topik.String));const h=oe(f.id_dosen),y=h&&t.lecturerLookup[h]?t.lecturerLookup[h]:"-";return[`P${f.pertemuan_ke}`,se?_t(f.tgl_pertemuan):"-",jt(f.jam_pertemuan),y,I||"-"]})],F=r.utils.aoa_to_sheet(_);F["!cols"]=[{wch:15},{wch:20},{wch:12},{wch:25},{wch:40}],r.utils.book_append_sheet(c,F,"Meeting Summary");const P=[["NIM","Name","Participation","Project","Quiz","Assignment","Midterm","Final","Numeric Grade","Letter Grade","Grade Index"]];t.students.forEach(f=>{const se=t.findGradeForStudent(f)||{aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null},I=h=>{const y=se[h];return y==null?"":typeof y=="object"&&"Float64"in y?y.Valid?y.Float64:"":typeof y=="object"&&"String"in y?y.Valid?y.String:"":typeof y=="object"&&"Int32"in y?y.Valid?y.Int32:"":typeof y=="number"||typeof y=="string"?y:""};P.push([f.nim,f.nama,(()=>{const h=I("aktivitas_partisipatif");return h!==""?h:"-"})(),(()=>{const h=I("hasil_proyek");return h!==""?h:"-"})(),(()=>{const h=I("quiz");return h!==""?h:"-"})(),(()=>{const h=I("tugas");return h!==""?h:"-"})(),(()=>{const h=I("uts");return h!==""?h:"-"})(),(()=>{const h=I("uas");return h!==""?h:"-"})(),(()=>{const h=I("nilai_angka");return h!==""?h:"-"})(),(()=>{const h=I("nilai_huruf");return h!==""?h:"-"})(),(()=>{const h=I("nilai_indeks");return h!==""?h:"-"})()])}),P.push(["Component Weights","",`${t.gradeWeights.aktivitas_partisipatif}%`,`${t.gradeWeights.hasil_proyek}%`,`${t.gradeWeights.quiz}%`,`${t.gradeWeights.tugas}%`,`${t.gradeWeights.uts}%`,`${t.gradeWeights.uas}%`,"Total: 100%","",""]);const l=r.utils.aoa_to_sheet(P);return l["!cols"]=[{wch:15},{wch:25},{wch:13},{wch:10},{wch:8},{wch:12},{wch:10},{wch:8},{wch:13},{wch:12},{wch:11}],r.utils.book_append_sheet(c,l,"Grades Overview"),{workbook:c,XLSX:r}}catch(r){throw console.error("Error generating XLSX:",r),new Error("Failed to generate XLSX. Please try again.")}},Ss=async(t,r,c)=>{const u=await ws(t),i=`Class_Summary_${r}_${c.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;u.save(i)},Es=async t=>{const{workbook:r,XLSX:c}=await vs(t),u=`Class_Summary_${t.className}_${t.courseName.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.xlsx`;c.writeFile(r,u)},Ms=()=>{const{classId:t}=rs(),[r]=as(),c=ns(),u=o.useRef(null),[i,S]=o.useState(!1),[w,C]=o.useState(!1),[_,F]=o.useState(!1),[D,P]=o.useState(!1),[l,f]=o.useState(!1),[se,I]=o.useState(!1),h=r.get("className")||"",y=r.get("courseName")||"",k=r.get("courseCode")||"",j=r.get("from")||"dashboard",v=parseInt(r.get("sksTatapMuka")||"0",10),z=parseInt(r.get("sksPraktek")||"0",10),E=parseInt(r.get("sksPrakLapangan")||"0",10),G=parseInt(r.get("sksSimulasi")||"0",10),J=Number(t),{data:V=[],isLoading:Z,error:ge}=cs(J),{data:re=[],isLoading:ee,error:te}=ds(J),{data:R=[],isLoading:W}=gs({kelas_id:J}),{data:K=[],isLoading:ue}=us({id_kelas:String(t)}),{data:ce,isLoading:d}=ze({queryKey:["class",t],queryFn:()=>de.getClassById(J),enabled:!!t}),p=o.useMemo(()=>{const s=new Set;return K.forEach(n=>{const x=oe(n.id_dosen);x&&s.add(x)}),Array.from(s)},[K]),N=ss({queries:p.map(s=>({queryKey:["lecturer",s],queryFn:()=>de.getLecturerByID(s),enabled:!!s}))}),b=o.useMemo(()=>{const s={};return N.forEach(n=>{const x=n.data;x?.id&&x?.nama_dosen&&(s[x.id]=x.nama_dosen)}),s},[N]),m=v+z+E+G,A=o.useMemo(()=>K.map(s=>{const n=oe(s.id_dosen);return n?b[n]||n:null}).filter(Boolean),[K,b]),Q=o.useMemo(()=>V.map(s=>s.id),[V]),{data:pe={},isLoading:be}=ze({queryKey:["class-attendances",t,Q],queryFn:async()=>{const s={};return await Promise.all(Q.map(async n=>{const x=await de.getMeetingAttendances(n);s[n]=x})),s},enabled:Q.length>0}),he=_s({classId:t,meetingIds:Q,attendanceMap:pe,isEditing:_}),fe=js({classIdNum:J,meetings:V}),ye=Ns({classIdNum:J,classId:t,students:re,gradeRecords:R,classData:ce}),{savingCells:X,modifiedCells:ae,pendingStatusChanges:Me,activeCell:Ke,currentShortcutStatus:ie,setActiveCell:Qe,setCurrentShortcutStatus:le,updateSingleCell:Ye,commitAttendanceChanges:vt,enterEditMode:St,exitEditMode:Et}=he,{editedTopics:ke,editedDates:Ct,editedTimes:It,editedLecturers:At,setEditedTopics:Fe,setEditedDates:Le,setEditedTimes:De,setEditedLecturers:Pe,startEditTopic:Tt,cancelEditTopic:Gt,saveTopic:Je}=fe,{editedGrades:$e,savingGradeIds:Mt,completedGradeKeys:Ft,isSavingBobots:Ve,bobotError:Ze,isBobotCompleted:Lt,gradeWeights:q,gradeComponents:Dt,hasEditedBobots:Pt,setEditedGrades:Ce,setCompletedGradeKeys:et,findGradeForStudent:me,saveGrade:tt,updateGradeField:_e,handleBobotChange:je,cancelBobots:$t,enableBobotEditing:Vt,saveBobots:st,exitEditMode:Rt}=ye,qt=N.some(s=>s.isLoading),Re=Z||ee||be||ue||W||d||qt,qe=ge||te,Bt=_||D||l,Ie=o.useMemo(()=>{const s=n=>{if(!n)return Number.POSITIVE_INFINITY;if(typeof n=="string"){const x=Date.parse(n);return isNaN(x)?Number.POSITIVE_INFINITY:x}if("Valid"in n){if(!n.Valid)return Number.POSITIVE_INFINITY;const x=Date.parse(n.Time);return isNaN(x)?Number.POSITIVE_INFINITY:x}return Number.POSITIVE_INFINITY};return[...V].sort((n,x)=>{const $=s(n.tgl_pertemuan)-s(x.tgl_pertemuan);return $!==0?$:n.pertemuan_ke-x.pertemuan_ke})},[V]),rt=o.useMemo(()=>{const s={};return Object.values(pe).forEach(n=>{n.forEach(x=>{s[x.nim]||(s[x.nim]={});const $=oe(x.status_kehadiran);s[x.nim][x.id_pertemuan]=$})}),s},[pe]),Ot=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return e.jsx(Te,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(gt,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(Se,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(xt,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(Te,{className:"h-4 w-4 text-purple-600"});case"alpa":case"alfa":case"absent":return e.jsx(mt,{className:"h-4 w-4 text-red-600"});default:return e.jsx(ht,{className:"h-4 w-4 text-gray-300"})}},zt=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return"bg-green-50 text-green-700";case"izin":case"excused":return"bg-blue-50 text-blue-700";case"sakit":case"sick":return"bg-yellow-50 text-yellow-700";case"terlambat":case"late":return"bg-orange-50 text-orange-700";case"pengganti":case"substitute":return"bg-purple-50 text-purple-700";case"alpa":case"alfa":case"absent":return"bg-red-50 text-red-700";default:return"bg-gray-50 text-gray-400"}};o.useEffect(()=>{if(!_)return;const s=n=>{ft[n.key]?(n.preventDefault(),le(ft[n.key])):n.key==="Escape"&&le(null)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[_,le]);const Xt=he.hasUnsavedChanges||fe.hasUnsavedChanges||ye.hasUnsavedChanges,Ht=()=>{St(),F(!0)},at=()=>{Et(),F(!1)},Ut=()=>{console.log("[MEETING] ðŸ“ Entering meeting edit mode");const s={},n={},x={},$={};V.forEach(a=>{s[a.id]=oe(a.topik),n[a.id]=He(a.tgl_pertemuan),x[a.id]=Ne(a.jam_pertemuan),$[a.id]=oe(a.id_dosen)}),Fe(s),Le(n),De(x),Pe($),P(!0)},nt=()=>{console.log("[MEETING] ðŸšª Exiting meeting edit mode - clearing edits"),Fe({}),Le({}),De({}),Pe({}),P(!1)},Wt=()=>{console.log("[GRADES] ðŸ“ Entering grades edit mode");const s={};re.forEach(n=>{const x=me(n)||{},$=we(n),a=wt(x,$,n.nim);s[a]=x}),console.log("[GRADES] Initial grade map:",s),Ce(s),f(!0)},ot=()=>{console.log("[GRADES] ðŸšª Exiting grades edit mode - clearing edits"),Rt(),f(!1)},it=()=>{at(),nt(),ot()},Kt=async()=>{console.log("[SAVE ALL] ðŸš€ Starting save all and finish"),console.log("[SAVE ALL] Attendance editing:",_),console.log("[SAVE ALL] Meeting editing:",D),console.log("[SAVE ALL] Grades editing:",l),I(!0);try{const s=D?Object.keys(ke).map(a=>Number(a)).filter(a=>!Number.isNaN(a)).map(a=>Je(a)):[];let n=!0;if(l&&Pt&&(console.log("[SAVE ALL] Saving bobot values..."),n=await st(),!n))throw new Error("Failed to save grade weights");const x=l?Object.entries($e).map(([a])=>{let M;if(a.startsWith("nim:")){const Y=a.substring(4);M=re.find(H=>H.nim===Y)}else if(a.startsWith("krs:")){const Y=Number(a.substring(4));M=re.find(H=>we(H)===Y)}else if(a.startsWith("id:")){const Y=Number(a.substring(3));M=re.find(H=>me(H)?.id===Y)}const B=M?me(M):$e[a];return tt(a,B,M)}):[];console.log("[SAVE ALL] Meeting promises:",s.length),console.log("[SAVE ALL] Grade promises:",x.length);const $=_?vt(!0):Promise.resolve();await Promise.all([Promise.all(s),Promise.all(x),$]),console.log("[SAVE ALL] âœ… All saves completed, exiting edit modes"),Yt()}catch(s){alert(s instanceof Error?s.message:"Failed to save changes")}finally{I(!1)}},Qt=()=>{c(-1)},Yt=()=>{it()},Jt=async()=>{if(u.current){(window.React?.startTransition||(s=>s()))(()=>{S(!0)}),await new Promise(s=>setTimeout(s,0));try{await Ss(u.current,h,y)}catch(s){console.error("Error generating PDF:",s),alert("Failed to generate PDF. Please try again.")}finally{S(!1)}}},Zt=async()=>{C(!0);try{await Es({className:h,courseName:y,courseCode:k,totalSks:m,lecturerNames:A,students:re.map(s=>({nim:s.nim,nama:s.nama})),sortedMeetings:Ie,attendanceLookup:rt,gradeRecords:R,gradeWeights:q,lecturerLookup:b,findGradeForStudent:me})}catch(s){console.error("Error generating XLSX:",s),alert("Failed to generate XLSX. Please try again.")}finally{C(!1)}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("nav",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>c(`/${j}`),className:"flex items-center hover:text-gray-900 transition-colors",children:e.jsx(ps,{className:"h-4 w-4"})}),e.jsx(bt,{className:"h-4 w-4"}),e.jsx("button",{onClick:Qt,className:"hover:text-gray-900 transition-colors",children:j==="lecturer/class-schedule"?"Class Schedule":j==="admin/class-management"?"Class Management":"Dashboard"}),e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Class Summary"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>_?at():Ht(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${_?"bg-blue-600 text-white":""}`,children:_?"Stop Attendance Editing":"Edit Attendance"}),e.jsx("button",{onClick:()=>D?nt():Ut(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${D?"bg-blue-600 text-white":""}`,children:D?"Stop Meeting Editing":"Edit Meetings"}),e.jsx("button",{onClick:()=>l?ot():Wt(),className:`btn-secondary flex items-center gap-2 hover:cursor-pointer transition-all active:scale-95 ${l?"bg-blue-600 text-white":""}`,children:l?"Stop Grades Editing":"Edit Grades"}),Bt&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Kt,className:"btn-primary",disabled:se||!Xt,children:"Save & Finish"}),e.jsx("button",{onClick:()=>it(),className:"btn-secondary",children:"Cancel"})]})]}),_&&e.jsxs("div",{className:"text-xs text-gray-600 flex flex-col gap-3 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Status Brush:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a status with buttons below or use keyboard shortcuts (1..6), then click cells to apply. Press Esc to clear."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>le("Hadir"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie==="Hadir"?"bg-green-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 1",children:"1 - Hadir"}),e.jsx("button",{onClick:()=>le("Izin"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie==="Izin"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 2",children:"2 - Izin"}),e.jsx("button",{onClick:()=>le("Sakit"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie==="Sakit"?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 3",children:"3 - Sakit"}),e.jsx("button",{onClick:()=>le("Alfa"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie==="Alfa"?"bg-red-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 4",children:"4 - Alfa"}),e.jsx("button",{onClick:()=>le("Terlambat"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie==="Terlambat"?"bg-orange-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 5",children:"5 - Terlambat"}),e.jsx("button",{onClick:()=>le("Pengganti"),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie==="Pengganti"?"bg-purple-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press 6",children:"6 - Tugas"}),e.jsx("button",{onClick:()=>le(null),className:`px-3 py-1 rounded text-xs font-medium transition-all ${ie===null?"bg-gray-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,title:"Press Esc",children:"Clear Brush"})]}),e.jsxs("div",{className:"text-xs text-gray-700 bg-white p-2 rounded border border-gray-200",children:[e.jsx("span",{className:"font-medium",children:"Current: "}),e.jsx("span",{className:"font-semibold",children:ie===null?"None":ie===""?"Kosong":ie})]})]}),e.jsx("button",{onClick:Jt,disabled:i||Re,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(bs,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate PDF Report"})]})}),e.jsx("button",{onClick:Zt,disabled:w||Re,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95",children:w?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Generating XLSX..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate XLSX Report"})]})})]}),e.jsxs("div",{ref:u,className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 pt-6 pb-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Summary"}),e.jsxs("p",{className:"text-base text-gray-600 mt-1",children:[k&&e.jsx("span",{className:"font-medium",children:k}),k&&" - ",y," - Class ",h,m>0&&` (${m} SKS)`]}),A.length>0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:A.join(", ")})]})}),e.jsx("div",{children:Re?e.jsxs("div",{className:"flex items-center justify-center py-12 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(Ae,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading attendance data..."})]}):qe?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[e.jsx(Se,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading attendance data"}),e.jsx("p",{className:"text-sm text-red-600",children:qe instanceof Error?qe.message:"Unknown error"})]})]}):V.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No meetings scheduled for this class"})]}):re.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No students enrolled in this class"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attendance Overview"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex gap-0",children:[e.jsx("div",{className:"flex-shrink-0 sticky left-0 z-10",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 align-top",children:e.jsx("div",{className:"min-h-[3.5rem] flex items-center",children:"NIM"})}),e.jsx("th",{className:"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 align-top",children:e.jsx("div",{className:"min-h-[3.5rem] flex items-center",children:"Name"})})]})}),e.jsx("tbody",{children:re.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9",children:[e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900",children:s.nim}),e.jsx("td",{className:"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate",children:s.nama})]},s.nim))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("table",{className:"border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:Ie.map(s=>{const n=s.tgl_pertemuan&&(typeof s.tgl_pertemuan=="string"||typeof s.tgl_pertemuan=="object"&&"Valid"in s.tgl_pertemuan&&s.tgl_pertemuan.Valid);return e.jsx("th",{className:"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-14 align-top",children:e.jsxs("div",{className:"min-h-[3.5rem] flex flex-col items-center justify-center gap-0.5",children:[e.jsxs("span",{className:"font-bold text-[10px]",children:["P",s.pertemuan_ke]}),n&&e.jsx("span",{className:"text-gray-500 font-normal text-[9px] whitespace-pre-line",children:fs(s.tgl_pertemuan)})]})},s.id)})})}),e.jsx("tbody",{children:re.map(s=>{const n=rt[s.nim]||{};return e.jsx("tr",{className:"hover:bg-gray-50 h-9",children:Ie.map(x=>{const $=Me[`${s.nim}-${x.id}`]??n[x.id]??"",a=`${s.nim}-${x.id}`,M=ae.has(a),B=X[a];return e.jsx("td",{className:`border-r border-b border-gray-300 px-1 py-1.5 text-center ${zt($)} ${_?"cursor-pointer":""} ${M?"bg-yellow-50":""} ${Ke===a?"outline outline-2 outline-blue-500":""}`,onClick:()=>{_&&(ie!==null?Ye(a,ie):Qe(a))},children:_&&Ke===a?e.jsxs("select",{autoFocus:!0,value:$,onChange:Y=>Ye(a,Y.target.value),onBlur:()=>Qe(null),className:"text-[10px] px-1 py-0.5 bg-white border border-gray-300 rounded w-full",children:[e.jsx("option",{value:""}),Ge.slice(1).map(Y=>e.jsx("option",{value:Y,children:Y},Y))]}):B?e.jsx(Ae,{className:"h-4 w-4 animate-spin text-gray-500 mx-auto"}):Ot($)},x.id)})},s.nim)})})]})})]})})})]}),e.jsx("div",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-gray-600",children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(gt,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(mt,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Tugas"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ht,{className:"h-4 w-4 text-gray-300"}),e.jsx("span",{className:"text-gray-600",children:"No data"})]})]})}),e.jsxs("div",{className:"px-6 py-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Meeting Descriptions"}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16",children:"Meeting"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-40",children:"Date"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-20",children:"Time"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48",children:"Lecturers"}),e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700",children:"Topic"})]})}),e.jsx("tbody",{children:Ie.map(s=>{const n=s.tgl_pertemuan&&(typeof s.tgl_pertemuan=="string"||typeof s.tgl_pertemuan=="object"&&"Valid"in s.tgl_pertemuan&&s.tgl_pertemuan.Valid);let x="";s.topik&&(typeof s.topik=="string"?x=s.topik:"String"in s.topik&&s.topik.Valid&&(x=s.topik.String));const $=It[s.id]??Ne(s.jam_pertemuan);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"border-b border-gray-300 px-3 py-2 font-medium text-gray-900",children:["P",s.pertemuan_ke]}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:ke[s.id]!==void 0?e.jsx("input",{type:"date",value:Ct[s.id]||(()=>{if(!n)return"";let a="";if(typeof s.tgl_pertemuan=="string"?a=s.tgl_pertemuan:typeof s.tgl_pertemuan=="object"&&s.tgl_pertemuan.Valid&&(a=s.tgl_pertemuan.Time),!a)return"";const M=new Date(a);return isNaN(M.getTime())?"":M.toISOString().slice(0,10)})(),onChange:a=>Le(M=>({...M,[s.id]:a.target.value})),className:"input-field text-xs"}):n?_t(s.tgl_pertemuan):"-"}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:ke[s.id]!==void 0?e.jsx("input",{type:"time",value:$||"",onChange:a=>De(M=>({...M,[s.id]:a.target.value})),className:"input-field text-xs"}):jt(s.jam_pertemuan)}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:ke[s.id]!==void 0?e.jsxs("select",{value:At[s.id]||"",onChange:a=>Pe(M=>({...M,[s.id]:a.target.value})),className:"input-field text-xs w-full",children:[e.jsx("option",{value:"",children:"- No Lecturer -"}),p.map(a=>e.jsx("option",{value:a,children:b[a]||a},a))]}):(()=>{const a=oe(s.id_dosen);return a&&b[a]?b[a]:"-"})()}),e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-gray-600",children:D?ke[s.id]!==void 0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:ke[s.id],onChange:a=>Fe(M=>({...M,[s.id]:a.target.value})),className:"input-field w-full text-xs",placeholder:"Enter topic/description"}),e.jsx("button",{onClick:()=>Je(s.id),className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:"Save"}),e.jsx("button",{onClick:()=>Gt(s.id),className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate max-w-[28rem]",children:x||"-"}),e.jsx("button",{onClick:()=>{let a="";if(n){let H="";if(typeof s.tgl_pertemuan=="string"?H=s.tgl_pertemuan:typeof s.tgl_pertemuan=="object"&&s.tgl_pertemuan.Valid&&(H=s.tgl_pertemuan.Time),H){const O=new Date(H);isNaN(O.getTime())||(a=O.toISOString().slice(0,10))}}let M="";const B=Ne(s.jam_pertemuan);if(B){const H=B.split(":");H.length>=2&&(M=`${H[0].padStart(2,"0")}:${H[1].padStart(2,"0")}`)}const Y=oe(s.id_dosen);Tt(s.id,x,a,M,Y)},className:"px-2 py-1 text-xs rounded bg-primary-600 text-white hover:bg-primary-700",children:"Edit"})]}):e.jsx("span",{children:x||"-"})})]},s.id)})})]})})]}),e.jsxs("div",{className:"px-6 py-3 pb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Grades Overview"})}),e.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28",children:"NIM"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-48",children:"Name"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Participation"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Project"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Quiz"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Assignment"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Midterm"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-24",children:"Final"}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Numeric"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),e.jsx("th",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Letter"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),e.jsx("th",{className:`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-20 ${l?"border-r":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:"Index"}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Auto)"})]})}),l&&e.jsx("th",{className:"border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-700 w-16",children:"Action"})]})}),e.jsxs("tbody",{children:[re.map(s=>{const n=me(s)||{id:0,krs_id:null,aktivitas_partisipatif:null,hasil_proyek:null,quiz:null,tugas:null,uts:null,uas:null,nilai_angka:null,nilai_huruf:null,nilai_indeks:null},x=(()=>{if(typeof n.krs_id=="object"&&n.krs_id!==null&&"Int32"in n.krs_id){const g=n.krs_id;return g.Valid?g.Int32:null}return typeof n.krs_id=="number"?n.krs_id:n.krs_id??null})(),$=we(s),a=n.id&&n.id>0?`id:${n.id}`:x!=null?`krs:${x}`:$!==null?`krs:${$}`:`nim:${s.nim}`,M=Ft.has(a),B=l&&!M,Y=n.id?Mt.has(n.id):!1,H=$e[a]||n,O=g=>{const T=H[g];return T==null?"":typeof T=="object"&&"Float64"in T?T.Valid?T.Float64:"":typeof T=="object"&&"String"in T?T.Valid?T.String:"":typeof T=="object"&&"Int32"in T?T.Valid?T.Int32:"":typeof T=="number"||typeof T=="string"?T:""},lt=O("nilai_angka"),xe=lt!==""?lt:l&&H?We(H,Dt):null,Be=typeof xe=="string"?Number(xe):xe,{huruf:es,indeks:ts}=Be!=null?Ue(Be):{huruf:"",indeks:0},ct=O("nilai_huruf"),dt=ct!==""?ct:es,ut=O("nilai_indeks"),pt=ut!==""?ut:ts;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 font-medium text-gray-900 w-28",children:s.nim}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-gray-900 w-48",children:s.nama}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:O("aktivitas_partisipatif"),onChange:g=>_e(a,"aktivitas_partisipatif",g.target.value?parseFloat(g.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const g=O("aktivitas_partisipatif");return g!==""?g:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:O("hasil_proyek"),onChange:g=>_e(a,"hasil_proyek",g.target.value?parseFloat(g.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const g=O("hasil_proyek");return g!==""?g:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:O("quiz"),onChange:g=>_e(a,"quiz",g.target.value?parseFloat(g.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const g=O("quiz");return g!==""?g:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:O("tugas"),onChange:g=>_e(a,"tugas",g.target.value?parseFloat(g.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const g=O("tugas");return g!==""?g:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:O("uts"),onChange:g=>_e(a,"uts",g.target.value?parseFloat(g.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const g=O("uts");return g!==""?g:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center w-24",children:B?e.jsx("input",{type:"number",step:"0.1",value:O("uas"),onChange:g=>_e(a,"uas",g.target.value?parseFloat(g.target.value):null),className:"input-field text-xs w-full [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):e.jsx("span",{className:"text-gray-600",children:(()=>{const g=O("uas");return g!==""?g:"-"})()})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20",children:e.jsxs("div",{className:`px-2 py-1 rounded ${B?"bg-blue-50 text-blue-900":""}`,children:[e.jsx("span",{children:xe!==null&&xe!==""?xe:"-"}),B&&xe!==null&&xe!==""&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"âœ“"})]})}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center font-bold text-blue-600 w-20",children:e.jsxs("div",{className:`px-2 py-1 rounded ${B?"bg-blue-50":""}`,children:[e.jsx("span",{children:dt||"-"}),B&&dt&&e.jsx("span",{className:"text-xs ml-1",children:"âœ“"})]})}),e.jsx("td",{className:`border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900 w-20 ${l?"border-r":""}`,children:e.jsxs("div",{className:`px-2 py-1 rounded ${B?"bg-blue-50 text-blue-900":""}`,children:[e.jsx("span",{children:pt||"-"}),B&&pt&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"âœ“"})]})}),l&&e.jsx("td",{className:"border-b border-gray-300 px-3 py-2 text-center",children:M?e.jsx("button",{onClick:()=>{et(T=>{const ve=new Set(T);return ve.delete(a),ve});const g=me(s);g&&Ce(T=>({...T,[a]:g}))},className:"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>tt(a,n,s),disabled:Y,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:Y?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{const g=me(s);Ce(g?T=>({...T,[a]:g}):T=>{const ve={...T};return delete ve[a],ve}),et(T=>new Set([...T,a]))},disabled:Y,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})})]},s.nim)}),e.jsxs("tr",{className:"bg-blue-50 font-bold",children:[e.jsxs("td",{colSpan:2,className:"border-r border-b border-gray-300 px-3 py-2 text-gray-900",children:["Component Weights",l&&e.jsx("div",{className:"text-xs font-normal text-gray-500 mt-1",children:"(Total must be 100%)"})]}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:l?e.jsx("input",{type:"text",value:q.aktivitas_partisipatif,onChange:s=>je("bobot_partisipatif",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${q.aktivitas_partisipatif}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:l?e.jsx("input",{type:"text",value:q.hasil_proyek,onChange:s=>je("bobot_proyek",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${q.hasil_proyek}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:l?e.jsx("input",{type:"text",value:q.quiz,onChange:s=>je("bobot_kuis",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${q.quiz}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:l?e.jsx("input",{type:"text",value:q.tugas,onChange:s=>je("bobot_tugas",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${q.tugas}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:l?e.jsx("input",{type:"text",value:q.uts,onChange:s=>je("bobot_uts",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${q.uts}%`}),e.jsx("td",{className:"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600 w-24",children:l?e.jsx("input",{type:"text",value:q.uas,onChange:s=>je("bobot_uas",s.target.value),className:"w-full px-2 py-1 text-center border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):`${q.uas}%`}),e.jsxs("td",{colSpan:3,className:"border-r border-b border-gray-300 px-3 py-2 text-center font-semibold text-gray-900",children:[e.jsxs("div",{className:"text-blue-600",children:["Total: ",(q.aktivitas_partisipatif+q.hasil_proyek+q.quiz+q.tugas+q.uts+q.uas).toFixed(1),"%"]}),Ze&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:Ze})]}),e.jsx("td",{className:`border-b border-gray-300 px-3 py-2 text-center ${l?"":"hidden"}`,children:l&&e.jsx(e.Fragment,{children:Lt?e.jsx("button",{onClick:()=>{Vt()},className:"px-2 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700",children:"Edit"}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>st(),disabled:Ve,className:"px-2 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:Ve?"Saving...":"Save"}),e.jsx("button",{onClick:$t,disabled:Ve,className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})})})]})]})]})})})]})]})})]})]})};export{Ms as default};
//# sourceMappingURL=ClassSummary-DVZeL4YE.js.map
