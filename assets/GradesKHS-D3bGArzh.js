import{j as e}from"./query-vendor-B--u1oZD.js";import{r as p}from"./react-vendor-XXJdR_Id.js";import{u as L,a as M,e as v,g as h,h as j,j as i}from"./index-BYG0ekbM.js";import{x as T,t as W,d as P,Q as B}from"./ui-vendor-CkH0jJa3.js";const V=()=>{const{user:y,currentSemester:o}=L(),{t:a}=M(),[I,x]=p.useState(!0),[f,N]=p.useState(null),[m,G]=p.useState([]);p.useEffect(()=>{(async()=>{if(!y?.studentId||!o){N("Student information or semester not available"),x(!1);return}try{x(!0),N(null);const r=await v.getEnrollments(y.studentId,o);if(!r||!Array.isArray(r)||r.length===0){G([]),x(!1);return}const u=new Map,D=r.filter(d=>h(d.kode_mk)).map(async d=>{const t=h(d.kode_mk);try{const n=await v.getCourseByCode(t);n&&u.set(t,n)}catch{}});await Promise.all(D);const q=r.map(async d=>{try{const t=await v.getGrades({krs_id:d.id});return{enrollment:d,grade:t[0]||null}}catch{return{enrollment:d,grade:null}}}),z=(await Promise.all(q)).map(({enrollment:d,grade:t})=>{const n=h(d.kode_mk)||"",l=u.get(n),H=j(l?.sks_tatap_muka)+j(l?.sks_praktek)+j(l?.sks_prak_lapangan)+j(l?.sks_simulasi),b=t?i(t.aktivitas_partisipatif)??void 0:void 0,w=t?i(t.hasil_proyek)??void 0:void 0,_=t?i(t.quiz)??void 0:void 0,C=t?i(t.tugas)??void 0:void 0,S=t?i(t.uts)??void 0:void 0,F=t?i(t.uas)??void 0:void 0,K=b!==void 0&&w!==void 0&&_!==void 0&&C!==void 0&&S!==void 0&&F!==void 0;return{enrollmentId:d.id,courseCode:n,courseName:l?.nama_mk||n,credits:H,aktivitasPartisipatif:b,hasilProyek:w,quiz:_,tugas:C,uts:S,uas:F,nilaiAngka:t?i(t.nilai_angka)??void 0:void 0,nilaiHuruf:t?h(t.nilai_huruf)??void 0:void 0,nilaiIndeks:t?i(t.nilai_indeks)??void 0:void 0,hasCompleteGrades:K}});G(z)}catch(r){N(r instanceof Error?r.message:"Failed to load grades")}finally{x(!1)}})()},[y?.studentId,o]);const k=m.filter(s=>s.hasCompleteGrades),A=m.reduce((s,r)=>s+r.credits,0),g=k.reduce((s,r)=>s+r.credits,0),E=k.reduce((s,r)=>{const u=r.nilaiIndeks??0;return s+r.credits*u},0),c=g>0?E/g:null;return I?e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-center py-12",children:[e.jsx(T,{className:"h-8 w-8 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:a("common.loading")})]}):f?e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"card bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(W,{className:"h-5 w-5"}),e.jsx("span",{children:f})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a("studentGrades.title")}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a("studentGrades.semester"),": ",o]})]}),e.jsxs("div",{className:"card grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:a("studentGrades.totalCredits")}),e.jsxs("div",{className:"text-lg font-semibold",children:[A," SKS"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:a("studentGrades.semesterGPA")}),e.jsx("div",{className:"text-lg font-semibold",children:c!==null?c.toFixed(2):"-"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-5 w-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:a("studentGrades.status")}),e.jsx("div",{className:"text-lg font-semibold",children:c!==null?c>=3?a("studentGrades.goodStanding"):c>=2?a("studentGrades.warning"):a("studentGrades.probation"):"-"})]})]})]}),m.length===0?e.jsx("div",{className:"card text-center py-12 text-gray-500",children:a("studentGrades.noGrades")}):e.jsx("div",{className:"card overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b-2 border-gray-200",children:[e.jsx("th",{className:"py-3 px-2",children:a("studentGrades.courseCode")}),e.jsx("th",{className:"py-3 px-2",children:a("studentGrades.courseName")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.credits")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.participation")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.project")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.quiz")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.assignment")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.uts")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.uas")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.total")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.grade")}),e.jsx("th",{className:"py-3 px-2 text-center",children:a("studentGrades.index")})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2 font-medium text-gray-900",children:s.courseCode}),e.jsx("td",{className:"py-3 px-2",children:s.courseName}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.credits}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.aktivitasPartisipatif?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.hasilProyek?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.quiz?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.tugas?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.uts?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.uas?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center font-medium",children:s.nilaiAngka?.toFixed(1)??"-"}),e.jsx("td",{className:"py-3 px-2 text-center font-semibold text-primary-600",children:s.hasCompleteGrades?s.nilaiHuruf??"-":"-"}),e.jsx("td",{className:"py-3 px-2 text-center",children:s.hasCompleteGrades?s.nilaiIndeks?.toFixed(2)??"-":"-"})]},s.enrollmentId))})]})})]})};export{V as default};
//# sourceMappingURL=GradesKHS-D3bGArzh.js.map
