{"version":3,"mappings":"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","names":["Reports","importedReports","setImportedReports","useState","isProcessing","setIsProcessing","uploadMessage","setUploadMessage","generatingId","setGeneratingId","selectedReport","setSelectedReport","reportRef","useRef","isDragActive","setIsDragActive","isBulkGenerating","setIsBulkGenerating","bulkProgress","setBulkProgress","getStatusIcon","status","jsx","CheckCircle","Clock","AlertCircle","ClockAlert","XCircle","Minus","getStatusColor","processFile","file","XLSX","data","workbook","classDescSheet","classDescData","courseCode","className","courseName","descMap","row","rowArray","lecturers","totalSKS","attendanceSheet","attendanceSheetData","isRowEmpty","r","classDescSheetData","meetingSheet","meetingSheetData","formatExcelDate","val","n","epoch","ms","idx","newRow","gradesSheetData","gradesSheet","handleFiles","files","fileArray","f","results","successes","failures","prev","filesText","failureText","handleFileUpload","event","handleDragOver","e","handleDragLeave","handleDrop","handleViewReport","report","handleCloseReport","generatePDFForReport","element","html2canvas","jsPDF","__vitePreload","canvas","imgWidth","pageHeight","imgHeight","heightLeft","pdf","position","imgData","filename","error","handleGeneratePDF","handleBulkGeneratePDF","successCount","failCount","i","resolve","message","handleDeleteReport","id","meetingHeaders","meetingDateMap","meeting","date","jsxs","X","Fragment","Loader2","Download","index","header","rowIndex","colIndex","getStatusDisplayLabel","cell","cellIndex","isNIM","isName","isLetterGrade","isFinalGrade","FileText","Upload"],"ignoreList":[],"sources":["../../src/pages/admin/Reports.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport { Download, FileText, Upload, AlertCircle, CheckCircle, Loader2, XCircle, Clock, ClockAlert, Minus, X } from 'lucide-react';\r\nimport { getStatusDisplayLabel } from '@/utils';\r\n\r\ninterface ImportedReport {\r\n  id: string;\r\n  fileName: string;\r\n  courseCode: string;\r\n  className: string;\r\n  courseName: string;\r\n  lecturers?: string;\r\n  totalSKS?: string | number;\r\n  classDescData?: any[][];\r\n  attendanceData?: any[][];\r\n  meetingSummaryData?: any[][];\r\n  gradesData?: any[][];\r\n  gradeWeights?: any[][];\r\n}\r\n\r\nconst Reports: React.FC = () => {\r\n  const [importedReports, setImportedReports] = useState<ImportedReport[]>([]);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [uploadMessage, setUploadMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [generatingId, setGeneratingId] = useState<string | null>(null);\r\n  const [selectedReport, setSelectedReport] = useState<ImportedReport | null>(null);\r\n  const reportRef = useRef<HTMLDivElement>(null);\r\n  const [isDragActive, setIsDragActive] = useState(false);\r\n  const [isBulkGenerating, setIsBulkGenerating] = useState(false);\r\n  const [bulkProgress, setBulkProgress] = useState({ current: 0, total: 0 });\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'izin':\r\n      case 'excused':\r\n        return <Clock className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'sakit':\r\n      case 'sick':\r\n        return <AlertCircle className=\"h-4 w-4 text-yellow-600\" />;\r\n      case 'terlambat':\r\n      case 'late':\r\n        return <ClockAlert className=\"h-4 w-4 text-orange-600\" />;\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return <CheckCircle className=\"h-4 w-4 text-purple-600\" />;\r\n      case 'alpa':\r\n      case 'absent':\r\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\r\n      default:\r\n        return <Minus className=\"h-4 w-4 text-gray-300\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'hadir':\r\n      case 'present':\r\n        return 'bg-green-50 text-green-700';\r\n      case 'izin':\r\n      case 'excused':\r\n        return 'bg-blue-50 text-blue-700';\r\n      case 'sakit':\r\n      case 'sick':\r\n        return 'bg-yellow-50 text-yellow-700';\r\n      case 'terlambat':\r\n      case 'late':\r\n        return 'bg-orange-50 text-orange-700';\r\n      case 'pengganti':\r\n      case 'substitute':\r\n        return 'bg-purple-50 text-purple-700';\r\n      case 'alpa':\r\n      case 'absent':\r\n        return 'bg-red-50 text-red-700';\r\n      default:\r\n        return 'bg-gray-50 text-gray-400';\r\n    }\r\n  };\r\n\r\n  // Parse a single XLSX file into an ImportedReport\r\n  const processFile = async (file: File): Promise<ImportedReport> => {\r\n    const XLSX = await import('xlsx');\r\n    const data = await file.arrayBuffer();\r\n    const workbook = XLSX.read(data, { type: 'array' });\r\n\r\n    // Read Class Description sheet\r\n    const classDescSheet = workbook.Sheets['Class Description'];\r\n    if (!classDescSheet) {\r\n      throw new Error('Class Description sheet not found');\r\n    }\r\n\r\n    const classDescData = XLSX.utils.sheet_to_json(classDescSheet, { header: 1 });\r\n\r\n    // Extract data from Class Description\r\n    let courseCode = '';\r\n    let className = '';\r\n    let courseName = '';\r\n\r\n    const descMap: Record<string, string | number> = {};\r\n    (classDescData as unknown[]).forEach((row: unknown) => {\r\n      const rowArray = row as any[];\r\n      if (rowArray[0] && rowArray[1]) {\r\n        descMap[rowArray[0]] = rowArray[1];\r\n      }\r\n    });\r\n\r\n    courseCode = (descMap['Course Code'] as string) || 'N/A';\r\n    className = (descMap['Class'] as string) || 'N/A';\r\n    courseName = (descMap['Course Name'] as string) || 'N/A';\r\n    const lecturers = (descMap['Lecturers'] as string) || '';\r\n    const totalSKS = descMap['Total SKS'] || descMap['SKS'] || '';\r\n\r\n    // Read Attendance Overview sheet\r\n    const attendanceSheet = workbook.Sheets['Attendance Overview'];\r\n    if (!attendanceSheet) {\r\n      throw new Error('Attendance Overview sheet not found');\r\n    }\r\n    let attendanceSheetData = XLSX.utils.sheet_to_json(attendanceSheet, { header: 1 }) as any[][];\r\n    // Filter out empty data rows (keep header)\r\n    const isRowEmpty = (row: any[]) => !row || row.every((c) => c === null || c === undefined || String(c).trim() === '');\r\n    if (attendanceSheetData.length > 0) {\r\n      attendanceSheetData = [attendanceSheetData[0], ...attendanceSheetData.slice(1).filter((r) => !isRowEmpty(r))];\r\n    }\r\n    const classDescSheetData = classDescData as any[][];\r\n\r\n    // Read Meeting Summary sheet\r\n    const meetingSheet = workbook.Sheets['Meeting Summary'];\r\n    if (!meetingSheet) {\r\n      throw new Error('Meeting Summary sheet not found');\r\n    }\r\n    let meetingSheetData = XLSX.utils.sheet_to_json(meetingSheet, { header: 1 }) as any[][];\r\n    if (meetingSheetData.length > 0) {\r\n      // Keep header, filter empty rows\r\n      meetingSheetData = [meetingSheetData[0], ...meetingSheetData.slice(1).filter((r) => !isRowEmpty(r))];\r\n      // Convert Excel serial date in Date column (index 1) to 'MMM dd, yyyy'\r\n      const formatExcelDate = (val: any): string => {\r\n        // Already a Date instance\r\n        if (val instanceof Date && !isNaN(val.getTime())) {\r\n          return val.toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });\r\n        }\r\n        // Numeric serial or numeric-looking string\r\n        const n = typeof val === 'number' ? val : (typeof val === 'string' && /^\\d+(\\.\\d+)?$/.test(val.trim()) ? parseFloat(val) : NaN);\r\n        if (!isNaN(n)) {\r\n          // Excel 1900 date system: days since 1899-12-31, with 1900 leap-year bug; approximate conversion\r\n          const epoch = new Date(Date.UTC(1899, 11, 30)); // 1899-12-30 to account for Excel offset\r\n          const ms = n * 24 * 60 * 60 * 1000;\r\n          const d = new Date(epoch.getTime() + ms);\r\n          return d.toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });\r\n        }\r\n        // Fallback: return as-is (string or other)\r\n        return typeof val === 'string' ? val : '';\r\n      };\r\n      meetingSheetData = meetingSheetData.map((row, idx) => {\r\n        if (idx === 0) return row; // header\r\n        const newRow = [...row];\r\n        if (newRow[1] !== undefined && newRow[1] !== null && String(newRow[1]).trim() !== '') {\r\n          newRow[1] = formatExcelDate(newRow[1]);\r\n        }\r\n        return newRow;\r\n      });\r\n    }\r\n\r\n    // Read Grades Overview sheet (optional - may not exist in older files)\r\n    let gradesSheetData: any[][] | undefined;\r\n    const gradesSheet = workbook.Sheets['Grades Overview'];\r\n    if (gradesSheet) {\r\n      gradesSheetData = XLSX.utils.sheet_to_json(gradesSheet, { header: 1 }) as any[][];\r\n      if (gradesSheetData.length > 0) {\r\n        gradesSheetData = [gradesSheetData[0], ...gradesSheetData.slice(1).filter((r) => !isRowEmpty(r))];\r\n      }\r\n    }\r\n\r\n    const newReport: ImportedReport = {\r\n      id: `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\r\n      fileName: file.name,\r\n      courseCode,\r\n      className,\r\n      courseName,\r\n      lecturers,\r\n      totalSKS,\r\n      classDescData: classDescSheetData,\r\n      attendanceData: attendanceSheetData,\r\n      meetingSummaryData: meetingSheetData,\r\n      gradesData: gradesSheetData,\r\n    };\r\n\r\n    return newReport;\r\n  };\r\n\r\n  const handleFiles = async (files: FileList | File[]) => {\r\n    const fileArray = Array.from(files || []).filter((f) => /\\.xlsx?$/i.test(f.name));\r\n    if (fileArray.length === 0) return;\r\n\r\n    setIsProcessing(true);\r\n    setUploadMessage(null);\r\n\r\n    const results = await Promise.allSettled(fileArray.map((f) => processFile(f)));\r\n    const successes: ImportedReport[] = [];\r\n    let failures = 0;\r\n    results.forEach((r) => {\r\n      if (r.status === 'fulfilled') successes.push(r.value);\r\n      else failures += 1;\r\n    });\r\n\r\n    if (successes.length > 0) {\r\n      setImportedReports((prev) => [...prev, ...successes]);\r\n      const filesText = successes.length === 1 ? '1 file' : `${successes.length} files`;\r\n      const failureText = failures > 0 ? ` (⚠️ ${failures} failed)` : '';\r\n      setUploadMessage({ type: 'success', text: `${filesText} berhasil diimpor${failureText}.` });\r\n    } else {\r\n      setUploadMessage({\r\n        type: 'error',\r\n        text: 'Gagal membaca semua file. Pastikan setiap file memiliki sheet: Class Description, Attendance Overview, Meeting Summary.',\r\n      });\r\n    }\r\n\r\n    setIsProcessing(false);\r\n  };\r\n\r\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = event.target.files;\r\n    if (files && files.length > 0) {\r\n      await handleFiles(files);\r\n    }\r\n    // Reset input\r\n    event.target.value = '';\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!isDragActive) setIsDragActive(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragActive(false);\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragActive(false);\r\n    if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {\r\n      await handleFiles(e.dataTransfer.files);\r\n      e.dataTransfer.clearData();\r\n    }\r\n  };\r\n\r\n  const handleViewReport = (report: ImportedReport) => {\r\n    setSelectedReport(report);\r\n  };\r\n\r\n  const handleCloseReport = () => {\r\n    setSelectedReport(null);\r\n  };\r\n\r\n  const generatePDFForReport = async (report: ImportedReport, element: HTMLElement): Promise<boolean> => {\r\n    try {\r\n      const [{ default: html2canvas }, { default: jsPDF }] = await Promise.all([\r\n        import('html2canvas-pro'),\r\n        import('jspdf')\r\n      ]);\r\n\r\n      const canvas = await html2canvas(element, {\r\n        scale: 1.5, // Reduced from 2 to 1.5 for smaller file size while maintaining quality\r\n        useCORS: true,\r\n        logging: false,\r\n        backgroundColor: '#ffffff',\r\n      });\r\n\r\n      const imgWidth = 210;\r\n      const pageHeight = 297;\r\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n      let heightLeft = imgHeight;\r\n\r\n      const pdf = new jsPDF('p', 'mm', 'a4');\r\n      let position = 0;\r\n\r\n      // Convert canvas to JPEG with compression for smaller file size\r\n      const imgData = canvas.toDataURL('image/jpeg', 0.85); // JPEG with 85% quality\r\n\r\n      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\r\n      heightLeft -= pageHeight;\r\n\r\n      while (heightLeft > 0) {\r\n        position = heightLeft - imgHeight;\r\n        pdf.addPage();\r\n        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);\r\n        heightLeft -= pageHeight;\r\n      }\r\n\r\n      const filename = `Class_Summary_${report.className}_${report.courseName.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;\r\n      pdf.save(filename);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error generating PDF:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleGeneratePDF = async () => {\r\n    if (!reportRef.current) return;\r\n\r\n    setGeneratingId('pdf-generation');\r\n\r\n    try {\r\n      await generatePDFForReport(selectedReport!, reportRef.current);\r\n    } catch (error) {\r\n      console.error('Error generating PDF:', error);\r\n      alert('Failed to generate PDF. Please try again.');\r\n    } finally {\r\n      setGeneratingId(null);\r\n    }\r\n  };\r\n\r\n  const handleBulkGeneratePDF = async () => {\r\n    if (importedReports.length === 0) return;\r\n\r\n    setIsBulkGenerating(true);\r\n    setBulkProgress({ current: 0, total: importedReports.length });\r\n\r\n    let successCount = 0;\r\n    let failCount = 0;\r\n\r\n    for (let i = 0; i < importedReports.length; i++) {\r\n      const report = importedReports[i];\r\n      setBulkProgress({ current: i + 1, total: importedReports.length });\r\n\r\n      // Temporarily set the report as selected to render it\r\n      setSelectedReport(report);\r\n      \r\n      // Wait for DOM to update\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n\r\n      if (reportRef.current) {\r\n        const success = await generatePDFForReport(report, reportRef.current);\r\n        if (success) {\r\n          successCount++;\r\n        } else {\r\n          failCount++;\r\n        }\r\n        \r\n        // Small delay between generations to prevent browser freezing\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n      }\r\n    }\r\n\r\n    // Clear selected report and show completion message\r\n    setSelectedReport(null);\r\n    setIsBulkGenerating(false);\r\n    setBulkProgress({ current: 0, total: 0 });\r\n\r\n    const message = failCount > 0 \r\n      ? `Bulk generation complete: ${successCount} succeeded, ${failCount} failed`\r\n      : `Successfully generated ${successCount} PDF reports!`;\r\n    \r\n    setUploadMessage({ \r\n      type: failCount > 0 ? 'error' : 'success', \r\n      text: message \r\n    });\r\n  };\r\n\r\n  const handleDeleteReport = (id: string) => {\r\n    setImportedReports((prev) => prev.filter((r) => r.id !== id));\r\n  };\r\n\r\n  // If a report is selected, show the report view\r\n  if (selectedReport) {\r\n    // Get meeting headers (P1, P2, etc.) from attendance data\r\n    const meetingHeaders = selectedReport.attendanceData && selectedReport.attendanceData.length > 0\r\n      ? selectedReport.attendanceData[0].slice(2) // Skip NIM and Name columns\r\n      : [];\r\n\r\n    // Build a map of meeting -> date from meeting summary data\r\n    const meetingDateMap: Record<string, string> = {};\r\n    if (selectedReport.meetingSummaryData && selectedReport.meetingSummaryData.length > 1) {\r\n      selectedReport.meetingSummaryData.slice(1).forEach((row: any[]) => {\r\n        const meeting = row[0]; // Meeting identifier (P1, P2, etc.)\r\n        const date = row[1]; // Date\r\n        if (meeting && date) {\r\n          meetingDateMap[meeting] = date;\r\n        }\r\n      });\r\n    }\r\n\r\n    return (\r\n      <div className=\"p-6 space-y-6\">\r\n        {/* Action Bar */}\r\n        <div className=\"flex justify-between items-center\">\r\n          <button\r\n            onClick={handleCloseReport}\r\n            className=\"btn-secondary flex items-center gap-2\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n            <span>Close Report</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleGeneratePDF}\r\n            disabled={generatingId === 'pdf-generation'}\r\n            className=\"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n          >\r\n            {generatingId === 'pdf-generation' ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                <span>Generating PDF...</span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Download className=\"h-4 w-4\" />\r\n                <span>Generate PDF Report</span>\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Report Content */}\r\n        <div ref={reportRef} className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n          {/* Header */}\r\n          <div className=\"px-6 pt-6 pb-3\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">Class Summary</h1>\r\n              <p className=\"text-base text-gray-600 mt-1\">\r\n                {selectedReport.courseCode && <span className=\"font-medium\">{selectedReport.courseCode}</span>}\r\n                {selectedReport.courseCode && ' - '}\r\n                {selectedReport.courseName} - Class {selectedReport.className}\r\n                {selectedReport.totalSKS && ` (${selectedReport.totalSKS} SKS)`}\r\n              </p>\r\n              {selectedReport.lecturers && (\r\n                <p className=\"text-sm text-gray-500 mt-2\">\r\n                  {selectedReport.lecturers}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div>\r\n            {/* Attendance Table Section */}\r\n            <div className=\"px-6 py-3\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Attendance Overview</h3>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                  <div className=\"flex gap-0\">\r\n                    {/* Fixed NIM/Name Table */}\r\n                    <div className=\"flex-shrink-0 sticky left-0 z-10\">\r\n                      <table className=\"border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50\">\r\n                            <th className=\"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-24 h-14\">\r\n                              NIM\r\n                            </th>\r\n                            <th className=\"bg-gray-50 border-r border-b border-gray-300 px-2 py-2 text-left text-xs font-semibold text-gray-700 w-52 h-14\">\r\n                              Name\r\n                            </th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {selectedReport.attendanceData?.slice(1).map((row: any[], index: number) => (\r\n                            <tr key={index} className=\"hover:bg-gray-50 h-9\">\r\n                              <td className=\"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs font-medium text-gray-900\">\r\n                                {row[0] || '-'}\r\n                              </td>\r\n                              <td className=\"bg-white border-r border-b border-gray-300 px-2 py-1.5 text-xs text-gray-900 truncate\">\r\n                                {row[1] || '-'}\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n\r\n                    {/* Scrollable Meetings Table */}\r\n                    <div className=\"flex-1\">\r\n                      <table className=\"border-collapse\">\r\n                        <thead>\r\n                          <tr className=\"bg-gray-50\">\r\n                            {meetingHeaders.map((header: any, index: number) => (\r\n                              <th\r\n                                key={index}\r\n                                className=\"border-r border-b border-gray-300 px-1 py-2 text-center text-xs font-semibold text-gray-700 w-16 h-14\"\r\n                              >\r\n                                <div className=\"flex flex-col items-center gap-0.5\">\r\n                                  <span className=\"font-bold text-[10px]\">{header}</span>\r\n                                  {meetingDateMap[header] && (\r\n                                    <span className=\"text-gray-500 font-normal text-[9px]\">\r\n                                      {meetingDateMap[header]}\r\n                                    </span>\r\n                                  )}\r\n                                </div>\r\n                              </th>\r\n                            ))}\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {selectedReport.attendanceData?.slice(1).map((row: any[], rowIndex: number) => (\r\n                            <tr key={rowIndex} className=\"hover:bg-gray-50 h-9\">\r\n                              {row.slice(2).map((status: any, colIndex: number) => (\r\n                                <td\r\n                                    key={colIndex}\r\n                                    className={`border-r border-b border-gray-300 px-1 py-1.5 text-center ${getStatusColor(status)}`}\r\n                                  >\r\n                                    <span className=\"inline-flex items-center gap-1 justify-center\">\r\n                                      {getStatusIcon(status)}\r\n                                      <span className=\"text-[10px] text-gray-700\">{getStatusDisplayLabel(status)}</span>\r\n                                    </span>\r\n                                  </td>\r\n                              ))}\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div className=\"px-6 py-3\">\r\n              <div className=\"flex items-center gap-4 text-xs flex-wrap\">\r\n                <span className=\"font-medium text-gray-700\">Legend:</span>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                  <span className=\"text-gray-600\">Present</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <ClockAlert className=\"h-4 w-4 text-orange-600\" />\r\n                  <span className=\"text-gray-600\">Late</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Clock className=\"h-4 w-4 text-blue-600\" />\r\n                  <span className=\"text-gray-600\">Excused</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\r\n                  <span className=\"text-gray-600\">Sick</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                  <span className=\"text-gray-600\">Absent</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <CheckCircle className=\"h-4 w-4 text-purple-600\" />\r\n                  <span className=\"text-gray-600\">Tugas</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Minus className=\"h-4 w-4 text-gray-300\" />\r\n                  <span className=\"text-gray-600\">No data</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Meeting Descriptions Table */}\r\n            <div className=\"px-6 py-3\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Meeting Descriptions</h3>\r\n              <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                <table className=\"w-full border-collapse text-xs\">\r\n                  <thead>\r\n                    <tr className=\"bg-gray-50\">\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-16\">\r\n                        Meeting\r\n                      </th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700 w-28\">\r\n                        Date\r\n                      </th>\r\n                      <th className=\"border-b border-gray-300 px-3 py-2 text-left font-semibold text-gray-700\">\r\n                        Topic\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {selectedReport.meetingSummaryData?.slice(1).map((row: any[], index: number) => (\r\n                      <tr key={index} className=\"hover:bg-gray-50\">\r\n                        <td className=\"border-b border-gray-300 px-3 py-2 font-medium text-gray-900\">\r\n                          {row[0] || '-'}\r\n                        </td>\r\n                        <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                          {row[1] || '-'}\r\n                        </td>\r\n                        <td className=\"border-b border-gray-300 px-3 py-2 text-gray-600\">\r\n                          {row[2] || '-'}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Grades Overview Table */}\r\n            {selectedReport.gradesData && selectedReport.gradesData.length > 0 && (\r\n              <div className=\"px-6 py-3 pb-6\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Grades Overview</h3>\r\n                <div className=\"border border-gray-300 rounded-lg overflow-hidden\">\r\n                  <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full border-collapse text-xs\">\r\n                      <thead>\r\n                        <tr className=\"bg-gray-50\">\r\n                          {selectedReport.gradesData[0].map((header: any, index: number) => (\r\n                            <th\r\n                              key={index}\r\n                              className={`border-${index < selectedReport.gradesData![0].length - 1 ? 'r' : ''} border-b border-gray-300 px-3 py-2 ${\r\n                                index <= 1 ? 'text-left' : 'text-center'\r\n                              } font-semibold text-gray-700`}\r\n                            >\r\n                              {header}\r\n                            </th>\r\n                          ))}\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {selectedReport.gradesData.slice(1).map((row: any[], rowIndex: number) => {\r\n                          // Check if this is the weights row (last row or contains \"Component Weights\")\r\n                          const isWeightsRow = rowIndex === selectedReport.gradesData!.length - 2 || \r\n                                              (row[0] && String(row[0]).toLowerCase().includes('weight'));\r\n                          \r\n                          if (isWeightsRow) {\r\n                            // Special rendering for weights row\r\n                            return (\r\n                              <tr key={rowIndex} className=\"bg-blue-50 font-bold\">\r\n                                {/* Component Weights label - spans first 2 columns */}\r\n                                <td \r\n                                  colSpan={2} \r\n                                  className=\"border-r border-b border-gray-300 px-3 py-2 text-left text-gray-900\"\r\n                                >\r\n                                  {row[0]}\r\n                                </td>\r\n                                {/* Individual weight percentages - columns 2-7 */}\r\n                                {row.slice(2, 8).map((cell: any, idx: number) => (\r\n                                  <td \r\n                                    key={idx + 2}\r\n                                    className=\"border-r border-b border-gray-300 px-3 py-2 text-center text-blue-600\"\r\n                                  >\r\n                                    {cell}\r\n                                  </td>\r\n                                ))}\r\n                                {/* Total: 100% - spans last 3 columns */}\r\n                                <td \r\n                                  colSpan={3}\r\n                                  className=\"border-b border-gray-300 px-3 py-2 text-center text-blue-600\"\r\n                                >\r\n                                  {row[8]}\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          }\r\n                          \r\n                          // Regular student row\r\n                          return (\r\n                            <tr key={rowIndex} className=\"hover:bg-gray-50\">\r\n                              {row.map((cell: any, cellIndex: number) => {\r\n                                // Determine styling based on column\r\n                                const isNIM = cellIndex === 0;\r\n                                const isName = cellIndex === 1;\r\n                                const isLetterGrade = cellIndex === selectedReport.gradesData![0].length - 2;\r\n                                const isFinalGrade = cellIndex >= selectedReport.gradesData![0].length - 3;\r\n                                \r\n                                return (\r\n                                  <td\r\n                                    key={cellIndex}\r\n                                    className={`border-${cellIndex < row.length - 1 ? 'r' : ''} border-b border-gray-300 px-3 py-2 ${\r\n                                      cellIndex <= 1 ? 'text-left' : 'text-center'\r\n                                    } ${\r\n                                      isNIM\r\n                                        ? 'font-medium text-gray-900'\r\n                                        : isName\r\n                                        ? 'text-gray-900'\r\n                                        : isLetterGrade\r\n                                        ? 'font-bold text-blue-600'\r\n                                        : isFinalGrade\r\n                                        ? 'font-semibold text-gray-900'\r\n                                        : 'text-gray-600'\r\n                                    }`}\r\n                                  >\r\n                                    {cell ?? '-'}\r\n                                  </td>\r\n                                );\r\n                              })}\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <FileText className=\"h-8 w-8 text-blue-600\" />\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900\">Class Report Generator</h1>\r\n            <p className=\"text-gray-600\">Import XLSX files dan generate laporan kelas</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Upload Section */}\r\n      <div className=\"card p-6\">\r\n        <div className=\"space-y-4\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900\">Upload XLSX Report</h2>\r\n          \r\n          <div\r\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\r\n              isDragActive ? 'border-blue-500 bg-blue-50' : 'border-blue-300 hover:border-blue-400'\r\n            }`}\r\n            onDragOver={handleDragOver}\r\n            onDragEnter={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n          >\r\n            <input\r\n              type=\"file\"\r\n              accept=\".xlsx,.xls\"\r\n              multiple\r\n              onChange={handleFileUpload}\r\n              disabled={isProcessing}\r\n              className=\"hidden\"\r\n              id=\"file-upload\"\r\n            />\r\n            <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\r\n              <div className=\"flex flex-col items-center justify-center\">\r\n                <Upload className=\"h-12 w-12 text-blue-400 mb-3\" />\r\n                <p className=\"text-lg font-medium text-gray-900\">Drag and drop your XLSX files</p>\r\n                <p className=\"text-sm text-gray-500 mt-2\">atau klik untuk memilih file</p>\r\n                <p className=\"text-xs text-gray-400 mt-3\">\r\n                  File harus memiliki sheet: Class Description, Attendance Overview, Meeting Summary\r\n                </p>\r\n                {isProcessing && (\r\n                  <div className=\"flex items-center gap-2 mt-4 text-blue-600\">\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                    <span className=\"text-sm\">Processing file(s)...</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </label>\r\n          </div>\r\n\r\n          {uploadMessage && (\r\n            <div\r\n              className={`flex items-center gap-3 p-4 rounded-lg ${\r\n                uploadMessage.type === 'success'\r\n                  ? 'bg-green-50 text-green-700 border border-green-200'\r\n                  : 'bg-red-50 text-red-700 border border-red-200'\r\n              }`}\r\n            >\r\n              {uploadMessage.type === 'success' ? (\r\n                <CheckCircle className=\"h-5 w-5 flex-shrink-0\" />\r\n              ) : (\r\n                <AlertCircle className=\"h-5 w-5 flex-shrink-0\" />\r\n              )}\r\n              <span className=\"text-sm\">{uploadMessage.text}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Imported Reports List */}\r\n      {importedReports.length > 0 ? (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">Imported Reports ({importedReports.length})</h2>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={handleBulkGeneratePDF}\r\n                disabled={isBulkGenerating || isProcessing}\r\n                className=\"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n              >\r\n                {isBulkGenerating ? (\r\n                  <>\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                    <span>Generating {bulkProgress.current}/{bulkProgress.total}...</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Download className=\"h-4 w-4\" />\r\n                    <span>Bulk Generate All PDFs</span>\r\n                  </>\r\n                )}\r\n              </button>\r\n              <button\r\n                onClick={() => setImportedReports([])}\r\n                disabled={isBulkGenerating || isProcessing || importedReports.length === 0}\r\n                className=\"btn-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:cursor-pointer transition-all active:scale-95\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n                <span>Remove All</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {importedReports.map((report) => (\r\n              <div key={report.id} className=\"card p-6\">\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">\r\n                      {report.courseCode && <span className=\"text-blue-600\">{report.courseCode}</span>}\r\n                      {report.courseCode && ' - '}\r\n                      {report.courseName} - Class {report.className}\r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-500\">File: {report.fileName}</p>\r\n                  </div>\r\n\r\n                  <div className=\"flex space-x-2\">\r\n                    <button\r\n                      onClick={() => handleViewReport(report)}\r\n                      className=\"flex-1 btn-primary flex items-center justify-center space-x-2\"\r\n                    >\r\n                      <FileText className=\"h-4 w-4\" />\r\n                      <span>View Report</span>\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDeleteReport(report.id)}\r\n                      className=\"flex-1 btn-secondary flex items-center justify-center space-x-2\"\r\n                    >\r\n                      <span>Remove</span>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12 card p-6\">\r\n          <FileText className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Reports Imported Yet</h3>\r\n          <p className=\"text-gray-500 mb-6\">Upload XLSX files to generate class reports</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Reports;"],"file":"assets/Reports-CmUyB183.js"}