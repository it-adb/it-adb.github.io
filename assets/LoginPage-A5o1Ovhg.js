const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C1kkCffi.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js","assets/ui-vendor-DIF6S0il.js","assets/index-JoeFw4Ap.css"])))=>i.map(i=>d[i]);
import{j as e,_ as P}from"./query-vendor-B--u1oZD.js";import{r as a,c as K}from"./react-vendor-XXJdR_Id.js";import{u as W,l as z,i as J,r as A,E as R,a as M,b as I}from"./index-C1kkCffi.js";import{E as Q,l as X,q as G}from"./ui-vendor-DIF6S0il.js";const se=()=>{const{isAuthenticated:L,login:g}=W(),[n,j]=a.useState(!1),[i,m]=a.useState(!1),[u,f]=a.useState(!1),[w,d]=a.useState(""),[h,D]=a.useState(""),[p,B]=a.useState(""),[y,C]=a.useState(!1),c=a.useRef(null),l=a.useRef(!0),x=R.googleClientId,T=R.isDevelopment,N=a.useCallback(async t=>{try{m(!0),d("");try{await g(t)}catch(r){throw console.error("❌ Backend authentication failed:",r),d("User not found. Please contact your administrator for access."),r}}catch(r){console.error("Failed to login:",r)}finally{m(!1)}},[g]);a.useEffect(()=>{l.current=!0,m(!0),f(!1);const t=setTimeout(()=>{l.current&&z().then(()=>{l.current&&(M(),f(!0),J(x,N),c.current&&A(c.current))}).catch(r=>{l.current&&(console.error("Google script loading failed:",r),f(!1))}).finally(()=>{l.current&&m(!1)})},100);return()=>{l.current=!1,clearTimeout(t)}},[x,N]),a.useEffect(()=>{if(u&&c.current&&!i&&!n){const t=setTimeout(()=>{l.current&&c.current&&A(c.current)},50);return()=>clearTimeout(t)}},[u,i,n]);const F=async t=>{if(t.preventDefault(),d(""),!h||!p){d("Please enter both username and password");return}j(!0);try{const r=await I.login(h,p),v=await I.getCurrentUser(),o={access_token:r.access_token,refresh_token:r.refresh_token,roles:v.roles,user:v.user},{extractString:U}=await P(async()=>{const{extractString:s}=await import("./index-C1kkCffi.js").then(b=>b.s);return{extractString:s}},__vite__mapDeps([0,1,2,3,4])),{getPrimaryRole:O}=await P(async()=>{const{getPrimaryRole:s}=await import("./index-C1kkCffi.js").then(b=>b.j);return{getPrimaryRole:s}},__vite__mapDeps([0,1,2,3,4])),_=o.roles.map(s=>s.role),V=O(_),q=U(o.user.name,o.user.email.split("@")[0]);let S,E,k;for(const s of o.roles)s.entity_type==="mahasiswa"&&s.entity_id?S=s.entity_id:s.entity_type==="dosen"&&s.entity_id?E=s.entity_id:s.entity_type==="applicant"&&s.entity_id&&(k=s.entity_id);const H={id:String(o.user.id),email:o.user.email,name:q,role:V,availableRoles:_,studentId:S,employeeId:E,applicationId:k,roleEntities:o.roles};await g(H)}catch(r){console.error("Login failed:",r),d(r instanceof Error?r.message:"Login failed. Please check your credentials.")}finally{j(!1)}};return L?e.jsx(K,{to:"/dashboard",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx("img",{src:"/logo.png",alt:"ADB Academic System Logo",className:"w-16 h-16 object-contain"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ADB Academic System"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your academic portal"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"space-y-6",children:[w&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium",children:"Authentication Failed"}),e.jsx("p",{className:"mt-1",children:w})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("strong",{children:"Kesulitan login dengan Google?"}),' Gunakan email sebagai username dan nama email diikuti "ADB" sebagai password.',e.jsx("br",{}),e.jsx("br",{}),"Contoh: untuk email ",e.jsx("code",{className:"text-blue-700",children:"john.doe@digitalbdg.ac.id"}),", gunakan username: ",e.jsx("code",{className:"text-blue-700",children:"john.doe@digitalbdg.ac.id"})," dan password: ",e.jsx("code",{className:"text-blue-700",children:"john.doeADB"}),e.jsx("br",{}),e.jsx("br",{}),"Setelah berhasil login, anda dapat mengubah password Anda di dengan membuka profil anda di kanan atas kemudian memilih menu settings."]}),e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{id:"username",type:"text",value:h,onChange:t=>D(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your username",disabled:n||i})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:y?"text":"password",value:p,onChange:t=>B(t.target.value),className:"w-full pr-10 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your password",disabled:n||i}),e.jsx("button",{type:"button",onClick:()=>C(t=>!t),disabled:n||i,className:"absolute inset-y-0 right-2 flex items-center px-2 text-gray-500","aria-label":y?"Hide password":"Show password",tabIndex:0,children:y?e.jsx(Q,{className:"h-5 w-5"}):e.jsx(X,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:n||i,className:"w-full btn-primary flex items-center justify-center",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Sign In"]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsxs("div",{className:"w-full flex flex-col items-center",children:[(i||n)&&e.jsxs("div",{className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-600 mr-3"}),i?"Preparing Google sign-in…":"Authentication in progress..."]}),!i&&!n&&u&&x&&e.jsx("div",{ref:c,className:"w-full flex justify-center"}),!i&&!n&&(!u||!x)&&e.jsxs("button",{disabled:!0,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-700 opacity-60",children:[e.jsx(G,{className:"h-5 w-5 mr-3"}),"Google sign-in unavailable"]})]}),T]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"By signing in, you agree to our Terms of Service and Privacy Policy"})})]}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:"© 2024 ADB Academic System. All rights reserved."})]})})};export{se as default};
//# sourceMappingURL=LoginPage-A5o1Ovhg.js.map
