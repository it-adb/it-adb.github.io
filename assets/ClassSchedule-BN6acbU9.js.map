{"version":3,"file":"ClassSchedule-BN6acbU9.js","sources":["../../src/pages/student/ClassSchedule.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { CalendarDays, Clock, MapPin, AlertCircle, CheckCircle, Loader2 } from 'lucide-react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { useTranslation } from '../../contexts/LanguageContext';\r\nimport type { StudentAttendanceResponse } from '../../types';\r\nimport { useStudentClasses, useStudentAttendances } from '../../hooks/useClasses';\r\nimport { extractString, extractDate } from '../../utils/sqlNull';\r\nimport CheckInModal from '../../components/shared/CheckInModal';\r\n\r\ntype Day = 'Monday' | 'Tuesday' | 'Wednesday' | 'Thursday' | 'Friday';\r\n\r\ninterface ScheduleItem {\r\n  id: string;\r\n  day: Day;\r\n  startTime: string; // HH:mm\r\n  endTime: string;   // HH:mm\r\n  courseCode: string;\r\n  courseName: string;\r\n  className: string;\r\n  credits: number;\r\n  room: string;\r\n  topic: string;\r\n  weekNumber: number;\r\n  classId: number;\r\n  actualDate?: Date; // Store the actual meeting date\r\n  meetingId: number; // For attendance check-in\r\n}\r\n\r\n// Helper to extract day name from date string\r\nconst getDayFromDate = (dateValue: unknown): Day | null => {\r\n  const date = extractDate(dateValue as any);\r\n  if (!date) return null;\r\n  const dayIndex = date.getDay();\r\n  const daysMap: Record<number, Day> = {\r\n    1: 'Monday',\r\n    2: 'Tuesday',\r\n    3: 'Wednesday',\r\n    4: 'Thursday',\r\n    5: 'Friday',\r\n  };\r\n  return daysMap[dayIndex] || null;\r\n};\r\n\r\n// Helper to extract time (HH:mm) from jam_pertemuan which can be:\r\n// - time string \"HH:mm\" or \"HH:mm:ss\"\r\n// - ISO datetime \"0000-01-01T11:00:00.000Z\" or \"2024-01-15T10:00:00Z\"\r\nconst getTimeFromDate = (dateValue: unknown): string => {\r\n  const dateStr = extractString(dateValue as any);\r\n  if (!dateStr) return '00:00';\r\n\r\n  // Time-only formats: \"HH:mm\" or \"H:mm\" or \"HH:mm:ss\"\r\n  const timeOnlyMatch = dateStr.match(/^(\\d{1,2}):(\\d{2})(?::\\d{2})?$/);\r\n  if (timeOnlyMatch) {\r\n    const hh = timeOnlyMatch[1].padStart(2, '0');\r\n    const mm = timeOnlyMatch[2];\r\n    return `${hh}:${mm}`;\r\n  }\r\n\r\n  // ISO-like datetime: extract after 'T' and before '.' or 'Z'\r\n  const afterT = dateStr.split('T')[1];\r\n  if (afterT) {\r\n    const part = afterT.split('.')[0].split('Z')[0];\r\n    const [hh = '00', mm = '00'] = part.split(':');\r\n    return `${hh.padStart(2,'0')}:${mm.padStart(2,'0')}`;\r\n  }\r\n\r\n  // As a last resort try Date parsing\r\n  try {\r\n    const d = new Date(dateStr);\r\n    if (!isNaN(d.getTime())) {\r\n      return d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });\r\n    }\r\n  } catch {}\r\n\r\n  return '00:00';\r\n};\r\n\r\nconst ClassSchedule: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const { t } = useTranslation();\r\n  const [scheduleItems, setScheduleItems] = useState<ScheduleItem[]>([]);\r\n  \r\n  // Filter and sort state for List of Schedules\r\n  const [selectedCourses, setSelectedCourses] = useState<string[]>([]);\r\n  const [filterStartDate, setFilterStartDate] = useState<string>('');\r\n  const [filterEndDate, setFilterEndDate] = useState<string>('');\r\n  \r\n  // Check-in modal state\r\n  const [showCheckInModal, setShowCheckInModal] = useState(false);\r\n  const [checkInMeetingId, setCheckInMeetingId] = useState<number | null>(null);\r\n  const [checkInCourseName, setCheckInCourseName] = useState('');\r\n  const [editProof, setEditProof] = useState('');\r\n  const [editDescription, setEditDescription] = useState('');\r\n  const [editModalOpen, setEditModalOpen] = useState(false);\r\n  const [editingAttendance, setEditingAttendance] = useState<StudentAttendanceResponse | null>(null);\r\n\r\n  // Build API params with date filters\r\n  const params = React.useMemo(() => {\r\n    const p: { semester?: string; start_day?: string; end_day?: string } = {};\r\n    if (filterStartDate) p.start_day = filterStartDate;\r\n    if (filterEndDate) p.end_day = filterEndDate;\r\n    return p;\r\n  }, [filterStartDate, filterEndDate]);\r\n\r\n  // Fetch classes with date filters\r\n  const { data: rawClasses, isLoading: loading, error: fetchError } = useStudentClasses(\r\n    user?.studentId || '',\r\n    params\r\n  );\r\n  // Avoid rendering-time default [] that changes identity on every render while loading\r\n  const classes = React.useMemo(() => rawClasses ?? [], [rawClasses]);\r\n\r\n  // Fetch attendances\r\n  const { data: attendances = [] } = useStudentAttendances();\r\n\r\n  const error = fetchError ? (fetchError instanceof Error ? fetchError.message : 'Failed to load class schedule') : null;\r\n\r\n  const openCheckInModal = (meetingId: number, courseName: string) => {\r\n    setCheckInMeetingId(meetingId);\r\n    setCheckInCourseName(courseName);\r\n    setShowCheckInModal(true);\r\n  };\r\n\r\n  const closeCheckInModal = () => {\r\n    setShowCheckInModal(false);\r\n    setCheckInMeetingId(null);\r\n    setCheckInCourseName('');\r\n  };\r\n\r\n  const startEditProof = (attendance: StudentAttendanceResponse) => {\r\n    setEditingAttendance(attendance);\r\n    setEditProof(attendance.link_bukti || '');\r\n    setEditDescription(attendance.deskripsi || '');\r\n    setEditModalOpen(true);\r\n  };\r\n\r\n  const cancelEditProof = () => {\r\n    setEditingAttendance(null);\r\n    setEditProof('');\r\n    setEditDescription('');\r\n    setEditModalOpen(false);\r\n  };\r\n\r\n  const isCheckedIn = (meetingId: number): boolean => {\r\n    return Array.isArray(attendances) && attendances.some(att => att.id_pertemuan === meetingId);\r\n  };\r\n\r\n  const getAttendanceInfo = (meetingId: number): StudentAttendanceResponse | undefined => {\r\n    return Array.isArray(attendances) ? attendances.find(att => att.id_pertemuan === meetingId) : undefined;\r\n  };\r\n\r\n  const canCheckIn = (item: ScheduleItem, absensiAktif: boolean): { allowed: boolean; reason?: string } => {\r\n    if (!item.actualDate) {\r\n      return { allowed: false, reason: 'Invalid meeting date' };\r\n    }\r\n\r\n    // Check if already checked in\r\n    if (isCheckedIn(item.meetingId)) {\r\n      return { allowed: false, reason: 'Already checked in' };\r\n    }\r\n\r\n    // Check if attendance is active\r\n    if (!absensiAktif) {\r\n      return { \r\n        allowed: false,\r\n        reason: 'Attendance not yet active'\r\n      };\r\n    }\r\n\r\n    return { allowed: true };\r\n  };\r\n\r\n  const getAttendanceColors = (status: string): { border: string; bg: string; text: string; icon: string } => {\r\n    const normalizedStatus = status.toLowerCase();\r\n    if (normalizedStatus === 'hadir') {\r\n      return { \r\n        border: 'border-green-300', \r\n        bg: 'bg-green-50', \r\n        text: 'text-green-700', \r\n        icon: 'text-green-600' \r\n      };\r\n    } else if (normalizedStatus === 'izin' || normalizedStatus === 'sakit') {\r\n      return { \r\n        border: 'border-yellow-300', \r\n        bg: 'bg-yellow-50', \r\n        text: 'text-yellow-700', \r\n        icon: 'text-yellow-600' \r\n      };\r\n    } else if (normalizedStatus === 'alfa') {\r\n      return { \r\n        border: 'border-red-300', \r\n        bg: 'bg-red-50', \r\n        text: 'text-red-700', \r\n        icon: 'text-red-600' \r\n      };\r\n    } else if (normalizedStatus === 'terlambat') {\r\n      return { \r\n        border: 'border-orange-300', \r\n        bg: 'bg-orange-50', \r\n        text: 'text-orange-700', \r\n        icon: 'text-orange-600' \r\n      };\r\n    } else if (normalizedStatus === 'pengganti') {\r\n      return {\r\n        border: 'border-purple-300',\r\n        bg: 'bg-purple-50',\r\n        text: 'text-purple-700',\r\n        icon: 'text-purple-600'\r\n      };\r\n    }\r\n    // Default to green for unknown status\r\n    return { \r\n      border: 'border-green-300', \r\n      bg: 'bg-green-50', \r\n      text: 'text-green-700', \r\n      icon: 'text-green-600' \r\n    };\r\n  };\r\n\r\n  // Process classes data whenever classes changes\r\n  useEffect(() => {\r\n    // Convert meeting schedules to schedule items\r\n    const items: ScheduleItem[] = [];\r\n    (rawClasses ?? []).forEach(classData => {\r\n          (classData.meeting_schedules ?? []).forEach(meeting => {\r\n            const day = getDayFromDate(meeting.tgl_pertemuan);\r\n            \r\n            // Skip if day is Saturday or Sunday (null)\r\n            if (!day) return;\r\n            \r\n            const startTime = getTimeFromDate(meeting.jam_pertemuan);\r\n            const actualDate = extractDate(meeting.tgl_pertemuan);\r\n            \r\n            // Skip if no valid date\r\n            if (!actualDate) return;\r\n            \r\n            // Calculate end time based on credits (assuming 1 SKS = 50 minutes)\r\n            const totalSKS = classData.sks_tatap_muka + classData.sks_praktek + classData.sks_prak_lapangan + classData.sks_simulasi;\r\n            const durationMinutes = totalSKS * 60;\r\n            \r\n            // Parse start time and add duration\r\n            const [startHours, startMinutes] = startTime.split(':').map(Number);\r\n            const totalMinutes = startHours * 60 + startMinutes + durationMinutes;\r\n            const endHours = Math.floor(totalMinutes / 60) % 24;\r\n            const endMinutes = totalMinutes % 60;\r\n            const endTime = `${String(endHours).padStart(2, '0')}:${String(endMinutes).padStart(2, '0')}`;\r\n\r\n            items.push({\r\n              id: `${classData.kelas_id}-${meeting.id}`,\r\n              day,\r\n              startTime,\r\n              endTime,\r\n              courseCode: classData.kode_mk,\r\n              courseName: classData.nama_mk,\r\n              className: classData.nama_kelas,\r\n              credits: totalSKS,\r\n              room: extractString(meeting.media_pembelajaran, 'TBA'),\r\n              topic: extractString(meeting.topik, ''),\r\n              weekNumber: meeting.pertemuan_ke,\r\n              classId: classData.kelas_id,\r\n              actualDate,\r\n              meetingId: meeting.id,\r\n            });\r\n          });\r\n        });\r\n    setScheduleItems(items);\r\n  }, [rawClasses]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        <div className=\"flex items-center justify-center h-64\">\r\n          <div className=\"text-center\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary-600 mx-auto mb-2\" />\r\n            <p className=\"text-gray-600\">Loading class schedule...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">Class & Schedule</h1>\r\n        <div className=\"card bg-red-50 border-red-200\">\r\n          <div className=\"flex items-center space-x-3 text-red-800\">\r\n            <AlertCircle className=\"h-5 w-5 flex-shrink-0\" />\r\n            <div>\r\n              <p className=\"font-medium\">Error loading schedule</p>\r\n              <p className=\"text-sm mt-1\">{error}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto space-y-4 lg:space-y-6\">\r\n      <h1 className=\"text-xl lg:text-2xl font-bold text-gray-900\">Class & Schedule</h1>\r\n\r\n      {/* Summary */}\r\n      <div className=\"card grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <CalendarDays className=\"h-5 w-5 text-primary-600 flex-shrink-0\" />\r\n          <div>\r\n            <div className=\"text-xs lg:text-sm text-gray-500\">Classes Enrolled</div>\r\n            <div className=\"text-base lg:text-lg font-semibold\">{classes.length} classes</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center space-x-3\">\r\n          <Clock className=\"h-5 w-5 text-green-600 flex-shrink-0\" />\r\n          <div>\r\n            <div className=\"text-xs lg:text-sm text-gray-500\">Total Meetings</div>\r\n            <div className=\"text-base lg:text-lg font-semibold\">{scheduleItems.length} sessions</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center space-x-3 sm:col-span-2 lg:col-span-1\">\r\n          <MapPin className=\"h-5 w-5 text-blue-600 flex-shrink-0\" />\r\n          <div>\r\n            <div className=\"text-xs lg:text-sm text-gray-500\">Total Credits</div>\r\n            <div className=\"text-base lg:text-lg font-semibold\">\r\n              {classes.reduce((sum, c) => sum + c.sks_tatap_muka + c.sks_praktek + c.sks_prak_lapangan + c.sks_simulasi, 0)} SKS\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {classes.length === 0 ? (\r\n        <div className=\"card text-center py-12\">\r\n          <CalendarDays className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Classes Found</h3>\r\n          <p className=\"text-gray-600\">\r\n            You are not enrolled in any classes.\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Class List */}\r\n          <div className=\"card\">\r\n            <h2 className=\"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4\">{t('student.enrolledClasses')}</h2>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3\">\r\n              {classes.map(classData => {\r\n                const totalSKS = classData.sks_tatap_muka + classData.sks_praktek + classData.sks_prak_lapangan + classData.sks_simulasi;\r\n                const meetingCount = classData.meeting_schedules?.length ?? 0;\r\n                \r\n                return (\r\n                  <div key={classData.kelas_id} className=\"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2 flex-wrap mb-2\">\r\n                        <span className=\"text-xs font-semibold text-primary-600\">{classData.kode_mk}</span>\r\n                      </div>\r\n                      <h3 className=\"text-xs font-medium text-gray-900 line-clamp-2 mb-1\">{classData.nama_mk}</h3>\r\n                      {classData.bahasan && (\r\n                        <p className=\"text-xs text-gray-600 line-clamp-2 mb-2\">{classData.bahasan}</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex items-center flex-wrap gap-x-2 gap-y-0.5 text-xs text-gray-500 border-t border-gray-100 pt-2\">\r\n                      <span className=\"font-medium text-gray-700\">{totalSKS} SKS</span>\r\n                      <span>•</span>\r\n                      <span>{meetingCount} meetings</span>\r\n                      {classData.mode_kuliah && (\r\n                        <>\r\n                          <span className=\"hidden sm:inline\">•</span>\r\n                          <span className=\"text-gray-600 hidden sm:inline\">{classData.mode_kuliah}</span>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* List of Schedules */}\r\n          <div className=\"card\">\r\n            <div className=\"flex items-center justify-between mb-3 lg:mb-4 flex-wrap gap-3\">\r\n              <h2 className=\"text-base lg:text-lg font-semibold text-gray-900\">{t('student.listOfSchedules')}</h2>\r\n            </div>\r\n\r\n            {/* Filter and Sort Controls */}\r\n            <div className=\"mb-4 lg:mb-6 pb-3 lg:pb-4 border-b border-gray-200\">\r\n              <div className=\"space-y-4\">\r\n                {/* Course Filter */}\r\n                <div>\r\n                  <label className=\"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3\">{t('student.filterByCourse')}</label>\r\n                  <div className=\"flex gap-2 flex-wrap\">\r\n                    {Array.from(new Set(scheduleItems.map(item => item.courseCode))).map(code => {\r\n                      const courseName = scheduleItems.find(item => item.courseCode === code)?.courseName;\r\n                      const isSelected = selectedCourses.includes(code);\r\n                      return (\r\n                        <button\r\n                          key={code}\r\n                          onClick={() => {\r\n                            if (isSelected) {\r\n                              setSelectedCourses(selectedCourses.filter(c => c !== code));\r\n                            } else {\r\n                              setSelectedCourses([...selectedCourses, code]);\r\n                            }\r\n                          }}\r\n                          className={`px-2.5 lg:px-3 py-1.5 text-xs font-medium rounded-lg transition-all cursor-pointer ${\r\n                            isSelected\r\n                              ? 'bg-primary-600 text-white border border-primary-600 hover:bg-primary-700'\r\n                              : 'bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200 hover:border-gray-300'\r\n                          }`}\r\n                          title={`${code} - ${courseName}`}\r\n                          type=\"button\"\r\n                        >\r\n                          <span className=\"hidden sm:inline\">{code} - {courseName}</span>\r\n                          <span className=\"sm:hidden\">{courseName}</span>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Date Filter */}\r\n                <div>\r\n                  <label className=\"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3\">{t('student.filterByDate')}</label>\r\n                  <div className=\"flex flex-col sm:flex-row gap-2 sm:gap-3\">\r\n                    <div className=\"flex-1\">\r\n                      <input\r\n                        type=\"date\"\r\n                        value={filterStartDate}\r\n                        onChange={(e) => setFilterStartDate(e.target.value)}\r\n                        className=\"input-field w-full text-xs\"\r\n                        placeholder=\"Start date\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <input\r\n                        type=\"date\"\r\n                        value={filterEndDate}\r\n                        onChange={(e) => setFilterEndDate(e.target.value)}\r\n                        className=\"input-field w-full text-xs\"\r\n                        placeholder=\"End date\"\r\n                      />\r\n                    </div>\r\n                    {(filterStartDate || filterEndDate) && (\r\n                      <button\r\n                        onClick={() => {\r\n                          setFilterStartDate('');\r\n                          setFilterEndDate('');\r\n                        }}\r\n                        className=\"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-lg hover:bg-gray-200 hover:border-gray-300 transition-all cursor-pointer whitespace-nowrap\"\r\n                        type=\"button\"\r\n                      >\r\n                        Clear Dates\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Schedule Table */}\r\n            {(() => {\r\n              let filtered = scheduleItems;\r\n              \r\n              if (selectedCourses.length > 0) {\r\n                filtered = filtered.filter(item => selectedCourses.includes(item.courseCode));\r\n              }\r\n\r\n              // Note: Date filtering is now handled by the backend via start_day and end_day parameters\r\n\r\n              // Sort by date\r\n              const sorted = [...filtered].sort((a, b) => {\r\n                if (!a.actualDate || !b.actualDate) return 0;\r\n                \r\n                // First, compare by date\r\n                const dateComparison = a.actualDate.getTime() - b.actualDate.getTime();\r\n                if (dateComparison !== 0) return dateComparison;\r\n                \r\n                // If dates are the same, compare by time\r\n                return a.startTime.localeCompare(b.startTime);\r\n              });\r\n\r\n              if (sorted.length === 0) {\r\n                return (\r\n                  <div className=\"text-center py-12\">\r\n                    <CalendarDays className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n                    <p className=\"text-gray-600\">No meetings match the selected filters.</p>\r\n                  </div>\r\n                );\r\n              }\r\n\r\n              return (\r\n                <div className=\"space-y-3\">\r\n                  {/* Mobile Card View */}\r\n                  <div className=\"lg:hidden space-y-2\">\r\n                    {sorted.map((item, index) => {\r\n                      const classData = classes.find(c => c.kelas_id === item.classId);\r\n                      const meeting = classData?.meeting_schedules?.find(\r\n                        m => `${classData.kelas_id}-${m.id}` === item.id\r\n                      );\r\n                      const meetingDateObj = meeting ? extractDate(meeting.tgl_pertemuan) : null;\r\n                      const meetingDate = meetingDateObj ? meetingDateObj.toLocaleDateString('id-ID', { \r\n                        day: 'numeric', \r\n                        month: 'short',\r\n                        year: 'numeric'\r\n                      }) : '';\r\n                      \r\n                      const absensiAktif = meeting?.absensi_aktif === true || (typeof meeting?.absensi_aktif === 'object' && meeting.absensi_aktif?.Valid && meeting.absensi_aktif?.Bool);\r\n                      const checkedIn = isCheckedIn(item.meetingId);\r\n                      const checkInStatus = canCheckIn(item, absensiAktif);\r\n                      const attendanceInfo = getAttendanceInfo(item.meetingId);\r\n                      const colors = attendanceInfo ? getAttendanceColors(attendanceInfo.status_kehadiran) : null;\r\n\r\n                      return (\r\n                        <div\r\n                          key={`${item.id}-${index}-mobile`}\r\n                          className={`p-3 border rounded-lg ${\r\n                            checkedIn && colors\r\n                              ? `${colors.border} ${colors.bg}`\r\n                              : 'border-gray-200 bg-white'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                            <div className=\"flex items-center gap-2 flex-wrap\">\r\n                              <span className=\"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded\">\r\n                                {item.day}\r\n                              </span>\r\n                              <span className=\"text-xs text-gray-600\">{meetingDate}</span>\r\n                            </div>\r\n                            {checkedIn && colors && (\r\n                              <CheckCircle className={`h-4 w-4 ${colors.icon} flex-shrink-0`} />\r\n                            )}\r\n                          </div>\r\n\r\n                          <div className=\"space-y-1.5\">\r\n                            <div className=\"flex items-start gap-2\">\r\n                              <span className=\"text-xs font-semibold text-primary-600 flex-shrink-0\">{item.courseCode}</span>\r\n                              <span className=\"text-xs font-medium text-gray-900\">{item.courseName}</span>\r\n                            </div>\r\n                            \r\n                            <div className=\"flex items-center gap-2 text-xs text-gray-600\">\r\n                              <span>Week {item.weekNumber}</span>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3 text-xs text-gray-600\">\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Clock className=\"h-3 w-3\" />\r\n                                <span>{item.startTime}</span>\r\n                              </div>\r\n                            </div>\r\n\r\n                            {checkedIn && attendanceInfo && colors ? (\r\n                              <div className={`text-xs ${colors.text} font-medium pt-2 border-t ${colors.border}`}>\r\n                                ✓ {attendanceInfo.status_kehadiran}\r\n                              </div>\r\n                            ) : checkInStatus.allowed ? (\r\n                              <button\r\n                                onClick={() => openCheckInModal(item.meetingId, item.courseName)}\r\n                                className=\"w-full text-xs px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all cursor-pointer font-medium mt-2\"\r\n                                type=\"button\"\r\n                              >\r\n                                Check In\r\n                              </button>\r\n                            ) : (\r\n                              <div className=\"text-xs text-gray-500 italic text-center py-1 mt-2\">\r\n                                {checkInStatus.reason}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n\r\n                  {/* Desktop Table View */}\r\n                  <div className=\"hidden lg:block overflow-x-auto\">\r\n                  <table className=\"w-full text-xs\">\r\n                    <thead>\r\n                      <tr className=\"border-b-2 border-gray-300 bg-gray-50\">\r\n                        <th className=\"px-3 py-2 text-left font-semibold text-gray-700\">{t('studentSchedule.status')}</th>\r\n                        <th className=\"px-3 py-2 text-left font-semibold text-gray-700\">{t('studentSchedule.day')}</th>\r\n                        <th className=\"px-3 py-2 text-left font-semibold text-gray-700\">{t('studentSchedule.date')}</th>\r\n                        <th className=\"px-3 py-2 text-left font-semibold text-gray-700\">{t('studentSchedule.time')}</th>\r\n                        <th className=\"px-3 py-2 text-left font-semibold text-gray-700\">{t('studentSchedule.courseCode')}</th>\r\n                        <th className=\"px-3 py-2 text-left font-semibold text-gray-700\">{t('studentSchedule.courseName')}</th>\r\n                        <th className=\"px-3 py-2 text-center font-semibold text-gray-700\">{t('studentSchedule.week')}</th>\r\n                        <th className=\"px-3 py-2 text-center font-semibold text-gray-700\">{t('studentSchedule.action')}</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {sorted.map((item, index) => {\r\n                        // Find the actual meeting to get the date\r\n                        const classData = classes.find(c => c.kelas_id === item.classId);\r\n                        const meeting = classData?.meeting_schedules?.find(\r\n                          m => `${classData.kelas_id}-${m.id}` === item.id\r\n                        );\r\n                        const meetingDateObj = meeting ? extractDate(meeting.tgl_pertemuan) : null;\r\n                        const meetingDate = meetingDateObj ? meetingDateObj.toLocaleDateString('id-ID', { \r\n                          day: 'numeric', \r\n                          month: 'short',\r\n                          year: 'numeric'\r\n                        }) : '';\r\n                        \r\n                        const absensiAktif = meeting?.absensi_aktif === true || (typeof meeting?.absensi_aktif === 'object' && meeting.absensi_aktif?.Valid && meeting.absensi_aktif?.Bool);\r\n                        const isEvenRow = index % 2 === 0;\r\n                        const checkedIn = isCheckedIn(item.meetingId);\r\n                        const checkInStatus = canCheckIn(item, absensiAktif);\r\n                        const attendanceInfo = getAttendanceInfo(item.meetingId);\r\n                        const colors = attendanceInfo ? getAttendanceColors(attendanceInfo.status_kehadiran) : null;\r\n\r\n                        return (\r\n                          <tr\r\n                            key={`${item.id}-${index}`}\r\n                            className={`border-b border-gray-200 transition-colors ${\r\n                              checkedIn && colors\r\n                                ? colors.bg\r\n                                : isEvenRow \r\n                                ? 'bg-white hover:bg-blue-50' \r\n                                : 'bg-gray-50 hover:bg-blue-50'\r\n                            }`}\r\n                          >\r\n                            <td className=\"px-3 py-2 text-center\">\r\n                              {checkedIn && colors && (\r\n                                <CheckCircle className={`h-4 w-4 ${colors.icon} inline`} />\r\n                              )}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 whitespace-nowrap\">\r\n                              <span className=\"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 font-semibold rounded\">\r\n                                {item.day}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-3 py-2 whitespace-nowrap text-gray-600\">\r\n                              {meetingDate}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 whitespace-nowrap text-gray-600\">\r\n                              {item.startTime}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 whitespace-nowrap font-semibold text-primary-600\">\r\n                              {item.courseCode}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 max-w-xs\">\r\n                              <div className=\"truncate text-gray-900 font-medium\">\r\n                                {item.courseName}\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-3 py-2 text-center text-gray-600 whitespace-nowrap\">\r\n                              {item.weekNumber}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 text-center whitespace-nowrap\">\r\n                              {checkedIn && attendanceInfo && colors ? (\r\n                                <div className=\"flex flex-col gap-1\">\r\n                                  <span className={`text-xs ${colors.text} font-medium whitespace-nowrap`}>\r\n                                    ✓ {attendanceInfo.status_kehadiran}\r\n                                  </span>\r\n                                  <button\r\n                                    onClick={() => startEditProof(attendanceInfo)}\r\n                                    className=\"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n                                    type=\"button\"\r\n                                  >\r\n                                    {t('studentSchedule.updateProof')}\r\n                                  </button>\r\n                                </div>\r\n                              ) : checkInStatus.allowed ? (\r\n                                <button\r\n                                  onClick={() => openCheckInModal(item.meetingId, item.courseName)}\r\n                                  className=\"text-xs px-2 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-all cursor-pointer font-medium\"\r\n                                  type=\"button\"\r\n                                >\r\n                                  {t('studentSchedule.checkIn')}\r\n                                </button>\r\n                              ) : (\r\n                                <div className=\"flex flex-col items-center gap-1\">\r\n                                  <button\r\n                                    disabled\r\n                                    className=\"text-xs px-2 py-1 bg-gray-300 text-gray-500 rounded cursor-not-allowed\"\r\n                                    title={checkInStatus.reason}\r\n                                  >\r\n                                    {t('studentSchedule.checkIn')}\r\n                                  </button>\r\n                                  <span className=\"text-xs text-gray-500 italic max-w-[120px] text-center\">\r\n                                    {checkInStatus.reason}\r\n                                  </span>\r\n                                </div>\r\n                              )}\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n                </div>\r\n              );\r\n            })()}\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      <CheckInModal\r\n        isOpen={showCheckInModal}\r\n        meetingId={checkInMeetingId}\r\n        courseName={checkInCourseName}\r\n        onClose={closeCheckInModal}\r\n      />\r\n      <CheckInModal\r\n        isOpen={editModalOpen}\r\n        meetingId={editingAttendance?.id_pertemuan || null}\r\n        courseName={editingAttendance?.nama_mk || ''}\r\n        onClose={cancelEditProof}\r\n        editMode={true}\r\n        existingProof={editProof}\r\n        existingDescription={editDescription}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ClassSchedule;\r\n"],"names":["getDayFromDate","dateValue","date","extractDate","dayIndex","getTimeFromDate","dateStr","extractString","timeOnlyMatch","hh","mm","afterT","part","ClassSchedule","user","useAuth","t","useTranslation","scheduleItems","setScheduleItems","useState","selectedCourses","setSelectedCourses","filterStartDate","setFilterStartDate","filterEndDate","setFilterEndDate","showCheckInModal","setShowCheckInModal","checkInMeetingId","setCheckInMeetingId","checkInCourseName","setCheckInCourseName","editProof","setEditProof","editDescription","setEditDescription","editModalOpen","setEditModalOpen","editingAttendance","setEditingAttendance","params","React","p","rawClasses","loading","fetchError","useStudentClasses","classes","attendances","useStudentAttendances","error","openCheckInModal","meetingId","courseName","closeCheckInModal","startEditProof","attendance","cancelEditProof","isCheckedIn","att","getAttendanceInfo","canCheckIn","item","absensiAktif","getAttendanceColors","status","normalizedStatus","useEffect","items","classData","meeting","day","startTime","actualDate","totalSKS","durationMinutes","startHours","startMinutes","totalMinutes","endHours","endMinutes","endTime","jsx","jsxs","Loader2","AlertCircle","CalendarDays","Clock","MapPin","sum","c","Fragment","meetingCount","code","isSelected","e","filtered","sorted","a","b","dateComparison","index","m","meetingDateObj","meetingDate","checkedIn","checkInStatus","attendanceInfo","colors","CheckCircle","isEvenRow","CheckInModal"],"mappings":"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"}