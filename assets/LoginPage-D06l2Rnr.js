const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-U_9acvuP.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js","assets/ui-vendor-C-UqR_Df.js","assets/index-DAcONv1f.css"])))=>i.map(i=>d[i]);
import{j as e,_ as E}from"./query-vendor-B--u1oZD.js";import{r as a,c as W}from"./react-vendor-XXJdR_Id.js";import{u as q,l as J,i as K,r as A,E as P,a as z,b as R}from"./index-U_9acvuP.js";import{q as G}from"./ui-vendor-C-UqR_Df.js";const Y=()=>{const{isAuthenticated:I,login:x}=q(),[n,b]=a.useState(!1),[i,u]=a.useState(!1),[m,f]=a.useState(!1),[j,d]=a.useState(""),[h,L]=a.useState(""),[p,D]=a.useState(""),c=a.useRef(null),o=a.useRef(!0),g=P.googleClientId,B=P.isDevelopment;a.useEffect(()=>{},[]);const w=a.useCallback(async t=>{try{console.log("Google JWT Token:",t),console.log("Token for backend testing - copy this value:",t),u(!0),d("");try{await x(t),console.log("✅ Backend authentication successful")}catch(r){throw console.error("❌ Backend authentication failed:",r),d("User not found. Please contact your administrator for access."),r}}catch(r){console.error("Failed to login:",r)}finally{u(!1)}},[x]);a.useEffect(()=>{o.current=!0,u(!0),f(!1);const t=setTimeout(()=>{o.current&&J().then(()=>{o.current&&(z(),f(!0),K(g,w),c.current&&A(c.current))}).catch(r=>{o.current&&(console.error("Google script loading failed:",r),f(!1))}).finally(()=>{o.current&&u(!1)})},100);return()=>{o.current=!1,clearTimeout(t)}},[g,w]),a.useEffect(()=>{if(m&&c.current&&!i&&!n){const t=setTimeout(()=>{o.current&&c.current&&A(c.current)},50);return()=>clearTimeout(t)}},[m,i,n]);const T=async t=>{if(t.preventDefault(),d(""),!h||!p){d("Please enter both username and password");return}b(!0);try{const r=await R.login(h,p),v=await R.getCurrentUser(),l={access_token:r.access_token,refresh_token:r.refresh_token,roles:v.roles,user:v.user},{extractString:C}=await E(async()=>{const{extractString:s}=await import("./index-U_9acvuP.js").then(y=>y.s);return{extractString:s}},__vite__mapDeps([0,1,2,3,4])),{getPrimaryRole:F}=await E(async()=>{const{getPrimaryRole:s}=await import("./index-U_9acvuP.js").then(y=>y.h);return{getPrimaryRole:s}},__vite__mapDeps([0,1,2,3,4])),N=l.roles.map(s=>s.role),U=F(N),O=C(l.user.name,l.user.email.split("@")[0]);let _,k,S;for(const s of l.roles)s.entity_type==="mahasiswa"&&s.entity_id?_=s.entity_id:s.entity_type==="dosen"&&s.entity_id?k=s.entity_id:s.entity_type==="applicant"&&s.entity_id&&(S=s.entity_id);const V={id:String(l.user.id),email:l.user.email,name:O,role:U,availableRoles:N,studentId:_,employeeId:k,applicationId:S,roleEntities:l.roles};await x(V)}catch(r){console.error("Login failed:",r),d(r instanceof Error?r.message:"Login failed. Please check your credentials.")}finally{b(!1)}};return I?e.jsx(W,{to:"/dashboard",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx("img",{src:"/logo.png",alt:"ADB Academic System Logo",className:"w-16 h-16 object-contain"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ADB Academic System"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your academic portal"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"space-y-6",children:[j&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium",children:"Authentication Failed"}),e.jsx("p",{className:"mt-1",children:j})]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("strong",{children:"Kesulitan login dengan Google?"}),' Gunakan email sebagai username dan nama email diikuti "ADB" sebagai password.',e.jsx("br",{}),e.jsx("br",{}),"Contoh: untuk email ",e.jsx("code",{className:"text-blue-700",children:"john.doe@digitalbdg.ac.id"}),", gunakan username: ",e.jsx("code",{className:"text-blue-700",children:"john.doe@digitalbdg.ac.id"})," dan password: ",e.jsx("code",{className:"text-blue-700",children:"john.doeADB"}),e.jsx("br",{}),e.jsx("br",{}),"Setelah berhasil login, anda dapat mengubah password Anda di dengan membuka profil anda di kanan atas kemudian memilih menu settings."]}),e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{id:"username",type:"text",value:h,onChange:t=>L(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your username",disabled:n||i})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:p,onChange:t=>D(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter your password",disabled:n||i})]}),e.jsx("button",{type:"submit",disabled:n||i,className:"w-full btn-primary flex items-center justify-center",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Sign In"]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsxs("div",{className:"w-full flex flex-col items-center",children:[(i||n)&&e.jsxs("div",{className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-600 mr-3"}),i?"Preparing Google sign-in…":"Authentication in progress..."]}),!i&&!n&&m&&g&&e.jsx("div",{ref:c,className:"w-full flex justify-center"}),!i&&!n&&(!m||!g)&&e.jsxs("button",{disabled:!0,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-700 opacity-60",children:[e.jsx(G,{className:"h-5 w-5 mr-3"}),"Google sign-in unavailable"]})]}),B]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"By signing in, you agree to our Terms of Service and Privacy Policy"})})]}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:"© 2024 ADB Academic System. All rights reserved."})]})})};export{Y as default};
//# sourceMappingURL=LoginPage-D06l2Rnr.js.map
