import{u as k,j as e}from"./query-vendor-B--u1oZD.js";import{r as i,u as P}from"./react-vendor-XXJdR_Id.js";import{c as h,e as C,b as _,g as p,u as D}from"./index-C1kkCffi.js";import{u as Q}from"./client-JIbyqFzl.js";import{u as T}from"./usePrograms-lhPWl3ZI.js";import{w as L,r as $,t as I,i as A,f as B,a1 as U,p as q,G,b as Y,B as v,z as R,$ as K,s as O}from"./ui-vendor-DIF6S0il.js";const V=s=>(s.sks_tatap_muka||0)+(s.sks_praktek||0)+(s.sks_prak_lapangan||0)+(s.sks_simulasi||0),W=s=>{switch(s){case"Online":return"bg-blue-100 text-blue-700";case"Offline":return"bg-green-100 text-green-700";case"Hybrid":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},z=s=>s?s.toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",H=s=>{if(!s||s.length<5)return"Unknown Semester";const n=s.slice(0,4),d=s.slice(4)==="1"?"Ganjil":"Genap";return`${`${n}/${parseInt(n)+1}`} ${d}`},X=s=>{if(typeof s=="boolean")return s;if(s&&typeof s=="object"&&"Bool"in s){const n=s;return!!(n.Valid&&n.Bool)}return!1},J=({meetings:s,totalStudents:n})=>{const d=i.useMemo(()=>s.map(a=>a.id),[s]),o=k({queryKey:["admin-meeting-attendances-batch",d],queryFn:async()=>{if(d.length===0)return{};try{const a=await _.getMeetingsBatch({meeting_ids:d,include_attendance_count:!0}),l={};return a.forEach(u=>{l[u.id]=u.total_attendances??0}),l}catch(a){return console.error("Failed to fetch meeting batch data:",a),{}}},enabled:d.length>0}),x=i.useMemo(()=>s.map(a=>{const l=o.data?.[a.id]??0,u=n>0&&l>=n,r=!!h(a.idDosen??a.id_dosen);return{id:a.id,weekNumber:a.pertemuan_ke,date:C(a.tgl_pertemuan),topic:h(a.topik,""),studentAttendanceComplete:u,lecturerAssigned:r,totalStudents:n,recordedAttendances:l,absensiAktif:X(a.absensi_aktif)}}).sort((a,l)=>a.weekNumber-l.weekNumber),[s,o.data,n]);return o.isFetching?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(L,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Loading meeting recap..."})]}):x.length===0?e.jsx("div",{className:"text-gray-500 text-[11px]",children:"No meetings scheduled"}):e.jsx("div",{className:"flex gap-1 flex-wrap",children:x.map(a=>{const l=a.date?a.date.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"-";return e.jsxs("div",{className:"flex flex-col items-center gap-1 p-2 rounded border border-gray-200 bg-white shadow-sm min-w-[80px]",title:`Week ${a.weekNumber} - ${l}${a.topic?` - ${a.topic}`:""}
Student Attendance: ${a.recordedAttendances}/${a.totalStudents}
Lecturer Assigned: ${a.lecturerAssigned?"Yes":"No"}
Attendance: ${a.absensiAktif?"Active":"Inactive"}`,children:[e.jsxs("div",{className:"text-[11px] font-semibold text-gray-700",children:["W",a.weekNumber]}),e.jsxs("div",{className:"flex gap-1 items-center justify-center h-5",children:[a.studentAttendanceComplete?e.jsx($,{className:"h-4 w-4 text-green-600"}):a.recordedAttendances>0?e.jsx($,{className:"h-4 w-4 text-orange-500"}):e.jsx(I,{className:"h-4 w-4 text-gray-300"}),a.lecturerAssigned?e.jsx(A,{className:"h-4 w-4 text-blue-600"}):e.jsx(A,{className:"h-4 w-4 text-gray-300"})]}),e.jsx("div",{className:"text-[11px] text-gray-500 text-center leading-tight",children:l}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:`h-2 w-2 rounded-full ${a.absensiAktif?"bg-green-600":"bg-gray-400"}`})})]},a.id)})})},Z=({kelas:s,courseCode:n,courseName:d})=>{const o=P(),x=k({queryKey:["admin-class-meetings",s.id],queryFn:async()=>{try{return await _.getMeetingsByClass(s.id)}catch(m){return console.error(`Failed to fetch meetings for class ${s.id}:`,m),[]}}}),a=k({queryKey:["admin-class-students",s.id],queryFn:async()=>{try{const m=await _.getClassStudents(s.id);return Array.isArray(m)?m.length:0}catch(m){return console.error(`Failed to fetch students for class ${s.id}:`,m),0}}}),l=i.useMemo(()=>x.data??[],[x.data]),u=i.useMemo(()=>a.data??0,[a.data]);return e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-xs hover:bg-gray-100 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900 whitespace-nowrap",children:["Class ",h(s.nama_kelas)]}),h(s.mode_kuliah)&&e.jsx("span",{className:`px-1.5 py-0.5 text-xs font-medium rounded whitespace-nowrap ${W(h(s.mode_kuliah))}`,children:h(s.mode_kuliah)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600 flex-wrap",children:[C(s.tgl_mulai)&&e.jsx("span",{className:"whitespace-nowrap",children:z(C(s.tgl_mulai))}),p(s.sks_tatap_muka)>0&&e.jsxs("span",{className:"whitespace-nowrap",children:[p(s.sks_tatap_muka),"SKS"]}),e.jsxs("button",{onClick:m=>{m.stopPropagation(),o(`/class-summary/${s.id}?courseCode=${encodeURIComponent(n)}&courseName=${encodeURIComponent(d)}&className=${encodeURIComponent(h(s.nama_kelas))}&sksTatapMuka=${p(s.sks_tatap_muka)}&sksPraktek=${p(s.sks_praktek)}&sksPrakLapangan=${p(s.sks_prak_lapangan)}&sksSimulasi=${p(s.sks_simulasi)}&from=admin/class-management`)},className:"ml-2 px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1 whitespace-nowrap",title:"View attendance matrix",children:[e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{children:"Summary"})]})]})]}),h(s.bahasan)&&e.jsx("p",{className:"text-gray-600 mt-1",children:h(s.bahasan)}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-600 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Meeting Recap"}),e.jsx("span",{className:"whitespace-nowrap",children:l.length?`${l.length} meeting${l.length!==1?"s":""}`:"No meetings"})]}),e.jsx(J,{meetings:l,totalStudents:u})]})]})},ee=({course:s,isExpanded:n,onToggleExpand:d})=>{const o=s.classes&&s.classes.length>0;return e.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between gap-2 cursor-pointer",onClick:()=>o&&d(),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:o&&e.jsx("div",{className:"text-gray-400",children:n?e.jsx(U,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 text-xs font-medium rounded whitespace-nowrap",children:s.kode_mk}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:s.nama_mk}),s.jenis_mk&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded whitespace-nowrap",children:s.jenis_mk})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-0.5 whitespace-nowrap",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[V(s)," SKS"]})]}),o&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 font-medium rounded whitespace-nowrap",children:[s.classes.length," classes"]})]})]})}),n&&o&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:s.classes.map(x=>e.jsx(Z,{kelas:x,courseCode:s.kode_mk,courseName:s.nama_mk},x.id))})]})},ie=()=>{const{currentSemester:s}=D(),[n,d]=i.useState([]),[o,x]=i.useState([]),[a,l]=i.useState(null),[u,m]=i.useState(new Set),[r,S]=i.useState({searchQuery:"",filterProgram:"all",filterYear:"",filterTerm:"1"}),N=i.useMemo(()=>r.filterYear?`${r.filterYear}${r.filterTerm}`:"",[r.filterYear,r.filterTerm]),{data:y}=T(),{data:b,error:g}=Q(i.useMemo(()=>N?{semester:N,include_classes:!0}:void 0,[N]));i.useEffect(()=>{y&&x(y)},[y]),i.useEffect(()=>{if(g){const t=g instanceof Error?g.message:"Failed to load courses";l(t),d([])}else l(null)},[g]),i.useEffect(()=>{Array.isArray(b)&&d(b)},[b]),i.useEffect(()=>{if(s&&!r.filterYear){const t=s.slice(0,4),c=s.slice(4);S(w=>({...w,filterYear:t,filterTerm:c}))}},[s,r.filterYear]);const f=i.useMemo(()=>{let t=n;return r.searchQuery&&(t=t.filter(c=>c.nama_mk.toLowerCase().includes(r.searchQuery.toLowerCase())||c.kode_mk.toLowerCase().includes(r.searchQuery.toLowerCase()))),r.filterProgram!=="all"&&(t=t.filter(c=>c.kode_prodi===r.filterProgram)),t},[n,r.searchQuery,r.filterProgram]),E=f.length,M=f.reduce((t,c)=>t+(c.classes?.length||0),0),j=(t,c)=>{S(w=>({...w,[t]:c}))},F=t=>{const c=new Set(u);c.has(t)?c.delete(t):c.add(t),m(c)};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Management"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-500",children:"Current Semester:"}),e.jsx("span",{className:"font-medium text-gray-900",children:H(s)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(v,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Courses"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:E})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(v,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Classes"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:M})]})]})})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by course name or code...",value:r.searchQuery,onChange:t=>j("searchQuery",t.target.value),className:"input-field pl-10 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",value:r.filterYear,onChange:t=>j("filterYear",t.target.value),placeholder:"Year",className:"input-field w-[80px] text-center",min:new Date().getFullYear()-10,max:new Date().getFullYear()+5}),e.jsx("span",{className:"text-gray-500 font-medium",children:"/"}),e.jsx("input",{type:"number",value:r.filterYear?parseInt(r.filterYear)+1:"",disabled:!0,className:"input-field w-[80px] text-center bg-gray-50 text-gray-600",readOnly:!0})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs("select",{value:r.filterTerm,onChange:t=>j("filterTerm",t.target.value),className:"input-field min-w-[120px]",children:[e.jsx("option",{value:"1",children:"Ganjil"}),e.jsx("option",{value:"2",children:"Genap"})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(K,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("select",{value:r.filterProgram,onChange:t=>j("filterProgram",t.target.value),className:"input-field min-w-[200px]",children:[e.jsx("option",{value:"all",children:"All Programs"}),o.map(t=>e.jsxs("option",{value:t.kode_prodi,children:[t.nama_prodi," (",t.kode_prodi,")"]},t.kode_prodi))]})]})]})}),a&&e.jsx("div",{className:"card bg-red-50 border-red-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(O,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading courses"}),e.jsx("p",{className:"text-sm text-red-600",children:a})]})]})}),f.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(v,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No courses found"}),e.jsx("p",{className:"text-sm text-gray-400",children:r.searchQuery||r.filterProgram!=="all"?"Try adjusting your filters or search query":"No courses available for this semester"})]}):e.jsx("div",{className:"space-y-2",children:f.map(t=>e.jsx(ee,{course:t,isExpanded:u.has(t.kode_mk),onToggleExpand:()=>F(t.kode_mk)},t.kode_mk))})]})};export{ie as default};
//# sourceMappingURL=index-D_5u2g5Z.js.map
