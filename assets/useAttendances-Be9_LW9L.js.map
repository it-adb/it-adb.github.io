{"version":3,"file":"useAttendances-Be9_LW9L.js","sources":["../../src/hooks/useAttendances.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient, type UseQueryOptions } from '@tanstack/react-query';\r\nimport { apiService } from '../services/api';\r\nimport type { AttendanceRecord, Mahasiswa, CreateAttendanceRequest, UpdateAttendanceRequest, UpdateMeetingRequest } from '../types';\r\n\r\nexport function useClassStudents(\r\n  classId?: number | string,\r\n  options?: Omit<UseQueryOptions<Mahasiswa[], Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['class-students', classId ?? null] as const;\r\n  return useQuery<Mahasiswa[], Error>({\r\n    queryKey: key,\r\n    queryFn: () => {\r\n      if (!classId) return Promise.resolve([] as Mahasiswa[]);\r\n      return apiService.getClassStudents(classId).then((res) => Array.isArray(res) ? res : []);\r\n    },\r\n    enabled: Boolean(classId),\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n\r\nexport function useMeetingAttendances(\r\n  meetingId?: number,\r\n  options?: Omit<UseQueryOptions<AttendanceRecord[], Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['meeting-attendances', meetingId ?? null] as const;\r\n  return useQuery<AttendanceRecord[], Error>({\r\n    queryKey: key,\r\n    queryFn: () => {\r\n      if (!meetingId) return Promise.resolve([] as AttendanceRecord[]);\r\n      return apiService.getMeetingAttendances(meetingId).then((res) => Array.isArray(res) ? res : []);\r\n    },\r\n    enabled: Boolean(meetingId),\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n\r\nexport function useCreateAttendance() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: (data: CreateAttendanceRequest) => apiService.createAttendance(data),\r\n    onSuccess: (_, variables) => {\r\n      // Invalidate the meeting attendances query for the specific meeting\r\n      queryClient.invalidateQueries({ queryKey: ['meeting-attendances', variables.id_pertemuan] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateAttendance() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: ({ id, data }: { id: number; data: UpdateAttendanceRequest }) => \r\n      apiService.updateAttendance(id, data),\r\n    onSuccess: () => {\r\n      // Invalidate all meeting attendances queries as we don't know which meeting was updated\r\n      queryClient.invalidateQueries({ queryKey: ['meeting-attendances'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useUpdateMeeting() {\r\n  const queryClient = useQueryClient();\r\n  return useMutation({\r\n    mutationFn: ({ id, data }: { id: number; data: UpdateMeetingRequest }) => \r\n      apiService.updateMeeting(id, data),\r\n    onSuccess: () => {\r\n      // Invalidate lecturer classes and all class meetings for refreshed schedule/topic\r\n      queryClient.invalidateQueries({ queryKey: ['lecturer-classes'] });\r\n      queryClient.invalidateQueries({ queryKey: ['class-meetings'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useClassMeetings(\r\n  classId?: number,\r\n  options?: Omit<UseQueryOptions<import('../types').MeetingSchedule[], Error>, 'queryKey' | 'queryFn'>\r\n) {\r\n  const key = ['class-meetings', classId ?? null] as const;\r\n  return useQuery<import('../types').MeetingSchedule[], Error>({\r\n    queryKey: key,\r\n    queryFn: () => {\r\n      if (!classId) return Promise.resolve([] as import('../types').MeetingSchedule[]);\r\n      return apiService.getMeetingsByClass(classId);\r\n    },\r\n    enabled: Boolean(classId),\r\n    ...(options ?? {}),\r\n  });\r\n}\r\n"],"names":["useClassStudents","classId","options","useQuery","apiService","res","useMeetingAttendances","meetingId","useCreateAttendance","queryClient","useQueryClient","useMutation","data","_","variables","useUpdateAttendance","id","useUpdateMeeting","useClassMeetings"],"mappings":"qGAIO,SAASA,EACdC,EACAC,EACA,CAEA,OAAOC,EAA6B,CAClC,SAFU,CAAC,iBAAkBF,GAAW,IAAI,EAG5C,QAAS,IACFA,EACEG,EAAW,iBAAiBH,CAAO,EAAE,KAAMI,GAAQ,MAAM,QAAQA,CAAG,EAAIA,EAAM,CAAA,CAAE,EADlE,QAAQ,QAAQ,CAAA,CAAiB,EAGxD,QAAS,EAAQJ,CACD,CACjB,CACH,CAEO,SAASK,EACdC,EACAL,EACA,CAEA,OAAOC,EAAoC,CACzC,SAFU,CAAC,sBAAuBI,GAAa,IAAI,EAGnD,QAAS,IACFA,EACEH,EAAW,sBAAsBG,CAAS,EAAE,KAAMF,GAAQ,MAAM,QAAQA,CAAG,EAAIA,EAAM,CAAA,CAAE,EADvE,QAAQ,QAAQ,CAAA,CAAwB,EAGjE,QAAS,EAAQE,CACD,CACjB,CACH,CAEO,SAASC,GAAsB,CACpC,MAAMC,EAAcC,EAAA,EACpB,OAAOC,EAAY,CACjB,WAAaC,GAAkCR,EAAW,iBAAiBQ,CAAI,EAC/E,UAAW,CAACC,EAAGC,IAAc,CAE3BL,EAAY,kBAAkB,CAAE,SAAU,CAAC,sBAAuBK,EAAU,YAAY,EAAG,CAC7F,CAAA,CACD,CACH,CAEO,SAASC,GAAsB,CACpC,MAAMN,EAAcC,EAAA,EACpB,OAAOC,EAAY,CACjB,WAAY,CAAC,CAAE,GAAAK,EAAI,KAAAJ,KACjBR,EAAW,iBAAiBY,EAAIJ,CAAI,EACtC,UAAW,IAAM,CAEfH,EAAY,kBAAkB,CAAE,SAAU,CAAC,qBAAqB,EAAG,CACrE,CAAA,CACD,CACH,CAEO,SAASQ,GAAmB,CACjC,MAAMR,EAAcC,EAAA,EACpB,OAAOC,EAAY,CACjB,WAAY,CAAC,CAAE,GAAAK,EAAI,KAAAJ,KACjBR,EAAW,cAAcY,EAAIJ,CAAI,EACnC,UAAW,IAAM,CAEfH,EAAY,kBAAkB,CAAE,SAAU,CAAC,kBAAkB,EAAG,EAChEA,EAAY,kBAAkB,CAAE,SAAU,CAAC,gBAAgB,EAAG,CAChE,CAAA,CACD,CACH,CAEO,SAASS,EACdjB,EACAC,EACA,CAEA,OAAOC,EAAsD,CAC3D,SAFU,CAAC,iBAAkBF,GAAW,IAAI,EAG5C,QAAS,IACFA,EACEG,EAAW,mBAAmBH,CAAO,EADvB,QAAQ,QAAQ,CAAA,CAA0C,EAGjF,QAAS,EAAQA,CACD,CACjB,CACH"}