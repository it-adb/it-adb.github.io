import{j as e,u as v}from"./query-vendor-B--u1oZD.js";import{r as p,g as F}from"./react-vendor-XXJdR_Id.js";import{u as q,a as R,g as d,L as Q,f as z,e as k}from"./index-ysxJ7eO1.js";import{u as B}from"./useClasses-C2oyc9Cb.js";import{P as w}from"./PageHeader-7xKs-Qb6.js";import{C as A}from"./Card-DDjmpwhs.js";import{t as j,w as _,c as C,u as S,v as M,x as N}from"./ui-vendor-DMb5NT47.js";const K=({title:o,description:r,icon:i,action:m,className:c=""})=>e.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 ${c}`,children:[i&&e.jsx("div",{className:"mb-4 p-4 bg-gray-100 rounded-full text-gray-400",children:i}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-center",children:o}),r&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 text-center max-w-sm",children:r}),m&&e.jsx("div",{className:"mt-6",children:m})]}),G=()=>{const{user:o}=q(),{t:r}=R(),[i,m]=p.useState(""),{data:c=[],isLoading:L}=B(o?.studentId,i?{semester:i}:void 0),g=p.useMemo(()=>c.map(t=>t.kelas_id),[c]),x=v({queryKey:["student-meetings",g],queryFn:async()=>{if(g.length===0)return{};const t={};return await Promise.all(g.map(async a=>{try{const s=await k.getMeetingsByClass(a);t[a]=s}catch(s){console.error(`Failed to fetch meetings for class ${a}:`,s),t[a]=[]}})),t},enabled:g.length>0}),h=p.useMemo(()=>x.data?Object.values(x.data).flat().map(t=>t.id):[],[x.data]),f=v({queryKey:["student-all-attendances",h],queryFn:async()=>{if(h.length===0)return{};const t={};return await Promise.all(h.map(async a=>{try{const n=(await k.getMeetingAttendances(a)).find(l=>l.nim===o?.studentId);n&&(t[a]=n)}catch(s){console.error(`Failed to fetch attendances for meeting ${a}:`,s)}})),t},enabled:h.length>0}),b=p.useMemo(()=>!x.data||!c.length?[]:c.map(t=>{const a=(x.data?.[t.kelas_id]||[]).sort((n,l)=>n.pertemuan_ke-l.pertemuan_ke),s={course:t,meetings:a.map(n=>({id:n.id,topik:d(n.topik),tgl_pertemuan:typeof n.tgl_pertemuan=="string"?n.tgl_pertemuan:n.tgl_pertemuan?.Time||"",pertemuan_ke:n.pertemuan_ke,attendance:f.data?.[n.id]})),stats:{totalMeetings:a.length,attended:0,excused:0,sick:0,late:0,substitute:0,absent:0,attendancePercentage:0}};if(a.forEach(n=>{const l=f.data?.[n.id];if(l)switch(d(l.status_kehadiran)?.toLowerCase()){case"hadir":case"present":s.stats.attended++;break;case"izin":case"excused":s.stats.excused++;break;case"sakit":case"sick":s.stats.sick++;break;case"terlambat":case"late":s.stats.late++;break;case"pengganti":case"substitute":s.stats.substitute++;break;case"alpa":case"alfa":case"absent":s.stats.absent++;break}}),s.stats.totalMeetings>0){const n=s.stats.attended+s.stats.late+s.stats.substitute;s.stats.attendancePercentage=Math.round(n/s.stats.totalMeetings*100)}return s}).sort((t,a)=>d(t.course.kode_mk||"").localeCompare(d(a.course.kode_mk||""))),[c,x.data,f.data,o?.studentId]),u=p.useMemo(()=>{const t=new Set;return c.forEach(a=>{const s=a.semester;s&&t.add(s)}),Array.from(t).sort().reverse()},[c]);F.useEffect(()=>{!i&&u.length>0&&m(u[0])},[u,i]);const P=L||x.isLoading||f.isLoading,$=t=>{switch(t?.toLowerCase()){case"hadir":case"present":return e.jsx(j,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(C,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(S,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(_,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(j,{className:"h-4 w-4 text-purple-600"});case"alpa":case"alfa":case"absent":return e.jsx(M,{className:"h-4 w-4 text-red-600"});default:return e.jsx(N,{className:"h-4 w-4 text-gray-300"})}},E=t=>t>=80?"text-green-600":t>=70?"text-yellow-600":"text-red-600";return P?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(w,{title:"Attendance Record"}),e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(Q,{})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(w,{title:r("student.attendanceRecord"),subtitle:r("student.viewAttendanceDesc")}),u.length>1&&e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"semester-filter",className:"font-medium text-gray-700",children:"Semester:"}),e.jsx("select",{id:"semester-filter",value:i,onChange:t=>m(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:u.map(t=>e.jsx("option",{value:t,children:t},t))})]})}),b.length===0?e.jsx(K,{title:r("studentAttendance.noCourses"),description:r("studentAttendance.noCoursesDesc")}):e.jsx("div",{className:"space-y-3",children:b.map(t=>e.jsxs(A,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[d(t.course.kode_mk||"")," - ",d(t.course.nama_mk||"")]}),e.jsx("p",{className:"text-xs text-gray-600",children:d(t.course.nama_kelas||"")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`font-bold text-lg ${E(t.stats.attendancePercentage)}`,children:[t.stats.attendancePercentage,"%"]})}),e.jsx("div",{className:"h-8 w-px bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-medium",children:t.stats.attended}),e.jsx("span",{className:"bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-medium",children:t.stats.late}),e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-medium",children:t.stats.excused}),e.jsx("span",{className:"bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-medium",children:t.stats.sick}),e.jsx("span",{className:"bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-medium",children:t.stats.substitute}),e.jsx("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-medium",children:t.stats.absent})]})]})]})}),t.meetings.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:r("studentAttendance.noMeetings")}):e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2 flex-wrap items-start",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 w-full",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3.5 w-3.5 text-green-600"}),e.jsx("span",{children:r("studentAttendance.present")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3.5 w-3.5 text-orange-600"}),e.jsx("span",{children:r("studentAttendance.late")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-3.5 w-3.5 text-blue-600"}),e.jsx("span",{children:r("studentAttendance.excused")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3.5 w-3.5 text-yellow-600"}),e.jsx("span",{children:r("studentAttendance.sick")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3.5 w-3.5 text-purple-600"}),e.jsx("span",{children:r("studentAttendance.substitute")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-3.5 w-3.5 text-red-600"}),e.jsx("span",{children:r("studentAttendance.absent")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3.5 w-3.5 text-gray-400"}),e.jsx("span",{children:r("studentAttendance.notMarked")})]})]})}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:t.meetings.map(a=>{const s=a.attendance,n=s?d(s.status_kehadiran):void 0,l=z(a.tgl_pertemuan),y=l?l.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"";return e.jsxs("div",{className:"flex flex-col items-center gap-1 p-2 rounded border border-gray-200 hover:bg-gray-50 transition-colors cursor-help",title:`Week ${a.pertemuan_ke} - ${y}${a.topik?` - ${d(a.topik)}`:""}`,children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-600",children:["W",a.pertemuan_ke]}),e.jsx("div",{className:"flex justify-center h-6",children:n?$(n):e.jsx(N,{className:"h-5 w-5 text-gray-300"})}),e.jsx("div",{className:"text-xs text-gray-500 text-center leading-tight max-w-12 break-words",children:y})]},a.id)})})]})})]},t.course.kelas_id))})]})};export{G as default};
//# sourceMappingURL=Attendance-CkWGezsR.js.map
