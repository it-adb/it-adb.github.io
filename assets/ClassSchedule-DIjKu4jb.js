import{j as e}from"./query-vendor-B--u1oZD.js";import{r as h,g as O}from"./react-vendor-XXJdR_Id.js";import{u as V,e as C,c as T}from"./index-1e-qg3UH.js";import{u as X,a as ee}from"./useClasses-BSFNMcQW.js";import{g as R}from"./status-sB_rSvKV.js";import{C as se}from"./CheckInModal-CNllqwJZ.js";import{r as te,u as ae,K as I,g as W,N as re,v as z}from"./ui-vendor-C-UqR_Df.js";const ne=y=>{const c=C(y);if(!c)return null;const p=c.getDay();return{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday"}[p]||null},le=y=>{const c=T(y);if(!c)return"00:00";const p=c.split("T")[1]?.split(".")[0]||c.split("T")[1]?.split("Z")[0];return p?p.substring(0,5):new Date(c).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})},ue=()=>{const{user:y}=V(),[c,p]=h.useState([]),[u,$]=h.useState([]),[f,D]=h.useState(""),[j,M]=h.useState(""),[P,E]=h.useState(!1),[Y,A]=h.useState(null),[Z,L]=h.useState(""),q=O.useMemo(()=>{const s={};return f&&(s.start_day=f),j&&(s.end_day=j),s},[f,j]),{data:w,isLoading:G,error:_}=X(y?.studentId||"",q),b=O.useMemo(()=>w??[],[w]),{data:v=[]}=ee(),F=_?_ instanceof Error?_.message:"Failed to load class schedule":null,K=(s,a)=>{A(s),L(a),E(!0)},J=()=>{E(!1),A(null),L("")},S=s=>Array.isArray(v)&&v.some(a=>a.id_pertemuan===s),U=s=>Array.isArray(v)?v.find(a=>a.id_pertemuan===s):void 0,B=s=>{if(!s.actualDate)return{allowed:!1,reason:"Invalid meeting date"};if(S(s.meetingId))return{allowed:!1,reason:"Already checked in"};const[a,t]=s.startTime.split(":").map(Number),r=new Date(s.actualDate);r.setHours(a,t,0,0);const i=new Date,o=new Date(r.getTime()-300*1e3);return i<o?{allowed:!1}:{allowed:!0}},H=s=>{const a=s.toLowerCase();return a==="hadir"?{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}:a==="izin"||a==="sakit"?{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-700",icon:"text-yellow-600"}:a==="alfa"?{border:"border-red-300",bg:"bg-red-50",text:"text-red-700",icon:"text-red-600"}:a==="terlambat"?{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"}:a==="pengganti"?{border:"border-purple-300",bg:"bg-purple-50",text:"text-purple-700",icon:"text-purple-600"}:{border:"border-green-300",bg:"bg-green-50",text:"text-green-700",icon:"text-green-600"}},Q=s=>{if(!s)return null;try{const a=new Date(s);return isNaN(a.getTime())?null:{date:a.toLocaleDateString("id-ID",{day:"numeric",month:"short"}),time:a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}}catch{return null}};return h.useEffect(()=>{const s=[];(w??[]).forEach(a=>{a.meeting_schedules.forEach(t=>{const r=ne(t.tgl_pertemuan);if(!r)return;const i=le(t.jam_pertemuan),o=C(t.tgl_pertemuan);if(!o)return;const x=a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,N=x*60,[g,m]=i.split(":").map(Number),d=g*60+m+N,n=Math.floor(d/60)%24,l=d%60,k=`${String(n).padStart(2,"0")}:${String(l).padStart(2,"0")}`;s.push({id:`${a.kelas_id}-${t.id}`,day:r,startTime:i,endTime:k,courseCode:a.kode_mk,courseName:a.nama_mk,className:a.nama_kelas,credits:x,room:T(t.media_pembelajaran,"TBA"),topic:T(t.topik,""),weekNumber:t.pertemuan_ke,classId:a.kelas_id,actualDate:o,meetingId:t.id})})}),p(s)},[w]),G?e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"h-8 w-8 animate-spin text-primary-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading class schedule..."})]})})}):F?e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class & Schedule"}),e.jsx("div",{className:"card bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-3 text-red-800",children:[e.jsx(ae,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error loading schedule"}),e.jsx("p",{className:"text-sm mt-1",children:F})]})]})})]}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 lg:space-y-6",children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold text-gray-900",children:"Class & Schedule"}),e.jsxs("div",{className:"card grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(I,{className:"h-5 w-5 text-primary-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Classes Enrolled"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[b.length," classes"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Total Meetings"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[c.length," sessions"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:col-span-2 lg:col-span-1",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"Total Credits"}),e.jsxs("div",{className:"text-base lg:text-lg font-semibold",children:[b.reduce((s,a)=>s+a.sks_tatap_muka+a.sks_praktek+a.sks_prak_lapangan+a.sks_simulasi,0)," SKS"]})]})]})]}),b.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Classes Found"}),e.jsx("p",{className:"text-gray-600",children:"You are not enrolled in any classes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4",children:"Enrolled Classes"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:b.map(s=>{const a=s.sks_tatap_muka+s.sks_praktek+s.sks_prak_lapangan+s.sks_simulasi,t=s.meeting_schedules.length;return e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:e.jsx("span",{className:"text-xs font-semibold text-primary-600",children:s.kode_mk})}),e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2 mb-1",children:s.nama_mk}),s.bahasan&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:s.bahasan})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-x-2 gap-y-0.5 text-xs text-gray-500 border-t border-gray-100 pt-2",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[a," SKS"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t," meetings"]}),s.mode_kuliah&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"text-gray-600 hidden sm:inline",children:s.mode_kuliah})]})]})]},s.kelas_id)})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 lg:mb-4 flex-wrap gap-3",children:e.jsx("h2",{className:"text-base lg:text-lg font-semibold text-gray-900",children:"List of Schedules"})}),e.jsx("div",{className:"mb-4 lg:mb-6 pb-3 lg:pb-4 border-b border-gray-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3",children:"Filter by Course"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from(new Set(c.map(s=>s.courseCode))).map(s=>{const a=c.find(r=>r.courseCode===s)?.courseName,t=u.includes(s);return e.jsxs("button",{onClick:()=>{$(t?u.filter(r=>r!==s):[...u,s])},className:`px-2.5 lg:px-3 py-1.5 text-xs font-medium rounded-lg transition-all cursor-pointer ${t?"bg-primary-600 text-white border border-primary-600 hover:bg-primary-700":"bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200 hover:border-gray-300"}`,title:`${s} - ${a}`,type:"button",children:[e.jsxs("span",{className:"hidden sm:inline",children:[s," - ",a]}),e.jsx("span",{className:"sm:hidden",children:a})]},s)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2 lg:mb-3",children:"Filter by Date"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:f,onChange:s=>D(s.target.value),className:"input-field w-full text-xs",placeholder:"Start date"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:j,onChange:s=>M(s.target.value),className:"input-field w-full text-xs",placeholder:"End date"})}),(f||j)&&e.jsx("button",{onClick:()=>{D(""),M("")},className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-lg hover:bg-gray-200 hover:border-gray-300 transition-all cursor-pointer whitespace-nowrap",type:"button",children:"Clear Dates"})]})]})]})}),(()=>{let s=c;u.length>0&&(s=s.filter(t=>u.includes(t.courseCode)));const a=[...s].sort((t,r)=>{if(!t.actualDate||!r.actualDate)return 0;const i=t.actualDate.getTime()-r.actualDate.getTime();return i!==0?i:t.startTime.localeCompare(r.startTime)});return a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No meetings match the selected filters."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"lg:hidden space-y-2",children:a.map((t,r)=>{const i=b.find(l=>l.kelas_id===t.classId),o=i?.meeting_schedules.find(l=>`${i.kelas_id}-${l.id}`===t.id),x=o?C(o.tgl_pertemuan):null,N=x?x.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"",g=S(t.meetingId),m=B(t),d=U(t.meetingId),n=d?H(d.status_kehadiran):null;return e.jsxs("div",{className:`p-3 border rounded-lg ${g&&n?`${n.border} ${n.bg}`:"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 text-xs font-semibold rounded",children:t.day}),e.jsx("span",{className:"text-xs text-gray-600",children:N})]}),g&&n&&e.jsx(z,{className:`h-4 w-4 ${n.icon} flex-shrink-0`})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-primary-600 flex-shrink-0",children:t.courseCode}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:t.courseName})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:e.jsxs("span",{children:["Week ",t.weekNumber]})}),e.jsx("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.startTime," - ",t.endTime]})]})}),g&&d&&n?e.jsx("div",{className:`text-xs ${n.text} font-medium pt-2 border-t ${n.border}`,children:(()=>{const l=Q(d.waktu_masuk);return l?`✓ Checked in: ${l.date} ${l.time} (${R(d.status_kehadiran)})`:"✓ Checked in"})()}):m.allowed?e.jsx("button",{onClick:()=>K(t.meetingId,t.courseName),className:"w-full text-xs px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all cursor-pointer font-medium mt-2",type:"button",children:"Check In"}):e.jsx("div",{className:"text-xs text-gray-500 italic text-center py-1 mt-2",children:m.reason})]})]},`${t.id}-${r}-mobile`)})}),e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Day"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Course Code"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-700",children:"Course Name"}),e.jsx("th",{className:"px-3 py-2 text-center font-semibold text-gray-700",children:"Week"}),e.jsx("th",{className:"px-3 py-2 text-center font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:a.map((t,r)=>{const i=b.find(k=>k.kelas_id===t.classId),o=i?.meeting_schedules.find(k=>`${i.kelas_id}-${k.id}`===t.id),x=o?C(o.tgl_pertemuan):null,N=x?x.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"",g=r%2===0,m=S(t.meetingId),d=B(t),n=U(t.meetingId),l=n?H(n.status_kehadiran):null;return e.jsxs("tr",{className:`border-b border-gray-200 transition-colors ${m&&l?l.bg:g?"bg-white hover:bg-blue-50":"bg-gray-50 hover:bg-blue-50"}`,children:[e.jsx("td",{className:"px-3 py-2 text-center",children:m&&l&&e.jsx(z,{className:`h-4 w-4 ${l.icon} inline`})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"inline-block px-2 py-0.5 bg-primary-100 text-primary-700 font-semibold rounded",children:t.day})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-gray-600",children:N}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap text-gray-600",children:[t.startTime," - ",t.endTime]}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap font-semibold text-primary-600",children:t.courseCode}),e.jsx("td",{className:"px-3 py-2 max-w-xs",children:e.jsx("div",{className:"truncate text-gray-900 font-medium",children:t.courseName})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-600 whitespace-nowrap",children:t.weekNumber}),e.jsx("td",{className:"px-3 py-2 text-center whitespace-nowrap",children:m&&n&&l?e.jsxs("span",{className:`text-xs ${l.text} font-medium whitespace-nowrap`,children:["✓ ",new Date(n.waktu_masuk).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ",new Date(n.waktu_masuk).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})," ","(",R(n.status_kehadiran),")"]}):d.allowed?e.jsx("button",{onClick:()=>K(t.meetingId,t.courseName),className:"text-xs px-2 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-all cursor-pointer font-medium",type:"button",children:"Check In"}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{disabled:!0,className:"text-xs px-2 py-1 bg-gray-300 text-gray-500 rounded cursor-not-allowed",title:d.reason,children:"Check In"}),e.jsx("span",{className:"text-xs text-gray-500 italic max-w-[120px] text-center",children:d.reason})]})})]},`${t.id}-${r}`)})})]})})]})})()]})]}),e.jsx(se,{isOpen:P,meetingId:Y,courseName:Z,onClose:J})]})};export{ue as default};
//# sourceMappingURL=ClassSchedule-DIjKu4jb.js.map
