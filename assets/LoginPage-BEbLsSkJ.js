const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ysxJ7eO1.js","assets/query-vendor-B--u1oZD.js","assets/react-vendor-XXJdR_Id.js","assets/ui-vendor-DMb5NT47.js","assets/index-76orekET.css"])))=>i.map(i=>d[i]);
import{j as e,_ as A}from"./query-vendor-B--u1oZD.js";import{r,c as Q}from"./react-vendor-XXJdR_Id.js";import{u as X,a as Y,b as Z,l as G,c as ee,i as se,r as D,E as C,d as te,e as T}from"./index-ysxJ7eO1.js";import{E as ae,m as re,s as B,p as ne}from"./ui-vendor-DMb5NT47.js";const de=()=>{const{isAuthenticated:F,login:f}=X(),{t:s}=Y(),{language:m,setLanguage:v}=Z(),[l,P]=r.useState(!1),[i,g]=r.useState(!1),[x,p]=r.useState(!1),[_,u]=r.useState(""),[b,O]=r.useState(""),[y,U]=r.useState(""),[j,$]=r.useState(!1),[V,w]=r.useState(!1),d=r.useRef(null),o=r.useRef(!0),h=C.googleClientId,z=C.isDevelopment,k=r.useCallback(async t=>{try{g(!0),u("");try{await f(t)}catch(n){throw u(s("auth.userNotFound")),n}}catch(n){G.error("Google login error:",n)}finally{g(!1)}},[f,s]);r.useEffect(()=>{o.current=!0,g(!0),p(!1);const t=setTimeout(()=>{o.current&&ee().then(()=>{o.current&&(te(),p(!0),se(h,k),d.current&&D(d.current))}).catch(n=>{G.error("Failed to load Google Identity Services:",n),o.current&&p(!1)}).finally(()=>{o.current&&g(!1)})},100);return()=>{o.current=!1,clearTimeout(t)}},[h,k]),r.useEffect(()=>{if(x&&d.current&&!i&&!l){const t=setTimeout(()=>{o.current&&d.current&&D(d.current)},50);return()=>clearTimeout(t)}},[x,i,l]);const K=async t=>{if(t.preventDefault(),u(""),!b||!y){u(s("loginPage.error"));return}P(!0);try{const n=await T.login(b,y),S=await T.getCurrentUser(),c={access_token:n.access_token,refresh_token:n.refresh_token,roles:S.roles,user:S.user},{extractString:M}=await A(async()=>{const{extractString:a}=await import("./index-ysxJ7eO1.js").then(N=>N.s);return{extractString:a}},__vite__mapDeps([0,1,2,3,4])),{getPrimaryRole:W}=await A(async()=>{const{getPrimaryRole:a}=await import("./index-ysxJ7eO1.js").then(N=>N.n);return{getPrimaryRole:a}},__vite__mapDeps([0,1,2,3,4])),E=c.roles.map(a=>a.role),q=W(E),H=M(c.user.name,c.user.email.split("@")[0]);let L,I,R;for(const a of c.roles)a.entity_type==="mahasiswa"&&a.entity_id?L=a.entity_id:a.entity_type==="dosen"&&a.entity_id?I=a.entity_id:a.entity_type==="applicant"&&a.entity_id&&(R=a.entity_id);const J={id:String(c.user.id),email:c.user.email,name:H,role:q,availableRoles:E,studentId:L,employeeId:I,applicationId:R,roleEntities:c.roles};await f(J)}catch(n){console.error("Login failed:",n),u(n instanceof Error?n.message:s("auth.loginFailed"))}finally{P(!1)}};return F?e.jsx(Q,{to:"/dashboard",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx("img",{src:"/logo.png",alt:"ADB Academic System Logo",className:"w-16 h-16 object-contain"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ADB Academic System"}),e.jsx("p",{className:"text-gray-600",children:s("loginPage.subtitle")})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"space-y-6",children:[_&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium",children:s("loginPage.error")}),e.jsx("p",{className:"mt-1",children:_})]}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("strong",{children:"Kesulitan login dengan Google?"}),' Gunakan email sebagai username dan nama email diikuti "ADB" sebagai password.',e.jsx("br",{}),e.jsx("br",{}),"Contoh: untuk email ",e.jsx("code",{className:"text-blue-700",children:"john.doe@digitalbdg.ac.id"}),", gunakan username: ",e.jsx("code",{className:"text-blue-700",children:"john.doe@digitalbdg.ac.id"})," dan password: ",e.jsx("code",{className:"text-blue-700",children:"john.doeADB"}),e.jsx("br",{}),e.jsx("br",{}),"Setelah berhasil login, anda dapat mengubah password Anda di dengan membuka profil anda di kanan atas kemudian memilih menu settings."]}),e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:s("loginPage.username")}),e.jsx("input",{id:"username",type:"text",value:b,onChange:t=>O(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:s("loginPage.username"),disabled:l||i})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:s("loginPage.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:j?"text":"password",value:y,onChange:t=>U(t.target.value),className:"w-full pr-10 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:s("loginPage.password"),disabled:l||i}),e.jsx("button",{type:"button",onClick:()=>$(t=>!t),disabled:l||i,className:"absolute inset-y-0 right-2 flex items-center px-2 text-gray-500","aria-label":s(j?"loginPage.hidePassword":"loginPage.showPassword"),tabIndex:0,children:j?e.jsx(ae,{className:"h-5 w-5"}):e.jsx(re,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:l||i,className:"w-full btn-primary flex items-center justify-center",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),s("loginPage.loggingIn")]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),s("loginPage.login")]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:s("common.or")})})]}),e.jsxs("div",{className:"w-full flex flex-col items-center",children:[(i||l)&&e.jsxs("div",{className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg bg-white text-sm text-gray-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-600 mr-3"}),s(i?"loginPage.googleLoading":"auth.loading")]}),!i&&!l&&x&&h&&e.jsx("div",{ref:d,className:"w-full flex justify-center"}),!i&&!l&&(!x||!h)&&e.jsxs("button",{disabled:!0,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-700 opacity-60",children:[e.jsx(B,{className:"h-5 w-5 mr-3"}),s("loginPage.clientIdMissing")]})]}),z]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:s("common.agreeTerms")})})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>w(t=>!t),className:"flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s(`language.${m}`)})]}),V&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{v("id"),w(!1)},className:`block w-full text-left px-4 py-2 text-sm cursor-pointer ${m==="id"?"bg-primary-50 text-primary-700 font-medium":"text-gray-700 hover:bg-gray-100"}`,children:[s("language.id"),m==="id"&&e.jsx("span",{className:"ml-2 text-primary-600",children:"✓"})]}),e.jsxs("button",{onClick:()=>{v("en"),w(!1)},className:`block w-full text-left px-4 py-2 text-sm cursor-pointer ${m==="en"?"bg-primary-50 text-primary-700 font-medium":"text-gray-700 hover:bg-gray-100"}`,children:[s("language.en"),m==="en"&&e.jsx("span",{className:"ml-2 text-primary-600",children:"✓"})]})]})})]})}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:"© 2024 ADB Academic System. All rights reserved."})]})})};export{de as default};
//# sourceMappingURL=LoginPage-BEbLsSkJ.js.map
