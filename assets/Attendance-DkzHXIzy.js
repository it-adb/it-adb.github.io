import{j as e,u as v}from"./query-vendor-B--u1oZD.js";import{r as u,g as E}from"./react-vendor-XXJdR_Id.js";import{u as F,c as l,L as q,e as R,b as k}from"./index-C1kkCffi.js";import{u as Q}from"./useClasses-K0xObK0J.js";import{P as w}from"./PageHeader-DTel3EaW.js";import{C as _}from"./Card-DDjmpwhs.js";import{r as f,u as S,c as C,s as M,t as A,v as N}from"./ui-vendor-DIF6S0il.js";const z=({title:x,description:i,icon:o,action:n,className:j=""})=>e.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 ${j}`,children:[o&&e.jsx("div",{className:"mb-4 p-4 bg-gray-100 rounded-full text-gray-400",children:o}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-center",children:x}),i&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 text-center max-w-sm",children:i}),n&&e.jsx("div",{className:"mt-6",children:n})]}),U=()=>{const{user:x}=F(),[i,o]=u.useState(""),{data:n=[],isLoading:j}=Q(x?.studentId,i?{semester:i}:void 0),p=u.useMemo(()=>n.map(s=>s.kelas_id),[n]),d=v({queryKey:["student-meetings",p],queryFn:async()=>{if(p.length===0)return{};const s={};return await Promise.all(p.map(async a=>{try{const t=await k.getMeetingsByClass(a);s[a]=t}catch(t){console.error(`Failed to fetch meetings for class ${a}:`,t),s[a]=[]}})),s},enabled:p.length>0}),g=u.useMemo(()=>d.data?Object.values(d.data).flat().map(s=>s.id):[],[d.data]),h=v({queryKey:["student-all-attendances",g],queryFn:async()=>{if(g.length===0)return{};const s={};return await Promise.all(g.map(async a=>{try{const r=(await k.getMeetingAttendances(a)).find(c=>c.nim===x?.studentId);r&&(s[a]=r)}catch(t){console.error(`Failed to fetch attendances for meeting ${a}:`,t)}})),s},enabled:g.length>0}),b=u.useMemo(()=>!d.data||!n.length?[]:n.map(s=>{const a=(d.data?.[s.kelas_id]||[]).sort((r,c)=>r.pertemuan_ke-c.pertemuan_ke),t={course:s,meetings:a.map(r=>({id:r.id,topik:l(r.topik),tgl_pertemuan:typeof r.tgl_pertemuan=="string"?r.tgl_pertemuan:r.tgl_pertemuan?.Time||"",pertemuan_ke:r.pertemuan_ke,attendance:h.data?.[r.id]})),stats:{totalMeetings:a.length,attended:0,excused:0,sick:0,late:0,substitute:0,absent:0,attendancePercentage:0}};if(a.forEach(r=>{const c=h.data?.[r.id];if(c)switch(l(c.status_kehadiran)?.toLowerCase()){case"hadir":case"present":t.stats.attended++;break;case"izin":case"excused":t.stats.excused++;break;case"sakit":case"sick":t.stats.sick++;break;case"terlambat":case"late":t.stats.late++;break;case"pengganti":case"substitute":t.stats.substitute++;break;case"alpa":case"alfa":case"absent":t.stats.absent++;break}}),t.stats.totalMeetings>0){const r=t.stats.attended+t.stats.late+t.stats.substitute;t.stats.attendancePercentage=Math.round(r/t.stats.totalMeetings*100)}return t}).sort((s,a)=>l(s.course.kode_mk||"").localeCompare(l(a.course.kode_mk||""))),[n,d.data,h.data,x?.studentId]),m=u.useMemo(()=>{const s=new Set;return n.forEach(a=>{const t=a.semester;t&&s.add(t)}),Array.from(s).sort().reverse()},[n]);E.useEffect(()=>{!i&&m.length>0&&o(m[0])},[m,i]);const L=j||d.isLoading||h.isLoading,P=s=>{switch(s?.toLowerCase()){case"hadir":case"present":return e.jsx(f,{className:"h-4 w-4 text-green-600"});case"izin":case"excused":return e.jsx(C,{className:"h-4 w-4 text-blue-600"});case"sakit":case"sick":return e.jsx(M,{className:"h-4 w-4 text-yellow-600"});case"terlambat":case"late":return e.jsx(S,{className:"h-4 w-4 text-orange-600"});case"pengganti":case"substitute":return e.jsx(f,{className:"h-4 w-4 text-purple-600"});case"alpa":case"alfa":case"absent":return e.jsx(A,{className:"h-4 w-4 text-red-600"});default:return e.jsx(N,{className:"h-4 w-4 text-gray-300"})}},$=s=>s>=80?"text-green-600":s>=70?"text-yellow-600":"text-red-600";return L?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(w,{title:"Attendance Record"}),e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(q,{})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(w,{title:"Attendance Record",subtitle:"View your attendance for all enrolled courses"}),m.length>1&&e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"semester-filter",className:"font-medium text-gray-700",children:"Semester:"}),e.jsx("select",{id:"semester-filter",value:i,onChange:s=>o(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:m.map(s=>e.jsx("option",{value:s,children:s},s))})]})}),b.length===0?e.jsx(z,{title:"No Courses Found",description:"You don't have any enrolled courses for the selected semester."}):e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsxs(_,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[l(s.course.kode_mk||"")," - ",l(s.course.nama_mk||"")]}),e.jsx("p",{className:"text-xs text-gray-600",children:l(s.course.nama_kelas||"")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`font-bold text-lg ${$(s.stats.attendancePercentage)}`,children:[s.stats.attendancePercentage,"%"]})}),e.jsx("div",{className:"h-8 w-px bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-medium",children:s.stats.attended}),e.jsx("span",{className:"bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-medium",children:s.stats.late}),e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-medium",children:s.stats.excused}),e.jsx("span",{className:"bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-medium",children:s.stats.sick}),e.jsx("span",{className:"bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-medium",children:s.stats.substitute}),e.jsx("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-medium",children:s.stats.absent})]})]})]})}),s.meetings.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No meetings recorded for this course."}):e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2 flex-wrap items-start",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 w-full",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-3.5 w-3.5 text-green-600"}),e.jsx("span",{children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3.5 w-3.5 text-orange-600"}),e.jsx("span",{children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-3.5 w-3.5 text-blue-600"}),e.jsx("span",{children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-3.5 w-3.5 text-yellow-600"}),e.jsx("span",{children:"Sick"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-3.5 w-3.5 text-purple-600"}),e.jsx("span",{children:"Substitute"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3.5 w-3.5 text-red-600"}),e.jsx("span",{children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3.5 w-3.5 text-gray-400"}),e.jsx("span",{children:"Not Marked"})]})]})}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:s.meetings.map(a=>{const t=a.attendance,r=t?l(t.status_kehadiran):void 0,c=R(a.tgl_pertemuan),y=c?c.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"";return e.jsxs("div",{className:"flex flex-col items-center gap-1 p-2 rounded border border-gray-200 hover:bg-gray-50 transition-colors cursor-help",title:`Week ${a.pertemuan_ke} - ${y}${a.topik?` - ${l(a.topik)}`:""}`,children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-600",children:["W",a.pertemuan_ke]}),e.jsx("div",{className:"flex justify-center h-6",children:r?P(r):e.jsx(N,{className:"h-5 w-5 text-gray-300"})}),e.jsx("div",{className:"text-xs text-gray-500 text-center leading-tight max-w-12 break-words",children:y})]},a.id)})})]})})]},s.course.kelas_id))})]})};export{U as default};
//# sourceMappingURL=Attendance-DkzHXIzy.js.map
