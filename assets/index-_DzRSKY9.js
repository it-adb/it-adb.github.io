import{u as k,j as e}from"./query-vendor-B--u1oZD.js";import{r as i,u as L}from"./react-vendor-XXJdR_Id.js";import{g as h,f as _,e as S,k as p,u as Q,a as I}from"./index-BYG0ekbM.js";import{u as T}from"./client-7ZBPrXqt.js";import{u as F}from"./usePrograms-Bc43pFBX.js";import{x as B,s as A,u as U,i as Y,f as R,a2 as q,p as K,G,b as M,B as C,I as O,a0 as V,t as W}from"./ui-vendor-CkH0jJa3.js";const H=s=>(s.sks_tatap_muka||0)+(s.sks_praktek||0)+(s.sks_prak_lapangan||0)+(s.sks_simulasi||0),X=s=>{switch(s){case"Online":return"bg-blue-100 text-blue-700";case"Offline":return"bg-green-100 text-green-700";case"Hybrid":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},z=s=>s?s.toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",J=s=>{if(!s||s.length<5)return"Unknown Semester";const r=s.slice(0,4),o=s.slice(4)==="1"?"Ganjil":"Genap";return`${`${r}/${parseInt(r)+1}`} ${o}`},Z=s=>{if(typeof s=="boolean")return s;if(s&&typeof s=="object"&&"Bool"in s){const r=s;return!!(r.Valid&&r.Bool)}return!1},ee=({meetings:s,totalStudents:r})=>{const o=i.useMemo(()=>s.map(a=>a.id),[s]),d=k({queryKey:["admin-meeting-attendances-batch",o],queryFn:async()=>{if(o.length===0)return{};try{const a=await S.getMeetingsBatch({meeting_ids:o,include_attendance_count:!0}),l={};return a.forEach(u=>{l[u.id]=u.total_attendances??0}),l}catch{return{}}},enabled:o.length>0}),m=i.useMemo(()=>s.map(a=>{const l=d.data?.[a.id]??0,u=r>0&&l>=r,N=!!h(a.idDosen??a.id_dosen);return{id:a.id,weekNumber:a.pertemuan_ke,date:_(a.tgl_pertemuan),topic:h(a.topik,""),studentAttendanceComplete:u,lecturerAssigned:N,totalStudents:r,recordedAttendances:l,absensiAktif:Z(a.absensi_aktif)}}).sort((a,l)=>a.weekNumber-l.weekNumber),[s,d.data,r]);return d.isFetching?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(B,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Loading meeting recap..."})]}):m.length===0?e.jsx("div",{className:"text-gray-500 text-[11px]",children:"No meetings scheduled"}):e.jsx("div",{className:"flex gap-1 flex-wrap",children:m.map(a=>{const l=a.date?a.date.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"-";return e.jsxs("div",{className:"flex flex-col items-center gap-1 p-2 rounded border border-gray-200 bg-white shadow-sm min-w-[80px]",title:`Week ${a.weekNumber} - ${l}${a.topic?` - ${a.topic}`:""}
Student Attendance: ${a.recordedAttendances}/${a.totalStudents}
Lecturer Assigned: ${a.lecturerAssigned?"Yes":"No"}
Attendance: ${a.absensiAktif?"Active":"Inactive"}`,children:[e.jsxs("div",{className:"text-[11px] font-semibold text-gray-700",children:["W",a.weekNumber]}),e.jsxs("div",{className:"flex gap-1 items-center justify-center h-5",children:[a.studentAttendanceComplete?e.jsx(A,{className:"h-4 w-4 text-green-600"}):a.recordedAttendances>0?e.jsx(A,{className:"h-4 w-4 text-orange-500"}):e.jsx(U,{className:"h-4 w-4 text-gray-300"}),a.lecturerAssigned?e.jsx(Y,{className:"h-4 w-4 text-blue-600"}):e.jsx(Y,{className:"h-4 w-4 text-gray-300"})]}),e.jsx("div",{className:"text-[11px] text-gray-500 text-center leading-tight",children:l}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:`h-2 w-2 rounded-full ${a.absensiAktif?"bg-green-600":"bg-gray-400"}`})})]},a.id)})})},se=({kelas:s,courseCode:r,courseName:o})=>{const d=L(),m=k({queryKey:["admin-class-meetings",s.id],queryFn:async()=>{try{return await S.getMeetingsByClass(s.id)}catch{return[]}}}),a=k({queryKey:["admin-class-students",s.id],queryFn:async()=>{try{const x=await S.getClassStudents(s.id);return Array.isArray(x)?x.length:0}catch{return 0}}}),l=i.useMemo(()=>m.data??[],[m.data]),u=i.useMemo(()=>a.data??0,[a.data]);return e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-xs hover:bg-gray-100 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900 whitespace-nowrap",children:["Class ",h(s.nama_kelas)]}),h(s.mode_kuliah)&&e.jsx("span",{className:`px-1.5 py-0.5 text-xs font-medium rounded whitespace-nowrap ${X(h(s.mode_kuliah))}`,children:h(s.mode_kuliah)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600 flex-wrap",children:[_(s.tgl_mulai)&&e.jsx("span",{className:"whitespace-nowrap",children:z(_(s.tgl_mulai))}),p(s.sks_tatap_muka)>0&&e.jsxs("span",{className:"whitespace-nowrap",children:[p(s.sks_tatap_muka),"SKS"]}),e.jsxs("button",{onClick:x=>{x.stopPropagation(),d(`/class-summary/${s.id}?courseCode=${encodeURIComponent(r)}&courseName=${encodeURIComponent(o)}&className=${encodeURIComponent(h(s.nama_kelas))}&sksTatapMuka=${p(s.sks_tatap_muka)}&sksPraktek=${p(s.sks_praktek)}&sksPrakLapangan=${p(s.sks_prak_lapangan)}&sksSimulasi=${p(s.sks_simulasi)}&from=admin/class-management`)},className:"ml-2 px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1 whitespace-nowrap",title:"View attendance matrix",children:[e.jsx(R,{className:"h-3 w-3"}),e.jsx("span",{children:"Summary"})]})]})]}),h(s.bahasan)&&e.jsx("p",{className:"text-gray-600 mt-1",children:h(s.bahasan)}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-600 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Meeting Recap"}),e.jsx("span",{className:"whitespace-nowrap",children:l.length?`${l.length} meeting${l.length!==1?"s":""}`:"No meetings"})]}),e.jsx(ee,{meetings:l,totalStudents:u})]})]})},ae=({course:s,isExpanded:r,onToggleExpand:o})=>{const d=s.classes&&s.classes.length>0;return e.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between gap-2 cursor-pointer",onClick:()=>d&&o(),children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:d&&e.jsx("div",{className:"text-gray-400",children:r?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 text-xs font-medium rounded whitespace-nowrap",children:s.kode_mk}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:s.nama_mk}),s.jenis_mk&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded whitespace-nowrap",children:s.jenis_mk})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-0.5 whitespace-nowrap",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[H(s)," SKS"]})]}),d&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 font-medium rounded whitespace-nowrap",children:[s.classes.length," classes"]})]})]})}),r&&d&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:s.classes.map(m=>e.jsx(se,{kelas:m,courseCode:s.kode_mk,courseName:s.nama_mk},m.id))})]})},de=()=>{const{currentSemester:s}=Q(),{t:r}=I(),[o,d]=i.useState([]),[m,a]=i.useState([]),[l,u]=i.useState(null),[x,N]=i.useState(new Set),[n,$]=i.useState({searchQuery:"",filterProgram:"all",filterYear:"",filterTerm:"1"}),y=i.useMemo(()=>n.filterYear?`${n.filterYear}${n.filterTerm}`:"",[n.filterYear,n.filterTerm]),{data:b}=F(),{data:w,error:g}=T(i.useMemo(()=>y?{semester:y,include_classes:!0}:void 0,[y]));i.useEffect(()=>{b&&a(b)},[b]),i.useEffect(()=>{if(g){const t=g instanceof Error?g.message:"Failed to load courses";u(t),d([])}else u(null)},[g]),i.useEffect(()=>{Array.isArray(w)&&d(w)},[w]),i.useEffect(()=>{if(s&&!n.filterYear){const t=s.slice(0,4),c=s.slice(4);$(v=>({...v,filterYear:t,filterTerm:c}))}},[s,n.filterYear]);const f=i.useMemo(()=>{let t=o;return n.searchQuery&&(t=t.filter(c=>c.nama_mk.toLowerCase().includes(n.searchQuery.toLowerCase())||c.kode_mk.toLowerCase().includes(n.searchQuery.toLowerCase()))),n.filterProgram!=="all"&&(t=t.filter(c=>c.kode_prodi===n.filterProgram)),t},[o,n.searchQuery,n.filterProgram]),E=f.length,P=f.reduce((t,c)=>t+(c.classes?.length||0),0),j=(t,c)=>{$(v=>({...v,[t]:c}))},D=t=>{const c=new Set(x);c.has(t)?c.delete(t):c.add(t),N(c)};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Class Management"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-500",children:"Current Semester:"}),e.jsx("span",{className:"font-medium text-gray-900",children:J(s)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(C,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Courses"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:E})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(C,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:r("adminClasses.totalClasses")}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:P})]})]})})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:r("adminClasses.searchPlaceholder"),value:n.searchQuery,onChange:t=>j("searchQuery",t.target.value),className:"input-field pl-10 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(M,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",value:n.filterYear,onChange:t=>j("filterYear",t.target.value),placeholder:r("adminClasses.year"),className:"input-field w-[80px] text-center",min:new Date().getFullYear()-10,max:new Date().getFullYear()+5}),e.jsx("span",{className:"text-gray-500 font-medium",children:"/"}),e.jsx("input",{type:"number",value:n.filterYear?parseInt(n.filterYear)+1:"",disabled:!0,className:"input-field w-[80px] text-center bg-gray-50 text-gray-600",readOnly:!0})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs("select",{value:n.filterTerm,onChange:t=>j("filterTerm",t.target.value),className:"input-field min-w-[120px]",children:[e.jsx("option",{value:"1",children:r("adminClasses.ganjil")}),e.jsx("option",{value:"2",children:r("adminClasses.genap")})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(V,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("select",{value:n.filterProgram,onChange:t=>j("filterProgram",t.target.value),className:"input-field min-w-[200px]",children:[e.jsx("option",{value:"all",children:r("adminClasses.allPrograms")}),m.map(t=>e.jsxs("option",{value:t.kode_prodi,children:[t.nama_prodi," (",t.kode_prodi,")"]},t.kode_prodi))]})]})]})}),l&&e.jsx("div",{className:"card bg-red-50 border-red-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(W,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r("adminClasses.errorLoading")}),e.jsx("p",{className:"text-sm text-red-600",children:l})]})]})}),f.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 mb-2",children:r("adminClasses.noCourses")}),e.jsx("p",{className:"text-sm text-gray-400",children:n.searchQuery||n.filterProgram!=="all"?r("adminClasses.tryAdjusting"):r("adminClasses.noCoursesAvailable")})]}):e.jsx("div",{className:"space-y-2",children:f.map(t=>e.jsx(ae,{course:t,isExpanded:x.has(t.kode_mk),onToggleExpand:()=>D(t.kode_mk)},t.kode_mk))})]})};export{de as default};
//# sourceMappingURL=index-_DzRSKY9.js.map
