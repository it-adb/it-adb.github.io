import{u as T,b as y,c as b,j as e}from"./query-vendor-B--u1oZD.js";import{r as l}from"./react-vendor-XXJdR_Id.js";import{e as m}from"./index-BYG0ekbM.js";import{f as j,c as f,s as v,u as N,I as D,a0 as Q}from"./ui-vendor-CkH0jJa3.js";function K(t,i){return T({queryKey:["role-requests",t??"all"],queryFn:()=>m.getRoleRequests(t)})}function U(t){const i=y();return b({mutationFn:({requestId:r})=>m.approveRoleRequest(r),onSuccess:(...r)=>{i.invalidateQueries({queryKey:["role-requests"]})},...t})}function I(t){const i=y();return b({mutationFn:({requestId:r,reason:x})=>m.rejectRoleRequest(r,x),onSuccess:(...r)=>{i.invalidateQueries({queryKey:["role-requests"]})},...t})}const G=()=>{const[t,i]=l.useState([]),[r,x]=l.useState([]),[w,R]=l.useState(!0),[n,q]=l.useState(""),[c,C]=l.useState("all"),[p,d]=l.useState(null),{data:u,isLoading:h}=K(c==="all"?void 0:c),{mutateAsync:S,isPending:A}=U(),{mutateAsync:L,isPending:F}=I();l.useEffect(()=>{R(h)},[h]),l.useEffect(()=>{Array.isArray(u)&&i(u)},[u]);const g=l.useCallback(()=>{let s=t;c!=="all"&&(s=s.filter(a=>a.status===c)),n&&(s=s.filter(a=>a.user_id.toLowerCase().includes(n.toLowerCase())||a.requested_role.toLowerCase().includes(n.toLowerCase())||a.reason.toLowerCase().includes(n.toLowerCase()))),x(s)},[t,n,c]);l.useEffect(()=>{g()},[g]);const k=async s=>{try{d(s),await S({requestId:s}),alert("Role request approved successfully")}catch(a){alert("Failed to approve request: "+a.message)}finally{d(null)}},P=async s=>{const a=prompt("Enter rejection reason (optional):");if(a!==null)try{d(s),await L({requestId:s,reason:a||void 0}),alert("Role request rejected")}catch(M){alert("Failed to reject request: "+M.message)}finally{d(null)}},E=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},_=s=>({student:"Mahasiswa",lecturer:"Dosen",admin:"Admin",staff:"Staff",alumni:"Alumni",student_applicant:"Calon Mahasiswa",guest:"Tamu"})[s]||s,o={total:t.length,pending:t.filter(s=>s.status==="pending").length,approved:t.filter(s=>s.status==="approved").length,rejected:t.filter(s=>s.status==="rejected").length};return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Role Request Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Review and manage user role requests"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(j,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Requests"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.total})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(f,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o.pending})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(v,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Approved"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.approved})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(N,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Rejected"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.rejected})]})]})})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search requests...",value:n,onChange:s=>q(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:c,onChange:s=>C(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(f,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No requests found"}),e.jsx("p",{className:"text-gray-600",children:n||c!=="all"?"No requests match your search criteria.":"There are no role requests at this time."})]}):r.map(s=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Request #",s.id.substring(0,8)]}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${E(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"User ID:"})," ",s.user_id]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Requested Role:"})," ",e.jsx("span",{className:"capitalize",children:_(s.requested_role)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Submitted:"})," ",new Date(s.created_at).toLocaleString()]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-medium",children:"Reason:"}),e.jsx("p",{className:"mt-1 text-gray-700 whitespace-pre-wrap",children:s.reason})]})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>k(s.id),disabled:p===s.id||A,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 cursor-pointer",children:[e.jsx(v,{className:"h-4 w-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>P(s.id),disabled:p===s.id||F,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 cursor-pointer",children:[e.jsx(N,{className:"h-4 w-4"}),"Reject"]})]})]})},s.id))})]})};export{G as default};
//# sourceMappingURL=RoleRequestManagement-B0rmIioJ.js.map
